/**
 * Copyright Croquet Labs 2026
 * Bundle of @croquet/croquet
 * Date: 2026-02-16
 * Version: 2.0.5-1
 */

var Croquet=function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if("function"==typeof e){var s=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};s.prototype=e.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(s,e,n.get?n:{enumerable:!0,get:function(){return t[e]}})})),s}var i,o={exports:{}};i||(i=1,function(t){var e=function(t){var e,s=Object.prototype,n=s.hasOwnProperty,i=Object.defineProperty||function(t,e,s){t[e]=s.value},o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(t,e,s){return Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,s){return t[e]=s}}function d(t,e,s,n){var o=e&&e.prototype instanceof y?e:y,r=Object.create(o.prototype),a=new k(n||[]);return i(r,"_invoke",{value:G(t,s,a)}),r}function h(t,e,s){try{return{type:"normal",arg:t.call(e,s)}}catch(t){return{type:"throw",arg:t}}}t.wrap=d;var u="suspendedStart",m="suspendedYield",p="executing",f="completed",b={};function y(){}function g(){}function w(){}var Z={};c(Z,r,(function(){return this}));var v=Object.getPrototypeOf,X=v&&v(v(P([])));X&&X!==s&&n.call(X,r)&&(Z=X);var L=w.prototype=y.prototype=Object.create(Z);function x(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function s(i,o,r,a){var l=h(t[i],t,o);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){s("next",t,r,a)}),(function(t){s("throw",t,r,a)})):e.resolve(d).then((function(t){c.value=t,r(c)}),(function(t){return s("throw",t,r,a)}))}a(l.arg)}var o;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){s(t,n,e,i)}))}return o=o?o.then(i,i):i()}})}function G(t,s,n){var i=u;return function(o,r){if(i===p)throw new Error("Generator is already running");if(i===f){if("throw"===o)throw r;return{value:e,done:!0}}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var l=T(a,n);if(l){if(l===b)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===u)throw i=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var c=h(t,s,n);if("normal"===c.type){if(i=n.done?f:m,c.arg===b)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=f,n.method="throw",n.arg=c.arg)}}}function T(t,s){var n=s.method,i=t.iterator[n];if(i===e)return s.delegate=null,"throw"===n&&t.iterator.return&&(s.method="return",s.arg=e,T(t,s),"throw"===s.method)||"return"!==n&&(s.method="throw",s.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var o=h(i,t.iterator,s.arg);if("throw"===o.type)return s.method="throw",s.arg=o.arg,s.delegate=null,b;var r=o.arg;return r?r.done?(s[t.resultName]=r.value,s.next=t.nextLoc,"return"!==s.method&&(s.method="next",s.arg=e),s.delegate=null,b):r:(s.method="throw",s.arg=new TypeError("iterator result is not an object"),s.delegate=null,b)}function W(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(W,this),this.reset(!0)}function P(t){if(null!=t){var s=t[r];if(s)return s.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function s(){for(;++i<t.length;)if(n.call(t,i))return s.value=t[i],s.done=!1,s;return s.value=e,s.done=!0,s};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return g.prototype=w,i(L,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:g,configurable:!0}),g.displayName=c(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,c(t,l,"GeneratorFunction")),t.prototype=Object.create(L),t},t.awrap=function(t){return{__await:t}},x(S.prototype),c(S.prototype,a,(function(){return this})),t.AsyncIterator=S,t.async=function(e,s,n,i,o){void 0===o&&(o=Promise);var r=new S(d(e,s,n,i),o);return t.isGeneratorFunction(s)?r:r.next().then((function(t){return t.done?t.value:r.next()}))},x(L),c(L,l,"Generator"),c(L,r,(function(){return this})),c(L,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),s=[];for(var n in e)s.push(n);return s.reverse(),function t(){for(;s.length;){var n=s.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=P,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var s in this)"t"===s.charAt(0)&&n.call(this,s)&&!isNaN(+s.slice(1))&&(this[s]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var s=this;function i(n,i){return a.type="throw",a.arg=t,s.next=n,i&&(s.method="next",s.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var l=n.call(r,"catchLoc"),c=n.call(r,"finallyLoc");if(l&&c){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=t,r.arg=e,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(r)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var s=this.tryEntries[e];if(s.finallyLoc===t)return this.complete(s.completion,s.afterLoc),C(s),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var s=this.tryEntries[e];if(s.tryLoc===t){var n=s.completion;if("throw"===n.type){var i=n.arg;C(s)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,s,n){return this.delegate={iterator:P(t),resultName:s,nextLoc:n},"next"===this.method&&(this.arg=e),b}},t}(t.exports);try{globalThis.regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(o));const r={CROQUET_VERSION:"2.0.5-1"},a=window&&window.location.hostname.endsWith("croquet.studio");let l="",c="";function d(t,e){if(e)for(const s of e.split("&")){const e=s.split("="),n=e[0];let i=!0;if(e.length>1&&(i=decodeURIComponent(e.slice(1).join("=")),i.match(/^(true|false|null|[0-9.]*|["[{].*)$/)))try{i=JSON.parse(i)}catch(t){"["===i[0]&&(i=i.slice(1,-1).split(","))}t[n]=i}}const h=new class{constructor(){this.getSession(),d(this,window.location.search.slice(1)),d(this,a?window.location.hash.slice(1):c),window.location.pathname.indexOf("/ar.html")>=0&&(this.ar=!0)}has(t,e,s=!1){"string"==typeof s&&(s=this.isHost(s));const n=this[t];if("string"!=typeof n)return s;const i=n.split(",");return!0===s&&(e=`no${e}`),e.endsWith("s")&&(e=e.slice(0,-1)),i.includes(e)||i.includes(`${e}s`)?!s:s}getSession(){if(a){const t=/^\/([^/]+)\/(.*)$/,e=window.location.pathname.match(t);if(e)return l=e[1],e[2]}else{const t=/^#([^&]+)&?(.*)$/,e=window.location.hash.match(t);if(e)return e[1].includes("=")?(c=`${e[1]}&${e[2]}`,""):(c=e[2],e[1])}return"string"==typeof this.session?(c=window.location.hash.slice(1),this.session):""}setSession(t,e=!1){null==a&&this.getSession();const{search:s,hash:n}=window.location,i=a?`/${l}/${t}${s}${n}`:`#${t}${c?"&"+c:""}`;e?window.history.replaceState({},"",i):window.history.pushState({},"",i)}isHost(t){const e=window.location.hostname;if(e===t)return!0;if("localhost"!==t)return!1;if(e.endsWith(".ngrok.io"))return!0;if("croquet.io"===e){if(window.location.pathname.match(/^\/(dev|files)\//))return!0}return"file:"===window.location.protocol||["127.0.0.1","[::1]"].includes(e)}isLocalhost(){return this.isHost("localhost")}};var u,m={exports:{}};var p,f,b,y,g=(u||(u=1,f=m.exports,b=function(t){var e=function(t){return new e.lib.init(t)};function s(t,e){return e.offset[t]?isNaN(e.offset[t])?e.offset[t]:e.offset[t]+"px":"0px"}function n(t,e){return!(!t||"string"!=typeof e||!(t.className&&t.className.trim().split(/\s+/gi).indexOf(e)>-1))}return e.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},e.lib=e.prototype={toastify:"1.12.0",constructor:e,init:function(t){return t||(t={}),this.options={},this.toastElement=null,this.options.text=t.text||e.defaults.text,this.options.node=t.node||e.defaults.node,this.options.duration=0===t.duration?0:t.duration||e.defaults.duration,this.options.selector=t.selector||e.defaults.selector,this.options.callback=t.callback||e.defaults.callback,this.options.destination=t.destination||e.defaults.destination,this.options.newWindow=t.newWindow||e.defaults.newWindow,this.options.close=t.close||e.defaults.close,this.options.gravity="bottom"===t.gravity?"toastify-bottom":e.defaults.gravity,this.options.positionLeft=t.positionLeft||e.defaults.positionLeft,this.options.position=t.position||e.defaults.position,this.options.backgroundColor=t.backgroundColor||e.defaults.backgroundColor,this.options.avatar=t.avatar||e.defaults.avatar,this.options.className=t.className||e.defaults.className,this.options.stopOnFocus=void 0===t.stopOnFocus?e.defaults.stopOnFocus:t.stopOnFocus,this.options.onClick=t.onClick||e.defaults.onClick,this.options.offset=t.offset||e.defaults.offset,this.options.escapeMarkup=void 0!==t.escapeMarkup?t.escapeMarkup:e.defaults.escapeMarkup,this.options.ariaLive=t.ariaLive||e.defaults.ariaLive,this.options.style=t.style||e.defaults.style,t.backgroundColor&&(this.options.style.background=t.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var t=document.createElement("div");for(var e in t.className="toastify on "+this.options.className,this.options.position?t.className+=" toastify-"+this.options.position:!0===this.options.positionLeft?(t.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):t.className+=" toastify-right",t.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.'),this.options.style)t.style[e]=this.options.style[e];if(this.options.ariaLive&&t.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)t.appendChild(this.options.node);else if(this.options.escapeMarkup?t.innerText=this.options.text:t.innerHTML=this.options.text,""!==this.options.avatar){var n=document.createElement("img");n.src=this.options.avatar,n.className="toastify-avatar","left"==this.options.position||!0===this.options.positionLeft?t.appendChild(n):t.insertAdjacentElement("afterbegin",n)}if(!0===this.options.close){var i=document.createElement("button");i.type="button",i.setAttribute("aria-label","Close"),i.className="toast-close",i.innerHTML="&#10006;",i.addEventListener("click",function(t){t.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}.bind(this));var o=window.innerWidth>0?window.innerWidth:screen.width;("left"==this.options.position||!0===this.options.positionLeft)&&o>360?t.insertAdjacentElement("afterbegin",i):t.appendChild(i)}if(this.options.stopOnFocus&&this.options.duration>0){var r=this;t.addEventListener("mouseover",(function(e){window.clearTimeout(t.timeOutValue)})),t.addEventListener("mouseleave",(function(){t.timeOutValue=window.setTimeout((function(){r.removeElement(t)}),r.options.duration)}))}if(void 0!==this.options.destination&&t.addEventListener("click",function(t){t.stopPropagation(),!0===this.options.newWindow?window.open(this.options.destination,"_blank"):window.location=this.options.destination}.bind(this)),"function"==typeof this.options.onClick&&void 0===this.options.destination&&t.addEventListener("click",function(t){t.stopPropagation(),this.options.onClick()}.bind(this)),"object"==typeof this.options.offset){var a=s("x",this.options),l=s("y",this.options),c="left"==this.options.position?a:"-"+a,d="toastify-top"==this.options.gravity?l:"-"+l;t.style.transform="translate("+c+","+d+")"}return t},showToast:function(){var t;if(this.toastElement=this.buildToast(),!(t="string"==typeof this.options.selector?document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||"undefined"!=typeof ShadowRoot&&this.options.selector instanceof ShadowRoot?this.options.selector:document.body))throw"Root element is not defined";var s=e.defaults.oldestFirst?t.firstChild:t.lastChild;return t.insertBefore(this.toastElement,s),e.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout(function(){this.removeElement(this.toastElement)}.bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(t){t.className=t.className.replace(" on",""),window.setTimeout(function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),t.parentNode&&t.parentNode.removeChild(t),this.options.callback.call(t),e.reposition()}.bind(this),400)}},e.reposition=function(){for(var t,e={top:15,bottom:15},s={top:15,bottom:15},i={top:15,bottom:15},o=document.getElementsByClassName("toastify"),r=0;r<o.length;r++){t=!0===n(o[r],"toastify-top")?"toastify-top":"toastify-bottom";var a=o[r].offsetHeight;t=t.substr(9,t.length-1),(window.innerWidth>0?window.innerWidth:screen.width)<=360?(o[r].style[t]=i[t]+"px",i[t]+=a+15):!0===n(o[r],"toastify-left")?(o[r].style[t]=e[t]+"px",e[t]+=a+15):(o[r].style[t]=s[t]+"px",s[t]+=a+15)}return this},e.lib.init.prototype=e.lib,e},(p=m).exports?p.exports=b():f.Toastify=b()),m.exports),w=s(g),Z=256,v=Math.pow(Z,6),X=Math.pow(2,52),L=2*X,x=255;function S(t,e){var s=[];if((e=e||{}).entropy)throw new Error("this version of seedrandom does not support entropy");if(null==t&&!e.state)throw new Error("this version of seedrandom requires a seed");!function(t,e){var s,n=t+"",i=0;for(;i<n.length;)e[x&i]=x&(s^=19*e[x&i])+n.charCodeAt(i++);return o=e,String.fromCharCode.apply(0,o);var o}(W(t,3),s);var n=new G(s),i=function(){for(var t=n.g(6),e=v,s=0;t<X;)t=(t+s)*Z,e*=Z,s=n.g(1);for(;t>=L;)t/=2,e/=2,s>>>=1;return(t+s)/e};return i.int32=function(){return 0|n.g(4)},i.quick=function(){return n.g(4)/4294967296},i.double=i,(e.pass||function(t,e){return e&&(e.S&&T(e,n),t.state=function(){return T(n,{})}),t})(i,e.state)}function G(t){var e,s=t.length,n=this,i=0,o=n.i=n.j=0,r=n.S=[];for(s||(t=[s++]);i<Z;)r[i]=i++;for(i=0;i<Z;i++)r[i]=r[o=x&o+t[i%s]+(e=r[i])],r[o]=e;(n.g=function(t){for(var e,s=0,i=n.i,o=n.j,r=n.S;t--;)e=r[i=x&i+1],s=s*Z+r[x&(r[i]=r[o=x&o+e])+(r[o]=e)];return n.i=i,n.j=o,s})(Z)}function T(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function W(t,e){var s,n=[],i=typeof t;if(e&&"object"==i)for(s in t)try{n.push(W(t[s],e-1))}catch(t){}return n.length?n:"string"==i?t:t+"\0"}!function(){function t(t){this.mode=s.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,n=this.data.length;e<n;e++){var i=[],o=this.data.charCodeAt(e);o>65536?(i[0]=240|(1835008&o)>>>18,i[1]=128|(258048&o)>>>12,i[2]=128|(4032&o)>>>6,i[3]=128|63&o):o>2048?(i[0]=224|(61440&o)>>>12,i[1]=128|(4032&o)>>>6,i[2]=128|63&o):o>128?(i[0]=192|(1984&o)>>>6,i[1]=128|63&o):i[0]=o,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,s=this.parsedData.length;e<s;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var s=new t(e);this.dataList.push(s),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,s){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[n][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,s),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,s)},setupPositionProbePattern:function(t,e){for(var s=-1;s<=7;s++)if(!(t+s<=-1||this.moduleCount<=t+s))for(var n=-1;n<=7;n++)e+n<=-1||this.moduleCount<=e+n||(this.modules[t+s][e+n]=0<=s&&s<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==s||6==s)||2<=s&&s<=4&&2<=n&&n<=4)},getBestMaskPattern:function(){for(var t=0,e=0,s=0;s<8;s++){this.makeImpl(!0,s);var n=u.getLostPoint(this);(0==s||t>n)&&(t=n,e=s)}return e},createMovieClip:function(t,e,s){var n=t.createEmptyMovieClip(e,s);this.make();for(var i=0;i<this.modules.length;i++)for(var o=1*i,r=0;r<this.modules[i].length;r++){var a=1*r;this.modules[i][r]&&(n.beginFill(0,100),n.moveTo(a,o),n.lineTo(a+1,o),n.lineTo(a+1,o+1),n.lineTo(a,o+1),n.endFill())}return n},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=u.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var s=0;s<t.length;s++){var n=t[e],i=t[s];if(null==this.modules[n][i])for(var o=-2;o<=2;o++)for(var r=-2;r<=2;r++)this.modules[n+o][i+r]=-2==o||2==o||-2==r||2==r||0==o&&0==r}},setupTypeNumber:function(t){for(var e=u.getBCHTypeNumber(this.typeNumber),s=0;s<18;s++){var n=!t&&1==(e>>s&1);this.modules[Math.floor(s/3)][s%3+this.moduleCount-8-3]=n}for(s=0;s<18;s++){n=!t&&1==(e>>s&1);this.modules[s%3+this.moduleCount-8-3][Math.floor(s/3)]=n}},setupTypeInfo:function(t,e){for(var s=this.errorCorrectLevel<<3|e,n=u.getBCHTypeInfo(s),i=0;i<15;i++){var o=!t&&1==(n>>i&1);i<6?this.modules[i][8]=o:i<8?this.modules[i+1][8]=o:this.modules[this.moduleCount-15+i][8]=o}for(i=0;i<15;i++){o=!t&&1==(n>>i&1);i<8?this.modules[8][this.moduleCount-i-1]=o:i<9?this.modules[8][15-i-1+1]=o:this.modules[8][15-i-1]=o}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var s=-1,n=this.moduleCount-1,i=7,o=0,r=this.moduleCount-1;r>0;r-=2)for(6==r&&r--;;){for(var a=0;a<2;a++)if(null==this.modules[n][r-a]){var l=!1;o<t.length&&(l=1==(t[o]>>>i&1)),u.getMask(e,n,r-a)&&(l=!l),this.modules[n][r-a]=l,-1==--i&&(o++,i=7)}if((n+=s)<0||this.moduleCount<=n){n-=s,s=-s;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,s,n){for(var i=b.getRSBlocks(t,s),o=new g,r=0;r<n.length;r++){var a=n[r];o.put(a.mode,4),o.put(a.getLength(),u.getLengthInBits(a.mode,t)),a.write(o)}var l=0;for(r=0;r<i.length;r++)l+=i[r].dataCount;if(o.getLengthInBits()>8*l)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*l+")");for(o.getLengthInBits()+4<=8*l&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(!1);for(;!(o.getLengthInBits()>=8*l||(o.put(e.PAD0,8),o.getLengthInBits()>=8*l));)o.put(e.PAD1,8);return e.createBytes(o,i)},e.createBytes=function(t,e){for(var s=0,n=0,i=0,o=new Array(e.length),r=new Array(e.length),a=0;a<e.length;a++){var l=e[a].dataCount,c=e[a].totalCount-l;n=Math.max(n,l),i=Math.max(i,c),o[a]=new Array(l);for(var d=0;d<o[a].length;d++)o[a][d]=255&t.buffer[d+s];s+=l;var h=u.getErrorCorrectPolynomial(c),m=new f(o[a],h.getLength()-1).mod(h);r[a]=new Array(h.getLength()-1);for(d=0;d<r[a].length;d++){var p=d+m.getLength()-r[a].length;r[a][d]=p>=0?m.get(p):0}}var b=0;for(d=0;d<e.length;d++)b+=e[d].totalCount;var y=new Array(b),g=0;for(d=0;d<n;d++)for(a=0;a<e.length;a++)d<o[a].length&&(y[g++]=o[a][d]);for(d=0;d<i;d++)for(a=0;a<e.length;a++)d<r[a].length&&(y[g++]=r[a][d]);return y};for(var s={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},n={L:1,M:0,Q:3,H:2},i=0,o=1,r=2,a=3,l=4,c=5,d=6,h=7,u={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;u.getBCHDigit(e)-u.getBCHDigit(u.G15)>=0;)e^=u.G15<<u.getBCHDigit(e)-u.getBCHDigit(u.G15);return(t<<10|e)^u.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;u.getBCHDigit(e)-u.getBCHDigit(u.G18)>=0;)e^=u.G18<<u.getBCHDigit(e)-u.getBCHDigit(u.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return u.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,s){switch(t){case i:return(e+s)%2==0;case o:return e%2==0;case r:return s%3==0;case a:return(e+s)%3==0;case l:return(Math.floor(e/2)+Math.floor(s/3))%2==0;case c:return e*s%2+e*s%3==0;case d:return(e*s%2+e*s%3)%2==0;case h:return(e*s%3+(e+s)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new f([1],0),s=0;s<t;s++)e=e.multiply(new f([1,m.gexp(s)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case s.MODE_NUMBER:return 10;case s.MODE_ALPHA_NUM:return 9;case s.MODE_8BIT_BYTE:case s.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case s.MODE_NUMBER:return 12;case s.MODE_ALPHA_NUM:return 11;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case s.MODE_NUMBER:return 14;case s.MODE_ALPHA_NUM:return 13;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),s=0,n=0;n<e;n++)for(var i=0;i<e;i++){for(var o=0,r=t.isDark(n,i),a=-1;a<=1;a++)if(!(n+a<0||e<=n+a))for(var l=-1;l<=1;l++)i+l<0||e<=i+l||0==a&&0==l||r==t.isDark(n+a,i+l)&&o++;o>5&&(s+=3+o-5)}for(n=0;n<e-1;n++)for(i=0;i<e-1;i++){var c=0;t.isDark(n,i)&&c++,t.isDark(n+1,i)&&c++,t.isDark(n,i+1)&&c++,t.isDark(n+1,i+1)&&c++,0!=c&&4!=c||(s+=3)}for(n=0;n<e;n++)for(i=0;i<e-6;i++)t.isDark(n,i)&&!t.isDark(n,i+1)&&t.isDark(n,i+2)&&t.isDark(n,i+3)&&t.isDark(n,i+4)&&!t.isDark(n,i+5)&&t.isDark(n,i+6)&&(s+=40);for(i=0;i<e;i++)for(n=0;n<e-6;n++)t.isDark(n,i)&&!t.isDark(n+1,i)&&t.isDark(n+2,i)&&t.isDark(n+3,i)&&t.isDark(n+4,i)&&!t.isDark(n+5,i)&&t.isDark(n+6,i)&&(s+=40);var d=0;for(i=0;i<e;i++)for(n=0;n<e;n++)t.isDark(n,i)&&d++;return s+=10*(Math.abs(100*d/e/e-50)/5)}},m={glog:function(t){if(t<1)throw new Error("glog("+t+")");return m.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return m.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},p=0;p<8;p++)m.EXP_TABLE[p]=1<<p;for(p=8;p<256;p++)m.EXP_TABLE[p]=m.EXP_TABLE[p-4]^m.EXP_TABLE[p-5]^m.EXP_TABLE[p-6]^m.EXP_TABLE[p-8];for(p=0;p<255;p++)m.LOG_TABLE[m.EXP_TABLE[p]]=p;function f(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var s=0;s<t.length&&0==t[s];)s++;this.num=new Array(t.length-s+e);for(var n=0;n<t.length-s;n++)this.num[n]=t[n+s]}function b(t,e){this.totalCount=t,this.dataCount=e}function g(){this.buffer=[],this.length=0}f.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),s=0;s<this.getLength();s++)for(var n=0;n<t.getLength();n++)e[s+n]^=m.gexp(m.glog(this.get(s))+m.glog(t.get(n)));return new f(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=m.glog(this.get(0))-m.glog(t.get(0)),s=new Array(this.getLength()),n=0;n<this.getLength();n++)s[n]=this.get(n);for(n=0;n<t.getLength();n++)s[n]^=m.gexp(m.glog(t.get(n))+e);return new f(s,0).mod(t)}},b.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],b.getRSBlocks=function(t,e){var s=b.getRsBlockTable(t,e);if(null==s)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var n=s.length/3,i=[],o=0;o<n;o++)for(var r=s[3*o+0],a=s[3*o+1],l=s[3*o+2],c=0;c<r;c++)i.push(new b(a,l));return i},b.getRsBlockTable=function(t,e){switch(e){case n.L:return b.RS_BLOCK_TABLE[4*(t-1)+0];case n.M:return b.RS_BLOCK_TABLE[4*(t-1)+1];case n.Q:return b.RS_BLOCK_TABLE[4*(t-1)+2];case n.H:return b.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},g.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var s=0;s<e;s++)this.putBit(1==(t>>>e-s-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var w=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],Z=function(){var t=function(t,e){this._bIsPainted=!1,this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};return t.prototype.draw=function(t){var e=this._oContext,s=this._htOption,n=t.getModuleCount(),i=s.width/n,o=s.height/n,r=Math.round(i),a=Math.round(o);this.clear();for(var l=0;l<n;l++)for(var c=0;c<n;c++){var d=t.isDark(l,c),h=c*i,u=l*o;e.strokeStyle=d?s.colorDark:s.colorLight,e.lineWidth=1,e.fillStyle=d?s.colorDark:s.colorLight,e.fillRect(h,u,i,o),e.strokeRect(Math.floor(h)+.5,Math.floor(u)+.5,r,a),e.strokeRect(Math.ceil(h)-.5,Math.ceil(u)-.5,r,a)}this._bIsPainted=!0},t.prototype.isPainted=function(){return this._bIsPainted},t.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},t.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},t}();function v(t,e){for(var s=1,i=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),o=0,r=w.length;o<=r;o++){var a=0;switch(e){case n.L:a=w[o][0];break;case n.M:a=w[o][1];break;case n.Q:a=w[o][2];break;case n.H:a=w[o][3]}if(i<=a)break;s++}if(s>w.length)throw new Error("Too long data");return s}y=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:n.H},"string"==typeof e&&(e={text:e}),e)for(var s in e)this._htOption[s]=e[s];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(Z=svgDrawer),this._el=t,this._oQRCode=null,this._oDrawing=new Z(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},y.prototype.makeCode=function(t){this._oQRCode=new e(v(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._oDrawing.draw(this._oQRCode)},y.prototype.clear=function(){this._oDrawing.clear()},y.prototype.getCanvas=function(){for(let t=0;t<this._el.children.length;t++){const e=this._el.children[t];if("CANVAS"===e.tagName)return e}return null},y.CorrectLevel=n}();var C,k,P=y;var V=s(k?C:(k=1,C=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var s,n="boolean"==typeof e.cycles&&e.cycles,i=e.cmp&&(s=e.cmp,function(t){return function(e,n){var i={key:e,value:t[e]},o={key:n,value:t[n]};return s(i,o)}}),o=[];return function t(e){if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0!==e){if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);var s,r;if(Array.isArray(e)){for(r="[",s=0;s<e.length;s++)s&&(r+=","),r+=t(e[s])||"null";return r+"]"}if(null===e)return"null";if(-1!==o.indexOf(e)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=o.push(e)-1,l=Object.keys(e).sort(i&&i(e));for(r="",s=0;s<l.length;s++){var c=l[s],d=t(e[c]);d&&(r&&(r+=","),r+=JSON.stringify(c)+":"+d)}return o.splice(a,1),"{"+r+"}"}}(t)})),I={exports:{}};var M,R={exports:{}},Y=n(Object.freeze({__proto__:null,default:{}}));function N(){return M||(M=1,function(t){var s;t.exports=(s=s||function(t,s){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==e&&e.crypto&&(n=e.crypto),!n)try{n=Y}catch(t){}var i=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function t(){}return function(e){var s;return t.prototype=e,s=new t,t.prototype=null,s}}(),r={},a=r.lib={},l=a.Base={extend:function(t){var e=o(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=l.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=e!=s?e:4*t.length},toString:function(t){return(t||h).stringify(this)},concat:function(t){var e=this.words,s=t.words,n=this.sigBytes,i=t.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var r=s[o>>>2]>>>24-o%4*8&255;e[n+o>>>2]|=r<<24-(n+o)%4*8}else for(var a=0;a<i;a+=4)e[n+a>>>2]=s[a>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,s=this.sigBytes;e[s>>>2]&=4294967295<<32-s%4*8,e.length=t.ceil(s/4)},clone:function(){var t=l.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],s=0;s<t;s+=4)e.push(i());return new c.init(e,t)}}),d=r.enc={},h=d.Hex={stringify:function(t){for(var e=t.words,s=t.sigBytes,n=[],i=0;i<s;i++){var o=e[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,s=[],n=0;n<e;n+=2)s[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new c.init(s,e/2)}},u=d.Latin1={stringify:function(t){for(var e=t.words,s=t.sigBytes,n=[],i=0;i<s;i++){var o=e[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(t){for(var e=t.length,s=[],n=0;n<e;n++)s[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new c.init(s,e)}},m=d.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},p=a.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=m.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var s,n=this._data,i=n.words,o=n.sigBytes,r=this.blockSize,a=o/(4*r),l=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*r,d=t.min(4*l,o);if(l){for(var h=0;h<l;h+=r)this._doProcessBlock(i,h);s=i.splice(0,l),n.sigBytes-=d}return new c.init(s,d)},clone:function(){var t=l.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});a.Hasher=p.extend({cfg:l.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,s){return new t.init(s).finalize(e)}},_createHmacHelper:function(t){return function(e,s){return new f.HMAC.init(t,s).finalize(e)}}});var f=r.algo={};return r}(Math),s)}(R)),R.exports}var H;var K,_=(H||(H=1,function(t){var e;t.exports=(e=N(),function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,s=t.init,n=t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var e=t.byteLength,n=[],i=0;i<e;i++)n[i>>>2]|=t[i]<<24-i%4*8;s.call(this,n,e)}else s.apply(this,arguments)};n.prototype=t}}(),e.lib.WordArray)}(I)),I.exports),z=s(_),F={exports:{}};function E(){return K||(K=1,function(t){var e;t.exports=(e=N(),function(t){var s=e,n=s.lib,i=n.WordArray,o=n.Hasher,r=s.algo,a=[],l=[];!function(){function e(e){for(var s=t.sqrt(e),n=2;n<=s;n++)if(!(e%n))return!1;return!0}function s(t){return 4294967296*(t-(0|t))|0}for(var n=2,i=0;i<64;)e(n)&&(i<8&&(a[i]=s(t.pow(n,.5))),l[i]=s(t.pow(n,1/3)),i++),n++}();var c=[],d=r.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(t,e){for(var s=this._hash.words,n=s[0],i=s[1],o=s[2],r=s[3],a=s[4],d=s[5],h=s[6],u=s[7],m=0;m<64;m++){if(m<16)c[m]=0|t[e+m];else{var p=c[m-15],f=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,b=c[m-2],y=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;c[m]=f+c[m-7]+y+c[m-16]}var g=n&i^n&o^i&o,w=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),Z=u+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&d^~a&h)+l[m]+c[m];u=h,h=d,d=a,a=r+Z|0,r=o,o=i,i=n,n=Z+(w+g)|0}s[0]=s[0]+n|0,s[1]=s[1]+i|0,s[2]=s[2]+o|0,s[3]=s[3]+r|0,s[4]=s[4]+a|0,s[5]=s[5]+d|0,s[6]=s[6]+h|0,s[7]=s[7]+u|0},_doFinalize:function(){var e=this._data,s=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return s[i>>>5]|=128<<24-i%32,s[14+(i+64>>>9<<4)]=t.floor(n/4294967296),s[15+(i+64>>>9<<4)]=n,e.sigBytes=4*s.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});s.SHA256=o._createHelper(d),s.HmacSHA256=o._createHmacHelper(d)}(Math),e.SHA256)}(F)),F.exports}var j=s(E());const J="node"===r.CROQUET_PLATFORM;let Q;function U(t){const e=t.sigBytes,s=t.words,n=new Uint8Array(e);let i=0,o=0;for(;i<e;){const t=s[o++];if(n[i++]=(4278190080&t)>>>24,i===e)break;if(n[i++]=(16711680&t)>>>16,i===e)break;if(n[i++]=(65280&t)>>>8,i===e)break;n[i++]=255&t}return n}function D(t){function e(t){const e=t.indexOf("{"),s=t.lastIndexOf("}");if(-1===e||-1===s||s<e)return t;const n=t.slice(0,e).replace(/\s+/g," ").replace(/\s\(/,"("),i=t.slice(e+1,s);return`${n.trim()}{${i.trim()}}`}let s=e(""+t);if(!s.startsWith("class")){const n=t.prototype;n&&(s+=Object.getOwnPropertyNames(n).map((t=>`${t}:${e(""+n[t])}`)).join(""))}return s}function O(t){return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function B(){return h.has("debug","hashing",!1)}Q=globalThis.crypto&&globalThis.crypto.subtle&&"function"==typeof globalThis.crypto.subtle.digest?globalThis.crypto.subtle.digest.bind(globalThis.crypto.subtle):(t,e)=>{if("SHA-256"!==t)throw Error(`${qt.libName}: only SHA-256 available`);const s=z.create(e);return U(j(s)).buffer};let A={};const $=new TextEncoder;async function q(t){const e=$.encode(t),s=await async function(t){return 0===t.length?"47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU":O(await Q("SHA-256",t))}(e);return A[s]={string:t,buffer:e},s}const tt=[],et={};const st=new Set;const nt=Date.now();"undefined"==typeof performance&&(window.performance={now:()=>Date.now()-nt});const it=["simulate","update","render","snapshot"],ot={total:"black",update:"blue",render:"magenta",simulate:"yellow",snapshot:"green",backlog:"red",network:"lightgray"};let rt,at,lt=null,ct=null,dt=null,ht=0,ut=null,mt=null;function pt(t){for(lt=t;t.firstChild;)t.removeChild(t.firstChild);t.style.background="#faf0dc",ut=document.createElement("canvas"),mt=ut.getContext("2d"),ut.id="text_stats",ut.width=Math.min(140,window.innerWidth),ut.height=36,ut.style.width=ut.width,ut.style.height=ut.height,mt.font="9.5pt sans-serif",t.appendChild(ut),t.title=Object.entries(ot).map((([t,e])=>`${e}: ${t}`)).join("\n"),ct=document.createElement("canvas"),ct.width=Math.min(125,window.innerWidth),ct.height=125,ct.style.width="100%";const e=document.createElement("div");e.id="innerDiv",t.appendChild(e),e.appendChild(ct),dt=ct.getContext("2d")}const ft=[];let bt=0,yt=!1,gt=Xt(0);const wt=1e3/60;function Zt(t){return 20*(1-t/wt)+60}function vt(t){rt=function(t){const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.style.width="100%",e.style.position="absolute",e.style.left="0px",lt.querySelector("#innerDiv").appendChild(e),e}(t),at=rt.getContext("2d"),at.strokeStyle="rgba(255, 255, 255, 0.5)";for(let t=0;t<60;t+=wt){const e=Zt(t);at.moveTo(0,e),at.lineTo(rt.width,e),at.stroke()}}function Xt(t){return{start:t,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:yt}}function Lt(t){gt.total=t-gt.start;const e=Math.min(120,window.innerWidth);if(ft.length>=e&&ft.splice(0,ft.length-e+1),ft.push(gt),ft.length<=1)return;if(!lt)return;if(0===lt.offsetHeight)return;const s=ft.slice(1).filter((t=>t.total)),n=s.map((t=>t.total)).reduce(((t,e)=>t+e),0)/s.length,i=Math.max(...s.map((t=>t.total)));Math.max(...s.map((t=>Math.max(t.backlog,t.network)))),bt=1e3,function(t,e){mt.globalCompositeOperation="copy",mt.fillStyle="rgb(255, 255, 255, 0)",mt.fillRect(0,0,ut.width,ut.height),mt.fillStyle="rgb(0, 0, 0, 1)",mt.globalCompositeOperation="source-over";let s=`${gt.users} users, ${Math.round(1e3/t)} fps`;e>70&&(s+=` ${Math.ceil(e).toLocaleString()}ms`),mt.fillText(s,2,15),s=gt.backlog<100&&gt.activity<1e3?`latency: ${gt.latency} ms`:`backlog: ${gt.backlog<100?"0.0":(gt.backlog/1e3).toFixed(1)} s`,mt.fillText(s,2,33)}(n,i),rt||vt(ct),ht===ct.width?(dt.globalCompositeOperation="copy",dt.drawImage(ct,1,0,ct.width-1,ct.height,0,0,ct.width-1,ct.height),dt.globalCompositeOperation="source-over",dt.fillStyle="transparent",dt.fillRect(ct.width-1,0,1,ct.height)):ht++;const o=t=>Zt(t/bt*-2*wt)+5;{const t=ft[ft.length-1],e=ht-.5;let s=Zt(0);dt.beginPath(),dt.moveTo(e,s),dt.lineTo(e,Zt(t.total)),dt.strokeStyle=ot[t.connected?"total":"network"],dt.stroke(),dt.beginPath(),dt.moveTo(e,s),s=Zt(t.total);let n=0;for(const i of it)t.items[i]&&(n+=t.items[i],s=Zt(n),dt.lineTo(e,s),dt.strokeStyle=ot[i],dt.stroke(),dt.beginPath(),dt.moveTo(e,s));t.network&&(dt.beginPath(),dt.moveTo(e,o(0)),dt.lineTo(e,o(t.network)),dt.strokeStyle=ot.network,dt.stroke())}}const xt=[],St={};let Gt={};const Tt={frames:ft,animationFrame(t,e={}){Lt(t),gt=Xt(t);for(const[t,s]of Object.entries(e))this[t](s)},begin(t){const e=performance.now();gt.items[t]=(gt.items[t]||0)-e;const s=xt[xt.length-1];return s&&(gt.items[s]+=e),xt.push(t),e},end(t){const e=performance.now();gt.items[t]+=e;const s=xt.pop();if(s!==t)throw Error(`Unmatched stats calls: expected end("${s}"), got end("${t}")`);const n=xt[xt.length-1];return n&&(gt.items[n]-=e),e},backlog(t){gt.backlog=Math.max(t,gt.backlog)},starvation(t){gt.network=t},latency(t){gt.latency=t},activity(t){gt.activity=t},users(t){gt.users=t},connected(t){const e=yt;gt.connected=yt=t,e&&!yt&&rt&&(rt.remove(),at=null)},networkTraffic:St,addNetworkTraffic(t,e,s=!1){St[t]=(St[t]||0)+e,s&&(St[`audit_${t}`]=(St[`audit_${t}`]||0)+e)},resetAuditStats(){for(const t in St)t.startsWith("audit_")&&(St[t]=0)},perSecondTally(t={}){if(window.logMessageStats)for(const[e,s]of Object.entries(t))Gt[e]=(Gt[e]||0)+s},stepSession(t,e=!1){const s=Math.floor(Date.now()/1e3);if(!window.logMessageStats)return Gt={second:s},null;let n=null;if(s!==Gt.second){if(Gt.second&&e&&(Gt.requestedMessages||Gt.sentMessagesTotal)){n={...Gt};const t=s-Gt.second;1!==t&&(n.sampleSeconds=t),n.sentBundles&&(n.averageDelay=Math.round(10*n.sendDelay/n.sentMessagesTotal)/10,n.averageBundlePayload=Math.round(n.sentBundlePayload/n.sentBundles)),delete n.second,delete n.sendDelay,delete n.sentBundlePayload}Gt={second:s}}return n}};globalThis.CROQUETSTATS=Tt;const Wt="ontouchstart"in document.documentElement,Ct=window&&window.parent!==window,kt=Wt?20:12,Pt=Wt?0:15;let Vt=!1;let It=!1;let Mt,Rt=!1;function Yt(t,e={}){return t&&qt.showMessage(t,{...e,level:"warning"})}function Nt(t,e={}){return t&&qt.showMessage(t,{...e,level:"status"})}function Ht(t,e,s="error"){console.error(`Error during ${t}`,e);const n=(e.stack||"").split("\n").filter((t=>!t.match(/croquet-.*\.min.js/))).join("\n");qt.showMessage(`Error during ${t}: ${e.message}\n\n${n}`,{level:s,duration:"error"===s?1e4:void 0,stopOnFocus:!0})}try{if(Mt=window.localStorage,Mt["croquet-debug-persist-allowed"]="true","true"!==Mt["croquet-debug-persist-allowed"])throw Error("localStorage not persisted");delete Mt["croquet-debug-persist-allowed"]}catch(ta){console.warn("localStorage not allowed"),Mt={}}const Kt={get pinned(){return"true"===Mt[window.location.pathname+"/croquet-debug-ui-pinned"]},set pinned(t){Mt[window.location.pathname+"/croquet-debug-ui-pinned"]=!!t},get activePage(){return Mt[window.location.pathname+"/croquet-debug-ui-activePage"]},set activePage(t){Mt[window.location.pathname+"/croquet-debug-ui-activePage"]=t}},_t=t=>{t.preventDefault(),t.stopPropagation()};function zt(t,e,s){const n=document.createElement("canvas"),i=n.width=40*kt/12,o=n.height=60,r=n.getContext("2d");r.font="36px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="black",r.fillText(t,i/2,.55*o);const a=document.createElement("button");a.id=e,a.className="croquet_dock_button";const l=t=>{t.preventDefault(),t.stopPropagation(),s()};return Wt?(a.ontouchstart=l,a.ontouchend=_t,a.onpointerdown=_t,a.onpointerup=_t):(a.onclick=l,a.onpointerdown=_t,a.onpointerup=_t),a.appendChild(n),a}function Ft(t,e){if(!1===qt.badge)return;const s=function(t){const e=new S(t),s=["bcdfghjklmnpqrstvwxyz","aeiou"];let n="";for(let t=0;t<5;t++)n+=s[t%2][e.quick()*s[t%2].length|0];return n}(e);for(document.title=document.title.replace(/:.*/,""),document.title+=":"+s;t.firstChild;)t.removeChild(t.firstChild);const n=document.createElement("canvas"),i=n.width=120,o=n.height=40;n.style.width="100%",t.appendChild(n);const r=n.getContext("2d"),a=function(t,e=1){const s=new S(t),n=[];for(let t=0;t<e;t++)n.push(`hsl(${360*s.quick()}, 50%, 70%)`);return n}(e,2);r.fillStyle=a[0],r.beginPath(),r.moveTo(0,0),r.lineTo(0,o),r.lineTo(i,0),r.closePath(),r.fill(),r.fillStyle=a[1],r.beginPath(),r.moveTo(i,o),r.lineTo(i,0),r.lineTo(0,o),r.closePath(),r.fill(),r.font="30px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="black",r.fillText(s,i/2,o/2)}function Et(t,e,s={}){for(;t.firstChild;)t.removeChild(t.firstChild);return new P(t,{text:e,width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:P.CorrectLevel.L,...s})}function jt(){if(!1===qt.root||!1===qt.qrcode)return;if(h.noqr)return;const t=qt.sessionURL;if(!t)return void console.warn("App.sessionURL is not set");const e=Ot(qt.qrcode);if(!e)return;Wt||(e.onclick=e=>{e.preventDefault(),e.stopPropagation(),e.shiftKey?function(){const t=document.getElementById("croquet_dock");t&&t.classList.toggle("debug")}():window.open(t)});Et(e,t).getCanvas().style.width="100%"}let Jt,Qt,Ut=0;function Dt(){!function(){if(It)return;It=!0;const t=`\n        ${Ct?"body { min-height: 100vh }":""}\n        #croquet_spinnerOverlay {\n            z-index: 1000;\n            position: fixed;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            background-color:#333;\n            opacity:0.9;\n            display:flex;\n            align-items:center;\n            justify-content:center;\n            transition: opacity 1.0s ease-out;\n        }\n        /* https://github.com/lukehaas/css-loaders */\n        @keyframes croquet_dots {\n            0%, 80%, 100% { box-shadow: 0 2.5em 0 -1.3em; }\n            40% { box-shadow: 0 2.5em 0 0; }\n        }\n        #croquet_loader,\n        #croquet_loader::before,\n        #croquet_loader::after {\n          border-radius: 50%;\n          width: 2.5em;\n          height: 2.5em;\n          animation: croquet_dots 1.8s infinite ease-in-out;\n        }\n        #croquet_loader {\n          color: #fff;\n          font-size: 10px;\n          margin: 80px auto;\n          position: relative;\n          text-indent: -9999em;\n          animation-delay: -0.16s;\n        }\n        #croquet_loader::before,\n        #croquet_loader::after {\n          content: '';\n          position: absolute;\n          top: 0;\n        }\n        #croquet_loader::before { left: -3.5em; animation-delay: -0.32s; }\n        #croquet_loader::after { left: 3.5em; }\n        #croquet_spinnerOverlay.croquet_error>*,\n        #croquet_spinnerOverlay.croquet_error>*::before,\n        #croquet_spinnerOverlay.croquet_error>*::after {\n            color: #f00;\n        }\n        #croquet_spinnerOverlay.croquet_fatal>*,\n        #croquet_spinnerOverlay.croquet_fatal>*::before,\n        #croquet_spinnerOverlay.croquet_fatal>*::after {\n            color: #f00;\n            box-shadow: 0 2.5em 0 0 !important;\n            animation: none !important;\n        }\n`,e=document.createElement("style");e.innerHTML=t,document.head.insertBefore(e,document.head.querySelector("style,link[rel=stylesheet]"))}();const t=document.createElement("div");t.id="croquet_spinnerOverlay";const e=document.createElement("div");return e.id="croquet_loader",e.innerText="Catching up...",t.appendChild(e),t}function Ot(t,e){if(!1===t)return!1;if(t instanceof Element)return t;if("string"==typeof t){const e=document.getElementById(t);if(e)return e}return e?e():null}function Bt(t=16){const e=new Uint8Array(t);return window.crypto.getRandomValues(e),O(e.buffer)}const At=new Set;let $t=function(){let t=null;const e=document.getElementsByTagName("link");for(const s of e)if("canonical"===s.getAttribute("rel")){t=s.getAttribute("href");break}return t||window.location.href}();const qt={get libName(){return globalThis.__MULTISYNQ__?"Multisynq":"Croquet"},get sessionURL(){return $t},set sessionURL(t){$t=t,jt()},root:null,sync:!0,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock:function(t={}){if(h.nodock)return;const e=t.debug||h.debug,s=document.getElementById("croquet_dock");s&&s.parentElement.removeChild(s);const n=Ot(qt.root,(()=>document.body));if(!n)return;!function(){if(Vt)return;Vt=!0;const t=`\n        #croquet_dock { position: fixed; z-index: 2; border: 3px solid white; bottom: 6px; left: 6px; width: 36px; height: 36px; box-sizing: border-box; background: white; opacity: 0.4; transition: all 0.3s ease; }\n        #croquet_dock.active { opacity: 0.95; border-radius: 12px; }\n        #croquet_dock.debug { width: 84px; }\n        #croquet_dock_bar { position: absolute; border: 3px solid white; width: 100%; height: 30px; box-sizing: border-box; background: white; }\n\n        #croquet_badge { position: absolute; width: 72px; height: 24px; top: 50%; transform: translate(0px, -50%); cursor: none; }\n        #croquet_dock.active #croquet_badge { left: 2%; }\n        #croquet_dock:not(.debug) #croquet_badge { display: none; }\n\n        .croquet_dock_button { position: absolute; width: ${kt}%; height: 90%; top: 50%; transform: translate(0px, -50%); border-radius: 20%; }\n        .croquet_dock_button:focus { outline: 0; }\n        .croquet_dock_button canvas { position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; }\n        #croquet_dock:not(.active) .croquet_dock_button { display: none; }\n        #croquet_dock_left { right: ${2+Pt+kt+2}% }\n        #croquet_dock:not(.debug) #croquet_dock_left { display: none; }\n        #croquet_dock_right { right: ${2+Pt}%; }\n        #croquet_dock:not(.debug) #croquet_dock_right { display: none; }\n        #croquet_dock_pin { right: 2%; }\n        #croquet_dock_pin.pinned { background: #cce6ff; }\n\n        #croquet_dock_content { position: absolute; left: 2px; top: 2px; right: 2px; bottom: 2px; background: white; overflow: hidden; }\n        #croquet_dock.debug:not(.active) #croquet_dock_content { display: none; }\n        #croquet_dock.debug:not(.active) #croquet_dock_content div { display: none; }\n\n        #croquet_qrcode { position: absolute; width: 100%; height: 100%;box-sizing: border-box; cursor: crosshair; }\n        #croquet_dock.active #croquet_qrcode { border: 6px solid white; }\n        #croquet_dock.debug #croquet_qrcode:not(.active) { display: none; }\n        #croquet_qrcode canvas { image-rendering: pixelated; }\n\n        #croquet_stats { position: absolute; width: 70%; height: 90%; left: 15%; top: 5%; opacity: 0.8; font-family: sans-serif; }\n        #croquet_stats:not(.active) { display: none; }\n`,e=document.createElement("style");e.innerHTML=t,document.head.insertBefore(e,document.head.querySelector("style,link[rel=stylesheet]"))}();const i=document.createElement("div");i.id="croquet_dock",e&&i.classList.add("debug"),Ct&&!1===t.iframe&&(i.style.display="none"),n.appendChild(i);const o=document.createElement("div");let r;o.id="croquet_dock_bar",i.appendChild(o),!1!==t.badge&&(r=document.createElement("div"),r.id="croquet_badge",o.appendChild(r),qt.badge=r);const a=document.createElement("div");a.id="croquet_dock_content",i.appendChild(a);const l=[];let c,d;if(!1!==t.qrcode){qt.sessionURL&&(c=document.createElement("div"),c.id="croquet_qrcode",a.appendChild(c),l.push(c.id),qt.qrcode=c,e||(Kt.activePage=c.id))}if(!1!==t.stats&&(d=document.createElement("div"),d.id="croquet_stats",a.appendChild(d),l.push(d.id),qt.stats=d),l.length){function b(t){const e=l.length;let s,n=0;if(Kt.activePage){const t=l.indexOf(Kt.activePage);t>=0?(n=t,s=document.getElementById(Kt.activePage)):Kt.activePage=null}const i=l[(n+e+t)%e];let o;i===Kt.activePage?o=s:(s&&s.classList.remove("active"),o=document.getElementById(i)),o&&o.classList.add("active"),Kt.activePage=i}l.length>1&&(o.appendChild(zt("<","croquet_dock_left",(()=>b(-1)))),o.appendChild(zt(">","croquet_dock_right",(()=>b(1))))),b(0)}if(!Wt&&!t.alwaysPinned){const y=zt("","croquet_dock_pin",(()=>{Kt.pinned=!Kt.pinned,g()})),g=()=>{Kt.pinned?y.classList.add("pinned"):y.classList.remove("pinned")};g(),o.appendChild(y)}const u=t=>{i.style.width=`${t}px`;const e=1.18*t;i.style.height=`${e}px`;const s=18*t/100;o.style.height=`${s}px`,a.style.top=`${s+2}px`,r&&(r.style.height=.9*s+"px",r.style.width=.9*s*3+"px"),c&&(c.style.border=8*t/200+"px solid white")};let m=t.fixedSize||200;const p=()=>{i.classList.add("active"),u(m),setTimeout((()=>i.style.transition="none"),300)},f=()=>{i.style.transition="",i.classList.remove("active"),i.style.width=i.style.height="",o.style.height="",a.style.top="",r&&(r.style.height=r.style.width=""),c&&(c.style.border="")};if(Wt)f(),i.ontouchstart=t=>{t.preventDefault(),t.stopPropagation(),i.classList.contains("active")?f():p()},i.ontouchend=_t,i.onpointerdown=_t,i.onpointerup=_t;else if(t.alwaysPinned?p():(Kt.pinned?p():f(),i.onmouseenter=p,i.onmouseleave=()=>{Kt.pinned||f()}),!t.fixedSize){let w=0;i.addEventListener("wheel",(t=>{t.stopPropagation();const e=Date.now();if(e-w<100)return;w=e;let{deltaY:s}=t;s=Math.sign(s)*Math.min(5,Math.abs(s));const n=.8*Math.min(window.innerWidth,window.innerHeight);m=Math.max(166,Math.min(n,i.offsetWidth/1.05**s)),u(m)}),{passive:!0})}},makeSessionWidgets:function(t){!function(t){if(!t||!1===qt.root)return;const e=Ot(qt.badge);e&&Ft(e,t)}(t),jt(),function(){if(!1===qt.root)return;if(h.nostats)return;const t=Ot(qt.stats);t&&pt(t)}()},makeQRCanvas(t={}){if(!qt.sessionURL)return null;const e=Et(document.createElement("div"),qt.sessionURL,t);return e&&e.getCanvas()},clearSessionMoniker:function(){!1!==qt.badge&&(document.title=document.title.replace(/:.*/,""))},showSyncWait(t){!1===qt.root?t=!1:Jt||(Jt=Dt()),function(t){if(Qt!==t&&("string"!=typeof Qt||!0!==t))if(!1===qt.sync&&(t=!1),Qt=t,t)clearTimeout(Ut),Ut=setTimeout((()=>{Qt&&(Ot(qt.root,(()=>document.body)).appendChild(Jt),Jt.style.opacity=.9,Jt.className="error"===Qt?"croquet_error":"fatal"===Qt?"croquet_fatal":"")}),500);else{if(!Jt)return;clearTimeout(Ut),Jt.style.opacity=0,Jt.className="",Ut=setTimeout((()=>{Qt||Jt.parentElement&&Jt.parentElement.removeChild(Jt)}),500)}}(t)},messageFunction:function(t,e={}){const s=e.level;let n;return"error"===s?(n="orangered,red",console.error(t)):"warning"===s?(n="gold,orange",console.warn(t)):n="silver,gray",function(t,e){const s=Ot(qt.root,(()=>document.body));if(!1===s)return null;!function(){if(Rt)return;Rt=!0;let t="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n";t+="\n        .toastify {\n            font-family: sans-serif;\n            border-radius: 8px;\n        }\n\n        .toastify-center {\n            margin-left: auto;\n            margin-right: auto;\n            left: 0;\n            right: 0;\n            max-width: fit-content;\n            max-width: -moz-fit-content;\n        }\n";const e=document.createElement("style");e.innerHTML="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n\n        .toastify {\n            font-family: sans-serif;\n            border-radius: 8px;\n        }\n\n        .toastify-center {\n            margin-left: auto;\n            margin-right: auto;\n            left: 0;\n            right: 0;\n            max-width: fit-content;\n            max-width: -moz-fit-content;\n        }\n",document.head.insertBefore(e,document.head.querySelector("style,link[rel=stylesheet]"))}();const n={text:t,duration:3e3,gravity:"bottom",position:"right",stopOnFocus:!0,...e};let i;s instanceof Element&&s!==document.body?(i=s.id,i||(s.id=i="_croquetToastParent")):"string"==typeof s&&(i=s);i&&(n.selector=i);return w(n).showToast()}(t,{style:{background:`linear-gradient(90deg,${n})`},...e})},showMessage(t,e={}){if("once"===e.only){if(At.has(t))return null;At.add(t)}return"fatal"===e.level&&(e.level="error",e.showSyncWait="fatal"),e.showSyncWait&&("fatal"!==e.showSyncWait||e.duration||(e.duration=-1),qt.showSyncWait(e.showSyncWait)),h.nomessages||!1===qt.root||!1===qt.messages||!qt.messageFunction?("warning"===e.level&&console.warn(t),"error"===e.level&&console.error(t),null):qt.messageFunction(t,e)},isCroquetHost:t=>t.endsWith("croquet.io")||["localhost","127.0.0.1","[::1]"].includes(t)||t.endsWith("ngrok.io"),referrerURL(){const t=new URL(qt.sessionURL),e=this.isCroquetHost(t.hostname);return`${t.protocol}//${t.host}${t.pathname}${e?t.search:""}`},autoSession(t={key:"q",force:!1,default:"",keyless:!1}){"string"==typeof t&&(t={key:t}),t||(t={});const e=t.key||"q",s=new URL(qt.sessionURL);let n="";if(!t.force){const i=s.search.slice(1).split("&"),o=i.find((t=>t.split("=")[0]===e));o?n=o.replace(/[^=]*=/,""):t.keyless&&(n=i.find((t=>!t.includes("="))),n||(n=s.hash.slice(1),n&&(s.hash="",s.search?s.searchParams.set(e,n):s.search=n)))}if(n)try{n=decodeURIComponent(n)}catch(t){}else n=t.default?t.default:this.randomSession(),s.searchParams.set(e,n);if(qt.sessionURL=s.href,window.location.href!==s.href)try{window.history.replaceState({},"",s.href)}catch(t){qt.showMessage(`Setting address bar to ${s.href}`,{only:"once"}),qt.showMessage(`Failed to change address bar: ${t.message}`,{level:"warning",only:"once"})}h.has("debug","session")&&console.log(`${qt.libName}.App.autoSession: "${n}"`);const i=Promise.resolve(n);return i[Symbol.toPrimitive]=()=>(console.warn(`Deprecated: ${qt.libName}.App.autoSession() return value used directly. It returns a promise now!`),n),i},autoPassword(t={key:"pw",default:"",force:!1,scrub:!1,keyless:!1}){"string"==typeof t&&(t={key:t});const e=t.key||"pw",s=t.scrub&&!h.has("debug","password"),n=t.keyless,i=new URL(qt.sessionURL);let o="";const r=t.force?"":i.hash.slice(1);if(r){const t=r.split("&"),a=t.find((t=>t.split("=")[0]===e));a?(o=a.replace(/[^=]*=/,""),o&&s&&(i.hash=t.filter((t=>t.split("=")[0]!==e)).join("&"))):n&&(o=t.find((t=>!t.includes("="))),o&&s&&(i.hash=t.filter((t=>t!==o)).join("&")))}if(o||(o=t.default?t.default:this.randomPassword(),i.hash=r?`${r}&${e}=${o}`:n?o:`${e}=${o}`,qt.sessionURL=i.href,s&&(i.hash=n?"":r)),h.has("debug","session")&&console.log(`${qt.libName}.App.sessionUrl: ${qt.sessionURL}`),window.location.href!==i.href)try{window.history.replaceState({},"",i.href)}catch(t){qt.showMessage(`Setting address bar to ${i.href}`,{only:"once"}),qt.showMessage(`Failed to change address bar: ${t.message}`,{level:"warning",only:"once"})}if(o)try{o=decodeURIComponent(o)}catch(t){}h.has("debug","session")&&console.log(`${qt.libName}.App.autoPassword: "${o}"`);const a=Promise.resolve(o);return a[Symbol.toPrimitive]=()=>(console.warn(`Deprecated: ${qt.libName}.App.autoPassword() return value used directly. It returns a promise now!`),o),a},randomSession:(t=10)=>Bt(t),randomPassword:(t=16)=>Bt(t)},te="#__vote";function ee(t,e,s=null){let n="none";for(const i of["immediate","queued","oncePerFrame","oncePerFrameWhileSynced"])for(const o of t[i])o.for===e?null===s||o.unbound===s?t[i].delete(o):n="subscriber":"none"===n&&(n="others");return n}const se=globalThis.CROQUETVD=new class{constructor(){this.subscriptions={},this.subscribers=new Map,this.genericSubscriptions=!1,this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.subscriberIds=0,this.currentEvent=void 0,this.currentEventFromModel=!1}register(t){return"V"+ ++this.subscriberIds}deregister(t){}addSubscription(t,e,s,n,i){if(t.includes(":"))throw Error(`Invalid subscription scope "${t}" (must not contain ':')`);if("vote"===i)return void this.addSubscription(t,e+te,s,n,"immediate");"*"!==t&&"*"!==e||(this.genericSubscriptions=!0);const o=t+":"+e,r=n;r.for=s;let a=this.subscriptions[o];if(a||(a=this.subscriptions[o]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!a[i])throw Error(`Unknown subscribe() option: handling="${i}"`);a[i].add(r);let l=this.subscribers.get(s);l||this.subscribers.set(s,l=new Set),l.add(o)}removeSubscription(t,e,s,n=null){const i=t+":"+e,o=this.subscriptions[i];if(o){const t=ee(o,s,n);if("none"===t&&delete this.subscriptions[i],"subscriber"!==t){const t=this.subscribers.get(s);t&&(t.delete(i),0===t.size&&this.subscribers.delete(s))}}e.endsWith(te)||this.removeSubscription(t,e+te,s)}removeAllSubscriptionsFor(t){const e=this.subscribers.get(t);if(e){for(const s of e){const e=this.subscriptions[s];if(e){"none"===ee(e,t)&&delete this.subscriptions[s]}else console.error(`${qt.libName}: topic ${s} not found in subscriptions table for ${t} during removeAllSubscriptionsFor()`)}this.subscribers.delete(t)}}subscriptionsFor(t){const e=this.subscriptions[t];if(!e&&!this.genericSubscriptions)return null;const s=[];let n=!!e;if(this.genericSubscriptions){const[e,i]=t.split(":");if(!(e.startsWith("__")&&e.endsWith("__")||i.startsWith("__")&&i.endsWith("__")))for(const t of["*:*",e+":*","*:"+i]){const e=this.subscriptions[t];e&&(s.push([e,t]),!n&&this.hasUserSubcription(e)&&(n=!0))}const o=!n;if(o)for(const t of s)t.push(o)}return e&&s.push([e,t]),0===s.length?null:s}hasUserSubcription(t){for(const e of["immediate","queued","oncePerFrame","oncePerFrameWhileSynced"])for(const s of t[e])if(!s.unbound.__CROQUET__)return!0;return!1}handleEvent(t,e,s=null){const n=this.subscriptionsFor(t);if(!n)return;const i=!!s;let o=0,r=0,a=0;for(const[l,c,d]of n)o+=l.queued.size,r+=l.oncePerFrame.size,a+=l.oncePerFrameWhileSynced.size,l.immediate.size>0&&(s||(s=t=>t()),s((()=>{for(const s of l.immediate){const n=this.currentEvent,o=this.currentEventFromModel,r=this.currentEventOnlyGeneric;this.currentEvent=t,this.currentEventFromModel=i,this.currentEventOnlyGeneric=d;try{s(e)}catch(t){console.error(t),console.warn(`${qt.libName}: error "${t.message}" in "immediate" subscription ${c}`)}this.currentEvent=n,this.currentEventFromModel=o,this.currentEventOnlyGeneric=r}})));o>0&&this.queuedEvents.push({topic:t,data:e,fromModel:i}),r>0&&this.perFrameEvents.set(t,{data:e,fromModel:i}),a>0&&this.perSyncedFrameEvents.set(t,{data:e,fromModel:i})}processFrameEvents(t,e){let s=0;const n=(t,e,n,i)=>{const o=this.subscriptionsFor(e);if(!o)return;const r=this.currentEvent,a=this.currentEventFromModel;this.currentEvent=e,this.currentEventFromModel=i;for(const[i,r,a]of o){const o=this.currentEventOnlyGeneric;this.currentEventOnlyGeneric=a;for(const o of i[t]){try{o(n)}catch(s){console.error(s),console.warn(`${qt.libName}: error "${s.message}" in "${t}" subscription ${e}`)}s++}this.currentEventOnlyGeneric=o}this.currentEvent=r,this.currentEventFromModel=a};for(const{topic:t,data:e,fromModel:s}of this.queuedEvents)n("queued",t,e,s);if(this.queuedEvents.length=0,t){for(const[t,{data:e,fromModel:s}]of this.perFrameEvents)n("oncePerFrame",t,e,s);if(this.perFrameEvents.clear(),e){for(const[t,{data:e,fromModel:s}]of this.perSyncedFrameEvents)n("oncePerFrameWhileSynced",t,e,s);this.perSyncedFrameEvents.clear()}for(const{topic:t,data:e,fromModel:s}of this.queuedEvents)n("queued",t,e,s);this.queuedEvents.length=0}return s}};let ne={get subscribe(){return ne={subscribe:h.has("debug","subscribe",!1)},ne.subscribe}};class ie{constructor(t){this.vm=t}register(t){return this.vm.registerModel(t)}deregister(t){this.vm.deregisterModel(t.id)}publish(t,e,s){this.vm.publishFromModel(s,t,e)}subscribe(t,e,s,n){return ne.subscribe&&console.log(`Model.subscribe("${e}:${s}", ${t} ${(""+n).replace(/\([\s\S]*/,"")})`),this.vm.addSubscription(t,e,s,n)}unsubscribe(t,e,s,n="*"){ne.subscribe&&console.log(`Model.unsubscribe(${e}:${s}", ${t} ${(""+n).replace(/\([\s\S]*/,"")})`),this.vm.removeSubscription(t,e,s,n)}unsubscribeAll(t){ne.subscribe&&console.log(`Model.unsubscribeAll(${t} ${t.id})`),this.vm.removeAllSubscriptionsFor(t)}future(t,e,s,n){if(re&&re.equal(this))return this.vm.future(t,e,s,n);throw Error(`Model.future() called from outside: ${t}`)}cancelFuture(t,e){if(re&&re.equal(this))return this.vm.cancelFuture(t,e);throw Error(`Model.cancelFuture() called from outside: ${t}`)}random(){return this.vm.random()}now(){return this.vm.time}equal(t){return t instanceof ie&&t.vm===this.vm}isViewRealm(){return!1}}class oe{constructor(t){this.vd=se,this.vm=t,this.controller=t.controller}valid(){return this.vm===this.controller.vm}register(t){return se.register(t)}deregister(t){se.deregister(t)}publish(t,e,s){this.vm.publishFromView(s,t,e)}subscribe(t,e,s,n,i="queued"){ne.subscribe&&console.log(`View[${e}].subscribe("${n}:${t}" ${s?s.name||(""+s).replace(/\([\s\S]*/,""):""+s} [${i}])`),se.addSubscription(n,t,e,s,i)}unsubscribe(t,e,s=null,n){ne.subscribe&&console.log(`View[${e}].unsubscribe("${n}:${t}" ${s?s.name||(""+s).replace(/\([\s\S]*/,""):"*"})`),se.removeSubscription(n,t,e,s)}unsubscribeAll(t){ne.subscribe&&console.log(`View[${t}].unsubscribeAll()`),se.removeAllSubscriptionsFor(t)}future(t,e){const s=this.vm;return new Proxy(t,{get(n,i){if("function"==typeof t[i]){return new Proxy(t[i],{apply(n,o,r){setTimeout((()=>{t.id&&ce(s,(()=>t[i](...r)),!0)}),e)}})}throw Error("Tried to call "+i+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}})}random(){return Math.random()}now(){return this.vm.time}externalNow(){return this.controller.reflectorTime}extrapolatedNow(){return this.controller.extrapolatedTime}isSynced(){return!!this.controller.synced}equal(t){return t instanceof oe&&t.vm===this.vm}isViewRealm(){return!0}}let re=null;function ae(t="Tried to execute code that requires realm outside of realm."){if(!re&&t)throw Error(t);return re}function le(t,e){if(null!==re)throw Error("Can't switch realms from inside realm");try{return re=new ie(t),e()}finally{re=null}}function ce(t,e,s=!1){if(null!==re&&!s)throw Error("Can't switch realms from inside realm");const n=re;try{return re=new oe(t),e()}finally{re=n}}var de=function(t){return t!=t},he=Math.sqrt,ue=.7853981633974483;var me=function(t){var e,s;return 0===t?.16666666666666713:((t<0?-t:t)<=1?(e=t*(19.562619833175948+t*(t*(5.444622390564711+t*(.004253011369004428*t-.6019598008014124))-16.262479672107002))-8.198089802484825,s=t*(139.51056146574857+t*(t*(70.49610280856842+t*(1*t-14.740913729888538))-147.1791292232726))-49.18853881490881):(e=.004253011369004428+(t=1/t)*(t*(5.444622390564711+t*(t*(19.562619833175948+-8.198089802484825*t)-16.262479672107002))-.6019598008014124),s=1+t*(t*(70.49610280856842+t*(t*(139.51056146574857+-49.18853881490881*t)-147.1791292232726))-14.740913729888538)),e/s)};var pe=function(t){var e,s;return 0===t?.08333333333333809:((t<0?-t:t)<=1?(e=28.536655482610616+t*(t*(6.968710824104713+t*(.002967721961301243*t-.5634242780008963))-25.56901049652825),s=342.43986579130785+t*(t*(147.0656354026815+t*(1*t-21.947795316429207))-383.8770957603691)):(e=.002967721961301243+(t=1/t)*(t*(6.968710824104713+t*(28.536655482610616*t-25.56901049652825))-.5634242780008963),s=1+t*(t*(147.0656354026815+t*(342.43986579130785*t-383.8770957603691))-21.947795316429207)),e/s)};var fe=function(t){var e,s,n,i,o;if(de(t))return NaN;if(t>0?n=t:(e=!0,n=-t),n>1)return NaN;if(n>.625)i=(s=1-n)*pe(s),s=he(s+s),o=ue-s,o-=s=s*i-6123233995736766e-32,o+=ue;else{if(n<1e-8)return t;o=n*(o=(s=n*n)*me(s))+n}return e?-o:o};var be=function(t){var e;return de(t)||t<-1||t>1?NaN:t>.5?2*fe(he(.5-.5*t)):(e=ue-fe(t),e+=6123233995736766e-32,e+=ue)};var ye=function(){return"function"==typeof Symbol&&"symbol"==typeof Symbol("foo")}();var ge=function(){return ye&&"symbol"==typeof Symbol.toStringTag},we=Object.prototype.toString;var Ze=function(t){return we.call(t)},ve=Object.prototype.hasOwnProperty;var Xe=function(t,e){return null!=t&&ve.call(t,e)},Le="function"==typeof Symbol?Symbol.toStringTag:"";var xe=function(t){var e,s,n;if(null==t)return we.call(t);s=t[Le],e=Xe(t,Le);try{t[Le]=void 0}catch(e){return we.call(t)}return n=we.call(t),e?t[Le]=s:delete t[Le],n},Se=ge()?xe:Ze,Ge="function"==typeof Uint32Array;var Te=function(t){return Ge&&t instanceof Uint32Array||"[object Uint32Array]"===Se(t)},We=4294967295,Ce="function"==typeof Uint32Array?Uint32Array:null;var ke=function(){var t,e;if("function"!=typeof Ce)return!1;try{e=new Ce(e=[1,3.14,-3.14,We+1,We+2]),t=Te(e)&&1===e[0]&&3===e[1]&&e[2]===We-2&&0===e[3]&&1===e[4]}catch(e){t=!1}return t},Pe="function"==typeof Uint32Array?Uint32Array:null;var Ve=function(){throw new Error("not implemented")},Ie=ke()?Pe:Ve,Me="function"==typeof Float64Array;var Re=function(t){return Me&&t instanceof Float64Array||"[object Float64Array]"===Se(t)},Ye="function"==typeof Float64Array?Float64Array:null;var Ne=function(){var t,e;if("function"!=typeof Ye)return!1;try{e=new Ye([1,3.14,-3.14,NaN]),t=Re(e)&&1===e[0]&&3.14===e[1]&&-3.14===e[2]&&e[3]!=e[3]}catch(e){t=!1}return t},He="function"==typeof Float64Array?Float64Array:null;var Ke=function(){throw new Error("not implemented")},_e=Ne()?He:Ke,ze="function"==typeof Uint8Array;var Fe=function(t){return ze&&t instanceof Uint8Array||"[object Uint8Array]"===Se(t)},Ee="function"==typeof Uint8Array?Uint8Array:null;var je=function(){var t,e;if("function"!=typeof Ee)return!1;try{e=new Ee(e=[1,3.14,-3.14,256,257]),t=Fe(e)&&1===e[0]&&3===e[1]&&253===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t},Je="function"==typeof Uint8Array?Uint8Array:null;var Qe=function(){throw new Error("not implemented")},Ue=je()?Je:Qe,De="function"==typeof Uint16Array;var Oe=function(t){return De&&t instanceof Uint16Array||"[object Uint16Array]"===Se(t)},Be="function"==typeof Uint16Array?Uint16Array:null;var Ae=function(){var t,e;if("function"!=typeof Be)return!1;try{e=new Be(e=[1,3.14,-3.14,65536,65537]),t=Oe(e)&&1===e[0]&&3===e[1]&&65533===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t},$e="function"==typeof Uint16Array?Uint16Array:null;var qe,ts=function(){throw new Error("not implemented")},es={uint16:Ae()?$e:ts,uint8:Ue};(qe=new es.uint16(1))[0]=4660;var ss=52===new es.uint8(qe.buffer)[0],ns=!0===ss?1:0,is=new _e(1),os=new Ie(is.buffer);var rs=function(t){return is[0]=t,os[ns]},as=!0===ss?1:0,ls=new _e(1),cs=new Ie(ls.buffer);var ds=function(t,e){return ls[0]=t,cs[as]=e>>>0,ls[0]},hs=ds,us=Number.POSITIVE_INFINITY,ms=Number.NEGATIVE_INFINITY,ps=1023;var fs=function(t){return 0===t?.6666666666666735:.6666666666666735+t*(.3999999999940942+t*(.2857142874366239+t*(.22222198432149784+t*(.1818357216161805+t*(.15313837699209373+.14798198605116586*t)))))},bs=.6931471803691238,ys=1.9082149292705877e-10;var gs=function(t){var e,s,n,i,o,r,a,l,c,d;if(t<-1||de(t))return NaN;if(-1===t)return ms;if(t===us)return t;if(0===t)return t;if(d=1,(n=t<0?-t:t)<.41421356237309503){if(n<1.862645149230957e-9)return n<5551115123125783e-32?t:t-t*t*.5;t>-.2928932188134525&&(d=0,i=t,s=1)}return 0!==d&&(n<9007199254740992?(o=(d=((s=rs(c=1+t))>>20)-ps)>0?1-(c-t):t-(c-1),o/=c):(d=((s=rs(c=t))>>20)-ps,o=0),(s&=1048575)<434334?c=hs(c,1072693248|s):(d+=1,c=hs(c,1071644672|s),s=1048576-s>>2),i=c-1),e=.5*i*i,0===s?0===i?d*bs+(o+=d*ys):d*bs-((l=e*(1-.6666666666666666*i))-(d*ys+o)-i):(l=(a=(r=i/(2+i))*r)*fs(a),0===d?i-(e-r*(e+l)):d*bs-(e-(r*(e+l)+(d*ys+o))-i))},ws=.6931471805599453;var Zs=function(t){return 0===t?.3999999999940942:.3999999999940942+t*(.22222198432149784+.15313837699209373*t)};var vs=function(t){return 0===t?.6666666666666735:.6666666666666735+t*(.2857142874366239+t*(.1818357216161805+.14798198605116586*t))},Xs=.6931471803691238,Ls=1.9082149292705877e-10,xs=1048575;var Ss=function(t){var e,s,n,i,o,r,a,l,c,d,h;return 0===t?ms:de(t)||t<0?NaN:(i=0,(s=rs(t))<1048576&&(i-=54,s=rs(t*=0x40000000000000)),s>=2146435072?t+t:(i+=(s>>20)-ps|0,i+=(a=(s&=xs)+614244&1048576)>>20,r=(t=hs(t,s|1072693248^a))-1,(xs&2+s)<3?0===r?0===i?0:i*Xs+i*Ls:(o=r*r*(.5-.3333333333333333*r),0===i?r-o:i*Xs-(o-i*Ls-r)):(a=s-398458|0,l=440401-s|0,n=(d=(h=(c=r/(2+r))*c)*h)*Zs(d),o=h*vs(d)+n,(a|=l)>0?(e=.5*r*r,0===i?r-(e-c*(e+o)):i*Xs-(e-(c*(e+o)+i*Ls)-r)):0===i?r-c*(r-o):i*Xs-(c*(r-o)-i*Ls-r))))};var Gs=function(t){var e;return de(t)||t<1?NaN:1===t?0:t>=268435456?Ss(t)+ws:t>2?Ss(2*t-1/(t+he(t*t-1))):gs((e=t-1)+he(2*e+e*e))};var Ts=function(t){return t===us||t===ms},Ws=1/(1<<28);var Cs=function(t){var e,s,n;return de(t)||Ts(t)?t:(t<0&&(t=-t,e=!0),n=t<Ws?t:t>268435456?Ss(t)+ws:t>2?Ss(2*t+1/(he(t*t+1)+t)):gs(t+(s=t*t)/(1+he(1+s))),e?-n:n)},ks=1.5707963267948966;var Ps=function(t){return 0===t?-64.85021904942025:t*(t*(t*(-.8750608600031904*t-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025};var Vs=function(t){return 0===t?194.5506571482614:194.5506571482614+t*(485.3903996359137+t*(432.88106049129027+t*(165.02700983169885+t*(24.858464901423062+1*t))))},Is=6123233995736766e-32;var Ms=function(t){var e,s,n,i;return de(t)||0===t?t:t===us?ks:t===ms?-1.5707963267948966:(t<0&&(s=!0,t=-t),e=0,t>2.414213562373095?(n=ks,e=1,t=-1/t):t<=.66?n=0:(n=ue,e=2,t=(t-1)/(t+1)),i=t*(i=(i=t*t)*Ps(i)/Vs(i))+t,2===e?i+=.5*Is:1===e&&(i+=Is),n+=i,s?-n:n)},Rs=1/(1<<28);var Ys,Ns,Hs=function(t){var e,s;return de(t)||t<-1||t>1?NaN:1===t?us:-1===t?ms:(t<0&&(e=!0,t=-t),t<Rs?e?-t:t:(s=t<.5?.5*gs((s=t+t)+s*t/(1-t)):.5*gs((t+t)/(1-t)),e?-s:s))};!0===ss?(Ys=1,Ns=0):(Ys=0,Ns=1);var Ks={HIGH:Ys,LOW:Ns},_s=new _e(1),zs=new Ie(_s.buffer),Fs=Ks.HIGH,Es=Ks.LOW;var js=function(t,e){return _s[0]=e,t[0]=zs[Fs],t[1]=zs[Es],t};var Js,Qs,Us=function(t,e){return 1===arguments.length?js([0,0],t):js(t,e)},Ds=Us;!0===ss?(Js=1,Qs=0):(Js=0,Qs=1);var Os={HIGH:Js,LOW:Qs},Bs=new _e(1),As=new Ie(Bs.buffer),$s=Os.HIGH,qs=Os.LOW;var tn=function(t,e){return As[$s]=t,As[qs]=e,Bs[0]},en=tn,sn=[0,0];var nn=function(t,e){var s,n;return Ds(sn,t),s=sn[0],s&=2147483647,n=rs(e),en(s|=n&=2147483648,sn[1])};var on=function(t){return!!(rs(t)>>>31)},rn=3.141592653589793;var an=function(t,e){var s;return de(e)||de(t)?NaN:Ts(e)?e===us?Ts(t)?nn(rn/4,t):nn(0,t):Ts(t)?nn(3*rn/4,t):nn(rn,t):Ts(t)?nn(rn/2,t):0===t?e>=0&&!on(e)?nn(0,t):nn(rn,t):0===e?nn(rn/2,t):(s=Ms(t/e),e<0?s<=0?s+rn:s-rn:s)},ln=22250738585072014e-324;var cn=function(t){return 0===t?1.87595182427177:1.87595182427177+t*(t*(1.6214297201053545+t*(.14599619288661245*t-.758397934778766))-1.8849797954337717)},dn=2147483647;var hn=function(t){var e,s,n,i,o;return de(t)||Ts(t)||0===t?t:(s=-2147483648&(n=rs(t)),n&=dn,o=0,t<ln?(o=0x40000000000000,e=rs(o*=t),o=en(s|(e=(e&dn)/3+696219795),0)):o=hs(o,s|(e=n/3+715094163)),o*=cn(i=o*o*(o/t)),e=rs(o),o=en(e+1,0),o+=o*(i=((i=t/(o*o))-o)/(o+o+i)))},un=hn;var mn=function(t){return 0===t?.0416666666666666:.0416666666666666+t*(2480158728947673e-20*t-.001388888888887411)};var pn=function(t){return 0===t?-2.7557314351390663e-7:t*(2.087572321298175e-9+-11359647557788195e-27*t)-2.7557314351390663e-7};var fn=function(t,e){var s,n,i,o;return i=(o=t*t)*o,n=o*mn(o),n+=i*i*pn(o),(i=1-(s=.5*o))+(1-i-s+(o*n-t*e))},bn=-.16666666666666632;var yn=function(t,e){var s,n,i;return s=.00833333333332249+(i=t*t)*(27557313707070068e-22*i-.0001984126982985795)+i*(i*i)*(1.58969099521155e-10*i-2.5050760253406863e-8),n=i*t,0===e?t+n*(bn+i*s):t-(i*(.5*e-n*s)-e-n*bn)},gn=!0===ss?0:1,wn=new _e(1),Zn=new Ie(wn.buffer);var vn=function(t){return wn[0]=t,Zn[gn]},Xn=Math.floor;var Ln=function(t){return t<0?-t:0===t?0:t};var xn=function(t,e){return de(e)||Ts(e)?(t[0]=e,t[1]=0,t):0!==e&&Ln(e)<ln?(t[0]=4503599627370496*e,t[1]=-52,t):(t[0]=e,t[1]=0,t)};var Sn=function(t,e){return 1===arguments.length?xn([0,0],t):xn(t,e)},Gn=Sn;var Tn=function(t){var e=rs(t);return(e=(2146435072&e)>>>20)-ps|0},Wn=Tn,Cn=[0,0],kn=[0,0];var Pn=function(t,e){var s,n;return 0===t||de(t)||Ts(t)?t:(Gn(Cn,t),e+=Cn[1],(e+=Wn(t=Cn[0]))<-1074?nn(0,t):e>1023?t<0?ms:us:(e<=-1023?(e+=52,n=2220446049250313e-31):n=1,Ds(kn,t),s=kn[0],s&=2148532223,n*en(s|=e+ps<<20,kn[1])))},Vn=Pn,In=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],Mn=[1.570796251296997,7.549789415861596e-8,5390302529957765e-30,3282003415807913e-37,1270655753080676e-44,12293330898111133e-52,27337005381646456e-60,21674168387780482e-67],Rn=16777216,Yn=5.960464477539063e-8,Nn=zn(new Array(20)),Hn=zn(new Array(20)),Kn=zn(new Array(20)),_n=zn(new Array(20));function zn(t){var e,s=t.length;for(e=0;e<s;e++)t[e]=0;return t}function Fn(t,e,s,n,i,o,r,a,l){var c,d,h,u,m,p,f,b,y;for(u=o,y=n[s],b=s,m=0;b>0;m++)d=Yn*y|0,_n[m]=y-Rn*d|0,y=n[b-1]+d,b-=1;if(y=Vn(y,i),y-=8*Xn(.125*y),y-=f=0|y,h=0,i>0?(f+=m=_n[s-1]>>24-i,_n[s-1]-=m<<24-i,h=_n[s-1]>>23-i):0===i?h=_n[s-1]>>23:y>=.5&&(h=2),h>0){for(f+=1,c=0,m=0;m<s;m++)b=_n[m],0===c?0!==b&&(c=1,_n[m]=16777216-b):_n[m]=16777215-b;if(i>0)switch(i){case 1:_n[s-1]&=8388607;break;case 2:_n[s-1]&=4194303}2===h&&(y=1-y,0!==c&&(y-=Vn(1,i)))}if(0===y){for(b=0,m=s-1;m>=o;m--)b|=_n[m];if(0===b){for(p=1;0===_n[o-p];p++);for(m=s+1;m<=s+p;m++){for(l[a+m]=In[r+m],d=0,b=0;b<=a;b++)d+=t[b]*l[a+(m-b)];n[m]=d}return Fn(t,e,s+=p,n,i,o,r,a,l)}}if(0===y)for(s-=1,i-=24;0===_n[s];)s-=1,i-=24;else(y=Vn(y,-i))>=Rn?(d=Yn*y|0,_n[s]=y-Rn*d|0,i+=24,_n[s+=1]=d):_n[s]=0|y;for(d=Vn(1,i),m=s;m>=0;m--)n[m]=d*_n[m],d*=Yn;for(m=s;m>=0;m--){for(d=0,p=0;p<=u&&p<=s-m;p++)d+=Mn[p]*n[m+p];Kn[s-m]=d}for(d=0,m=s;m>=0;m--)d+=Kn[m];for(e[0]=0===h?d:-d,d=Kn[0]-d,m=1;m<=s;m++)d+=Kn[m];return e[1]=0===h?d:-d,7&f}var En=function(t,e,s,n){var i,o,r,a,l,c,d;for((o=(s-3)/24|0)<0&&(o=0),a=s-24*(o+1),c=o-(r=n-1),d=r+4,l=0;l<=d;l++)Nn[l]=c<0?0:In[c],c+=1;for(l=0;l<=4;l++){for(i=0,c=0;c<=r;c++)i+=t[c]*Nn[r+(l-c)];Hn[l]=i}return Fn(t,e,4,Hn,a,4,o,r,Nn)},jn=Math.round;var Jn=function(t,e,s){var n,i,o,r,a;return o=t-1.5707963267341256*(n=jn(.6366197723675814*t)),r=6077100506506192e-26*n,a=e>>20,s[0]=o-r,a-(rs(s[0])>>20&2047)>16&&(r=20222662487959506e-37*n-((i=o)-(o=i-(r=6077100506303966e-26*n))-r),s[0]=o-r,a-(rs(s[0])>>20&2047)>49&&(r=84784276603689e-45*n-((i=o)-(o=i-(r=20222662487111665e-37*n))-r),s[0]=o-r)),s[1]=o-s[0]-r,n},Qn=1.5707963267341256,Un=6077100506506192e-26,Dn=2*Un,On=3*Un,Bn=4*Un,An=new Array(3),$n=new Array(2);var qn=function(t,e){var s,n,i,o,r,a,l;if((i=2147483647&rs(t))<=1072243195)return e[0]=t,e[1]=0,0;if(i<=1074752122)return 598523==(1048575&i)?Jn(t,i,e):i<=1073928572?t>0?(l=t-Qn,e[0]=l-Un,e[1]=l-e[0]-Un,1):(l=t+Qn,e[0]=l+Un,e[1]=l-e[0]+Un,-1):t>0?(l=t-2*Qn,e[0]=l-Dn,e[1]=l-e[0]-Dn,2):(l=t+2*Qn,e[0]=l+Dn,e[1]=l-e[0]+Dn,-2);if(i<=1075594811)return i<=1075183036?1074977148===i?Jn(t,i,e):t>0?(l=t-3*Qn,e[0]=l-On,e[1]=l-e[0]-On,3):(l=t+3*Qn,e[0]=l+On,e[1]=l-e[0]+On,-3):1075388923===i?Jn(t,i,e):t>0?(l=t-4*Qn,e[0]=l-Bn,e[1]=l-e[0]-Bn,4):(l=t+4*Qn,e[0]=l+Bn,e[1]=l-e[0]+Bn,-4);if(i<1094263291)return Jn(t,i,e);if(i>=2146435072)return e[0]=NaN,e[1]=NaN,0;for(s=vn(t),l=en(i-((n=(i>>20)-1046)<<20),s),r=0;r<2;r++)An[r]=0|l,l=16777216*(l-An[r]);for(An[2]=l,o=3;0===An[o-1];)o-=1;return a=En(An,$n,n,o),t<0?(e[0]=-$n[0],e[1]=-$n[1],-a):(e[0]=$n[0],e[1]=$n[1],a)},ti=qn,ei=[0,0];var si=function(t){var e;if(e=rs(t),(e&=2147483647)<=1072243195)return e<1044381696?1:fn(t,0);if(e>=2146435072)return NaN;switch(3&ti(t,ei)){case 0:return fn(ei[0],ei[1]);case 1:return-yn(ei[0],ei[1]);case 2:return-fn(ei[0],ei[1]);default:return yn(ei[0],ei[1])}},ni=Math.ceil;var ii=function(t){return t<0?ni(t):Xn(t)};var oi=function(t){return 0===t?.16666666666666602:.16666666666666602+t*(t*(6613756321437934e-20+t*(4.1381367970572385e-8*t-16533902205465252e-22))-.0027777777777015593)};var ri=function(t,e,s){var n,i,o;return o=(n=t-e)-(i=n*n)*oi(i),Vn(1-(e-n*o/(2-o)-t),s)},ai=1.4426950408889634,li=1/(1<<28);var ci=function(t){var e;return de(t)||t===us?t:t===ms?0:t>709.782712893384?us:t<-745.1332191019411?0:t>-3.725290298461914e-9&&t<li?1+t:(e=ii(t<0?ai*t-.5:ai*t+.5),ri(t-.6931471803691238*e,1.9082149292705877e-10*e,e))};var di=function(t){return de(t)?t:(t<0&&(t=-t),t>21?ci(t)/2:(ci(t)+ci(-t))/2)};var hi=function(t){return 0===t?-.03333333333333313:t*(.0015873015872548146+t*(t*(4008217827329362e-21+-2.0109921818362437e-7*t)-793650757867488e-19))-.03333333333333313},ui=.6931471803691238,mi=1.9082149292705877e-10,pi=1.4426950408889634;var fi=function(t){var e,s,n,i,o,r,a,l,c,d,h,u;if(t===us||de(t))return t;if(t===ms)return-1;if(0===t)return t;if(t<0?(s=!0,a=-t):(s=!1,a=t),a>=38.816242111356935){if(s)return-1;if(a>=709.782712893384)return us}if(o=0|rs(a),a>.34657359027997264)a<1.0397207708399179?s?(n=t+ui,i=-1.9082149292705877e-10,u=-1):(n=t-ui,i=mi,u=1):(u=s?pi*t-.5:pi*t+.5,n=t-(d=u|=0)*ui,i=d*mi),c=n-(t=n-i)-i;else{if(o<1016070144)return t;u=0}return h=(l=t*(e=.5*t))*(((r=1+l*hi(l))-(d=3-r*e))/(6-t*d)),0===u?t-(t*h-l):(h=t*(h-c)-c,h-=l,-1===u?.5*(t-h)-.5:1===u?t<-.25?-2*(h-(t+.5)):1+2*(t-h):u<=-2||u>56?(n=rs(a=1-(h-t))+(u<<20)|0,(a=hs(a,n))-1):(d=1,u<20?a=(d=hs(d,n=1072693248-(2097152>>u)|0))-(h-t):(a=t-(h+(d=hs(d,n=ps-u<<20))),a+=1),n=rs(a)+(u<<20)|0,hs(a,n)))},bi=!0===ss?0:1,yi=new _e(1),gi=new Ie(yi.buffer);var wi=function(t,e){return yi[0]=t,gi[bi]=e>>>0,yi[0]},Zi=wi;var vi=function(t){return 0===t?.3999999999940942:.3999999999940942+t*(.22222198432149784+.15313837699209373*t)};var Xi=function(t){return 0===t?.6666666666666735:.6666666666666735+t*(.2857142874366239+t*(.1818357216161805+.14798198605116586*t))},Li=1048575;var xi=function(t){var e,s,n,i,o,r,a,l,c,d;return n=rs(t),i=t-1,(Li&2+n)<3?0===i?0:i*i*(.3333333333333333*i-.5):(c=(n&=Li)-398458|0,d=440401-n|0,s=(l=(r=(o=i/(2+i))*o)*r)*vi(l),a=r*Xi(l)+s,(c|=d)>0?o*((e=.5*i*i)+a)-e:o*(a-i))},Si=.4342944818781689;var Gi=function(t){var e,s,n,i,o,r,a;return de(t)||t<0?NaN:0===t?ms:(o=0,(s=rs(t))<1048576&&(o-=54,s=rs(t*=0x40000000000000)),s>=2146435072?t+t:(o+=(s>>20)-ps|0,t=hs(t,(s&=1048575)|1072693248^(i=s+614244&1048576)),r=o+=i>>20,n=xi(t),a=3694239077158931e-28*r+25082946711645275e-27*((t-=1)+n),(a+=(t-(e=Zi(t,0))+n)*Si+e*Si)+.30102999566361177*r))};var Ti=function(t){return 0===t?.3999999999940942:.3999999999940942+t*(.22222198432149784+.15313837699209373*t)};var Wi=function(t){return 0===t?.6666666666666735:.6666666666666735+t*(.2857142874366239+t*(.1818357216161805+.14798198605116586*t))},Ci=1048575;var ki=function(t){var e,s,n,i,o,r,a,l,c,d;return n=rs(t),i=t-1,(Ci&2+n)<3?0===i?0:i*i*(.3333333333333333*i-.5):(c=(n&=Ci)-398458|0,d=440401-n|0,s=(l=(r=(o=i/(2+i))*o)*r)*Ti(l),a=r*Wi(l)+s,(c|=d)>0?o*((e=.5*i*i)+a)-e:o*(a-i))},Pi=1.4426950407214463,Vi=[0,0];var Ii=function(t){var e,s,n,i,o;if(de(t)||t<0)return NaN;if(Ds(Vi,t),o=0,(s=Vi[0])<1048576){if(!(2147483647&s|Vi[1]))return ms;o-=54,s=rs(t*=0x40000000000000)}return s>=2146435072?t+t:(o+=(s>>20)-ps|0,t=hs(t,(s&=1048575)|1072693248^(i=s+614244&1048576)),o+=i>>20,n=ki(t),1.6751713164886512e-10*((t-=1)+n)+(t-(e=Zi(t,0))+n)*Pi+e*Pi+o)},Mi=[0,0];var Ri=function(t){var e;if(e=rs(t),(e&=2147483647)<=1072243195)return e<1045430272?t:yn(t,0);if(e>=2146435072)return NaN;switch(3&ti(t,Mi)){case 0:return yn(Mi[0],Mi[1]);case 1:return fn(Mi[0],Mi[1]);case 2:return-yn(Mi[0],Mi[1]);default:return-fn(Mi[0],Mi[1])}};var Yi=function(t){var e,s;return 0===t?.16666666666666666:((t<0?-t:t)<=1?(e=t*(t*(-.789474443963537*t-163.72585752598383)-11561.443576500522)-351754.9648081514,s=t*(36157.827983443196+t*(1*t-277.7110814206028))-2110529.7888489086):(e=(t=1/t)*(t*(-351754.9648081514*t-11561.443576500522)-163.72585752598383)-.789474443963537,s=1+t*(t*(36157.827983443196+-2110529.7888489086*t)-277.7110814206028)),e/s)},Ni=709.782712893384,Hi=Ni+ws,Ki=Ni-ws;var _i=function(t){var e;return 0===t?t:(e=Ln(t),t>Hi||t<-709.089565712824?t>0?us:ms:e>1?e>=Ki?(e=ci(.5*e),e*=.5*e,t<0&&(e=-e),e):(e=.5*(e=ci(e))-.5/e,t<0&&(e=-e),e):t+t*(e*=e)*Yi(e))};var zi=function(t){return 0===t?.13333333333320124:.13333333333320124+t*(.021869488294859542+t*(.0035920791075913124+t*(.0005880412408202641+t*(7817944429395571e-20+-18558637485527546e-21*t))))};var Fi=function(t){return 0===t?.05396825397622605:.05396825397622605+t*(.0088632398235993+t*(.0014562094543252903+t*(.0002464631348184699+t*(7140724913826082e-20+2590730518636337e-20*t))))};var Ei=function(t,e,s){var n,i,o,r,a,l,c,d,h;return(i=2147483647&(n=rs(t)))>=1072010280&&(t<0&&(t=-t,e=-e),t=(h=.7853981633974483-t)+(d=3061616997868383e-32-e),e=0),r=e+(h=t*t)*((a=h*t)*((r=zi(d=h*h))+(c=h*Fi(d)))+e),d=t+(r+=.3333333333333341*a),i>=1072010280?(1-(n>>30&2))*((c=s)-2*(t-(d*d/(d+c)-r))):1===s?d:(Zi(h=d,0),c=r-(h-t),Zi(l=o=-1/d,0),l+o*((a=1+l*h)+l*c))},ji=[0,0];var Ji=function(t){var e,s;return e=rs(t),(e&=2147483647)<=1072243195?e<1044381696?t:Ei(t,0,1):e>=2146435072?NaN:(s=ti(t,ji),Ei(ji[0],ji[1],1-((1&s)<<1)))};var Qi=function(t){var e,s;return 0===t?-.3333333333333332:((t<0?-t:t)<=1?(e=t*(t*(0*t-.9643991794250523)-99.28772310019185)-1614.6876844170845,s=4844.063053251255+t*(2235.4883906010045+t*(112.81167849163293+1*t))):(e=0+(t=1/t)*(t*(-1614.6876844170845*t-99.28772310019185)-.9643991794250523),s=1+t*(112.81167849163293+t*(2235.4883906010045+4844.063053251255*t))),e/s)};var Ui=function(t){var e,s;if((s=Ln(t))>44.014845965556525)return t<0?-1:1;if(s>=.625)s=1-2/((e=ci(2*s))+1),t<0&&(s=-s);else{if(0===t)return t;s=t+t*(e=t*t)*Qi(e)}return s};void 0===globalThis.CroquetMath&&(globalThis.CroquetMath={}),Object.assign(globalThis.CroquetMath,{acos:be,acosh:Gs,asin:fe,asinh:Cs,atan:Ms,atanh:Hs,atan2:an,cbrt:un,cos:si,cosh:di,exp:ci,expm1:fi,log:Ss,log1p:gs,log10:Gi,log2:Ii,sin:Ri,sinh:_i,tan:Ji,tanh:Ui});const Di=Math.pow;function Oi(t){return t===1/0||t===-1/0}var Bi,Ai;globalThis.CroquetMath.pow=(t,e)=>{if(isNaN(t)||isNaN(e))return NaN;if(Oi(t)||Oi(e))return Di(t,e);if(0===t||0===e)return Di(t,e);if(t<0&&!function(t){return Number.isInteger(t)}(e))return NaN;if(1===e)return t;if(2===e)return t*t;if(3===e)return t*t*t;if(4===e)return t*t*t*t;let s=1;t<0&&(t*=-1,s=Di(-1,e));return globalThis.CroquetMath.exp(globalThis.CroquetMath.log(t)*e)*s};var $i=function(){if(Ai)return Bi;Ai=1;var t=function(t,e){return t<e};function e(s){if(!(this instanceof e))return new e(s);this.array=[],this.size=0,this.compare=s||t}return e.prototype.clone=function(){var t=new e(this.compare);return t.size=this.size,t.array=this.array.slice(0,this.size),t},e.prototype.add=function(t){var e,s,n=this.size;for(this.array[this.size]=t,this.size+=1;n>0&&(e=n-1>>1,s=this.array[e],this.compare(t,s));)this.array[n]=s,n=e;this.array[n]=t},e.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},e.prototype._percolateUp=function(t,e){for(var s,n,i=this.array[t];t>0&&(s=t-1>>1,n=this.array[s],e||this.compare(i,n));)this.array[t]=n,t=s;this.array[t]=i},e.prototype._percolateDown=function(t){for(var e,s,n,i=this.size,o=this.size>>>1,r=this.array[t];t<o&&(s=(e=1+(t<<1))+1,n=this.array[e],s<i&&this.compare(this.array[s],n)&&(e=s,n=this.array[s]),this.compare(n,r));)this.array[t]=n,t=e;this.array[t]=r},e.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},e.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},e.prototype.removeOne=function(t){if("function"==typeof t)for(var e=0;e<this.size;e++)if(t(this.array[e]))return this._removeAt(e)},e.prototype.removeMany=function(t,e){if("function"!=typeof t||this.size<1)return[];e=e?Math.min(e,this.size):this.size;for(var s=0,n=new Array(e),i=0,o=new Array(this.size);s<e&&!this.isEmpty();){var r=this.poll();t(r)?n[s++]=r:o[i++]=r}n.length=s;for(var a=0;a<i;)this.add(o[a++]);return n},e.prototype.peek=function(){if(0!=this.size)return this.array[0]},e.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},e.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},e.prototype.trim=function(){this.array=this.array.slice(0,this.size)},e.prototype.isEmpty=function(){return 0===this.size},e.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,s=this.clone();!s.isEmpty();)t(s.poll(),e++)},e.prototype.kSmallest=function(t){if(0==this.size||t<=0)return[];t=Math.min(this.size,t);const s=Math.min(this.size,2**(t-1)+1);if(s<2)return[this.peek()];const n=new e(this.compare);n.size=s,n.array=this.array.slice(0,s);const i=new Array(t);for(let e=0;e<t;e++)i[e]=n.poll();return i},Bi=e}(),qi=s($i);class to extends qi{poll(){const t=super.poll();return this.array[this.size]=null,t}asArray(){const t=[];return this.forEach((e=>t.push(e))),t}asUnsortedArray(){return this.array.slice(0,this.size)}}var eo,so={exports:{}};function no(){return eo||(eo=1,function(t){var e;t.exports=(e=N(),function(){var t=e,s=t.lib.WordArray;function n(t,e,n){for(var i=[],o=0,r=0;r<e;r++)if(r%4){var a=n[t.charCodeAt(r-1)]<<r%4*2|n[t.charCodeAt(r)]>>>6-r%4*2;i[o>>>2]|=a<<24-o%4*8,o++}return s.create(i,o)}t.enc.Base64={stringify:function(t){var e=t.words,s=t.sigBytes,n=this._map;t.clamp();for(var i=[],o=0;o<s;o+=3)for(var r=(e[o>>>2]>>>24-o%4*8&255)<<16|(e[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|e[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<s;a++)i.push(n.charAt(r>>>6*(3-a)&63));var l=n.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(t){var e=t.length,s=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<s.length;o++)i[s.charCodeAt(o)]=o}var r=s.charAt(64);if(r){var a=t.indexOf(r);-1!==a&&(e=a)}return n(t,e,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64)}(so)),so.exports}var io,oo=s(no()),ro=N(),ao={exports:{}};var lo,co=(io||(io=1,function(t){t.exports=N().enc.Utf8}(ao)),ao.exports),ho=s(co),uo={exports:{}},mo={exports:{}};function po(){return lo||(lo=1,function(t){var e;t.exports=(e=N(),void function(){var t=e,s=t.lib.Base,n=t.enc.Utf8;t.algo.HMAC=s.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=n.parse(e));var s=t.blockSize,i=4*s;e.sigBytes>i&&(e=t.finalize(e)),e.clamp();for(var o=this._oKey=e.clone(),r=this._iKey=e.clone(),a=o.words,l=r.words,c=0;c<s;c++)a[c]^=1549556828,l[c]^=909522486;o.sigBytes=r.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,s=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(s))}})}())}(mo)),mo.exports}var fo;var bo,yo=(fo||(fo=1,function(t){var e;t.exports=(e=N(),E(),po(),function(){var t=e,s=t.lib,n=s.Base,i=s.WordArray,o=t.algo,r=o.SHA256,a=o.HMAC,l=o.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:r,iterations:25e4}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var s=this.cfg,n=a.create(s.hasher,t),o=i.create(),r=i.create([1]),l=o.words,c=r.words,d=s.keySize,h=s.iterations;l.length<d;){var u=n.update(e).finalize(r);n.reset();for(var m=u.words,p=m.length,f=u,b=1;b<h;b++){f=n.finalize(f),n.reset();for(var y=f.words,g=0;g<p;g++)m[g]^=y[g]}o.concat(u),c[0]++}return o.sigBytes=4*d,o}});t.PBKDF2=function(t,e,s){return l.create(s).compute(t,e)}}(),e.PBKDF2)}(uo)),uo.exports),go=s(yo),wo={exports:{}},Zo={exports:{}};function vo(){return bo||(bo=1,function(t){var e;t.exports=(e=N(),function(t){var s=e,n=s.lib,i=n.WordArray,o=n.Hasher,r=s.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var l=r.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var s=0;s<16;s++){var n=e+s,i=t[n];t[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,r=t[e+0],l=t[e+1],m=t[e+2],p=t[e+3],f=t[e+4],b=t[e+5],y=t[e+6],g=t[e+7],w=t[e+8],Z=t[e+9],v=t[e+10],X=t[e+11],L=t[e+12],x=t[e+13],S=t[e+14],G=t[e+15],T=o[0],W=o[1],C=o[2],k=o[3];T=c(T,W,C,k,r,7,a[0]),k=c(k,T,W,C,l,12,a[1]),C=c(C,k,T,W,m,17,a[2]),W=c(W,C,k,T,p,22,a[3]),T=c(T,W,C,k,f,7,a[4]),k=c(k,T,W,C,b,12,a[5]),C=c(C,k,T,W,y,17,a[6]),W=c(W,C,k,T,g,22,a[7]),T=c(T,W,C,k,w,7,a[8]),k=c(k,T,W,C,Z,12,a[9]),C=c(C,k,T,W,v,17,a[10]),W=c(W,C,k,T,X,22,a[11]),T=c(T,W,C,k,L,7,a[12]),k=c(k,T,W,C,x,12,a[13]),C=c(C,k,T,W,S,17,a[14]),T=d(T,W=c(W,C,k,T,G,22,a[15]),C,k,l,5,a[16]),k=d(k,T,W,C,y,9,a[17]),C=d(C,k,T,W,X,14,a[18]),W=d(W,C,k,T,r,20,a[19]),T=d(T,W,C,k,b,5,a[20]),k=d(k,T,W,C,v,9,a[21]),C=d(C,k,T,W,G,14,a[22]),W=d(W,C,k,T,f,20,a[23]),T=d(T,W,C,k,Z,5,a[24]),k=d(k,T,W,C,S,9,a[25]),C=d(C,k,T,W,p,14,a[26]),W=d(W,C,k,T,w,20,a[27]),T=d(T,W,C,k,x,5,a[28]),k=d(k,T,W,C,m,9,a[29]),C=d(C,k,T,W,g,14,a[30]),T=h(T,W=d(W,C,k,T,L,20,a[31]),C,k,b,4,a[32]),k=h(k,T,W,C,w,11,a[33]),C=h(C,k,T,W,X,16,a[34]),W=h(W,C,k,T,S,23,a[35]),T=h(T,W,C,k,l,4,a[36]),k=h(k,T,W,C,f,11,a[37]),C=h(C,k,T,W,g,16,a[38]),W=h(W,C,k,T,v,23,a[39]),T=h(T,W,C,k,x,4,a[40]),k=h(k,T,W,C,r,11,a[41]),C=h(C,k,T,W,p,16,a[42]),W=h(W,C,k,T,y,23,a[43]),T=h(T,W,C,k,Z,4,a[44]),k=h(k,T,W,C,L,11,a[45]),C=h(C,k,T,W,G,16,a[46]),T=u(T,W=h(W,C,k,T,m,23,a[47]),C,k,r,6,a[48]),k=u(k,T,W,C,g,10,a[49]),C=u(C,k,T,W,S,15,a[50]),W=u(W,C,k,T,b,21,a[51]),T=u(T,W,C,k,L,6,a[52]),k=u(k,T,W,C,p,10,a[53]),C=u(C,k,T,W,v,15,a[54]),W=u(W,C,k,T,l,21,a[55]),T=u(T,W,C,k,w,6,a[56]),k=u(k,T,W,C,G,10,a[57]),C=u(C,k,T,W,y,15,a[58]),W=u(W,C,k,T,x,21,a[59]),T=u(T,W,C,k,f,6,a[60]),k=u(k,T,W,C,X,10,a[61]),C=u(C,k,T,W,m,15,a[62]),W=u(W,C,k,T,Z,21,a[63]),o[0]=o[0]+T|0,o[1]=o[1]+W|0,o[2]=o[2]+C|0,o[3]=o[3]+k|0},_doFinalize:function(){var e=this._data,s=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;s[i>>>5]|=128<<24-i%32;var o=t.floor(n/4294967296),r=n;s[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),s[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(s.length+1),this._process();for(var a=this._hash,l=a.words,c=0;c<4;c++){var d=l[c];l[c]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return a},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});function c(t,e,s,n,i,o,r){var a=t+(e&s|~e&n)+i+r;return(a<<o|a>>>32-o)+e}function d(t,e,s,n,i,o,r){var a=t+(e&n|s&~n)+i+r;return(a<<o|a>>>32-o)+e}function h(t,e,s,n,i,o,r){var a=t+(e^s^n)+i+r;return(a<<o|a>>>32-o)+e}function u(t,e,s,n,i,o,r){var a=t+(s^(e|~n))+i+r;return(a<<o|a>>>32-o)+e}s.MD5=o._createHelper(l),s.HmacMD5=o._createHmacHelper(l)}(Math),e.MD5)}(Zo)),Zo.exports}var Xo,Lo={exports:{}},xo={exports:{}};function So(){return Xo||(Xo=1,function(t){var e;t.exports=(e=N(),function(){var t=e,s=t.lib,n=s.WordArray,i=s.Hasher,o=t.algo,r=[],a=o.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var s=this._hash.words,n=s[0],i=s[1],o=s[2],a=s[3],l=s[4],c=0;c<80;c++){if(c<16)r[c]=0|t[e+c];else{var d=r[c-3]^r[c-8]^r[c-14]^r[c-16];r[c]=d<<1|d>>>31}var h=(n<<5|n>>>27)+l+r[c];h+=c<20?1518500249+(i&o|~i&a):c<40?1859775393+(i^o^a):c<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,l=a,a=o,o=i<<30|i>>>2,i=n,n=h}s[0]=s[0]+n|0,s[1]=s[1]+i|0,s[2]=s[2]+o|0,s[3]=s[3]+a|0,s[4]=s[4]+l|0},_doFinalize:function(){var t=this._data,e=t.words,s=8*this._nDataBytes,n=8*t.sigBytes;return e[n>>>5]|=128<<24-n%32,e[14+(n+64>>>9<<4)]=Math.floor(s/4294967296),e[15+(n+64>>>9<<4)]=s,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=i._createHelper(a),t.HmacSHA1=i._createHmacHelper(a)}(),e.SHA1)}(xo)),xo.exports}var Go;function To(){return Go||(Go=1,function(t){var e;t.exports=(e=N(),So(),po(),function(){var t=e,s=t.lib,n=s.Base,i=s.WordArray,o=t.algo,r=o.MD5,a=o.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:r,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var s,n=this.cfg,o=n.hasher.create(),r=i.create(),a=r.words,l=n.keySize,c=n.iterations;a.length<l;){s&&o.update(s),s=o.update(t).finalize(e),o.reset();for(var d=1;d<c;d++)s=o.finalize(s),o.reset();r.concat(s)}return r.sigBytes=4*l,r}});t.EvpKDF=function(t,e,s){return a.create(s).compute(t,e)}}(),e.EvpKDF)}(Lo)),Lo.exports}var Wo,Co={exports:{}};var ko;var Po,Vo=(ko||(ko=1,function(t){var e;t.exports=(e=N(),no(),vo(),To(),Wo||(Wo=1,function(t){var e;t.exports=(e=N(),To(),void(e.lib.Cipher||function(t){var s=e,n=s.lib,i=n.Base,o=n.WordArray,r=n.BufferedBlockAlgorithm,a=s.enc;a.Utf8;var l=a.Base64,c=s.algo.EvpKDF,d=n.Cipher=r.extend({cfg:i.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,s){this.cfg=this.cfg.extend(s),this._xformMode=t,this._key=e,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?w:y}return function(e){return{encrypt:function(s,n,i){return t(n).encrypt(e,s,n,i)},decrypt:function(s,n,i){return t(n).decrypt(e,s,n,i)}}}}()});n.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var h=s.mode={},u=n.BlockCipherMode=i.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),m=h.CBC=function(){var e=u.extend();function s(e,s,n){var i,o=this._iv;o?(i=o,this._iv=t):i=this._prevBlock;for(var r=0;r<n;r++)e[s+r]^=i[r]}return e.Encryptor=e.extend({processBlock:function(t,e){var n=this._cipher,i=n.blockSize;s.call(this,t,e,i),n.encryptBlock(t,e),this._prevBlock=t.slice(e,e+i)}}),e.Decryptor=e.extend({processBlock:function(t,e){var n=this._cipher,i=n.blockSize,o=t.slice(e,e+i);n.decryptBlock(t,e),s.call(this,t,e,i),this._prevBlock=o}}),e}(),p=(s.pad={}).Pkcs7={pad:function(t,e){for(var s=4*e,n=s-t.sigBytes%s,i=n<<24|n<<16|n<<8|n,r=[],a=0;a<n;a+=4)r.push(i);var l=o.create(r,n);t.concat(l)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}};n.BlockCipher=d.extend({cfg:d.cfg.extend({mode:m,padding:p}),reset:function(){var t;d.reset.call(this);var e=this.cfg,s=e.iv,n=e.mode;this._xformMode==this._ENC_XFORM_MODE?t=n.createEncryptor:(t=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,s&&s.words):(this._mode=t.call(n,this,s&&s.words),this._mode.__creator=t)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t,e=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(e.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),e.unpad(t)),t},blockSize:4});var f=n.CipherParams=i.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),b=(s.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext,s=t.salt;return(s?o.create([1398893684,1701076831]).concat(s).concat(e):e).toString(l)},parse:function(t){var e,s=l.parse(t),n=s.words;return 1398893684==n[0]&&1701076831==n[1]&&(e=o.create(n.slice(2,4)),n.splice(0,4),s.sigBytes-=16),f.create({ciphertext:s,salt:e})}},y=n.SerializableCipher=i.extend({cfg:i.extend({format:b}),encrypt:function(t,e,s,n){n=this.cfg.extend(n);var i=t.createEncryptor(s,n),o=i.finalize(e),r=i.cfg;return f.create({ciphertext:o,key:s,iv:r.iv,algorithm:t,mode:r.mode,padding:r.padding,blockSize:t.blockSize,formatter:n.format})},decrypt:function(t,e,s,n){return n=this.cfg.extend(n),e=this._parse(e,n.format),t.createDecryptor(s,n).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),g=(s.kdf={}).OpenSSL={execute:function(t,e,s,n,i){if(n||(n=o.random(8)),i)r=c.create({keySize:e+s,hasher:i}).compute(t,n);else var r=c.create({keySize:e+s}).compute(t,n);var a=o.create(r.words.slice(e),4*s);return r.sigBytes=4*e,f.create({key:r,iv:a,salt:n})}},w=n.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:g}),encrypt:function(t,e,s,n){var i=(n=this.cfg.extend(n)).kdf.execute(s,t.keySize,t.ivSize,n.salt,n.hasher);n.iv=i.iv;var o=y.encrypt.call(this,t,e,i.key,n);return o.mixIn(i),o},decrypt:function(t,e,s,n){n=this.cfg.extend(n),e=this._parse(e,n.format);var i=n.kdf.execute(s,t.keySize,t.ivSize,e.salt,n.hasher);return n.iv=i.iv,y.decrypt.call(this,t,e,i.key,n)}})}()))}(Co)),function(){var t=e,s=t.lib.BlockCipher,n=t.algo,i=[],o=[],r=[],a=[],l=[],c=[],d=[],h=[],u=[],m=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;var s=0,n=0;for(e=0;e<256;e++){var p=n^n<<1^n<<2^n<<3^n<<4;p=p>>>8^255&p^99,i[s]=p,o[p]=s;var f=t[s],b=t[f],y=t[b],g=257*t[p]^16843008*p;r[s]=g<<24|g>>>8,a[s]=g<<16|g>>>16,l[s]=g<<8|g>>>24,c[s]=g,g=16843009*y^65537*b^257*f^16843008*s,d[p]=g<<24|g>>>8,h[p]=g<<16|g>>>16,u[p]=g<<8|g>>>24,m[p]=g,s?(s=f^t[t[t[y^f]]],n^=t[t[n]]):s=n=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],f=n.AES=s.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,s=t.sigBytes/4,n=4*((this._nRounds=s+6)+1),o=this._keySchedule=[],r=0;r<n;r++)r<s?o[r]=e[r]:(c=o[r-1],r%s?s>6&&r%s==4&&(c=i[c>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c]):(c=i[(c=c<<8|c>>>24)>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c],c^=p[r/s|0]<<24),o[r]=o[r-s]^c);for(var a=this._invKeySchedule=[],l=0;l<n;l++){if(r=n-l,l%4)var c=o[r];else c=o[r-4];a[l]=l<4||r<=4?c:d[i[c>>>24]]^h[i[c>>>16&255]]^u[i[c>>>8&255]]^m[i[255&c]]}}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,r,a,l,c,i)},decryptBlock:function(t,e){var s=t[e+1];t[e+1]=t[e+3],t[e+3]=s,this._doCryptBlock(t,e,this._invKeySchedule,d,h,u,m,o),s=t[e+1],t[e+1]=t[e+3],t[e+3]=s},_doCryptBlock:function(t,e,s,n,i,o,r,a){for(var l=this._nRounds,c=t[e]^s[0],d=t[e+1]^s[1],h=t[e+2]^s[2],u=t[e+3]^s[3],m=4,p=1;p<l;p++){var f=n[c>>>24]^i[d>>>16&255]^o[h>>>8&255]^r[255&u]^s[m++],b=n[d>>>24]^i[h>>>16&255]^o[u>>>8&255]^r[255&c]^s[m++],y=n[h>>>24]^i[u>>>16&255]^o[c>>>8&255]^r[255&d]^s[m++],g=n[u>>>24]^i[c>>>16&255]^o[d>>>8&255]^r[255&h]^s[m++];c=f,d=b,h=y,u=g}f=(a[c>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^s[m++],b=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&c])^s[m++],y=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[c>>>8&255]<<8|a[255&d])^s[m++],g=(a[u>>>24]<<24|a[c>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^s[m++],t[e]=f,t[e+1]=b,t[e+2]=y,t[e+3]=g},keySize:8});t.AES=s._createHelper(f)}(),e.AES)}(wo)),wo.exports),Io=s(Vo),Mo={exports:{}};var Ro=(Po||(Po=1,function(t){var e;t.exports=(e=N(),E(),po(),e.HmacSHA256)}(Mo)),Mo.exports),Yo=s(Ro);function No(t){let e=t.length;for(;--e>=0;)t[e]=0}const Ho=256,Ko=286,_o=30,zo=15,Fo=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Eo=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),jo=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Jo=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Qo=new Array(576);No(Qo);const Uo=new Array(60);No(Uo);const Do=new Array(512);No(Do);const Oo=new Array(256);No(Oo);const Bo=new Array(29);No(Bo);const Ao=new Array(_o);function $o(t,e,s,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=s,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}let qo,tr,er;function sr(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}No(Ao);const nr=t=>t<256?Do[t]:Do[256+(t>>>7)],ir=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},or=(t,e,s)=>{t.bi_valid>16-s?(t.bi_buf|=e<<t.bi_valid&65535,ir(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=s)},rr=(t,e,s)=>{or(t,s[2*e],s[2*e+1])},ar=(t,e)=>{let s=0;do{s|=1&t,t>>>=1,s<<=1}while(--e>0);return s>>>1},lr=(t,e,s)=>{const n=new Array(16);let i,o,r=0;for(i=1;i<=zo;i++)r=r+s[i-1]<<1,n[i]=r;for(o=0;o<=e;o++){let e=t[2*o+1];0!==e&&(t[2*o]=ar(n[e]++,e))}},cr=t=>{let e;for(e=0;e<Ko;e++)t.dyn_ltree[2*e]=0;for(e=0;e<_o;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},dr=t=>{t.bi_valid>8?ir(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},hr=(t,e,s,n)=>{const i=2*e,o=2*s;return t[i]<t[o]||t[i]===t[o]&&n[e]<=n[s]},ur=(t,e,s)=>{const n=t.heap[s];let i=s<<1;for(;i<=t.heap_len&&(i<t.heap_len&&hr(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!hr(e,n,t.heap[i],t.depth));)t.heap[s]=t.heap[i],s=i,i<<=1;t.heap[s]=n},mr=(t,e,s)=>{let n,i,o,r,a=0;if(0!==t.sym_next)do{n=255&t.pending_buf[t.sym_buf+a++],n+=(255&t.pending_buf[t.sym_buf+a++])<<8,i=t.pending_buf[t.sym_buf+a++],0===n?rr(t,i,e):(o=Oo[i],rr(t,o+Ho+1,e),r=Fo[o],0!==r&&(i-=Bo[o],or(t,i,r)),n--,o=nr(n),rr(t,o,s),r=Eo[o],0!==r&&(n-=Ao[o],or(t,n,r)))}while(a<t.sym_next);rr(t,256,e)},pr=(t,e)=>{const s=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,o=e.stat_desc.elems;let r,a,l,c=-1;for(t.heap_len=0,t.heap_max=573,r=0;r<o;r++)0!==s[2*r]?(t.heap[++t.heap_len]=c=r,t.depth[r]=0):s[2*r+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,s[2*l]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=n[2*l+1]);for(e.max_code=c,r=t.heap_len>>1;r>=1;r--)ur(t,s,r);l=o;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],ur(t,s,1),a=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=a,s[2*l]=s[2*r]+s[2*a],t.depth[l]=(t.depth[r]>=t.depth[a]?t.depth[r]:t.depth[a])+1,s[2*r+1]=s[2*a+1]=l,t.heap[1]=l++,ur(t,s,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const s=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,o=e.stat_desc.has_stree,r=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,l=e.stat_desc.max_length;let c,d,h,u,m,p,f=0;for(u=0;u<=zo;u++)t.bl_count[u]=0;for(s[2*t.heap[t.heap_max]+1]=0,c=t.heap_max+1;c<573;c++)d=t.heap[c],u=s[2*s[2*d+1]+1]+1,u>l&&(u=l,f++),s[2*d+1]=u,d>n||(t.bl_count[u]++,m=0,d>=a&&(m=r[d-a]),p=s[2*d],t.opt_len+=p*(u+m),o&&(t.static_len+=p*(i[2*d+1]+m)));if(0!==f){do{for(u=l-1;0===t.bl_count[u];)u--;t.bl_count[u]--,t.bl_count[u+1]+=2,t.bl_count[l]--,f-=2}while(f>0);for(u=l;0!==u;u--)for(d=t.bl_count[u];0!==d;)h=t.heap[--c],h>n||(s[2*h+1]!==u&&(t.opt_len+=(u-s[2*h+1])*s[2*h],s[2*h+1]=u),d--)}})(t,e),lr(s,c,t.bl_count)},fr=(t,e,s)=>{let n,i,o=-1,r=e[1],a=0,l=7,c=4;for(0===r&&(l=138,c=3),e[2*(s+1)+1]=65535,n=0;n<=s;n++)i=r,r=e[2*(n+1)+1],++a<l&&i===r||(a<c?t.bl_tree[2*i]+=a:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,o=i,0===r?(l=138,c=3):i===r?(l=6,c=3):(l=7,c=4))},br=(t,e,s)=>{let n,i,o=-1,r=e[1],a=0,l=7,c=4;for(0===r&&(l=138,c=3),n=0;n<=s;n++)if(i=r,r=e[2*(n+1)+1],!(++a<l&&i===r)){if(a<c)do{rr(t,i,t.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&(rr(t,i,t.bl_tree),a--),rr(t,16,t.bl_tree),or(t,a-3,2)):a<=10?(rr(t,17,t.bl_tree),or(t,a-3,3)):(rr(t,18,t.bl_tree),or(t,a-11,7));a=0,o=i,0===r?(l=138,c=3):i===r?(l=6,c=3):(l=7,c=4)}};let yr=!1;const gr=(t,e,s,n)=>{or(t,0+(n?1:0),3),dr(t),ir(t,s),ir(t,~s),s&&t.pending_buf.set(t.window.subarray(e,e+s),t.pending),t.pending+=s};var wr=(t,e,s,n)=>{let i,o,r=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,s=4093624447;for(e=0;e<=31;e++,s>>>=1)if(1&s&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<Ho;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),pr(t,t.l_desc),pr(t,t.d_desc),r=(t=>{let e;for(fr(t,t.dyn_ltree,t.l_desc.max_code),fr(t,t.dyn_dtree,t.d_desc.max_code),pr(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*Jo[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),i=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=i&&(i=o)):i=o=s+5,s+4<=i&&-1!==e?gr(t,e,s,n):4===t.strategy||o===i?(or(t,2+(n?1:0),3),mr(t,Qo,Uo)):(or(t,4+(n?1:0),3),((t,e,s,n)=>{let i;for(or(t,e-257,5),or(t,s-1,5),or(t,n-4,4),i=0;i<n;i++)or(t,t.bl_tree[2*Jo[i]+1],3);br(t,t.dyn_ltree,e-1),br(t,t.dyn_dtree,s-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,r+1),mr(t,t.dyn_ltree,t.dyn_dtree)),cr(t),n&&dr(t)},Zr={_tr_init:t=>{yr||((()=>{let t,e,s,n,i;const o=new Array(16);for(s=0,n=0;n<28;n++)for(Bo[n]=s,t=0;t<1<<Fo[n];t++)Oo[s++]=n;for(Oo[s-1]=n,i=0,n=0;n<16;n++)for(Ao[n]=i,t=0;t<1<<Eo[n];t++)Do[i++]=n;for(i>>=7;n<_o;n++)for(Ao[n]=i<<7,t=0;t<1<<Eo[n]-7;t++)Do[256+i++]=n;for(e=0;e<=zo;e++)o[e]=0;for(t=0;t<=143;)Qo[2*t+1]=8,t++,o[8]++;for(;t<=255;)Qo[2*t+1]=9,t++,o[9]++;for(;t<=279;)Qo[2*t+1]=7,t++,o[7]++;for(;t<=287;)Qo[2*t+1]=8,t++,o[8]++;for(lr(Qo,287,o),t=0;t<_o;t++)Uo[2*t+1]=5,Uo[2*t]=ar(t,5);qo=new $o(Qo,Fo,257,Ko,zo),tr=new $o(Uo,Eo,0,_o,zo),er=new $o(new Array(0),jo,0,19,7)})(),yr=!0),t.l_desc=new sr(t.dyn_ltree,qo),t.d_desc=new sr(t.dyn_dtree,tr),t.bl_desc=new sr(t.bl_tree,er),t.bi_buf=0,t.bi_valid=0,cr(t)},_tr_stored_block:gr,_tr_flush_block:wr,_tr_tally:(t,e,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,0===e?t.dyn_ltree[2*s]++:(t.matches++,e--,t.dyn_ltree[2*(Oo[s]+Ho+1)]++,t.dyn_dtree[2*nr(e)]++),t.sym_next===t.sym_end),_tr_align:t=>{or(t,2,3),rr(t,256,Qo),(t=>{16===t.bi_valid?(ir(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var vr=(t,e,s,n)=>{let i=65535&t,o=t>>>16&65535,r=0;for(;0!==s;){r=s>2e3?2e3:s,s-=r;do{i=i+e[n++]|0,o=o+i|0}while(--r);i%=65521,o%=65521}return i|o<<16};const Xr=new Uint32Array((()=>{let t,e=[];for(var s=0;s<256;s++){t=s;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[s]=t}return e})());var Lr=(t,e,s,n)=>{const i=Xr,o=n+s;t^=-1;for(let s=n;s<o;s++)t=t>>>8^i[255&(t^e[s])];return~t},xr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Sr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Gr,_tr_stored_block:Tr,_tr_flush_block:Wr,_tr_tally:Cr,_tr_align:kr}=Zr,{Z_NO_FLUSH:Pr,Z_PARTIAL_FLUSH:Vr,Z_FULL_FLUSH:Ir,Z_FINISH:Mr,Z_BLOCK:Rr,Z_OK:Yr,Z_STREAM_END:Nr,Z_STREAM_ERROR:Hr,Z_DATA_ERROR:Kr,Z_BUF_ERROR:_r,Z_DEFAULT_COMPRESSION:zr,Z_FILTERED:Fr,Z_HUFFMAN_ONLY:Er,Z_RLE:jr,Z_FIXED:Jr,Z_DEFAULT_STRATEGY:Qr,Z_UNKNOWN:Ur,Z_DEFLATED:Dr}=Sr,Or=258,Br=262,Ar=42,$r=113,qr=666,ta=(t,e)=>(t.msg=xr[e],e),ea=t=>2*t-(t>4?9:0),sa=t=>{let e=t.length;for(;--e>=0;)t[e]=0},na=t=>{let e,s,n,i=t.w_size;e=t.hash_size,n=e;do{s=t.head[--n],t.head[n]=s>=i?s-i:0}while(--e);e=i,n=e;do{s=t.prev[--n],t.prev[n]=s>=i?s-i:0}while(--e)};let ia=(t,e,s)=>(e<<t.hash_shift^s)&t.hash_mask;const oa=t=>{const e=t.state;let s=e.pending;s>t.avail_out&&(s=t.avail_out),0!==s&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+s),t.next_out),t.next_out+=s,e.pending_out+=s,t.total_out+=s,t.avail_out-=s,e.pending-=s,0===e.pending&&(e.pending_out=0))},ra=(t,e)=>{Wr(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,oa(t.strm)},aa=(t,e)=>{t.pending_buf[t.pending++]=e},la=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},ca=(t,e,s,n)=>{let i=t.avail_in;return i>n&&(i=n),0===i?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),s),1===t.state.wrap?t.adler=vr(t.adler,e,i,s):2===t.state.wrap&&(t.adler=Lr(t.adler,e,i,s)),t.next_in+=i,t.total_in+=i,i)},da=(t,e)=>{let s,n,i=t.max_chain_length,o=t.strstart,r=t.prev_length,a=t.nice_match;const l=t.strstart>t.w_size-Br?t.strstart-(t.w_size-Br):0,c=t.window,d=t.w_mask,h=t.prev,u=t.strstart+Or;let m=c[o+r-1],p=c[o+r];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do{if(s=e,c[s+r]===p&&c[s+r-1]===m&&c[s]===c[o]&&c[++s]===c[o+1]){o+=2,s++;do{}while(c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&o<u);if(n=Or-(u-o),o=u-Or,n>r){if(t.match_start=e,r=n,n>=a)break;m=c[o+r-1],p=c[o+r]}}}while((e=h[e&d])>l&&0!=--i);return r<=t.lookahead?r:t.lookahead},ha=t=>{const e=t.w_size;let s,n,i;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Br)&&(t.window.set(t.window.subarray(e,e+e-n),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),na(t),n+=e),0===t.strm.avail_in)break;if(s=ca(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=s,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=ia(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=ia(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Br&&0!==t.strm.avail_in)},ua=(t,e)=>{let s,n,i,o=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r=0,a=t.strm.avail_in;do{if(s=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i)break;if(i=t.strm.avail_out-i,n=t.strstart-t.block_start,s>n+t.strm.avail_in&&(s=n+t.strm.avail_in),s>i&&(s=i),s<o&&(0===s&&e!==Mr||e===Pr||s!==n+t.strm.avail_in))break;r=e===Mr&&s===n+t.strm.avail_in?1:0,Tr(t,0,0,r),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,oa(t.strm),n&&(n>s&&(n=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+n),t.strm.next_out),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n,t.block_start+=n,s-=n),s&&(ca(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(0===r);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),r?4:e!==Pr&&e!==Mr&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(ca(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,o=i>t.w_size?t.w_size:i,n=t.strstart-t.block_start,(n>=o||(n||e===Mr)&&e!==Pr&&0===t.strm.avail_in&&n<=i)&&(s=n>i?i:n,r=e===Mr&&0===t.strm.avail_in&&s===n?1:0,Tr(t,t.block_start,s,r),t.block_start+=s,oa(t.strm)),r?3:1)},ma=(t,e)=>{let s,n;for(;;){if(t.lookahead<Br){if(ha(t),t.lookahead<Br&&e===Pr)return 1;if(0===t.lookahead)break}if(s=0,t.lookahead>=3&&(t.ins_h=ia(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==s&&t.strstart-s<=t.w_size-Br&&(t.match_length=da(t,s)),t.match_length>=3)if(n=Cr(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=ia(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ia(t,t.ins_h,t.window[t.strstart+1]);else n=Cr(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(ra(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Mr?(ra(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ra(t,!1),0===t.strm.avail_out)?1:2},pa=(t,e)=>{let s,n,i;for(;;){if(t.lookahead<Br){if(ha(t),t.lookahead<Br&&e===Pr)return 1;if(0===t.lookahead)break}if(s=0,t.lookahead>=3&&(t.ins_h=ia(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==s&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-Br&&(t.match_length=da(t,s),t.match_length<=5&&(t.strategy===Fr||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,n=Cr(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=ia(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(ra(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(n=Cr(t,0,t.window[t.strstart-1]),n&&ra(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=Cr(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Mr?(ra(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ra(t,!1),0===t.strm.avail_out)?1:2};function fa(t,e,s,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=s,this.max_chain=n,this.func=i}const ba=[new fa(0,0,0,0,ua),new fa(4,4,8,4,ma),new fa(4,5,16,8,ma),new fa(4,6,32,32,ma),new fa(4,4,16,16,pa),new fa(8,16,32,32,pa),new fa(8,16,128,128,pa),new fa(8,32,128,256,pa),new fa(32,128,258,1024,pa),new fa(32,258,258,4096,pa)];function ya(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Dr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),sa(this.dyn_ltree),sa(this.dyn_dtree),sa(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),sa(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),sa(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ga=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Ar&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==$r&&e.status!==qr?1:0},wa=t=>{if(ga(t))return ta(t,Hr);t.total_in=t.total_out=0,t.data_type=Ur;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?Ar:$r,t.adler=2===e.wrap?0:1,e.last_flush=-2,Gr(e),Yr},Za=t=>{const e=wa(t);var s;return e===Yr&&((s=t.state).window_size=2*s.w_size,sa(s.head),s.max_lazy_match=ba[s.level].max_lazy,s.good_match=ba[s.level].good_length,s.nice_match=ba[s.level].nice_length,s.max_chain_length=ba[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),e},va=(t,e,s,n,i,o)=>{if(!t)return Hr;let r=1;if(e===zr&&(e=6),n<0?(r=0,n=-n):n>15&&(r=2,n-=16),i<1||i>9||s!==Dr||n<8||n>15||e<0||e>9||o<0||o>Jr||8===n&&1!==r)return ta(t,Hr);8===n&&(n=9);const a=new ya;return t.state=a,a.strm=t,a.status=Ar,a.wrap=r,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=o,a.method=s,Za(t)};var Xa=(t,e)=>{if(ga(t)||e>Rr||e<0)return t?ta(t,Hr):Hr;const s=t.state;if(!t.output||0!==t.avail_in&&!t.input||s.status===qr&&e!==Mr)return ta(t,0===t.avail_out?_r:Hr);const n=s.last_flush;if(s.last_flush=e,0!==s.pending){if(oa(t),0===t.avail_out)return s.last_flush=-1,Yr}else if(0===t.avail_in&&ea(e)<=ea(n)&&e!==Mr)return ta(t,_r);if(s.status===qr&&0!==t.avail_in)return ta(t,_r);if(s.status===Ar&&0===s.wrap&&(s.status=$r),s.status===Ar){let e=Dr+(s.w_bits-8<<4)<<8,n=-1;if(n=s.strategy>=Er||s.level<2?0:s.level<6?1:6===s.level?2:3,e|=n<<6,0!==s.strstart&&(e|=32),e+=31-e%31,la(s,e),0!==s.strstart&&(la(s,t.adler>>>16),la(s,65535&t.adler)),t.adler=1,s.status=$r,oa(t),0!==s.pending)return s.last_flush=-1,Yr}if(57===s.status)if(t.adler=0,aa(s,31),aa(s,139),aa(s,8),s.gzhead)aa(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),aa(s,255&s.gzhead.time),aa(s,s.gzhead.time>>8&255),aa(s,s.gzhead.time>>16&255),aa(s,s.gzhead.time>>24&255),aa(s,9===s.level?2:s.strategy>=Er||s.level<2?4:0),aa(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(aa(s,255&s.gzhead.extra.length),aa(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=Lr(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(aa(s,0),aa(s,0),aa(s,0),aa(s,0),aa(s,0),aa(s,9===s.level?2:s.strategy>=Er||s.level<2?4:0),aa(s,3),s.status=$r,oa(t),0!==s.pending)return s.last_flush=-1,Yr;if(69===s.status){if(s.gzhead.extra){let e=s.pending,n=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+n>s.pending_buf_size;){let i=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+i),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>e&&(t.adler=Lr(t.adler,s.pending_buf,s.pending-e,e)),s.gzindex+=i,oa(t),0!==s.pending)return s.last_flush=-1,Yr;e=0,n-=i}let i=new Uint8Array(s.gzhead.extra);s.pending_buf.set(i.subarray(s.gzindex,s.gzindex+n),s.pending),s.pending+=n,s.gzhead.hcrc&&s.pending>e&&(t.adler=Lr(t.adler,s.pending_buf,s.pending-e,e)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let e,n=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>n&&(t.adler=Lr(t.adler,s.pending_buf,s.pending-n,n)),oa(t),0!==s.pending)return s.last_flush=-1,Yr;n=0}e=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,aa(s,e)}while(0!==e);s.gzhead.hcrc&&s.pending>n&&(t.adler=Lr(t.adler,s.pending_buf,s.pending-n,n)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let e,n=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>n&&(t.adler=Lr(t.adler,s.pending_buf,s.pending-n,n)),oa(t),0!==s.pending)return s.last_flush=-1,Yr;n=0}e=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,aa(s,e)}while(0!==e);s.gzhead.hcrc&&s.pending>n&&(t.adler=Lr(t.adler,s.pending_buf,s.pending-n,n))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(oa(t),0!==s.pending))return s.last_flush=-1,Yr;aa(s,255&t.adler),aa(s,t.adler>>8&255),t.adler=0}if(s.status=$r,oa(t),0!==s.pending)return s.last_flush=-1,Yr}if(0!==t.avail_in||0!==s.lookahead||e!==Pr&&s.status!==qr){let n=0===s.level?ua(s,e):s.strategy===Er?((t,e)=>{let s;for(;;){if(0===t.lookahead&&(ha(t),0===t.lookahead)){if(e===Pr)return 1;break}if(t.match_length=0,s=Cr(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,s&&(ra(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Mr?(ra(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ra(t,!1),0===t.strm.avail_out)?1:2})(s,e):s.strategy===jr?((t,e)=>{let s,n,i,o;const r=t.window;for(;;){if(t.lookahead<=Or){if(ha(t),t.lookahead<=Or&&e===Pr)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(i=t.strstart-1,n=r[i],n===r[++i]&&n===r[++i]&&n===r[++i])){o=t.strstart+Or;do{}while(n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&i<o);t.match_length=Or-(o-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(s=Cr(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(s=Cr(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),s&&(ra(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Mr?(ra(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ra(t,!1),0===t.strm.avail_out)?1:2})(s,e):ba[s.level].func(s,e);if(3!==n&&4!==n||(s.status=qr),1===n||3===n)return 0===t.avail_out&&(s.last_flush=-1),Yr;if(2===n&&(e===Vr?kr(s):e!==Rr&&(Tr(s,0,0,!1),e===Ir&&(sa(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),oa(t),0===t.avail_out))return s.last_flush=-1,Yr}return e!==Mr?Yr:s.wrap<=0?Nr:(2===s.wrap?(aa(s,255&t.adler),aa(s,t.adler>>8&255),aa(s,t.adler>>16&255),aa(s,t.adler>>24&255),aa(s,255&t.total_in),aa(s,t.total_in>>8&255),aa(s,t.total_in>>16&255),aa(s,t.total_in>>24&255)):(la(s,t.adler>>>16),la(s,65535&t.adler)),oa(t),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?Yr:Nr)},La={deflateInit:(t,e)=>va(t,e,Dr,15,8,Qr),deflateInit2:va,deflateReset:Za,deflateResetKeep:wa,deflateSetHeader:(t,e)=>ga(t)||2!==t.state.wrap?Hr:(t.state.gzhead=e,Yr),deflate:Xa,deflateEnd:t=>{if(ga(t))return Hr;const e=t.state.status;return t.state=null,e===$r?ta(t,Kr):Yr},deflateSetDictionary:(t,e)=>{let s=e.length;if(ga(t))return Hr;const n=t.state,i=n.wrap;if(2===i||1===i&&n.status!==Ar||n.lookahead)return Hr;if(1===i&&(t.adler=vr(t.adler,e,s,0)),n.wrap=0,s>=n.w_size){0===i&&(sa(n.head),n.strstart=0,n.block_start=0,n.insert=0);let t=new Uint8Array(n.w_size);t.set(e.subarray(s-n.w_size,s),0),e=t,s=n.w_size}const o=t.avail_in,r=t.next_in,a=t.input;for(t.avail_in=s,t.next_in=0,t.input=e,ha(n);n.lookahead>=3;){let t=n.strstart,e=n.lookahead-2;do{n.ins_h=ia(n,n.ins_h,n.window[t+3-1]),n.prev[t&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=t,t++}while(--e);n.strstart=t,n.lookahead=2,ha(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=r,t.input=a,t.avail_in=o,n.wrap=i,Yr},deflateInfo:"pako deflate (from Nodeca project)"};const xa=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Sa=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const s=e.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const e in s)xa(s,e)&&(t[e]=s[e])}}return t},Ga=t=>{let e=0;for(let s=0,n=t.length;s<n;s++)e+=t[s].length;const s=new Uint8Array(e);for(let e=0,n=0,i=t.length;e<i;e++){let i=t[e];s.set(i,n),n+=i.length}return s};let Ta=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Ta=!1}const Wa=new Uint8Array(256);for(let t=0;t<256;t++)Wa[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Wa[254]=Wa[254]=1;var Ca=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,s,n,i,o,r=t.length,a=0;for(i=0;i<r;i++)s=t.charCodeAt(i),55296==(64512&s)&&i+1<r&&(n=t.charCodeAt(i+1),56320==(64512&n)&&(s=65536+(s-55296<<10)+(n-56320),i++)),a+=s<128?1:s<2048?2:s<65536?3:4;for(e=new Uint8Array(a),o=0,i=0;o<a;i++)s=t.charCodeAt(i),55296==(64512&s)&&i+1<r&&(n=t.charCodeAt(i+1),56320==(64512&n)&&(s=65536+(s-55296<<10)+(n-56320),i++)),s<128?e[o++]=s:s<2048?(e[o++]=192|s>>>6,e[o++]=128|63&s):s<65536?(e[o++]=224|s>>>12,e[o++]=128|s>>>6&63,e[o++]=128|63&s):(e[o++]=240|s>>>18,e[o++]=128|s>>>12&63,e[o++]=128|s>>>6&63,e[o++]=128|63&s);return e},ka=(t,e)=>{const s=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let n,i;const o=new Array(2*s);for(i=0,n=0;n<s;){let e=t[n++];if(e<128){o[i++]=e;continue}let r=Wa[e];if(r>4)o[i++]=65533,n+=r-1;else{for(e&=2===r?31:3===r?15:7;r>1&&n<s;)e=e<<6|63&t[n++],r--;r>1?o[i++]=65533:e<65536?o[i++]=e:(e-=65536,o[i++]=55296|e>>10&1023,o[i++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Ta)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let s="";for(let n=0;n<e;n++)s+=String.fromCharCode(t[n]);return s})(o,i)},Pa=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let s=e-1;for(;s>=0&&128==(192&t[s]);)s--;return s<0||0===s?e:s+Wa[t[s]]>e?s:e};var Va=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ia=Object.prototype.toString,{Z_NO_FLUSH:Ma,Z_SYNC_FLUSH:Ra,Z_FULL_FLUSH:Ya,Z_FINISH:Na,Z_OK:Ha,Z_STREAM_END:Ka,Z_DEFAULT_COMPRESSION:_a,Z_DEFAULT_STRATEGY:za,Z_DEFLATED:Fa}=Sr;function Ea(t){this.options=Sa({level:_a,method:Fa,chunkSize:16384,windowBits:15,memLevel:8,strategy:za},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Va,this.strm.avail_out=0;let s=La.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(s!==Ha)throw new Error(xr[s]);if(e.header&&La.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?Ca(e.dictionary):"[object ArrayBuffer]"===Ia.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,s=La.deflateSetDictionary(this.strm,t),s!==Ha)throw new Error(xr[s]);this._dict_set=!0}}function ja(t,e){const s=new Ea(e);if(s.push(t,!0),s.err)throw s.msg||xr[s.err];return s.result}Ea.prototype.push=function(t,e){const s=this.strm,n=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=e===~~e?e:!0===e?Na:Ma,"string"==typeof t?s.input=Ca(t):"[object ArrayBuffer]"===Ia.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(n),s.next_out=0,s.avail_out=n),(o===Ra||o===Ya)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(i=La.deflate(s,o),i===Ka)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),i=La.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Ha;if(0!==s.avail_out){if(o>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},Ea.prototype.onData=function(t){this.chunks.push(t)},Ea.prototype.onEnd=function(t){t===Ha&&(this.result=Ga(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Ja={Deflate:Ea,deflate:ja,deflateRaw:function(t,e){return(e=e||{}).raw=!0,ja(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,ja(t,e)}};const Qa=16209;var Ua=function(t,e){let s,n,i,o,r,a,l,c,d,h,u,m,p,f,b,y,g,w,Z,v,X,L,x,S;const G=t.state;s=t.next_in,x=t.input,n=s+(t.avail_in-5),i=t.next_out,S=t.output,o=i-(e-t.avail_out),r=i+(t.avail_out-257),a=G.dmax,l=G.wsize,c=G.whave,d=G.wnext,h=G.window,u=G.hold,m=G.bits,p=G.lencode,f=G.distcode,b=(1<<G.lenbits)-1,y=(1<<G.distbits)-1;t:do{m<15&&(u+=x[s++]<<m,m+=8,u+=x[s++]<<m,m+=8),g=p[u&b];e:for(;;){if(w=g>>>24,u>>>=w,m-=w,w=g>>>16&255,0===w)S[i++]=65535&g;else{if(!(16&w)){if(64&w){if(32&w){G.mode=16191;break t}t.msg="invalid literal/length code",G.mode=Qa;break t}g=p[(65535&g)+(u&(1<<w)-1)];continue e}for(Z=65535&g,w&=15,w&&(m<w&&(u+=x[s++]<<m,m+=8),Z+=u&(1<<w)-1,u>>>=w,m-=w),m<15&&(u+=x[s++]<<m,m+=8,u+=x[s++]<<m,m+=8),g=f[u&y];;){if(w=g>>>24,u>>>=w,m-=w,w=g>>>16&255,16&w){if(v=65535&g,w&=15,m<w&&(u+=x[s++]<<m,m+=8,m<w&&(u+=x[s++]<<m,m+=8)),v+=u&(1<<w)-1,v>a){t.msg="invalid distance too far back",G.mode=Qa;break t}if(u>>>=w,m-=w,w=i-o,v>w){if(w=v-w,w>c&&G.sane){t.msg="invalid distance too far back",G.mode=Qa;break t}if(X=0,L=h,0===d){if(X+=l-w,w<Z){Z-=w;do{S[i++]=h[X++]}while(--w);X=i-v,L=S}}else if(d<w){if(X+=l+d-w,w-=d,w<Z){Z-=w;do{S[i++]=h[X++]}while(--w);if(X=0,d<Z){w=d,Z-=w;do{S[i++]=h[X++]}while(--w);X=i-v,L=S}}}else if(X+=d-w,w<Z){Z-=w;do{S[i++]=h[X++]}while(--w);X=i-v,L=S}for(;Z>2;)S[i++]=L[X++],S[i++]=L[X++],S[i++]=L[X++],Z-=3;Z&&(S[i++]=L[X++],Z>1&&(S[i++]=L[X++]))}else{X=i-v;do{S[i++]=S[X++],S[i++]=S[X++],S[i++]=S[X++],Z-=3}while(Z>2);Z&&(S[i++]=S[X++],Z>1&&(S[i++]=S[X++]))}break}if(64&w){t.msg="invalid distance code",G.mode=Qa;break t}g=f[(65535&g)+(u&(1<<w)-1)]}}break}}while(s<n&&i<r);Z=m>>3,s-=Z,m-=Z<<3,u&=(1<<m)-1,t.next_in=s,t.next_out=i,t.avail_in=s<n?n-s+5:5-(s-n),t.avail_out=i<r?r-i+257:257-(i-r),G.hold=u,G.bits=m};const Da=15,Oa=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ba=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Aa=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),$a=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var qa=(t,e,s,n,i,o,r,a)=>{const l=a.bits;let c,d,h,u,m,p,f=0,b=0,y=0,g=0,w=0,Z=0,v=0,X=0,L=0,x=0,S=null;const G=new Uint16Array(16),T=new Uint16Array(16);let W,C,k,P=null;for(f=0;f<=Da;f++)G[f]=0;for(b=0;b<n;b++)G[e[s+b]]++;for(w=l,g=Da;g>=1&&0===G[g];g--);if(w>g&&(w=g),0===g)return i[o++]=20971520,i[o++]=20971520,a.bits=1,0;for(y=1;y<g&&0===G[y];y++);for(w<y&&(w=y),X=1,f=1;f<=Da;f++)if(X<<=1,X-=G[f],X<0)return-1;if(X>0&&(0===t||1!==g))return-1;for(T[1]=0,f=1;f<Da;f++)T[f+1]=T[f]+G[f];for(b=0;b<n;b++)0!==e[s+b]&&(r[T[e[s+b]]++]=b);if(0===t?(S=P=r,p=20):1===t?(S=Oa,P=Ba,p=257):(S=Aa,P=$a,p=0),x=0,b=0,f=y,m=o,Z=w,v=0,h=-1,L=1<<w,u=L-1,1===t&&L>852||2===t&&L>592)return 1;for(;;){W=f-v,r[b]+1<p?(C=0,k=r[b]):r[b]>=p?(C=P[r[b]-p],k=S[r[b]-p]):(C=96,k=0),c=1<<f-v,d=1<<Z,y=d;do{d-=c,i[m+(x>>v)+d]=W<<24|C<<16|k}while(0!==d);for(c=1<<f-1;x&c;)c>>=1;if(0!==c?(x&=c-1,x+=c):x=0,b++,0==--G[f]){if(f===g)break;f=e[s+r[b]]}if(f>w&&(x&u)!==h){for(0===v&&(v=w),m+=y,Z=f-v,X=1<<Z;Z+v<g&&(X-=G[Z+v],!(X<=0));)Z++,X<<=1;if(L+=1<<Z,1===t&&L>852||2===t&&L>592)return 1;h=x&u,i[h]=w<<24|Z<<16|m-o}}return 0!==x&&(i[m+x]=f-v<<24|64<<16),a.bits=w,0};const{Z_FINISH:tl,Z_BLOCK:el,Z_TREES:sl,Z_OK:nl,Z_STREAM_END:il,Z_NEED_DICT:ol,Z_STREAM_ERROR:rl,Z_DATA_ERROR:al,Z_MEM_ERROR:ll,Z_BUF_ERROR:cl,Z_DEFLATED:dl}=Sr,hl=16180,ul=16190,ml=16191,pl=16192,fl=16194,bl=16199,yl=16200,gl=16206,wl=16209,Zl=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function vl(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Xl=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<hl||e.mode>16211?1:0},Ll=t=>{if(Xl(t))return rl;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=hl,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,nl},xl=t=>{if(Xl(t))return rl;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Ll(t)},Sl=(t,e)=>{let s;if(Xl(t))return rl;const n=t.state;return e<0?(s=0,e=-e):(s=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?rl:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=s,n.wbits=e,xl(t))},Gl=(t,e)=>{if(!t)return rl;const s=new vl;t.state=s,s.strm=t,s.window=null,s.mode=hl;const n=Sl(t,e);return n!==nl&&(t.state=null),n};let Tl,Wl,Cl=!0;const kl=t=>{if(Cl){Tl=new Int32Array(512),Wl=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(qa(1,t.lens,0,288,Tl,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;qa(2,t.lens,0,32,Wl,0,t.work,{bits:5}),Cl=!1}t.lencode=Tl,t.lenbits=9,t.distcode=Wl,t.distbits=5},Pl=(t,e,s,n)=>{let i;const o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(s-o.wsize,s),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(e.subarray(s-n,s-n+i),o.wnext),(n-=i)?(o.window.set(e.subarray(s-n,s),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var Vl=(t,e)=>{let s,n,i,o,r,a,l,c,d,h,u,m,p,f,b,y,g,w,Z,v,X,L,x=0;const S=new Uint8Array(4);let G,T;const W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Xl(t)||!t.output||!t.input&&0!==t.avail_in)return rl;s=t.state,s.mode===ml&&(s.mode=pl),r=t.next_out,i=t.output,l=t.avail_out,o=t.next_in,n=t.input,a=t.avail_in,c=s.hold,d=s.bits,h=a,u=l,L=nl;t:for(;;)switch(s.mode){case hl:if(0===s.wrap){s.mode=pl;break}for(;d<16;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(2&s.wrap&&35615===c){0===s.wbits&&(s.wbits=15),s.check=0,S[0]=255&c,S[1]=c>>>8&255,s.check=Lr(s.check,S,2,0),c=0,d=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",s.mode=wl;break}if((15&c)!==dl){t.msg="unknown compression method",s.mode=wl;break}if(c>>>=4,d-=4,X=8+(15&c),0===s.wbits&&(s.wbits=X),X>15||X>s.wbits){t.msg="invalid window size",s.mode=wl;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&c?16189:ml,c=0,d=0;break;case 16181:for(;d<16;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(s.flags=c,(255&s.flags)!==dl){t.msg="unknown compression method",s.mode=wl;break}if(57344&s.flags){t.msg="unknown header flags set",s.mode=wl;break}s.head&&(s.head.text=c>>8&1),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,s.check=Lr(s.check,S,2,0)),c=0,d=0,s.mode=16182;case 16182:for(;d<32;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}s.head&&(s.head.time=c),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,S[2]=c>>>16&255,S[3]=c>>>24&255,s.check=Lr(s.check,S,4,0)),c=0,d=0,s.mode=16183;case 16183:for(;d<16;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}s.head&&(s.head.xflags=255&c,s.head.os=c>>8),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,s.check=Lr(s.check,S,2,0)),c=0,d=0,s.mode=16184;case 16184:if(1024&s.flags){for(;d<16;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}s.length=c,s.head&&(s.head.extra_len=c),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,s.check=Lr(s.check,S,2,0)),c=0,d=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&s.flags&&(m=s.length,m>a&&(m=a),m&&(s.head&&(X=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(n.subarray(o,o+m),X)),512&s.flags&&4&s.wrap&&(s.check=Lr(s.check,n,m,o)),a-=m,o+=m,s.length-=m),s.length))break t;s.length=0,s.mode=16186;case 16186:if(2048&s.flags){if(0===a)break t;m=0;do{X=n[o+m++],s.head&&X&&s.length<65536&&(s.head.name+=String.fromCharCode(X))}while(X&&m<a);if(512&s.flags&&4&s.wrap&&(s.check=Lr(s.check,n,m,o)),a-=m,o+=m,X)break t}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&s.flags){if(0===a)break t;m=0;do{X=n[o+m++],s.head&&X&&s.length<65536&&(s.head.comment+=String.fromCharCode(X))}while(X&&m<a);if(512&s.flags&&4&s.wrap&&(s.check=Lr(s.check,n,m,o)),a-=m,o+=m,X)break t}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&s.flags){for(;d<16;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(4&s.wrap&&c!==(65535&s.check)){t.msg="header crc mismatch",s.mode=wl;break}c=0,d=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=ml;break;case 16189:for(;d<32;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}t.adler=s.check=Zl(c),c=0,d=0,s.mode=ul;case ul:if(0===s.havedict)return t.next_out=r,t.avail_out=l,t.next_in=o,t.avail_in=a,s.hold=c,s.bits=d,ol;t.adler=s.check=1,s.mode=ml;case ml:if(e===el||e===sl)break t;case pl:if(s.last){c>>>=7&d,d-=7&d,s.mode=gl;break}for(;d<3;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}switch(s.last=1&c,c>>>=1,d-=1,3&c){case 0:s.mode=16193;break;case 1:if(kl(s),s.mode=bl,e===sl){c>>>=2,d-=2;break t}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=wl}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){t.msg="invalid stored block lengths",s.mode=wl;break}if(s.length=65535&c,c=0,d=0,s.mode=fl,e===sl)break t;case fl:s.mode=16195;case 16195:if(m=s.length,m){if(m>a&&(m=a),m>l&&(m=l),0===m)break t;i.set(n.subarray(o,o+m),r),a-=m,o+=m,l-=m,r+=m,s.length-=m;break}s.mode=ml;break;case 16196:for(;d<14;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(s.nlen=257+(31&c),c>>>=5,d-=5,s.ndist=1+(31&c),c>>>=5,d-=5,s.ncode=4+(15&c),c>>>=4,d-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=wl;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;d<3;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}s.lens[W[s.have++]]=7&c,c>>>=3,d-=3}for(;s.have<19;)s.lens[W[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,G={bits:s.lenbits},L=qa(0,s.lens,0,19,s.lencode,0,s.work,G),s.lenbits=G.bits,L){t.msg="invalid code lengths set",s.mode=wl;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;x=s.lencode[c&(1<<s.lenbits)-1],b=x>>>24,y=x>>>16&255,g=65535&x,!(b<=d);){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(g<16)c>>>=b,d-=b,s.lens[s.have++]=g;else{if(16===g){for(T=b+2;d<T;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(c>>>=b,d-=b,0===s.have){t.msg="invalid bit length repeat",s.mode=wl;break}X=s.lens[s.have-1],m=3+(3&c),c>>>=2,d-=2}else if(17===g){for(T=b+3;d<T;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}c>>>=b,d-=b,X=0,m=3+(7&c),c>>>=3,d-=3}else{for(T=b+7;d<T;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}c>>>=b,d-=b,X=0,m=11+(127&c),c>>>=7,d-=7}if(s.have+m>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=wl;break}for(;m--;)s.lens[s.have++]=X}}if(s.mode===wl)break;if(0===s.lens[256]){t.msg="invalid code -- missing end-of-block",s.mode=wl;break}if(s.lenbits=9,G={bits:s.lenbits},L=qa(1,s.lens,0,s.nlen,s.lencode,0,s.work,G),s.lenbits=G.bits,L){t.msg="invalid literal/lengths set",s.mode=wl;break}if(s.distbits=6,s.distcode=s.distdyn,G={bits:s.distbits},L=qa(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,G),s.distbits=G.bits,L){t.msg="invalid distances set",s.mode=wl;break}if(s.mode=bl,e===sl)break t;case bl:s.mode=yl;case yl:if(a>=6&&l>=258){t.next_out=r,t.avail_out=l,t.next_in=o,t.avail_in=a,s.hold=c,s.bits=d,Ua(t,u),r=t.next_out,i=t.output,l=t.avail_out,o=t.next_in,n=t.input,a=t.avail_in,c=s.hold,d=s.bits,s.mode===ml&&(s.back=-1);break}for(s.back=0;x=s.lencode[c&(1<<s.lenbits)-1],b=x>>>24,y=x>>>16&255,g=65535&x,!(b<=d);){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(y&&!(240&y)){for(w=b,Z=y,v=g;x=s.lencode[v+((c&(1<<w+Z)-1)>>w)],b=x>>>24,y=x>>>16&255,g=65535&x,!(w+b<=d);){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}c>>>=w,d-=w,s.back+=w}if(c>>>=b,d-=b,s.back+=b,s.length=g,0===y){s.mode=16205;break}if(32&y){s.back=-1,s.mode=ml;break}if(64&y){t.msg="invalid literal/length code",s.mode=wl;break}s.extra=15&y,s.mode=16201;case 16201:if(s.extra){for(T=s.extra;d<T;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}s.length+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;x=s.distcode[c&(1<<s.distbits)-1],b=x>>>24,y=x>>>16&255,g=65535&x,!(b<=d);){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(!(240&y)){for(w=b,Z=y,v=g;x=s.distcode[v+((c&(1<<w+Z)-1)>>w)],b=x>>>24,y=x>>>16&255,g=65535&x,!(w+b<=d);){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}c>>>=w,d-=w,s.back+=w}if(c>>>=b,d-=b,s.back+=b,64&y){t.msg="invalid distance code",s.mode=wl;break}s.offset=g,s.extra=15&y,s.mode=16203;case 16203:if(s.extra){for(T=s.extra;d<T;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}s.offset+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=wl;break}s.mode=16204;case 16204:if(0===l)break t;if(m=u-l,s.offset>m){if(m=s.offset-m,m>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=wl;break}m>s.wnext?(m-=s.wnext,p=s.wsize-m):p=s.wnext-m,m>s.length&&(m=s.length),f=s.window}else f=i,p=r-s.offset,m=s.length;m>l&&(m=l),l-=m,s.length-=m;do{i[r++]=f[p++]}while(--m);0===s.length&&(s.mode=yl);break;case 16205:if(0===l)break t;i[r++]=s.length,l--,s.mode=yl;break;case gl:if(s.wrap){for(;d<32;){if(0===a)break t;a--,c|=n[o++]<<d,d+=8}if(u-=l,t.total_out+=u,s.total+=u,4&s.wrap&&u&&(t.adler=s.check=s.flags?Lr(s.check,i,u,r-u):vr(s.check,i,u,r-u)),u=l,4&s.wrap&&(s.flags?c:Zl(c))!==s.check){t.msg="incorrect data check",s.mode=wl;break}c=0,d=0}s.mode=16207;case 16207:if(s.wrap&&s.flags){for(;d<32;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(4&s.wrap&&c!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=wl;break}c=0,d=0}s.mode=16208;case 16208:L=il;break t;case wl:L=al;break t;case 16210:return ll;default:return rl}return t.next_out=r,t.avail_out=l,t.next_in=o,t.avail_in=a,s.hold=c,s.bits=d,(s.wsize||u!==t.avail_out&&s.mode<wl&&(s.mode<gl||e!==tl))&&Pl(t,t.output,t.next_out,u-t.avail_out),h-=t.avail_in,u-=t.avail_out,t.total_in+=h,t.total_out+=u,s.total+=u,4&s.wrap&&u&&(t.adler=s.check=s.flags?Lr(s.check,i,u,t.next_out-u):vr(s.check,i,u,t.next_out-u)),t.data_type=s.bits+(s.last?64:0)+(s.mode===ml?128:0)+(s.mode===bl||s.mode===fl?256:0),(0===h&&0===u||e===tl)&&L===nl&&(L=cl),L},Il={inflateReset:xl,inflateReset2:Sl,inflateResetKeep:Ll,inflateInit:t=>Gl(t,15),inflateInit2:Gl,inflate:Vl,inflateEnd:t=>{if(Xl(t))return rl;let e=t.state;return e.window&&(e.window=null),t.state=null,nl},inflateGetHeader:(t,e)=>{if(Xl(t))return rl;const s=t.state;return 2&s.wrap?(s.head=e,e.done=!1,nl):rl},inflateSetDictionary:(t,e)=>{const s=e.length;let n,i,o;return Xl(t)?rl:(n=t.state,0!==n.wrap&&n.mode!==ul?rl:n.mode===ul&&(i=1,i=vr(i,e,s,0),i!==n.check)?al:(o=Pl(t,e,s,s),o?(n.mode=16210,ll):(n.havedict=1,nl)))},inflateInfo:"pako inflate (from Nodeca project)"};var Ml=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Rl=Object.prototype.toString,{Z_NO_FLUSH:Yl,Z_FINISH:Nl,Z_OK:Hl,Z_STREAM_END:Kl,Z_NEED_DICT:_l,Z_STREAM_ERROR:zl,Z_DATA_ERROR:Fl,Z_MEM_ERROR:El}=Sr;function jl(t){this.options=Sa({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Va,this.strm.avail_out=0;let s=Il.inflateInit2(this.strm,e.windowBits);if(s!==Hl)throw new Error(xr[s]);if(this.header=new Ml,Il.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Ca(e.dictionary):"[object ArrayBuffer]"===Rl.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(s=Il.inflateSetDictionary(this.strm,e.dictionary),s!==Hl)))throw new Error(xr[s])}function Jl(t,e){const s=new jl(e);if(s.push(t),s.err)throw s.msg||xr[s.err];return s.result}jl.prototype.push=function(t,e){const s=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let o,r,a;if(this.ended)return!1;for(r=e===~~e?e:!0===e?Nl:Yl,"[object ArrayBuffer]"===Rl.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(n),s.next_out=0,s.avail_out=n),o=Il.inflate(s,r),o===_l&&i&&(o=Il.inflateSetDictionary(s,i),o===Hl?o=Il.inflate(s,r):o===Fl&&(o=_l));s.avail_in>0&&o===Kl&&s.state.wrap>0&&0!==t[s.next_in];)Il.inflateReset(s),o=Il.inflate(s,r);switch(o){case zl:case Fl:case _l:case El:return this.onEnd(o),this.ended=!0,!1}if(a=s.avail_out,s.next_out&&(0===s.avail_out||o===Kl))if("string"===this.options.to){let t=Pa(s.output,s.next_out),e=s.next_out-t,i=ka(s.output,t);s.next_out=e,s.avail_out=n-e,e&&s.output.set(s.output.subarray(t,t+e),0),this.onData(i)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(o!==Hl||0!==a){if(o===Kl)return o=Il.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},jl.prototype.onData=function(t){this.chunks.push(t)},jl.prototype.onEnd=function(t){t===Hl&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ga(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Ql={Inflate:jl,inflate:Jl,inflateRaw:function(t,e){return(e=e||{}).raw=!0,Jl(t,e)},ungzip:Jl};const{Deflate:Ul,deflate:Dl,deflateRaw:Ol,gzip:Bl}=Ja,{Inflate:Al,inflate:$l,inflateRaw:ql,ungzip:tc}=Ql;var ec={Deflate:Ul,deflate:Dl,deflateRaw:Ol,gzip:Bl,Inflate:Al,inflate:$l,inflateRaw:ql,ungzip:tc,constants:Sr};class sc{constructor(){this.url="(offline)",this.readyState=WebSocket.CONNECTING,this.bufferedAmount=0,setTimeout((()=>{this.readyState=WebSocket.OPEN,this.onopen&&this.onopen()}),50),this.start=Date.now()}send(t){const{id:e,action:s,args:n}=JSON.parse(t);switch(s){case"JOIN":return this.id=e,this.ticks=n.ticks.tick,this.seq=-16>>>0,this.reply("SYNC",{messages:[],time:this.time,seq:this.seq,tove:n.tove,reflector:"offline"}),this.reply("RECV",[this.time,++this.seq,{what:"users",joined:[n.user],active:1,total:1}]),void this.tick();case"SEND":{const t=[...n];return t[0]=this.time,t[1]=++this.seq,void this.reply("RECV",t)}case"PULSE":return;default:throw Error("Offline unhandled "+s)}}close(t,e){this.readyState=WebSocket.CLOSING,setTimeout((()=>{this.readyState=WebSocket.CLOSED,this.onclose&&this.onclose({code:t,reason:e})}),50)}get time(){return Date.now()-this.start}tick(){clearInterval(this.ticker),this.ticker=setInterval((()=>{this.reply("TICK",{time:this.time})}),this.ticks)}reply(t,e){setTimeout((()=>{this.onmessage&&this.onmessage({data:JSON.stringify({id:this.id,action:t,args:e})})}),50)}}const nc=!!globalThis.navigator?.userAgent.toLowerCase().includes("firefox");let ic={get connection(){return ic={connection:h.has("debug","connection",!1)},ic.connection}};class oc{static get name(){return`${qt.libName}WebRTCConnection`}constructor(t){var e;this.clientId=(e=4,Math.random().toString(36).substring(2,2+e)),ic.connection&&console.log(`${this.clientId} WebRTCConnection created`),this.pc=null,this.dataChannel=null,this.signaling=null,this.connectionTypes={},this.onopen=null,this.onmessage=null,this.onerror=null,this.onclose=null,this.onconnected=null,this.twoStageConnection=!0,this.url="synchronizer",this.bufferedAmount=0,this.openConnection(t)}isConnecting(){return this.signaling?.readyState===WebSocket.OPEN}async openConnection(t){try{await this.openSignalingChannel(t),ic.connection&&console.log(`${this.clientId} signaling ready`),this.onopen&&this.onopen(),await this.createPeerConnection(),ic.connection&&console.log(`${this.clientId} peer connection created`),this.dataChannel=this.pc.createDataChannel(`client-${this.clientId}`),ic.connection&&console.log(`${this.clientId} data channel created`),this.dataChannel.onopen=t=>this.onDataChannelOpen(t),this.dataChannel.onmessage=t=>this.onDataChannelMessage(t),this.dataChannel.onclosing=t=>this.onDataChannelClosing(t),this.dataChannel.onclose=t=>this.onDataChannelClose(t),this.dataChannel.onerror=t=>this.onDataChannelError(t);const e=await this.pc.createOffer();if(this.signaling?.readyState!==WebSocket.OPEN)return;if(this.negotiationTimeout=setTimeout((()=>{delete this.negotiationTimeout,this.dataChannelFlowing?this.signalingCloseScheduled||(ic.connection&&console.log(`${this.clientId} ICE negotiation timed out but appears to have succeeded`),this.scheduleSignalingClose()):this.synchronizerDisconnected(4003,"ICE negotiation timed out")}),15e3),this.signalToSessionRunner({type:"offer",sdp:e.sdp}),await this.pc.setLocalDescription(e),!this.pc.sctp)return;const s=this.pc.sctp.transport.iceTransport;s.onselectedcandidatepairchange=t=>{ic.connection&&console.log(`${this.clientId} ICE candidate pair changed`);const e=s.getSelectedCandidatePair();this.connectionTypes.local=e.local.type,this.connectionTypes.remote=e.remote.type,this.logConnectionState()}}catch(t){this.synchronizerDisconnected(t.code||4003,t.message)}}openSignalingChannel(t){return this.signaling?(console.warn(`${this.clientId} signaling channel already open`),Promise.resolve()):(this.synchronizerGatheringComplete=!1,this.localGatheringComplete=!1,this.dataChannelFlowing=!1,this.signalingCloseScheduled=!1,this.signalingKey=Math.random(),new Promise((e=>{this.signaling=new WebSocket(t),this.signaling.onopen=()=>{ic.connection&&console.log(`${this.clientId} signaling socket opened`)},this.signaling.onmessage=t=>{const s=JSON.parse(t.data);if("READY"===s.what)return this.clientId+=`_${s.id}`,this.iceServers=s.iceServers,void e();if("ERROR"!==s.what)if(s.type)switch(ic.connection&&console.log(`${this.clientId} received signal of type "${s.type}"`),s.type){case"answer":this.handleAnswer(s);break;case"candidate":this.handleCandidate(s);break;case"gathering-complete":this.synchronizerGatheringComplete=!0;break;default:ic.connection&&console.log(`${this.clientId} unhandled: ${s.type}`)}else console.error(`${this.clientId} unexpected message: ${t.data}`);else console.error(`${this.clientId} registry error: ${s.reason}`)},this.signaling.onclose=t=>{ic.connection&&console.log(`${this.clientId} signaling socket closed unexpectedly (${t.code})`),this.synchronizerDisconnected(t.code,t.reason)},this.signaling.onerror=t=>{ic.connection&&console.log(`${this.clientId} signaling socket error`,t),this.synchronizerError()}})))}clearNegotiationTimeout(){this.negotiationTimeout&&(clearTimeout(this.negotiationTimeout),delete this.negotiationTimeout)}signalToSessionRunner(t){const e=JSON.stringify(t);try{this.signaling.send(e)}catch(t){console.error(`${this.clientId} WebRTC signaling send error`,t)}}async logConnectionState(){if(nc&&this.pc)try{const t=await this.pc.getStats();if(t){let e=null;for(const s of t.values())if("transport"===s.type){e=s.selectedCandidatePairId;break}let s=t.get(e);if(!s)for(const e of t.values())if("candidate-pair"===e.type&&e.selected){s=e;break}s&&(this.connectionTypes.local=t.get(s.localCandidateId).candidateType,this.connectionTypes.remote=t.get(s.remoteCandidateId).candidateType)}}catch(t){}const t=this.connectionTypes.local||"",e=this.connectionTypes.remote||"";if(ic.connection&&console.log(`${this.clientId} RTCDataChannel connection state: "${this.dataChannel.readyState}" (client connection="${t}"; synchronizer connection="${e}")`),this.signaling?.readyState===WebSocket.OPEN){const s={type:"selectedCandidatePair",clientType:t,syncType:e};this.signalToSessionRunner(s)}}close(t,e){this.cleanUpConnection()}synchronizerDisconnected(t=1006,e="connection to synchronizer lost"){this.synchronizerCloseReason&&(t=this.synchronizerCloseReason[0],e=this.synchronizerCloseReason[1]),this.cleanUpConnection(),this.onclose&&this.onclose({code:t,reason:e})}synchronizerError(t){this.onerror&&this.onerror(),this.synchronizerDisconnected(void 0,t)}cleanUpConnection(){this.closeSignalingChannel();const{pc:t}=this;t&&(this.pc=null,t.close(),clearInterval(this.peerConnectionStatsInterval)),this.dataChannel=null}closeSignalingChannel(){this.clearNegotiationTimeout(),this.signaling&&(this.signaling.onclose=null,this.signaling.onerror=null,this.signaling.close(),this.signaling=null)}async createPeerConnection(){const{iceServers:t}=this,e=new Set,s=this.pc=new globalThis.RTCPeerConnection({iceServers:t});s.onnegotiationneeded=t=>{s===this.pc&&ic.connection&&console.log(`${this.clientId} negotiationneeded event fired`)},s.onsignalingstatechange=t=>{s===this.pc&&ic.connection&&console.log(`${this.clientId} signaling state: "${s.signalingState}"`)},s.onconnectionstatechange=t=>{if(s!==this.pc)return;const{connectionState:e,iceConnectionState:n}=s;ic.connection&&console.log(`${this.clientId} connection state: "${e}" (cf. ICE connection state: "${n}")`),"disconnected"!==e&&"failed"!==e||this.synchronizerDisconnected()},s.oniceconnectionstatechange=t=>{if(s!==this.pc)return;const e=s.iceConnectionState,n=this.dataChannel.readyState;ic.connection&&console.log(`${this.clientId} ICE connection state: "${e}"; data channel: "${n}"`),"failed"===e&&this.synchronizerDisconnected(4003,"ICE negotiation failed")},s.onicegatheringstatechange=t=>{if(s!==this.pc)return;const e=s.iceGatheringState;ic.connection&&console.log(`${this.clientId} ICE gathering state: "${e}"`),"complete"===e&&(this.localGatheringComplete=!0)},s.onicecandidate=t=>{if(s===this.pc)if(t.candidate){if(this.signaling?.readyState===WebSocket.OPEN){const e={type:"candidate",candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};this.signalToSessionRunner(e)}}else this.localGatheringComplete=!0},s.onicecandidateerror=t=>{if(s===this.pc&&ic.connection){const s=`${t.errorCode}|${t.url}`;e.has(s)||(701===t.errorCode?console.log(`${this.clientId} ICE 701 warning on ${t.url}`):console.log(`${this.clientId} ICE error from ${t.url}: ${t.errorCode} ${t.errorText}`),e.add(s))}}}async handleAnswer(t){this.pc?await this.pc.setRemoteDescription(t):console.error("no peerconnection")}async handleCandidate(t){this.pc?t.candidate?await this.pc.addIceCandidate(t):await this.pc.addIceCandidate(null):console.error("no peerconnection")}send(t){this.dataChannel?this.dataChannel.send(t):console.warn(`${this.clientId} no data channel to send: ${t}`)}onDataChannelOpen(t){ic.connection&&console.log(`${this.clientId} RTCDataChannel open`),this.onconnected&&this.onconnected(),this.logConnectionState()}onDataChannelMessage(t){if(!this.onmessage)return;this.dataChannelFlowing=!0,!this.signalingCloseScheduled&&this.synchronizerGatheringComplete&&this.localGatheringComplete&&(this.clearNegotiationTimeout(),this.scheduleSignalingClose());const e=t.data;if(e.startsWith("!ping"))this.send(e.replace("ping","pong"));else if(e.startsWith("!close")){const t=e.split("|");this.synchronizerCloseReason=[Number(t[1]),t[2]]}else this.onmessage(t)}onDataChannelError(t){console.error(`${this.clientId} RTCDataChannel error`,t),this.synchronizerError(t.errorDetail)}onDataChannelClosing(t){this.pc&&(ic.connection&&console.log(`${this.clientId} data channel closing`),this.synchronizerDisconnected())}onDataChannelClose(t){this.pc&&(ic.connection&&console.log(`${this.clientId} data channel closed`),this.synchronizerDisconnected())}scheduleSignalingClose(){this.signalingCloseScheduled=!0,ic.connection&&console.log(`${this.clientId} signaling channel closure scheduled`);const{signalingKey:t}=this;setTimeout((()=>{t===this.signalingKey&&(ic.connection&&console.log(`${this.clientId} closing signaling channel`),this.closeSignalingChannel())}),1e3)}async defunct_readConnectionType(){const t=await this.pc.getStats();if(t){let e=null;for(const[s,n]of t)if("transport"===n.type){e=n.selectedCandidatePairId;break}let s=t.get(e);if(!s)for(const[e,n]of t)if("candidate-pair"===n.type&&n.selected){s=n;break}if(s)for(const[e,n]of t)if(e===s.remoteCandidateId)return n.candidateType}return""}}function rc(t,e,s){var n=function(t){return atob(t)}(t),i=n.indexOf("\n",10)+1,o=n.substring(i)+"",r=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(r)}function ac(t,e,s){var n;return function(e){return n=n||rc(t),new Worker(n,e)}}var lc=ac("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwovKioKICogQ29weXJpZ2h0IENyb3F1ZXQgTGFicyAyMDI2CiAqIEJ1bmRsZSBvZiBAY3JvcXVldC9jcm9xdWV0CiAqIERhdGU6IDIwMjYtMDItMTYKICogVmVyc2lvbjogMi4wLjUtMQogKi8KCiFmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijt2YXIgdD0idW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbFRoaXM/Z2xvYmFsVGhpczoidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdz93aW5kb3c6InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWw/Z2xvYmFsOiJ1bmRlZmluZWQiIT10eXBlb2Ygc2VsZj9zZWxmOnt9O2Z1bmN0aW9uIGUodCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZSYmT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsImRlZmF1bHQiKT90LmRlZmF1bHQ6dH1mdW5jdGlvbiByKHQpe2lmKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCJfX2VzTW9kdWxlIikpcmV0dXJuIHQ7dmFyIGU9dC5kZWZhdWx0O2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBlKXt2YXIgcj1mdW5jdGlvbiB0KCl7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiB0P1JlZmxlY3QuY29uc3RydWN0KGUsYXJndW1lbnRzLHRoaXMuY29uc3RydWN0b3IpOmUuYXBwbHkodGhpcyxhcmd1bWVudHMpfTtyLnByb3RvdHlwZT1lLnByb3RvdHlwZX1lbHNlIHI9e307cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxPYmplY3Qua2V5cyh0KS5mb3JFYWNoKChmdW5jdGlvbihlKXt2YXIgbj1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsZSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsZSxuLmdldD9uOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0W2VdfX0pfSkpLHJ9dmFyIG4saT17ZXhwb3J0czp7fX07bnx8KG49MSxmdW5jdGlvbih0KXt2YXIgZT1mdW5jdGlvbih0KXt2YXIgZSxyPU9iamVjdC5wcm90b3R5cGUsbj1yLmhhc093blByb3BlcnR5LGk9T2JqZWN0LmRlZmluZVByb3BlcnR5fHxmdW5jdGlvbih0LGUscil7dFtlXT1yLnZhbHVlfSxhPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2w/U3ltYm9sOnt9LHM9YS5pdGVyYXRvcnx8IkBAaXRlcmF0b3IiLG89YS5hc3luY0l0ZXJhdG9yfHwiQEBhc3luY0l0ZXJhdG9yIixsPWEudG9TdHJpbmdUYWd8fCJAQHRvU3RyaW5nVGFnIjtmdW5jdGlvbiBoKHQsZSxyKXtyZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsZSx7dmFsdWU6cixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pLHRbZV19dHJ5e2goe30sIiIpfWNhdGNoKHQpe2g9ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0W2VdPXJ9fWZ1bmN0aW9uIGModCxlLHIsbil7dmFyIGE9ZSYmZS5wcm90b3R5cGUgaW5zdGFuY2VvZiB5P2U6eSxzPU9iamVjdC5jcmVhdGUoYS5wcm90b3R5cGUpLG89bmV3IEwobnx8W10pO3JldHVybiBpKHMsIl9pbnZva2UiLHt2YWx1ZTpFKHQscixvKX0pLHN9ZnVuY3Rpb24gdSh0LGUscil7dHJ5e3JldHVybnt0eXBlOiJub3JtYWwiLGFyZzp0LmNhbGwoZSxyKX19Y2F0Y2godCl7cmV0dXJue3R5cGU6InRocm93Iixhcmc6dH19fXQud3JhcD1jO3ZhciBfPSJzdXNwZW5kZWRTdGFydCIsZD0ic3VzcGVuZGVkWWllbGQiLGY9ImV4ZWN1dGluZyIscD0iY29tcGxldGVkIixnPXt9O2Z1bmN0aW9uIHkoKXt9ZnVuY3Rpb24gdygpe31mdW5jdGlvbiB2KCl7fXZhciBtPXt9O2gobSxzLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpO3ZhciBiPU9iamVjdC5nZXRQcm90b3R5cGVPZix4PWImJmIoYihSKFtdKSkpO3gmJnghPT1yJiZuLmNhbGwoeCxzKSYmKG09eCk7dmFyIGs9di5wcm90b3R5cGU9eS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShtKTtmdW5jdGlvbiB6KHQpe1sibmV4dCIsInRocm93IiwicmV0dXJuIl0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7aCh0LGUsKGZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9pbnZva2UoZSx0KX0pKX0pKX1mdW5jdGlvbiBBKHQsZSl7ZnVuY3Rpb24gcihpLGEscyxvKXt2YXIgbD11KHRbaV0sdCxhKTtpZigidGhyb3ciIT09bC50eXBlKXt2YXIgaD1sLmFyZyxjPWgudmFsdWU7cmV0dXJuIGMmJiJvYmplY3QiPT10eXBlb2YgYyYmbi5jYWxsKGMsIl9fYXdhaXQiKT9lLnJlc29sdmUoYy5fX2F3YWl0KS50aGVuKChmdW5jdGlvbih0KXtyKCJuZXh0Iix0LHMsbyl9KSwoZnVuY3Rpb24odCl7cigidGhyb3ciLHQscyxvKX0pKTplLnJlc29sdmUoYykudGhlbigoZnVuY3Rpb24odCl7aC52YWx1ZT10LHMoaCl9KSwoZnVuY3Rpb24odCl7cmV0dXJuIHIoInRocm93Iix0LHMsbyl9KSl9byhsLmFyZyl9dmFyIGE7aSh0aGlzLCJfaW52b2tlIix7dmFsdWU6ZnVuY3Rpb24odCxuKXtmdW5jdGlvbiBpKCl7cmV0dXJuIG5ldyBlKChmdW5jdGlvbihlLGkpe3IodCxuLGUsaSl9KSl9cmV0dXJuIGE9YT9hLnRoZW4oaSxpKTppKCl9fSl9ZnVuY3Rpb24gRSh0LHIsbil7dmFyIGk9XztyZXR1cm4gZnVuY3Rpb24oYSxzKXtpZihpPT09Zil0aHJvdyBuZXcgRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmciKTtpZihpPT09cCl7aWYoInRocm93Ij09PWEpdGhyb3cgcztyZXR1cm57dmFsdWU6ZSxkb25lOiEwfX1mb3Iobi5tZXRob2Q9YSxuLmFyZz1zOzspe3ZhciBvPW4uZGVsZWdhdGU7aWYobyl7dmFyIGw9UyhvLG4pO2lmKGwpe2lmKGw9PT1nKWNvbnRpbnVlO3JldHVybiBsfX1pZigibmV4dCI9PT1uLm1ldGhvZCluLnNlbnQ9bi5fc2VudD1uLmFyZztlbHNlIGlmKCJ0aHJvdyI9PT1uLm1ldGhvZCl7aWYoaT09PV8pdGhyb3cgaT1wLG4uYXJnO24uZGlzcGF0Y2hFeGNlcHRpb24obi5hcmcpfWVsc2UicmV0dXJuIj09PW4ubWV0aG9kJiZuLmFicnVwdCgicmV0dXJuIixuLmFyZyk7aT1mO3ZhciBoPXUodCxyLG4pO2lmKCJub3JtYWwiPT09aC50eXBlKXtpZihpPW4uZG9uZT9wOmQsaC5hcmc9PT1nKWNvbnRpbnVlO3JldHVybnt2YWx1ZTpoLmFyZyxkb25lOm4uZG9uZX19InRocm93Ij09PWgudHlwZSYmKGk9cCxuLm1ldGhvZD0idGhyb3ciLG4uYXJnPWguYXJnKX19fWZ1bmN0aW9uIFModCxyKXt2YXIgbj1yLm1ldGhvZCxpPXQuaXRlcmF0b3Jbbl07aWYoaT09PWUpcmV0dXJuIHIuZGVsZWdhdGU9bnVsbCwidGhyb3ciPT09biYmdC5pdGVyYXRvci5yZXR1cm4mJihyLm1ldGhvZD0icmV0dXJuIixyLmFyZz1lLFModCxyKSwidGhyb3ciPT09ci5tZXRob2QpfHwicmV0dXJuIiE9PW4mJihyLm1ldGhvZD0idGhyb3ciLHIuYXJnPW5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIrbisiJyBtZXRob2QiKSksZzt2YXIgYT11KGksdC5pdGVyYXRvcixyLmFyZyk7aWYoInRocm93Ij09PWEudHlwZSlyZXR1cm4gci5tZXRob2Q9InRocm93IixyLmFyZz1hLmFyZyxyLmRlbGVnYXRlPW51bGwsZzt2YXIgcz1hLmFyZztyZXR1cm4gcz9zLmRvbmU/KHJbdC5yZXN1bHROYW1lXT1zLnZhbHVlLHIubmV4dD10Lm5leHRMb2MsInJldHVybiIhPT1yLm1ldGhvZCYmKHIubWV0aG9kPSJuZXh0IixyLmFyZz1lKSxyLmRlbGVnYXRlPW51bGwsZyk6czooci5tZXRob2Q9InRocm93IixyLmFyZz1uZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLHIuZGVsZWdhdGU9bnVsbCxnKX1mdW5jdGlvbiBCKHQpe3ZhciBlPXt0cnlMb2M6dFswXX07MSBpbiB0JiYoZS5jYXRjaExvYz10WzFdKSwyIGluIHQmJihlLmZpbmFsbHlMb2M9dFsyXSxlLmFmdGVyTG9jPXRbM10pLHRoaXMudHJ5RW50cmllcy5wdXNoKGUpfWZ1bmN0aW9uIE8odCl7dmFyIGU9dC5jb21wbGV0aW9ufHx7fTtlLnR5cGU9Im5vcm1hbCIsZGVsZXRlIGUuYXJnLHQuY29tcGxldGlvbj1lfWZ1bmN0aW9uIEwodCl7dGhpcy50cnlFbnRyaWVzPVt7dHJ5TG9jOiJyb290In1dLHQuZm9yRWFjaChCLHRoaXMpLHRoaXMucmVzZXQoITApfWZ1bmN0aW9uIFIodCl7aWYobnVsbCE9dCl7dmFyIHI9dFtzXTtpZihyKXJldHVybiByLmNhbGwodCk7aWYoImZ1bmN0aW9uIj09dHlwZW9mIHQubmV4dClyZXR1cm4gdDtpZighaXNOYU4odC5sZW5ndGgpKXt2YXIgaT0tMSxhPWZ1bmN0aW9uIHIoKXtmb3IoOysraTx0Lmxlbmd0aDspaWYobi5jYWxsKHQsaSkpcmV0dXJuIHIudmFsdWU9dFtpXSxyLmRvbmU9ITEscjtyZXR1cm4gci52YWx1ZT1lLHIuZG9uZT0hMCxyfTtyZXR1cm4gYS5uZXh0PWF9fXRocm93IG5ldyBUeXBlRXJyb3IodHlwZW9mIHQrIiBpcyBub3QgaXRlcmFibGUiKX1yZXR1cm4gdy5wcm90b3R5cGU9dixpKGssImNvbnN0cnVjdG9yIix7dmFsdWU6dixjb25maWd1cmFibGU6ITB9KSxpKHYsImNvbnN0cnVjdG9yIix7dmFsdWU6dyxjb25maWd1cmFibGU6ITB9KSx3LmRpc3BsYXlOYW1lPWgodixsLCJHZW5lcmF0b3JGdW5jdGlvbiIpLHQuaXNHZW5lcmF0b3JGdW5jdGlvbj1mdW5jdGlvbih0KXt2YXIgZT0iZnVuY3Rpb24iPT10eXBlb2YgdCYmdC5jb25zdHJ1Y3RvcjtyZXR1cm4hIWUmJihlPT09d3x8IkdlbmVyYXRvckZ1bmN0aW9uIj09PShlLmRpc3BsYXlOYW1lfHxlLm5hbWUpKX0sdC5tYXJrPWZ1bmN0aW9uKHQpe3JldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsdik6KHQuX19wcm90b19fPXYsaCh0LGwsIkdlbmVyYXRvckZ1bmN0aW9uIikpLHQucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoayksdH0sdC5hd3JhcD1mdW5jdGlvbih0KXtyZXR1cm57X19hd2FpdDp0fX0seihBLnByb3RvdHlwZSksaChBLnByb3RvdHlwZSxvLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpLHQuQXN5bmNJdGVyYXRvcj1BLHQuYXN5bmM9ZnVuY3Rpb24oZSxyLG4saSxhKXt2b2lkIDA9PT1hJiYoYT1Qcm9taXNlKTt2YXIgcz1uZXcgQShjKGUscixuLGkpLGEpO3JldHVybiB0LmlzR2VuZXJhdG9yRnVuY3Rpb24ocik/czpzLm5leHQoKS50aGVuKChmdW5jdGlvbih0KXtyZXR1cm4gdC5kb25lP3QudmFsdWU6cy5uZXh0KCl9KSl9LHooayksaChrLGwsIkdlbmVyYXRvciIpLGgoayxzLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpLGgoaywidG9TdHJpbmciLChmdW5jdGlvbigpe3JldHVybiJbb2JqZWN0IEdlbmVyYXRvcl0ifSkpLHQua2V5cz1mdW5jdGlvbih0KXt2YXIgZT1PYmplY3QodCkscj1bXTtmb3IodmFyIG4gaW4gZSlyLnB1c2gobik7cmV0dXJuIHIucmV2ZXJzZSgpLGZ1bmN0aW9uIHQoKXtmb3IoO3IubGVuZ3RoOyl7dmFyIG49ci5wb3AoKTtpZihuIGluIGUpcmV0dXJuIHQudmFsdWU9bix0LmRvbmU9ITEsdH1yZXR1cm4gdC5kb25lPSEwLHR9fSx0LnZhbHVlcz1SLEwucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjpMLHJlc2V0OmZ1bmN0aW9uKHQpe2lmKHRoaXMucHJldj0wLHRoaXMubmV4dD0wLHRoaXMuc2VudD10aGlzLl9zZW50PWUsdGhpcy5kb25lPSExLHRoaXMuZGVsZWdhdGU9bnVsbCx0aGlzLm1ldGhvZD0ibmV4dCIsdGhpcy5hcmc9ZSx0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChPKSwhdClmb3IodmFyIHIgaW4gdGhpcykidCI9PT1yLmNoYXJBdCgwKSYmbi5jYWxsKHRoaXMscikmJiFpc05hTigrci5zbGljZSgxKSkmJih0aGlzW3JdPWUpfSxzdG9wOmZ1bmN0aW9uKCl7dGhpcy5kb25lPSEwO3ZhciB0PXRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmKCJ0aHJvdyI9PT10LnR5cGUpdGhyb3cgdC5hcmc7cmV0dXJuIHRoaXMucnZhbH0sZGlzcGF0Y2hFeGNlcHRpb246ZnVuY3Rpb24odCl7aWYodGhpcy5kb25lKXRocm93IHQ7dmFyIHI9dGhpcztmdW5jdGlvbiBpKG4saSl7cmV0dXJuIG8udHlwZT0idGhyb3ciLG8uYXJnPXQsci5uZXh0PW4saSYmKHIubWV0aG9kPSJuZXh0IixyLmFyZz1lKSwhIWl9Zm9yKHZhciBhPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTthPj0wOy0tYSl7dmFyIHM9dGhpcy50cnlFbnRyaWVzW2FdLG89cy5jb21wbGV0aW9uO2lmKCJyb290Ij09PXMudHJ5TG9jKXJldHVybiBpKCJlbmQiKTtpZihzLnRyeUxvYzw9dGhpcy5wcmV2KXt2YXIgbD1uLmNhbGwocywiY2F0Y2hMb2MiKSxoPW4uY2FsbChzLCJmaW5hbGx5TG9jIik7aWYobCYmaCl7aWYodGhpcy5wcmV2PHMuY2F0Y2hMb2MpcmV0dXJuIGkocy5jYXRjaExvYywhMCk7aWYodGhpcy5wcmV2PHMuZmluYWxseUxvYylyZXR1cm4gaShzLmZpbmFsbHlMb2MpfWVsc2UgaWYobCl7aWYodGhpcy5wcmV2PHMuY2F0Y2hMb2MpcmV0dXJuIGkocy5jYXRjaExvYywhMCl9ZWxzZXtpZighaCl0aHJvdyBuZXcgRXJyb3IoInRyeSBzdGF0ZW1lbnQgd2l0aG91dCBjYXRjaCBvciBmaW5hbGx5Iik7aWYodGhpcy5wcmV2PHMuZmluYWxseUxvYylyZXR1cm4gaShzLmZpbmFsbHlMb2MpfX19fSxhYnJ1cHQ6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO3I+PTA7LS1yKXt2YXIgaT10aGlzLnRyeUVudHJpZXNbcl07aWYoaS50cnlMb2M8PXRoaXMucHJldiYmbi5jYWxsKGksImZpbmFsbHlMb2MiKSYmdGhpcy5wcmV2PGkuZmluYWxseUxvYyl7dmFyIGE9aTticmVha319YSYmKCJicmVhayI9PT10fHwiY29udGludWUiPT09dCkmJmEudHJ5TG9jPD1lJiZlPD1hLmZpbmFsbHlMb2MmJihhPW51bGwpO3ZhciBzPWE/YS5jb21wbGV0aW9uOnt9O3JldHVybiBzLnR5cGU9dCxzLmFyZz1lLGE/KHRoaXMubWV0aG9kPSJuZXh0Iix0aGlzLm5leHQ9YS5maW5hbGx5TG9jLGcpOnRoaXMuY29tcGxldGUocyl9LGNvbXBsZXRlOmZ1bmN0aW9uKHQsZSl7aWYoInRocm93Ij09PXQudHlwZSl0aHJvdyB0LmFyZztyZXR1cm4iYnJlYWsiPT09dC50eXBlfHwiY29udGludWUiPT09dC50eXBlP3RoaXMubmV4dD10LmFyZzoicmV0dXJuIj09PXQudHlwZT8odGhpcy5ydmFsPXRoaXMuYXJnPXQuYXJnLHRoaXMubWV0aG9kPSJyZXR1cm4iLHRoaXMubmV4dD0iZW5kIik6Im5vcm1hbCI9PT10LnR5cGUmJmUmJih0aGlzLm5leHQ9ZSksZ30sZmluaXNoOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10aGlzLnRyeUVudHJpZXMubGVuZ3RoLTE7ZT49MDstLWUpe3ZhciByPXRoaXMudHJ5RW50cmllc1tlXTtpZihyLmZpbmFsbHlMb2M9PT10KXJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbixyLmFmdGVyTG9jKSxPKHIpLGd9fSxjYXRjaDpmdW5jdGlvbih0KXtmb3IodmFyIGU9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO2U+PTA7LS1lKXt2YXIgcj10aGlzLnRyeUVudHJpZXNbZV07aWYoci50cnlMb2M9PT10KXt2YXIgbj1yLmNvbXBsZXRpb247aWYoInRocm93Ij09PW4udHlwZSl7dmFyIGk9bi5hcmc7TyhyKX1yZXR1cm4gaX19dGhyb3cgbmV3IEVycm9yKCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHQiKX0sZGVsZWdhdGVZaWVsZDpmdW5jdGlvbih0LHIsbil7cmV0dXJuIHRoaXMuZGVsZWdhdGU9e2l0ZXJhdG9yOlIodCkscmVzdWx0TmFtZTpyLG5leHRMb2M6bn0sIm5leHQiPT09dGhpcy5tZXRob2QmJih0aGlzLmFyZz1lKSxnfX0sdH0odC5leHBvcnRzKTt0cnl7Z2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWU9ZX1jYXRjaCh0KXsib2JqZWN0Ij09dHlwZW9mIGdsb2JhbFRoaXM/Z2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWU9ZTpGdW5jdGlvbigiciIsInJlZ2VuZXJhdG9yUnVudGltZSA9IHIiKShlKX19KGkpKTt2YXIgYSxzPXtleHBvcnRzOnt9fTt2YXIgbz0oYXx8KGE9MSxmdW5jdGlvbih0KXtjb25zdCBlPTQscj0wLG49MSxpPTI7ZnVuY3Rpb24gYSh0KXtsZXQgZT10Lmxlbmd0aDtmb3IoOy0tZT49MDspdFtlXT0wfWNvbnN0IHM9MCxvPTEsbD0yLGg9MyxjPTI1OCx1PTI5LF89MjU2LGQ9XysxK3UsZj0zMCxwPTE5LGc9MipkKzEseT0xNSx3PTE2LHY9NyxtPTI1NixiPTE2LHg9MTcsaz0xOCx6PW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMSwxLDEsMSwyLDIsMiwyLDMsMywzLDMsNCw0LDQsNCw1LDUsNSw1LDBdKSxBPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDEsMSwyLDIsMywzLDQsNCw1LDUsNiw2LDcsNyw4LDgsOSw5LDEwLDEwLDExLDExLDEyLDEyLDEzLDEzXSksRT1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyLDMsN10pLFM9bmV3IFVpbnQ4QXJyYXkoWzE2LDE3LDE4LDAsOCw3LDksNiwxMCw1LDExLDQsMTIsMywxMywyLDE0LDEsMTVdKSxCPTUxMixPPW5ldyBBcnJheSgyKihkKzIpKTthKE8pO2NvbnN0IEw9bmV3IEFycmF5KDIqZik7YShMKTtjb25zdCBSPW5ldyBBcnJheShCKTthKFIpO2NvbnN0IEQ9bmV3IEFycmF5KGMtaCsxKTthKEQpO2NvbnN0IFU9bmV3IEFycmF5KHUpO2EoVSk7Y29uc3QgQz1uZXcgQXJyYXkoZik7ZnVuY3Rpb24gVCh0LGUscixuLGkpe3RoaXMuc3RhdGljX3RyZWU9dCx0aGlzLmV4dHJhX2JpdHM9ZSx0aGlzLmV4dHJhX2Jhc2U9cix0aGlzLmVsZW1zPW4sdGhpcy5tYXhfbGVuZ3RoPWksdGhpcy5oYXNfc3RyZWU9dCYmdC5sZW5ndGh9bGV0IEYsSCxaO2Z1bmN0aW9uIE0odCxlKXt0aGlzLmR5bl90cmVlPXQsdGhpcy5tYXhfY29kZT0wLHRoaXMuc3RhdF9kZXNjPWV9YShDKTtjb25zdCBOPXQ9PnQ8MjU2P1JbdF06UlsyNTYrKHQ+Pj43KV0sST0odCxlKT0+e3QucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPTI1NSZlLHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPWU+Pj44JjI1NX0saj0odCxlLHIpPT57dC5iaV92YWxpZD53LXI/KHQuYmlfYnVmfD1lPDx0LmJpX3ZhbGlkJjY1NTM1LEkodCx0LmJpX2J1ZiksdC5iaV9idWY9ZT4+dy10LmJpX3ZhbGlkLHQuYmlfdmFsaWQrPXItdyk6KHQuYmlfYnVmfD1lPDx0LmJpX3ZhbGlkJjY1NTM1LHQuYmlfdmFsaWQrPXIpfSxQPSh0LGUscik9PntqKHQsclsyKmVdLHJbMiplKzFdKX0sJD0odCxlKT0+e2xldCByPTA7ZG97cnw9MSZ0LHQ+Pj49MSxyPDw9MX13aGlsZSgtLWU+MCk7cmV0dXJuIHI+Pj4xfSxLPXQ9PnsxNj09PXQuYmlfdmFsaWQ/KEkodCx0LmJpX2J1ZiksdC5iaV9idWY9MCx0LmJpX3ZhbGlkPTApOnQuYmlfdmFsaWQ+PTgmJih0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmdC5iaV9idWYsdC5iaV9idWY+Pj04LHQuYmlfdmFsaWQtPTgpfSxYPSh0LGUpPT57Y29uc3Qgcj1lLmR5bl90cmVlLG49ZS5tYXhfY29kZSxpPWUuc3RhdF9kZXNjLnN0YXRpY190cmVlLGE9ZS5zdGF0X2Rlc2MuaGFzX3N0cmVlLHM9ZS5zdGF0X2Rlc2MuZXh0cmFfYml0cyxvPWUuc3RhdF9kZXNjLmV4dHJhX2Jhc2UsbD1lLnN0YXRfZGVzYy5tYXhfbGVuZ3RoO2xldCBoLGMsdSxfLGQsZixwPTA7Zm9yKF89MDtfPD15O18rKyl0LmJsX2NvdW50W19dPTA7Zm9yKHJbMip0LmhlYXBbdC5oZWFwX21heF0rMV09MCxoPXQuaGVhcF9tYXgrMTtoPGc7aCsrKWM9dC5oZWFwW2hdLF89clsyKnJbMipjKzFdKzFdKzEsXz5sJiYoXz1sLHArKyksclsyKmMrMV09XyxjPm58fCh0LmJsX2NvdW50W19dKyssZD0wLGM+PW8mJihkPXNbYy1vXSksZj1yWzIqY10sdC5vcHRfbGVuKz1mKihfK2QpLGEmJih0LnN0YXRpY19sZW4rPWYqKGlbMipjKzFdK2QpKSk7aWYoMCE9PXApe2Rve2ZvcihfPWwtMTswPT09dC5ibF9jb3VudFtfXTspXy0tO3QuYmxfY291bnRbX10tLSx0LmJsX2NvdW50W18rMV0rPTIsdC5ibF9jb3VudFtsXS0tLHAtPTJ9d2hpbGUocD4wKTtmb3IoXz1sOzAhPT1fO18tLSlmb3IoYz10LmJsX2NvdW50W19dOzAhPT1jOyl1PXQuaGVhcFstLWhdLHU+bnx8KHJbMip1KzFdIT09XyYmKHQub3B0X2xlbis9KF8tclsyKnUrMV0pKnJbMip1XSxyWzIqdSsxXT1fKSxjLS0pfX0sRz0odCxlLHIpPT57Y29uc3Qgbj1uZXcgQXJyYXkoeSsxKTtsZXQgaSxhLHM9MDtmb3IoaT0xO2k8PXk7aSsrKXM9cytyW2ktMV08PDEsbltpXT1zO2ZvcihhPTA7YTw9ZTthKyspe2xldCBlPXRbMiphKzFdOzAhPT1lJiYodFsyKmFdPSQobltlXSsrLGUpKX19LFc9KCk9PntsZXQgdCxlLHIsbixpO2NvbnN0IGE9bmV3IEFycmF5KHkrMSk7Zm9yKHI9MCxuPTA7bjx1LTE7bisrKWZvcihVW25dPXIsdD0wO3Q8MTw8eltuXTt0KyspRFtyKytdPW47Zm9yKERbci0xXT1uLGk9MCxuPTA7bjwxNjtuKyspZm9yKENbbl09aSx0PTA7dDwxPDxBW25dO3QrKylSW2krK109bjtmb3IoaT4+PTc7bjxmO24rKylmb3IoQ1tuXT1pPDw3LHQ9MDt0PDE8PEFbbl0tNzt0KyspUlsyNTYraSsrXT1uO2ZvcihlPTA7ZTw9eTtlKyspYVtlXT0wO2Zvcih0PTA7dDw9MTQzOylPWzIqdCsxXT04LHQrKyxhWzhdKys7Zm9yKDt0PD0yNTU7KU9bMip0KzFdPTksdCsrLGFbOV0rKztmb3IoO3Q8PTI3OTspT1syKnQrMV09Nyx0KyssYVs3XSsrO2Zvcig7dDw9Mjg3OylPWzIqdCsxXT04LHQrKyxhWzhdKys7Zm9yKEcoTyxkKzEsYSksdD0wO3Q8Zjt0KyspTFsyKnQrMV09NSxMWzIqdF09JCh0LDUpO0Y9bmV3IFQoTyx6LF8rMSxkLHkpLEg9bmV3IFQoTCxBLDAsZix5KSxaPW5ldyBUKG5ldyBBcnJheSgwKSxFLDAscCx2KX0sWT10PT57bGV0IGU7Zm9yKGU9MDtlPGQ7ZSsrKXQuZHluX2x0cmVlWzIqZV09MDtmb3IoZT0wO2U8ZjtlKyspdC5keW5fZHRyZWVbMiplXT0wO2ZvcihlPTA7ZTxwO2UrKyl0LmJsX3RyZWVbMiplXT0wO3QuZHluX2x0cmVlWzIqbV09MSx0Lm9wdF9sZW49dC5zdGF0aWNfbGVuPTAsdC5zeW1fbmV4dD10Lm1hdGNoZXM9MH0scT10PT57dC5iaV92YWxpZD44P0kodCx0LmJpX2J1Zik6dC5iaV92YWxpZD4wJiYodC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109dC5iaV9idWYpLHQuYmlfYnVmPTAsdC5iaV92YWxpZD0wfSxWPSh0LGUscixuKT0+e2NvbnN0IGk9MiplLGE9MipyO3JldHVybiB0W2ldPHRbYV18fHRbaV09PT10W2FdJiZuW2VdPD1uW3JdfSxRPSh0LGUscik9Pntjb25zdCBuPXQuaGVhcFtyXTtsZXQgaT1yPDwxO2Zvcig7aTw9dC5oZWFwX2xlbiYmKGk8dC5oZWFwX2xlbiYmVihlLHQuaGVhcFtpKzFdLHQuaGVhcFtpXSx0LmRlcHRoKSYmaSsrLCFWKGUsbix0LmhlYXBbaV0sdC5kZXB0aCkpOyl0LmhlYXBbcl09dC5oZWFwW2ldLHI9aSxpPDw9MTt0LmhlYXBbcl09bn0sSj0odCxlLHIpPT57bGV0IG4saSxhLHMsbz0wO2lmKDAhPT10LnN5bV9uZXh0KWRve249MjU1JnQucGVuZGluZ19idWZbdC5zeW1fYnVmK28rK10sbis9KDI1NSZ0LnBlbmRpbmdfYnVmW3Quc3ltX2J1ZitvKytdKTw8OCxpPXQucGVuZGluZ19idWZbdC5zeW1fYnVmK28rK10sMD09PW4/UCh0LGksZSk6KGE9RFtpXSxQKHQsYStfKzEsZSkscz16W2FdLDAhPT1zJiYoaS09VVthXSxqKHQsaSxzKSksbi0tLGE9TihuKSxQKHQsYSxyKSxzPUFbYV0sMCE9PXMmJihuLT1DW2FdLGoodCxuLHMpKSl9d2hpbGUobzx0LnN5bV9uZXh0KTtQKHQsbSxlKX0sdHQ9KHQsZSk9Pntjb25zdCByPWUuZHluX3RyZWUsbj1lLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSxpPWUuc3RhdF9kZXNjLmhhc19zdHJlZSxhPWUuc3RhdF9kZXNjLmVsZW1zO2xldCBzLG8sbCxoPS0xO2Zvcih0LmhlYXBfbGVuPTAsdC5oZWFwX21heD1nLHM9MDtzPGE7cysrKTAhPT1yWzIqc10/KHQuaGVhcFsrK3QuaGVhcF9sZW5dPWg9cyx0LmRlcHRoW3NdPTApOnJbMipzKzFdPTA7Zm9yKDt0LmhlYXBfbGVuPDI7KWw9dC5oZWFwWysrdC5oZWFwX2xlbl09aDwyPysraDowLHJbMipsXT0xLHQuZGVwdGhbbF09MCx0Lm9wdF9sZW4tLSxpJiYodC5zdGF0aWNfbGVuLT1uWzIqbCsxXSk7Zm9yKGUubWF4X2NvZGU9aCxzPXQuaGVhcF9sZW4+PjE7cz49MTtzLS0pUSh0LHIscyk7bD1hO2Rve3M9dC5oZWFwWzFdLHQuaGVhcFsxXT10LmhlYXBbdC5oZWFwX2xlbi0tXSxRKHQsciwxKSxvPXQuaGVhcFsxXSx0LmhlYXBbLS10LmhlYXBfbWF4XT1zLHQuaGVhcFstLXQuaGVhcF9tYXhdPW8sclsyKmxdPXJbMipzXStyWzIqb10sdC5kZXB0aFtsXT0odC5kZXB0aFtzXT49dC5kZXB0aFtvXT90LmRlcHRoW3NdOnQuZGVwdGhbb10pKzEsclsyKnMrMV09clsyKm8rMV09bCx0LmhlYXBbMV09bCsrLFEodCxyLDEpfXdoaWxlKHQuaGVhcF9sZW4+PTIpO3QuaGVhcFstLXQuaGVhcF9tYXhdPXQuaGVhcFsxXSxYKHQsZSksRyhyLGgsdC5ibF9jb3VudCl9LGV0PSh0LGUscik9PntsZXQgbixpLGE9LTEscz1lWzFdLG89MCxsPTcsaD00O2ZvcigwPT09cyYmKGw9MTM4LGg9MyksZVsyKihyKzEpKzFdPTY1NTM1LG49MDtuPD1yO24rKylpPXMscz1lWzIqKG4rMSkrMV0sKytvPGwmJmk9PT1zfHwobzxoP3QuYmxfdHJlZVsyKmldKz1vOjAhPT1pPyhpIT09YSYmdC5ibF90cmVlWzIqaV0rKyx0LmJsX3RyZWVbMipiXSsrKTpvPD0xMD90LmJsX3RyZWVbMip4XSsrOnQuYmxfdHJlZVsyKmtdKyssbz0wLGE9aSwwPT09cz8obD0xMzgsaD0zKTppPT09cz8obD02LGg9Myk6KGw9NyxoPTQpKX0scnQ9KHQsZSxyKT0+e2xldCBuLGksYT0tMSxzPWVbMV0sbz0wLGw9NyxoPTQ7Zm9yKDA9PT1zJiYobD0xMzgsaD0zKSxuPTA7bjw9cjtuKyspaWYoaT1zLHM9ZVsyKihuKzEpKzFdLCEoKytvPGwmJmk9PT1zKSl7aWYobzxoKWRve1AodCxpLHQuYmxfdHJlZSl9d2hpbGUoMCE9LS1vKTtlbHNlIDAhPT1pPyhpIT09YSYmKFAodCxpLHQuYmxfdHJlZSksby0tKSxQKHQsYix0LmJsX3RyZWUpLGoodCxvLTMsMikpOm88PTEwPyhQKHQseCx0LmJsX3RyZWUpLGoodCxvLTMsMykpOihQKHQsayx0LmJsX3RyZWUpLGoodCxvLTExLDcpKTtvPTAsYT1pLDA9PT1zPyhsPTEzOCxoPTMpOmk9PT1zPyhsPTYsaD0zKToobD03LGg9NCl9fSxudD10PT57bGV0IGU7Zm9yKGV0KHQsdC5keW5fbHRyZWUsdC5sX2Rlc2MubWF4X2NvZGUpLGV0KHQsdC5keW5fZHRyZWUsdC5kX2Rlc2MubWF4X2NvZGUpLHR0KHQsdC5ibF9kZXNjKSxlPXAtMTtlPj0zJiYwPT09dC5ibF90cmVlWzIqU1tlXSsxXTtlLS0pO3JldHVybiB0Lm9wdF9sZW4rPTMqKGUrMSkrNSs1KzQsZX0saXQ9KHQsZSxyLG4pPT57bGV0IGk7Zm9yKGoodCxlLTI1Nyw1KSxqKHQsci0xLDUpLGoodCxuLTQsNCksaT0wO2k8bjtpKyspaih0LHQuYmxfdHJlZVsyKlNbaV0rMV0sMyk7cnQodCx0LmR5bl9sdHJlZSxlLTEpLHJ0KHQsdC5keW5fZHRyZWUsci0xKX0sYXQ9dD0+e2xldCBlLGk9NDA5MzYyNDQ0Nztmb3IoZT0wO2U8PTMxO2UrKyxpPj4+PTEpaWYoMSZpJiYwIT09dC5keW5fbHRyZWVbMiplXSlyZXR1cm4gcjtpZigwIT09dC5keW5fbHRyZWVbMThdfHwwIT09dC5keW5fbHRyZWVbMjBdfHwwIT09dC5keW5fbHRyZWVbMjZdKXJldHVybiBuO2ZvcihlPTMyO2U8XztlKyspaWYoMCE9PXQuZHluX2x0cmVlWzIqZV0pcmV0dXJuIG47cmV0dXJuIHJ9O2xldCBzdD0hMTtjb25zdCBvdD0odCxlLHIsbik9PntqKHQsKHM8PDEpKyhuPzE6MCksMykscSh0KSxJKHQsciksSSh0LH5yKSxyJiZ0LnBlbmRpbmdfYnVmLnNldCh0LndpbmRvdy5zdWJhcnJheShlLGUrciksdC5wZW5kaW5nKSx0LnBlbmRpbmcrPXJ9LGx0PSh0LHIsbixhKT0+e2xldCBzLGgsYz0wO3QubGV2ZWw+MD8odC5zdHJtLmRhdGFfdHlwZT09PWkmJih0LnN0cm0uZGF0YV90eXBlPWF0KHQpKSx0dCh0LHQubF9kZXNjKSx0dCh0LHQuZF9kZXNjKSxjPW50KHQpLHM9dC5vcHRfbGVuKzMrNz4+PjMsaD10LnN0YXRpY19sZW4rMys3Pj4+MyxoPD1zJiYocz1oKSk6cz1oPW4rNSxuKzQ8PXMmJi0xIT09cj9vdCh0LHIsbixhKTp0LnN0cmF0ZWd5PT09ZXx8aD09PXM/KGoodCwobzw8MSkrKGE/MTowKSwzKSxKKHQsTyxMKSk6KGoodCwobDw8MSkrKGE/MTowKSwzKSxpdCh0LHQubF9kZXNjLm1heF9jb2RlKzEsdC5kX2Rlc2MubWF4X2NvZGUrMSxjKzEpLEoodCx0LmR5bl9sdHJlZSx0LmR5bl9kdHJlZSkpLFkodCksYSYmcSh0KX07dmFyIGh0PXtfdHJfaW5pdDp0PT57c3R8fChXKCksc3Q9ITApLHQubF9kZXNjPW5ldyBNKHQuZHluX2x0cmVlLEYpLHQuZF9kZXNjPW5ldyBNKHQuZHluX2R0cmVlLEgpLHQuYmxfZGVzYz1uZXcgTSh0LmJsX3RyZWUsWiksdC5iaV9idWY9MCx0LmJpX3ZhbGlkPTAsWSh0KX0sX3RyX3N0b3JlZF9ibG9jazpvdCxfdHJfZmx1c2hfYmxvY2s6bHQsX3RyX3RhbGx5Oih0LGUscik9Pih0LnBlbmRpbmdfYnVmW3Quc3ltX2J1Zit0LnN5bV9uZXh0KytdPWUsdC5wZW5kaW5nX2J1Zlt0LnN5bV9idWYrdC5zeW1fbmV4dCsrXT1lPj44LHQucGVuZGluZ19idWZbdC5zeW1fYnVmK3Quc3ltX25leHQrK109ciwwPT09ZT90LmR5bl9sdHJlZVsyKnJdKys6KHQubWF0Y2hlcysrLGUtLSx0LmR5bl9sdHJlZVsyKihEW3JdK18rMSldKyssdC5keW5fZHRyZWVbMipOKGUpXSsrKSx0LnN5bV9uZXh0PT09dC5zeW1fZW5kKSxfdHJfYWxpZ246dD0+e2oodCxvPDwxLDMpLFAodCxtLE8pLEsodCl9fSxjdD0odCxlLHIsbik9PntsZXQgaT02NTUzNSZ0LGE9dD4+PjE2JjY1NTM1LHM9MDtmb3IoOzAhPT1yOyl7cz1yPjJlMz8yZTM6cixyLT1zO2Rve2k9aStlW24rK118MCxhPWEraXwwfXdoaWxlKC0tcyk7aSU9NjU1MjEsYSU9NjU1MjF9cmV0dXJuIGl8YTw8MTZ9O2NvbnN0IHV0PW5ldyBVaW50MzJBcnJheSgoKCk9PntsZXQgdCxlPVtdO2Zvcih2YXIgcj0wO3I8MjU2O3IrKyl7dD1yO2Zvcih2YXIgbj0wO248ODtuKyspdD0xJnQ/Mzk4ODI5MjM4NF50Pj4+MTp0Pj4+MTtlW3JdPXR9cmV0dXJuIGV9KSgpKTt2YXIgX3Q9KHQsZSxyLG4pPT57Y29uc3QgaT11dCxhPW4rcjt0Xj0tMTtmb3IobGV0IHI9bjtyPGE7cisrKXQ9dD4+PjheaVsyNTUmKHReZVtyXSldO3JldHVybn50fSxkdD17MjoibmVlZCBkaWN0aW9uYXJ5IiwxOiJzdHJlYW0gZW5kIiwwOiIiLCItMSI6ImZpbGUgZXJyb3IiLCItMiI6InN0cmVhbSBlcnJvciIsIi0zIjoiZGF0YSBlcnJvciIsIi00IjoiaW5zdWZmaWNpZW50IG1lbW9yeSIsIi01IjoiYnVmZmVyIGVycm9yIiwiLTYiOiJpbmNvbXBhdGlibGUgdmVyc2lvbiJ9LGZ0PXtaX05PX0ZMVVNIOjAsWl9QQVJUSUFMX0ZMVVNIOjEsWl9TWU5DX0ZMVVNIOjIsWl9GVUxMX0ZMVVNIOjMsWl9GSU5JU0g6NCxaX0JMT0NLOjUsWl9UUkVFUzo2LFpfT0s6MCxaX1NUUkVBTV9FTkQ6MSxaX05FRURfRElDVDoyLFpfRVJSTk86LTEsWl9TVFJFQU1fRVJST1I6LTIsWl9EQVRBX0VSUk9SOi0zLFpfTUVNX0VSUk9SOi00LFpfQlVGX0VSUk9SOi01LFpfTk9fQ09NUFJFU1NJT046MCxaX0JFU1RfU1BFRUQ6MSxaX0JFU1RfQ09NUFJFU1NJT046OSxaX0RFRkFVTFRfQ09NUFJFU1NJT046LTEsWl9GSUxURVJFRDoxLFpfSFVGRk1BTl9PTkxZOjIsWl9STEU6MyxaX0ZJWEVEOjQsWl9ERUZBVUxUX1NUUkFURUdZOjAsWl9CSU5BUlk6MCxaX1RFWFQ6MSxaX1VOS05PV046MixaX0RFRkxBVEVEOjh9O2NvbnN0e190cl9pbml0OnB0LF90cl9zdG9yZWRfYmxvY2s6Z3QsX3RyX2ZsdXNoX2Jsb2NrOnl0LF90cl90YWxseTp3dCxfdHJfYWxpZ246dnR9PWh0LHtaX05PX0ZMVVNIOm10LFpfUEFSVElBTF9GTFVTSDpidCxaX0ZVTExfRkxVU0g6eHQsWl9GSU5JU0g6a3QsWl9CTE9DSzp6dCxaX09LOkF0LFpfU1RSRUFNX0VORDpFdCxaX1NUUkVBTV9FUlJPUjpTdCxaX0RBVEFfRVJST1I6QnQsWl9CVUZfRVJST1I6T3QsWl9ERUZBVUxUX0NPTVBSRVNTSU9OOkx0LFpfRklMVEVSRUQ6UnQsWl9IVUZGTUFOX09OTFk6RHQsWl9STEU6VXQsWl9GSVhFRDpDdCxaX0RFRkFVTFRfU1RSQVRFR1k6VHQsWl9VTktOT1dOOkZ0LFpfREVGTEFURUQ6SHR9PWZ0LFp0PTksTXQ9MTUsTnQ9OCxJdD0yODYsanQ9MzAsUHQ9MTksJHQ9MipJdCsxLEt0PTE1LFh0PTMsR3Q9MjU4LFd0PUd0K1h0KzEsWXQ9MzIscXQ9NDIsVnQ9NTcsUXQ9NjksSnQ9NzMsdGU9OTEsZWU9MTAzLHJlPTExMyxuZT02NjYsaWU9MSxhZT0yLHNlPTMsb2U9NCxsZT0zLGhlPSh0LGUpPT4odC5tc2c9ZHRbZV0sZSksY2U9dD0+Mip0LSh0PjQ/OTowKSx1ZT10PT57bGV0IGU9dC5sZW5ndGg7Zm9yKDstLWU+PTA7KXRbZV09MH0sX2U9dD0+e2xldCBlLHIsbixpPXQud19zaXplO2U9dC5oYXNoX3NpemUsbj1lO2Rve3I9dC5oZWFkWy0tbl0sdC5oZWFkW25dPXI+PWk/ci1pOjB9d2hpbGUoLS1lKTtlPWksbj1lO2Rve3I9dC5wcmV2Wy0tbl0sdC5wcmV2W25dPXI+PWk/ci1pOjB9d2hpbGUoLS1lKX07bGV0IGRlPSh0LGUscik9PihlPDx0Lmhhc2hfc2hpZnRecikmdC5oYXNoX21hc2s7Y29uc3QgZmU9dD0+e2NvbnN0IGU9dC5zdGF0ZTtsZXQgcj1lLnBlbmRpbmc7cj50LmF2YWlsX291dCYmKHI9dC5hdmFpbF9vdXQpLDAhPT1yJiYodC5vdXRwdXQuc2V0KGUucGVuZGluZ19idWYuc3ViYXJyYXkoZS5wZW5kaW5nX291dCxlLnBlbmRpbmdfb3V0K3IpLHQubmV4dF9vdXQpLHQubmV4dF9vdXQrPXIsZS5wZW5kaW5nX291dCs9cix0LnRvdGFsX291dCs9cix0LmF2YWlsX291dC09cixlLnBlbmRpbmctPXIsMD09PWUucGVuZGluZyYmKGUucGVuZGluZ19vdXQ9MCkpfSxwZT0odCxlKT0+e3l0KHQsdC5ibG9ja19zdGFydD49MD90LmJsb2NrX3N0YXJ0Oi0xLHQuc3Ryc3RhcnQtdC5ibG9ja19zdGFydCxlKSx0LmJsb2NrX3N0YXJ0PXQuc3Ryc3RhcnQsZmUodC5zdHJtKX0sZ2U9KHQsZSk9Pnt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lfSx5ZT0odCxlKT0+e3QucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPWU+Pj44JjI1NSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmZX0sd2U9KHQsZSxyLG4pPT57bGV0IGk9dC5hdmFpbF9pbjtyZXR1cm4gaT5uJiYoaT1uKSwwPT09aT8wOih0LmF2YWlsX2luLT1pLGUuc2V0KHQuaW5wdXQuc3ViYXJyYXkodC5uZXh0X2luLHQubmV4dF9pbitpKSxyKSwxPT09dC5zdGF0ZS53cmFwP3QuYWRsZXI9Y3QodC5hZGxlcixlLGkscik6Mj09PXQuc3RhdGUud3JhcCYmKHQuYWRsZXI9X3QodC5hZGxlcixlLGkscikpLHQubmV4dF9pbis9aSx0LnRvdGFsX2luKz1pLGkpfSx2ZT0odCxlKT0+e2xldCByLG4saT10Lm1heF9jaGFpbl9sZW5ndGgsYT10LnN0cnN0YXJ0LHM9dC5wcmV2X2xlbmd0aCxvPXQubmljZV9tYXRjaDtjb25zdCBsPXQuc3Ryc3RhcnQ+dC53X3NpemUtV3Q/dC5zdHJzdGFydC0odC53X3NpemUtV3QpOjAsaD10LndpbmRvdyxjPXQud19tYXNrLHU9dC5wcmV2LF89dC5zdHJzdGFydCtHdDtsZXQgZD1oW2Ercy0xXSxmPWhbYStzXTt0LnByZXZfbGVuZ3RoPj10Lmdvb2RfbWF0Y2gmJihpPj49Miksbz50Lmxvb2thaGVhZCYmKG89dC5sb29rYWhlYWQpO2Rve2lmKHI9ZSxoW3Irc109PT1mJiZoW3Ircy0xXT09PWQmJmhbcl09PT1oW2FdJiZoWysrcl09PT1oW2ErMV0pe2ErPTIscisrO2Rve313aGlsZShoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmYTxfKTtpZihuPUd0LShfLWEpLGE9Xy1HdCxuPnMpe2lmKHQubWF0Y2hfc3RhcnQ9ZSxzPW4sbj49bylicmVhaztkPWhbYStzLTFdLGY9aFthK3NdfX19d2hpbGUoKGU9dVtlJmNdKT5sJiYwIT0tLWkpO3JldHVybiBzPD10Lmxvb2thaGVhZD9zOnQubG9va2FoZWFkfSxtZT10PT57Y29uc3QgZT10Lndfc2l6ZTtsZXQgcixuLGk7ZG97aWYobj10LndpbmRvd19zaXplLXQubG9va2FoZWFkLXQuc3Ryc3RhcnQsdC5zdHJzdGFydD49ZSsoZS1XdCkmJih0LndpbmRvdy5zZXQodC53aW5kb3cuc3ViYXJyYXkoZSxlK2UtbiksMCksdC5tYXRjaF9zdGFydC09ZSx0LnN0cnN0YXJ0LT1lLHQuYmxvY2tfc3RhcnQtPWUsdC5pbnNlcnQ+dC5zdHJzdGFydCYmKHQuaW5zZXJ0PXQuc3Ryc3RhcnQpLF9lKHQpLG4rPWUpLDA9PT10LnN0cm0uYXZhaWxfaW4pYnJlYWs7aWYocj13ZSh0LnN0cm0sdC53aW5kb3csdC5zdHJzdGFydCt0Lmxvb2thaGVhZCxuKSx0Lmxvb2thaGVhZCs9cix0Lmxvb2thaGVhZCt0Lmluc2VydD49WHQpZm9yKGk9dC5zdHJzdGFydC10Lmluc2VydCx0Lmluc19oPXQud2luZG93W2ldLHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W2krMV0pO3QuaW5zZXJ0JiYodC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbaStYdC0xXSksdC5wcmV2W2kmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09aSxpKyssdC5pbnNlcnQtLSwhKHQubG9va2FoZWFkK3QuaW5zZXJ0PFh0KSk7KTt9d2hpbGUodC5sb29rYWhlYWQ8V3QmJjAhPT10LnN0cm0uYXZhaWxfaW4pfSxiZT0odCxlKT0+e2xldCByLG4saSxhPXQucGVuZGluZ19idWZfc2l6ZS01PnQud19zaXplP3Qud19zaXplOnQucGVuZGluZ19idWZfc2l6ZS01LHM9MCxvPXQuc3RybS5hdmFpbF9pbjtkb3tpZihyPTY1NTM1LGk9dC5iaV92YWxpZCs0Mj4+Myx0LnN0cm0uYXZhaWxfb3V0PGkpYnJlYWs7aWYoaT10LnN0cm0uYXZhaWxfb3V0LWksbj10LnN0cnN0YXJ0LXQuYmxvY2tfc3RhcnQscj5uK3Quc3RybS5hdmFpbF9pbiYmKHI9bit0LnN0cm0uYXZhaWxfaW4pLHI+aSYmKHI9aSkscjxhJiYoMD09PXImJmUhPT1rdHx8ZT09PW10fHxyIT09bit0LnN0cm0uYXZhaWxfaW4pKWJyZWFrO3M9ZT09PWt0JiZyPT09bit0LnN0cm0uYXZhaWxfaW4/MTowLGd0KHQsMCwwLHMpLHQucGVuZGluZ19idWZbdC5wZW5kaW5nLTRdPXIsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmctM109cj4+OCx0LnBlbmRpbmdfYnVmW3QucGVuZGluZy0yXT1+cix0LnBlbmRpbmdfYnVmW3QucGVuZGluZy0xXT1+cj4+OCxmZSh0LnN0cm0pLG4mJihuPnImJihuPXIpLHQuc3RybS5vdXRwdXQuc2V0KHQud2luZG93LnN1YmFycmF5KHQuYmxvY2tfc3RhcnQsdC5ibG9ja19zdGFydCtuKSx0LnN0cm0ubmV4dF9vdXQpLHQuc3RybS5uZXh0X291dCs9bix0LnN0cm0uYXZhaWxfb3V0LT1uLHQuc3RybS50b3RhbF9vdXQrPW4sdC5ibG9ja19zdGFydCs9bixyLT1uKSxyJiYod2UodC5zdHJtLHQuc3RybS5vdXRwdXQsdC5zdHJtLm5leHRfb3V0LHIpLHQuc3RybS5uZXh0X291dCs9cix0LnN0cm0uYXZhaWxfb3V0LT1yLHQuc3RybS50b3RhbF9vdXQrPXIpfXdoaWxlKDA9PT1zKTtyZXR1cm4gby09dC5zdHJtLmF2YWlsX2luLG8mJihvPj10Lndfc2l6ZT8odC5tYXRjaGVzPTIsdC53aW5kb3cuc2V0KHQuc3RybS5pbnB1dC5zdWJhcnJheSh0LnN0cm0ubmV4dF9pbi10Lndfc2l6ZSx0LnN0cm0ubmV4dF9pbiksMCksdC5zdHJzdGFydD10Lndfc2l6ZSx0Lmluc2VydD10LnN0cnN0YXJ0KToodC53aW5kb3dfc2l6ZS10LnN0cnN0YXJ0PD1vJiYodC5zdHJzdGFydC09dC53X3NpemUsdC53aW5kb3cuc2V0KHQud2luZG93LnN1YmFycmF5KHQud19zaXplLHQud19zaXplK3Quc3Ryc3RhcnQpLDApLHQubWF0Y2hlczwyJiZ0Lm1hdGNoZXMrKyx0Lmluc2VydD50LnN0cnN0YXJ0JiYodC5pbnNlcnQ9dC5zdHJzdGFydCkpLHQud2luZG93LnNldCh0LnN0cm0uaW5wdXQuc3ViYXJyYXkodC5zdHJtLm5leHRfaW4tbyx0LnN0cm0ubmV4dF9pbiksdC5zdHJzdGFydCksdC5zdHJzdGFydCs9byx0Lmluc2VydCs9bz50Lndfc2l6ZS10Lmluc2VydD90Lndfc2l6ZS10Lmluc2VydDpvKSx0LmJsb2NrX3N0YXJ0PXQuc3Ryc3RhcnQpLHQuaGlnaF93YXRlcjx0LnN0cnN0YXJ0JiYodC5oaWdoX3dhdGVyPXQuc3Ryc3RhcnQpLHM/b2U6ZSE9PW10JiZlIT09a3QmJjA9PT10LnN0cm0uYXZhaWxfaW4mJnQuc3Ryc3RhcnQ9PT10LmJsb2NrX3N0YXJ0P2FlOihpPXQud2luZG93X3NpemUtdC5zdHJzdGFydCx0LnN0cm0uYXZhaWxfaW4+aSYmdC5ibG9ja19zdGFydD49dC53X3NpemUmJih0LmJsb2NrX3N0YXJ0LT10Lndfc2l6ZSx0LnN0cnN0YXJ0LT10Lndfc2l6ZSx0LndpbmRvdy5zZXQodC53aW5kb3cuc3ViYXJyYXkodC53X3NpemUsdC53X3NpemUrdC5zdHJzdGFydCksMCksdC5tYXRjaGVzPDImJnQubWF0Y2hlcysrLGkrPXQud19zaXplLHQuaW5zZXJ0PnQuc3Ryc3RhcnQmJih0Lmluc2VydD10LnN0cnN0YXJ0KSksaT50LnN0cm0uYXZhaWxfaW4mJihpPXQuc3RybS5hdmFpbF9pbiksaSYmKHdlKHQuc3RybSx0LndpbmRvdyx0LnN0cnN0YXJ0LGkpLHQuc3Ryc3RhcnQrPWksdC5pbnNlcnQrPWk+dC53X3NpemUtdC5pbnNlcnQ/dC53X3NpemUtdC5pbnNlcnQ6aSksdC5oaWdoX3dhdGVyPHQuc3Ryc3RhcnQmJih0LmhpZ2hfd2F0ZXI9dC5zdHJzdGFydCksaT10LmJpX3ZhbGlkKzQyPj4zLGk9dC5wZW5kaW5nX2J1Zl9zaXplLWk+NjU1MzU/NjU1MzU6dC5wZW5kaW5nX2J1Zl9zaXplLWksYT1pPnQud19zaXplP3Qud19zaXplOmksbj10LnN0cnN0YXJ0LXQuYmxvY2tfc3RhcnQsKG4+PWF8fChufHxlPT09a3QpJiZlIT09bXQmJjA9PT10LnN0cm0uYXZhaWxfaW4mJm48PWkpJiYocj1uPmk/aTpuLHM9ZT09PWt0JiYwPT09dC5zdHJtLmF2YWlsX2luJiZyPT09bj8xOjAsZ3QodCx0LmJsb2NrX3N0YXJ0LHIscyksdC5ibG9ja19zdGFydCs9cixmZSh0LnN0cm0pKSxzP3NlOmllKX0seGU9KHQsZSk9PntsZXQgcixuO2Zvcig7Oyl7aWYodC5sb29rYWhlYWQ8V3Qpe2lmKG1lKHQpLHQubG9va2FoZWFkPFd0JiZlPT09bXQpcmV0dXJuIGllO2lmKDA9PT10Lmxvb2thaGVhZClicmVha31pZihyPTAsdC5sb29rYWhlYWQ+PVh0JiYodC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCtYdC0xXSkscj10LnByZXZbdC5zdHJzdGFydCZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT10LnN0cnN0YXJ0KSwwIT09ciYmdC5zdHJzdGFydC1yPD10Lndfc2l6ZS1XdCYmKHQubWF0Y2hfbGVuZ3RoPXZlKHQscikpLHQubWF0Y2hfbGVuZ3RoPj1YdClpZihuPXd0KHQsdC5zdHJzdGFydC10Lm1hdGNoX3N0YXJ0LHQubWF0Y2hfbGVuZ3RoLVh0KSx0Lmxvb2thaGVhZC09dC5tYXRjaF9sZW5ndGgsdC5tYXRjaF9sZW5ndGg8PXQubWF4X2xhenlfbWF0Y2gmJnQubG9va2FoZWFkPj1YdCl7dC5tYXRjaF9sZW5ndGgtLTtkb3t0LnN0cnN0YXJ0KyssdC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCtYdC0xXSkscj10LnByZXZbdC5zdHJzdGFydCZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT10LnN0cnN0YXJ0fXdoaWxlKDAhPS0tdC5tYXRjaF9sZW5ndGgpO3Quc3Ryc3RhcnQrK31lbHNlIHQuc3Ryc3RhcnQrPXQubWF0Y2hfbGVuZ3RoLHQubWF0Y2hfbGVuZ3RoPTAsdC5pbnNfaD10LndpbmRvd1t0LnN0cnN0YXJ0XSx0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1t0LnN0cnN0YXJ0KzFdKTtlbHNlIG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKztpZihuJiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9dC5zdHJzdGFydDxYdC0xP3Quc3Ryc3RhcnQ6WHQtMSxlPT09a3Q/KHBlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0LnN5bV9uZXh0JiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSxrZT0odCxlKT0+e2xldCByLG4saTtmb3IoOzspe2lmKHQubG9va2FoZWFkPFd0KXtpZihtZSh0KSx0Lmxvb2thaGVhZDxXdCYmZT09PW10KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYocj0wLHQubG9va2FoZWFkPj1YdCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrWHQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCksdC5wcmV2X2xlbmd0aD10Lm1hdGNoX2xlbmd0aCx0LnByZXZfbWF0Y2g9dC5tYXRjaF9zdGFydCx0Lm1hdGNoX2xlbmd0aD1YdC0xLDAhPT1yJiZ0LnByZXZfbGVuZ3RoPHQubWF4X2xhenlfbWF0Y2gmJnQuc3Ryc3RhcnQtcjw9dC53X3NpemUtV3QmJih0Lm1hdGNoX2xlbmd0aD12ZSh0LHIpLHQubWF0Y2hfbGVuZ3RoPD01JiYodC5zdHJhdGVneT09PVJ0fHx0Lm1hdGNoX2xlbmd0aD09PVh0JiZ0LnN0cnN0YXJ0LXQubWF0Y2hfc3RhcnQ+NDA5NikmJih0Lm1hdGNoX2xlbmd0aD1YdC0xKSksdC5wcmV2X2xlbmd0aD49WHQmJnQubWF0Y2hfbGVuZ3RoPD10LnByZXZfbGVuZ3RoKXtpPXQuc3Ryc3RhcnQrdC5sb29rYWhlYWQtWHQsbj13dCh0LHQuc3Ryc3RhcnQtMS10LnByZXZfbWF0Y2gsdC5wcmV2X2xlbmd0aC1YdCksdC5sb29rYWhlYWQtPXQucHJldl9sZW5ndGgtMSx0LnByZXZfbGVuZ3RoLT0yO2RveysrdC5zdHJzdGFydDw9aSYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrWHQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCl9d2hpbGUoMCE9LS10LnByZXZfbGVuZ3RoKTtpZih0Lm1hdGNoX2F2YWlsYWJsZT0wLHQubWF0Y2hfbGVuZ3RoPVh0LTEsdC5zdHJzdGFydCsrLG4mJihwZSh0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCkpcmV0dXJuIGllfWVsc2UgaWYodC5tYXRjaF9hdmFpbGFibGUpe2lmKG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnQtMV0pLG4mJnBlKHQsITEpLHQuc3Ryc3RhcnQrKyx0Lmxvb2thaGVhZC0tLDA9PT10LnN0cm0uYXZhaWxfb3V0KXJldHVybiBpZX1lbHNlIHQubWF0Y2hfYXZhaWxhYmxlPTEsdC5zdHJzdGFydCsrLHQubG9va2FoZWFkLS19cmV0dXJuIHQubWF0Y2hfYXZhaWxhYmxlJiYobj13dCh0LDAsdC53aW5kb3dbdC5zdHJzdGFydC0xXSksdC5tYXRjaF9hdmFpbGFibGU9MCksdC5pbnNlcnQ9dC5zdHJzdGFydDxYdC0xP3Quc3Ryc3RhcnQ6WHQtMSxlPT09a3Q/KHBlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0LnN5bV9uZXh0JiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSx6ZT0odCxlKT0+e2xldCByLG4saSxhO2NvbnN0IHM9dC53aW5kb3c7Zm9yKDs7KXtpZih0Lmxvb2thaGVhZDw9R3Qpe2lmKG1lKHQpLHQubG9va2FoZWFkPD1HdCYmZT09PW10KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYodC5tYXRjaF9sZW5ndGg9MCx0Lmxvb2thaGVhZD49WHQmJnQuc3Ryc3RhcnQ+MCYmKGk9dC5zdHJzdGFydC0xLG49c1tpXSxuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldKSl7YT10LnN0cnN0YXJ0K0d0O2Rve313aGlsZShuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZpPGEpO3QubWF0Y2hfbGVuZ3RoPUd0LShhLWkpLHQubWF0Y2hfbGVuZ3RoPnQubG9va2FoZWFkJiYodC5tYXRjaF9sZW5ndGg9dC5sb29rYWhlYWQpfWlmKHQubWF0Y2hfbGVuZ3RoPj1YdD8ocj13dCh0LDEsdC5tYXRjaF9sZW5ndGgtWHQpLHQubG9va2FoZWFkLT10Lm1hdGNoX2xlbmd0aCx0LnN0cnN0YXJ0Kz10Lm1hdGNoX2xlbmd0aCx0Lm1hdGNoX2xlbmd0aD0wKToocj13dCh0LDAsdC53aW5kb3dbdC5zdHJzdGFydF0pLHQubG9va2FoZWFkLS0sdC5zdHJzdGFydCsrKSxyJiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9MCxlPT09a3Q/KHBlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0LnN5bV9uZXh0JiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSxBZT0odCxlKT0+e2xldCByO2Zvcig7Oyl7aWYoMD09PXQubG9va2FoZWFkJiYobWUodCksMD09PXQubG9va2FoZWFkKSl7aWYoZT09PW10KXJldHVybiBpZTticmVha31pZih0Lm1hdGNoX2xlbmd0aD0wLHI9d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKyxyJiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9MCxlPT09a3Q/KHBlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0LnN5bV9uZXh0JiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfTtmdW5jdGlvbiBFZSh0LGUscixuLGkpe3RoaXMuZ29vZF9sZW5ndGg9dCx0aGlzLm1heF9sYXp5PWUsdGhpcy5uaWNlX2xlbmd0aD1yLHRoaXMubWF4X2NoYWluPW4sdGhpcy5mdW5jPWl9Y29uc3QgU2U9W25ldyBFZSgwLDAsMCwwLGJlKSxuZXcgRWUoNCw0LDgsNCx4ZSksbmV3IEVlKDQsNSwxNiw4LHhlKSxuZXcgRWUoNCw2LDMyLDMyLHhlKSxuZXcgRWUoNCw0LDE2LDE2LGtlKSxuZXcgRWUoOCwxNiwzMiwzMixrZSksbmV3IEVlKDgsMTYsMTI4LDEyOCxrZSksbmV3IEVlKDgsMzIsMTI4LDI1NixrZSksbmV3IEVlKDMyLDEyOCwyNTgsMTAyNCxrZSksbmV3IEVlKDMyLDI1OCwyNTgsNDA5NixrZSldLEJlPXQ9Pnt0LndpbmRvd19zaXplPTIqdC53X3NpemUsdWUodC5oZWFkKSx0Lm1heF9sYXp5X21hdGNoPVNlW3QubGV2ZWxdLm1heF9sYXp5LHQuZ29vZF9tYXRjaD1TZVt0LmxldmVsXS5nb29kX2xlbmd0aCx0Lm5pY2VfbWF0Y2g9U2VbdC5sZXZlbF0ubmljZV9sZW5ndGgsdC5tYXhfY2hhaW5fbGVuZ3RoPVNlW3QubGV2ZWxdLm1heF9jaGFpbix0LnN0cnN0YXJ0PTAsdC5ibG9ja19zdGFydD0wLHQubG9va2FoZWFkPTAsdC5pbnNlcnQ9MCx0Lm1hdGNoX2xlbmd0aD10LnByZXZfbGVuZ3RoPVh0LTEsdC5tYXRjaF9hdmFpbGFibGU9MCx0Lmluc19oPTB9O2Z1bmN0aW9uIE9lKCl7dGhpcy5zdHJtPW51bGwsdGhpcy5zdGF0dXM9MCx0aGlzLnBlbmRpbmdfYnVmPW51bGwsdGhpcy5wZW5kaW5nX2J1Zl9zaXplPTAsdGhpcy5wZW5kaW5nX291dD0wLHRoaXMucGVuZGluZz0wLHRoaXMud3JhcD0wLHRoaXMuZ3poZWFkPW51bGwsdGhpcy5nemluZGV4PTAsdGhpcy5tZXRob2Q9SHQsdGhpcy5sYXN0X2ZsdXNoPS0xLHRoaXMud19zaXplPTAsdGhpcy53X2JpdHM9MCx0aGlzLndfbWFzaz0wLHRoaXMud2luZG93PW51bGwsdGhpcy53aW5kb3dfc2l6ZT0wLHRoaXMucHJldj1udWxsLHRoaXMuaGVhZD1udWxsLHRoaXMuaW5zX2g9MCx0aGlzLmhhc2hfc2l6ZT0wLHRoaXMuaGFzaF9iaXRzPTAsdGhpcy5oYXNoX21hc2s9MCx0aGlzLmhhc2hfc2hpZnQ9MCx0aGlzLmJsb2NrX3N0YXJ0PTAsdGhpcy5tYXRjaF9sZW5ndGg9MCx0aGlzLnByZXZfbWF0Y2g9MCx0aGlzLm1hdGNoX2F2YWlsYWJsZT0wLHRoaXMuc3Ryc3RhcnQ9MCx0aGlzLm1hdGNoX3N0YXJ0PTAsdGhpcy5sb29rYWhlYWQ9MCx0aGlzLnByZXZfbGVuZ3RoPTAsdGhpcy5tYXhfY2hhaW5fbGVuZ3RoPTAsdGhpcy5tYXhfbGF6eV9tYXRjaD0wLHRoaXMubGV2ZWw9MCx0aGlzLnN0cmF0ZWd5PTAsdGhpcy5nb29kX21hdGNoPTAsdGhpcy5uaWNlX21hdGNoPTAsdGhpcy5keW5fbHRyZWU9bmV3IFVpbnQxNkFycmF5KDIqJHQpLHRoaXMuZHluX2R0cmVlPW5ldyBVaW50MTZBcnJheSgyKigyKmp0KzEpKSx0aGlzLmJsX3RyZWU9bmV3IFVpbnQxNkFycmF5KDIqKDIqUHQrMSkpLHVlKHRoaXMuZHluX2x0cmVlKSx1ZSh0aGlzLmR5bl9kdHJlZSksdWUodGhpcy5ibF90cmVlKSx0aGlzLmxfZGVzYz1udWxsLHRoaXMuZF9kZXNjPW51bGwsdGhpcy5ibF9kZXNjPW51bGwsdGhpcy5ibF9jb3VudD1uZXcgVWludDE2QXJyYXkoS3QrMSksdGhpcy5oZWFwPW5ldyBVaW50MTZBcnJheSgyKkl0KzEpLHVlKHRoaXMuaGVhcCksdGhpcy5oZWFwX2xlbj0wLHRoaXMuaGVhcF9tYXg9MCx0aGlzLmRlcHRoPW5ldyBVaW50MTZBcnJheSgyKkl0KzEpLHVlKHRoaXMuZGVwdGgpLHRoaXMuc3ltX2J1Zj0wLHRoaXMubGl0X2J1ZnNpemU9MCx0aGlzLnN5bV9uZXh0PTAsdGhpcy5zeW1fZW5kPTAsdGhpcy5vcHRfbGVuPTAsdGhpcy5zdGF0aWNfbGVuPTAsdGhpcy5tYXRjaGVzPTAsdGhpcy5pbnNlcnQ9MCx0aGlzLmJpX2J1Zj0wLHRoaXMuYmlfdmFsaWQ9MH1jb25zdCBMZT10PT57aWYoIXQpcmV0dXJuIDE7Y29uc3QgZT10LnN0YXRlO3JldHVybiFlfHxlLnN0cm0hPT10fHxlLnN0YXR1cyE9PXF0JiZlLnN0YXR1cyE9PVZ0JiZlLnN0YXR1cyE9PVF0JiZlLnN0YXR1cyE9PUp0JiZlLnN0YXR1cyE9PXRlJiZlLnN0YXR1cyE9PWVlJiZlLnN0YXR1cyE9PXJlJiZlLnN0YXR1cyE9PW5lPzE6MH0sUmU9dD0+e2lmKExlKHQpKXJldHVybiBoZSh0LFN0KTt0LnRvdGFsX2luPXQudG90YWxfb3V0PTAsdC5kYXRhX3R5cGU9RnQ7Y29uc3QgZT10LnN0YXRlO3JldHVybiBlLnBlbmRpbmc9MCxlLnBlbmRpbmdfb3V0PTAsZS53cmFwPDAmJihlLndyYXA9LWUud3JhcCksZS5zdGF0dXM9Mj09PWUud3JhcD9WdDplLndyYXA/cXQ6cmUsdC5hZGxlcj0yPT09ZS53cmFwPzA6MSxlLmxhc3RfZmx1c2g9LTIscHQoZSksQXR9LERlPXQ9Pntjb25zdCBlPVJlKHQpO3JldHVybiBlPT09QXQmJkJlKHQuc3RhdGUpLGV9LFVlPSh0LGUscixuLGksYSk9PntpZighdClyZXR1cm4gU3Q7bGV0IHM9MTtpZihlPT09THQmJihlPTYpLG48MD8ocz0wLG49LW4pOm4+MTUmJihzPTIsbi09MTYpLGk8MXx8aT5adHx8ciE9PUh0fHxuPDh8fG4+MTV8fGU8MHx8ZT45fHxhPDB8fGE+Q3R8fDg9PT1uJiYxIT09cylyZXR1cm4gaGUodCxTdCk7OD09PW4mJihuPTkpO2NvbnN0IG89bmV3IE9lO3JldHVybiB0LnN0YXRlPW8sby5zdHJtPXQsby5zdGF0dXM9cXQsby53cmFwPXMsby5nemhlYWQ9bnVsbCxvLndfYml0cz1uLG8ud19zaXplPTE8PG8ud19iaXRzLG8ud19tYXNrPW8ud19zaXplLTEsby5oYXNoX2JpdHM9aSs3LG8uaGFzaF9zaXplPTE8PG8uaGFzaF9iaXRzLG8uaGFzaF9tYXNrPW8uaGFzaF9zaXplLTEsby5oYXNoX3NoaWZ0PX5+KChvLmhhc2hfYml0cytYdC0xKS9YdCksby53aW5kb3c9bmV3IFVpbnQ4QXJyYXkoMipvLndfc2l6ZSksby5oZWFkPW5ldyBVaW50MTZBcnJheShvLmhhc2hfc2l6ZSksby5wcmV2PW5ldyBVaW50MTZBcnJheShvLndfc2l6ZSksby5saXRfYnVmc2l6ZT0xPDxpKzYsby5wZW5kaW5nX2J1Zl9zaXplPTQqby5saXRfYnVmc2l6ZSxvLnBlbmRpbmdfYnVmPW5ldyBVaW50OEFycmF5KG8ucGVuZGluZ19idWZfc2l6ZSksby5zeW1fYnVmPW8ubGl0X2J1ZnNpemUsby5zeW1fZW5kPTMqKG8ubGl0X2J1ZnNpemUtMSksby5sZXZlbD1lLG8uc3RyYXRlZ3k9YSxvLm1ldGhvZD1yLERlKHQpfTt2YXIgQ2U9e2RlZmxhdGVJbml0Oih0LGUpPT5VZSh0LGUsSHQsTXQsTnQsVHQpLGRlZmxhdGVJbml0MjpVZSxkZWZsYXRlUmVzZXQ6RGUsZGVmbGF0ZVJlc2V0S2VlcDpSZSxkZWZsYXRlU2V0SGVhZGVyOih0LGUpPT5MZSh0KXx8MiE9PXQuc3RhdGUud3JhcD9TdDoodC5zdGF0ZS5nemhlYWQ9ZSxBdCksZGVmbGF0ZToodCxlKT0+e2lmKExlKHQpfHxlPnp0fHxlPDApcmV0dXJuIHQ/aGUodCxTdCk6U3Q7Y29uc3Qgcj10LnN0YXRlO2lmKCF0Lm91dHB1dHx8MCE9PXQuYXZhaWxfaW4mJiF0LmlucHV0fHxyLnN0YXR1cz09PW5lJiZlIT09a3QpcmV0dXJuIGhlKHQsMD09PXQuYXZhaWxfb3V0P090OlN0KTtjb25zdCBuPXIubGFzdF9mbHVzaDtpZihyLmxhc3RfZmx1c2g9ZSwwIT09ci5wZW5kaW5nKXtpZihmZSh0KSwwPT09dC5hdmFpbF9vdXQpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdH1lbHNlIGlmKDA9PT10LmF2YWlsX2luJiZjZShlKTw9Y2UobikmJmUhPT1rdClyZXR1cm4gaGUodCxPdCk7aWYoci5zdGF0dXM9PT1uZSYmMCE9PXQuYXZhaWxfaW4pcmV0dXJuIGhlKHQsT3QpO2lmKHIuc3RhdHVzPT09cXQmJjA9PT1yLndyYXAmJihyLnN0YXR1cz1yZSksci5zdGF0dXM9PT1xdCl7bGV0IGU9SHQrKHIud19iaXRzLTg8PDQpPDw4LG49LTE7aWYobj1yLnN0cmF0ZWd5Pj1EdHx8ci5sZXZlbDwyPzA6ci5sZXZlbDw2PzE6Nj09PXIubGV2ZWw/MjozLGV8PW48PDYsMCE9PXIuc3Ryc3RhcnQmJihlfD1ZdCksZSs9MzEtZSUzMSx5ZShyLGUpLDAhPT1yLnN0cnN0YXJ0JiYoeWUocix0LmFkbGVyPj4+MTYpLHllKHIsNjU1MzUmdC5hZGxlcikpLHQuYWRsZXI9MSxyLnN0YXR1cz1yZSxmZSh0KSwwIT09ci5wZW5kaW5nKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXR9aWYoci5zdGF0dXM9PT1WdClpZih0LmFkbGVyPTAsZ2UociwzMSksZ2UociwxMzkpLGdlKHIsOCksci5nemhlYWQpZ2Uociwoci5nemhlYWQudGV4dD8xOjApKyhyLmd6aGVhZC5oY3JjPzI6MCkrKHIuZ3poZWFkLmV4dHJhPzQ6MCkrKHIuZ3poZWFkLm5hbWU/ODowKSsoci5nemhlYWQuY29tbWVudD8xNjowKSksZ2UociwyNTUmci5nemhlYWQudGltZSksZ2UocixyLmd6aGVhZC50aW1lPj44JjI1NSksZ2UocixyLmd6aGVhZC50aW1lPj4xNiYyNTUpLGdlKHIsci5nemhlYWQudGltZT4+MjQmMjU1KSxnZShyLDk9PT1yLmxldmVsPzI6ci5zdHJhdGVneT49RHR8fHIubGV2ZWw8Mj80OjApLGdlKHIsMjU1JnIuZ3poZWFkLm9zKSxyLmd6aGVhZC5leHRyYSYmci5nemhlYWQuZXh0cmEubGVuZ3RoJiYoZ2UociwyNTUmci5nemhlYWQuZXh0cmEubGVuZ3RoKSxnZShyLHIuZ3poZWFkLmV4dHJhLmxlbmd0aD4+OCYyNTUpKSxyLmd6aGVhZC5oY3JjJiYodC5hZGxlcj1fdCh0LmFkbGVyLHIucGVuZGluZ19idWYsci5wZW5kaW5nLDApKSxyLmd6aW5kZXg9MCxyLnN0YXR1cz1RdDtlbHNlIGlmKGdlKHIsMCksZ2UociwwKSxnZShyLDApLGdlKHIsMCksZ2UociwwKSxnZShyLDk9PT1yLmxldmVsPzI6ci5zdHJhdGVneT49RHR8fHIubGV2ZWw8Mj80OjApLGdlKHIsbGUpLHIuc3RhdHVzPXJlLGZlKHQpLDAhPT1yLnBlbmRpbmcpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdDtpZihyLnN0YXR1cz09PVF0KXtpZihyLmd6aGVhZC5leHRyYSl7bGV0IGU9ci5wZW5kaW5nLG49KDY1NTM1JnIuZ3poZWFkLmV4dHJhLmxlbmd0aCktci5nemluZGV4O2Zvcig7ci5wZW5kaW5nK24+ci5wZW5kaW5nX2J1Zl9zaXplOyl7bGV0IGk9ci5wZW5kaW5nX2J1Zl9zaXplLXIucGVuZGluZztpZihyLnBlbmRpbmdfYnVmLnNldChyLmd6aGVhZC5leHRyYS5zdWJhcnJheShyLmd6aW5kZXgsci5nemluZGV4K2kpLHIucGVuZGluZyksci5wZW5kaW5nPXIucGVuZGluZ19idWZfc2l6ZSxyLmd6aGVhZC5oY3JjJiZyLnBlbmRpbmc+ZSYmKHQuYWRsZXI9X3QodC5hZGxlcixyLnBlbmRpbmdfYnVmLHIucGVuZGluZy1lLGUpKSxyLmd6aW5kZXgrPWksZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0O2U9MCxuLT1pfWxldCBpPW5ldyBVaW50OEFycmF5KHIuZ3poZWFkLmV4dHJhKTtyLnBlbmRpbmdfYnVmLnNldChpLnN1YmFycmF5KHIuZ3ppbmRleCxyLmd6aW5kZXgrbiksci5wZW5kaW5nKSxyLnBlbmRpbmcrPW4sci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPmUmJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctZSxlKSksci5nemluZGV4PTB9ci5zdGF0dXM9SnR9aWYoci5zdGF0dXM9PT1KdCl7aWYoci5nemhlYWQubmFtZSl7bGV0IGUsbj1yLnBlbmRpbmc7ZG97aWYoci5wZW5kaW5nPT09ci5wZW5kaW5nX2J1Zl9zaXplKXtpZihyLmd6aGVhZC5oY3JjJiZyLnBlbmRpbmc+biYmKHQuYWRsZXI9X3QodC5hZGxlcixyLnBlbmRpbmdfYnVmLHIucGVuZGluZy1uLG4pKSxmZSh0KSwwIT09ci5wZW5kaW5nKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXQ7bj0wfWU9ci5nemluZGV4PHIuZ3poZWFkLm5hbWUubGVuZ3RoPzI1NSZyLmd6aGVhZC5uYW1lLmNoYXJDb2RlQXQoci5nemluZGV4KyspOjAsZ2UocixlKX13aGlsZSgwIT09ZSk7ci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPm4mJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctbixuKSksci5nemluZGV4PTB9ci5zdGF0dXM9dGV9aWYoci5zdGF0dXM9PT10ZSl7aWYoci5nemhlYWQuY29tbWVudCl7bGV0IGUsbj1yLnBlbmRpbmc7ZG97aWYoci5wZW5kaW5nPT09ci5wZW5kaW5nX2J1Zl9zaXplKXtpZihyLmd6aGVhZC5oY3JjJiZyLnBlbmRpbmc+biYmKHQuYWRsZXI9X3QodC5hZGxlcixyLnBlbmRpbmdfYnVmLHIucGVuZGluZy1uLG4pKSxmZSh0KSwwIT09ci5wZW5kaW5nKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXQ7bj0wfWU9ci5nemluZGV4PHIuZ3poZWFkLmNvbW1lbnQubGVuZ3RoPzI1NSZyLmd6aGVhZC5jb21tZW50LmNoYXJDb2RlQXQoci5nemluZGV4KyspOjAsZ2UocixlKX13aGlsZSgwIT09ZSk7ci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPm4mJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctbixuKSl9ci5zdGF0dXM9ZWV9aWYoci5zdGF0dXM9PT1lZSl7aWYoci5nemhlYWQuaGNyYyl7aWYoci5wZW5kaW5nKzI+ci5wZW5kaW5nX2J1Zl9zaXplJiYoZmUodCksMCE9PXIucGVuZGluZykpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdDtnZShyLDI1NSZ0LmFkbGVyKSxnZShyLHQuYWRsZXI+PjgmMjU1KSx0LmFkbGVyPTB9aWYoci5zdGF0dXM9cmUsZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0fWlmKDAhPT10LmF2YWlsX2lufHwwIT09ci5sb29rYWhlYWR8fGUhPT1tdCYmci5zdGF0dXMhPT1uZSl7bGV0IG49MD09PXIubGV2ZWw/YmUocixlKTpyLnN0cmF0ZWd5PT09RHQ/QWUocixlKTpyLnN0cmF0ZWd5PT09VXQ/emUocixlKTpTZVtyLmxldmVsXS5mdW5jKHIsZSk7aWYobiE9PXNlJiZuIT09b2V8fChyLnN0YXR1cz1uZSksbj09PWllfHxuPT09c2UpcmV0dXJuIDA9PT10LmF2YWlsX291dCYmKHIubGFzdF9mbHVzaD0tMSksQXQ7aWYobj09PWFlJiYoZT09PWJ0P3Z0KHIpOmUhPT16dCYmKGd0KHIsMCwwLCExKSxlPT09eHQmJih1ZShyLmhlYWQpLDA9PT1yLmxvb2thaGVhZCYmKHIuc3Ryc3RhcnQ9MCxyLmJsb2NrX3N0YXJ0PTAsci5pbnNlcnQ9MCkpKSxmZSh0KSwwPT09dC5hdmFpbF9vdXQpKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXR9cmV0dXJuIGUhPT1rdD9BdDpyLndyYXA8PTA/RXQ6KDI9PT1yLndyYXA/KGdlKHIsMjU1JnQuYWRsZXIpLGdlKHIsdC5hZGxlcj4+OCYyNTUpLGdlKHIsdC5hZGxlcj4+MTYmMjU1KSxnZShyLHQuYWRsZXI+PjI0JjI1NSksZ2UociwyNTUmdC50b3RhbF9pbiksZ2Uocix0LnRvdGFsX2luPj44JjI1NSksZ2Uocix0LnRvdGFsX2luPj4xNiYyNTUpLGdlKHIsdC50b3RhbF9pbj4+MjQmMjU1KSk6KHllKHIsdC5hZGxlcj4+PjE2KSx5ZShyLDY1NTM1JnQuYWRsZXIpKSxmZSh0KSxyLndyYXA+MCYmKHIud3JhcD0tci53cmFwKSwwIT09ci5wZW5kaW5nP0F0OkV0KX0sZGVmbGF0ZUVuZDp0PT57aWYoTGUodCkpcmV0dXJuIFN0O2NvbnN0IGU9dC5zdGF0ZS5zdGF0dXM7cmV0dXJuIHQuc3RhdGU9bnVsbCxlPT09cmU/aGUodCxCdCk6QXR9LGRlZmxhdGVTZXREaWN0aW9uYXJ5Oih0LGUpPT57bGV0IHI9ZS5sZW5ndGg7aWYoTGUodCkpcmV0dXJuIFN0O2NvbnN0IG49dC5zdGF0ZSxpPW4ud3JhcDtpZigyPT09aXx8MT09PWkmJm4uc3RhdHVzIT09cXR8fG4ubG9va2FoZWFkKXJldHVybiBTdDtpZigxPT09aSYmKHQuYWRsZXI9Y3QodC5hZGxlcixlLHIsMCkpLG4ud3JhcD0wLHI+PW4ud19zaXplKXswPT09aSYmKHVlKG4uaGVhZCksbi5zdHJzdGFydD0wLG4uYmxvY2tfc3RhcnQ9MCxuLmluc2VydD0wKTtsZXQgdD1uZXcgVWludDhBcnJheShuLndfc2l6ZSk7dC5zZXQoZS5zdWJhcnJheShyLW4ud19zaXplLHIpLDApLGU9dCxyPW4ud19zaXplfWNvbnN0IGE9dC5hdmFpbF9pbixzPXQubmV4dF9pbixvPXQuaW5wdXQ7Zm9yKHQuYXZhaWxfaW49cix0Lm5leHRfaW49MCx0LmlucHV0PWUsbWUobik7bi5sb29rYWhlYWQ+PVh0Oyl7bGV0IHQ9bi5zdHJzdGFydCxlPW4ubG9va2FoZWFkLShYdC0xKTtkb3tuLmluc19oPWRlKG4sbi5pbnNfaCxuLndpbmRvd1t0K1h0LTFdKSxuLnByZXZbdCZuLndfbWFza109bi5oZWFkW24uaW5zX2hdLG4uaGVhZFtuLmluc19oXT10LHQrK313aGlsZSgtLWUpO24uc3Ryc3RhcnQ9dCxuLmxvb2thaGVhZD1YdC0xLG1lKG4pfXJldHVybiBuLnN0cnN0YXJ0Kz1uLmxvb2thaGVhZCxuLmJsb2NrX3N0YXJ0PW4uc3Ryc3RhcnQsbi5pbnNlcnQ9bi5sb29rYWhlYWQsbi5sb29rYWhlYWQ9MCxuLm1hdGNoX2xlbmd0aD1uLnByZXZfbGVuZ3RoPVh0LTEsbi5tYXRjaF9hdmFpbGFibGU9MCx0Lm5leHRfaW49cyx0LmlucHV0PW8sdC5hdmFpbF9pbj1hLG4ud3JhcD1pLEF0fSxkZWZsYXRlSW5mbzoicGFrbyBkZWZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSJ9O2NvbnN0IFRlPSh0LGUpPT5PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCxlKTt2YXIgRmU9ZnVuY3Rpb24odCl7Y29uc3QgZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7Zm9yKDtlLmxlbmd0aDspe2NvbnN0IHI9ZS5zaGlmdCgpO2lmKHIpe2lmKCJvYmplY3QiIT10eXBlb2Ygcil0aHJvdyBuZXcgVHlwZUVycm9yKHIrIm11c3QgYmUgbm9uLW9iamVjdCIpO2Zvcihjb25zdCBlIGluIHIpVGUocixlKSYmKHRbZV09cltlXSl9fXJldHVybiB0fSxIZT17YXNzaWduOkZlLGZsYXR0ZW5DaHVua3M6dD0+e2xldCBlPTA7Zm9yKGxldCByPTAsbj10Lmxlbmd0aDtyPG47cisrKWUrPXRbcl0ubGVuZ3RoO2NvbnN0IHI9bmV3IFVpbnQ4QXJyYXkoZSk7Zm9yKGxldCBlPTAsbj0wLGk9dC5sZW5ndGg7ZTxpO2UrKyl7bGV0IGk9dFtlXTtyLnNldChpLG4pLG4rPWkubGVuZ3RofXJldHVybiByfX07bGV0IFplPSEwO3RyeXtTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsbmV3IFVpbnQ4QXJyYXkoMSkpfWNhdGNoKHQpe1plPSExfWNvbnN0IE1lPW5ldyBVaW50OEFycmF5KDI1Nik7Zm9yKGxldCB0PTA7dDwyNTY7dCsrKU1lW3RdPXQ+PTI1Mj82OnQ+PTI0OD81OnQ+PTI0MD80OnQ+PTIyND8zOnQ+PTE5Mj8yOjE7TWVbMjU0XT1NZVsyNTRdPTE7Y29uc3QgTmU9KHQsZSk9PntpZihlPDY1NTM0JiZ0LnN1YmFycmF5JiZaZSlyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLHQubGVuZ3RoPT09ZT90OnQuc3ViYXJyYXkoMCxlKSk7bGV0IHI9IiI7Zm9yKGxldCBuPTA7bjxlO24rKylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHRbbl0pO3JldHVybiByfTt2YXIgSWU9e3N0cmluZzJidWY6dD0+e2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBUZXh0RW5jb2RlciYmVGV4dEVuY29kZXIucHJvdG90eXBlLmVuY29kZSlyZXR1cm4obmV3IFRleHRFbmNvZGVyKS5lbmNvZGUodCk7bGV0IGUscixuLGksYSxzPXQubGVuZ3RoLG89MDtmb3IoaT0wO2k8cztpKyspcj10LmNoYXJDb2RlQXQoaSksNTUyOTY9PSg2NDUxMiZyKSYmaSsxPHMmJihuPXQuY2hhckNvZGVBdChpKzEpLDU2MzIwPT0oNjQ1MTImbikmJihyPTY1NTM2KyhyLTU1Mjk2PDwxMCkrKG4tNTYzMjApLGkrKykpLG8rPXI8MTI4PzE6cjwyMDQ4PzI6cjw2NTUzNj8zOjQ7Zm9yKGU9bmV3IFVpbnQ4QXJyYXkobyksYT0wLGk9MDthPG87aSsrKXI9dC5jaGFyQ29kZUF0KGkpLDU1Mjk2PT0oNjQ1MTImcikmJmkrMTxzJiYobj10LmNoYXJDb2RlQXQoaSsxKSw1NjMyMD09KDY0NTEyJm4pJiYocj02NTUzNisoci01NTI5Njw8MTApKyhuLTU2MzIwKSxpKyspKSxyPDEyOD9lW2ErK109cjpyPDIwNDg/KGVbYSsrXT0xOTJ8cj4+PjYsZVthKytdPTEyOHw2MyZyKTpyPDY1NTM2PyhlW2ErK109MjI0fHI+Pj4xMixlW2ErK109MTI4fHI+Pj42JjYzLGVbYSsrXT0xMjh8NjMmcik6KGVbYSsrXT0yNDB8cj4+PjE4LGVbYSsrXT0xMjh8cj4+PjEyJjYzLGVbYSsrXT0xMjh8cj4+PjYmNjMsZVthKytdPTEyOHw2MyZyKTtyZXR1cm4gZX0sYnVmMnN0cmluZzoodCxlKT0+e2NvbnN0IHI9ZXx8dC5sZW5ndGg7aWYoImZ1bmN0aW9uIj09dHlwZW9mIFRleHREZWNvZGVyJiZUZXh0RGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlKXJldHVybihuZXcgVGV4dERlY29kZXIpLmRlY29kZSh0LnN1YmFycmF5KDAsZSkpO2xldCBuLGk7Y29uc3QgYT1uZXcgQXJyYXkoMipyKTtmb3IoaT0wLG49MDtuPHI7KXtsZXQgZT10W24rK107aWYoZTwxMjgpe2FbaSsrXT1lO2NvbnRpbnVlfWxldCBzPU1lW2VdO2lmKHM+NClhW2krK109NjU1MzMsbis9cy0xO2Vsc2V7Zm9yKGUmPTI9PT1zPzMxOjM9PT1zPzE1Ojc7cz4xJiZuPHI7KWU9ZTw8Nnw2MyZ0W24rK10scy0tO3M+MT9hW2krK109NjU1MzM6ZTw2NTUzNj9hW2krK109ZTooZS09NjU1MzYsYVtpKytdPTU1Mjk2fGU+PjEwJjEwMjMsYVtpKytdPTU2MzIwfDEwMjMmZSl9fXJldHVybiBOZShhLGkpfSx1dGY4Ym9yZGVyOih0LGUpPT57KGU9ZXx8dC5sZW5ndGgpPnQubGVuZ3RoJiYoZT10Lmxlbmd0aCk7bGV0IHI9ZS0xO2Zvcig7cj49MCYmMTI4PT0oMTkyJnRbcl0pOylyLS07cmV0dXJuIHI8MHx8MD09PXI/ZTpyK01lW3Rbcl1dPmU/cjplfX07ZnVuY3Rpb24gamUoKXt0aGlzLmlucHV0PW51bGwsdGhpcy5uZXh0X2luPTAsdGhpcy5hdmFpbF9pbj0wLHRoaXMudG90YWxfaW49MCx0aGlzLm91dHB1dD1udWxsLHRoaXMubmV4dF9vdXQ9MCx0aGlzLmF2YWlsX291dD0wLHRoaXMudG90YWxfb3V0PTAsdGhpcy5tc2c9IiIsdGhpcy5zdGF0ZT1udWxsLHRoaXMuZGF0YV90eXBlPTIsdGhpcy5hZGxlcj0wfXZhciBQZT1qZTtjb25zdCAkZT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLHtaX05PX0ZMVVNIOktlLFpfU1lOQ19GTFVTSDpYZSxaX0ZVTExfRkxVU0g6R2UsWl9GSU5JU0g6V2UsWl9PSzpZZSxaX1NUUkVBTV9FTkQ6cWUsWl9ERUZBVUxUX0NPTVBSRVNTSU9OOlZlLFpfREVGQVVMVF9TVFJBVEVHWTpRZSxaX0RFRkxBVEVEOkplfT1mdDtmdW5jdGlvbiB0cih0KXt0aGlzLm9wdGlvbnM9SGUuYXNzaWduKHtsZXZlbDpWZSxtZXRob2Q6SmUsY2h1bmtTaXplOjE2Mzg0LHdpbmRvd0JpdHM6MTUsbWVtTGV2ZWw6OCxzdHJhdGVneTpRZX0sdHx8e30pO2xldCBlPXRoaXMub3B0aW9ucztlLnJhdyYmZS53aW5kb3dCaXRzPjA/ZS53aW5kb3dCaXRzPS1lLndpbmRvd0JpdHM6ZS5nemlwJiZlLndpbmRvd0JpdHM+MCYmZS53aW5kb3dCaXRzPDE2JiYoZS53aW5kb3dCaXRzKz0xNiksdGhpcy5lcnI9MCx0aGlzLm1zZz0iIix0aGlzLmVuZGVkPSExLHRoaXMuY2h1bmtzPVtdLHRoaXMuc3RybT1uZXcgUGUsdGhpcy5zdHJtLmF2YWlsX291dD0wO2xldCByPUNlLmRlZmxhdGVJbml0Mih0aGlzLnN0cm0sZS5sZXZlbCxlLm1ldGhvZCxlLndpbmRvd0JpdHMsZS5tZW1MZXZlbCxlLnN0cmF0ZWd5KTtpZihyIT09WWUpdGhyb3cgbmV3IEVycm9yKGR0W3JdKTtpZihlLmhlYWRlciYmQ2UuZGVmbGF0ZVNldEhlYWRlcih0aGlzLnN0cm0sZS5oZWFkZXIpLGUuZGljdGlvbmFyeSl7bGV0IHQ7aWYodD0ic3RyaW5nIj09dHlwZW9mIGUuZGljdGlvbmFyeT9JZS5zdHJpbmcyYnVmKGUuZGljdGlvbmFyeSk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PSRlLmNhbGwoZS5kaWN0aW9uYXJ5KT9uZXcgVWludDhBcnJheShlLmRpY3Rpb25hcnkpOmUuZGljdGlvbmFyeSxyPUNlLmRlZmxhdGVTZXREaWN0aW9uYXJ5KHRoaXMuc3RybSx0KSxyIT09WWUpdGhyb3cgbmV3IEVycm9yKGR0W3JdKTt0aGlzLl9kaWN0X3NldD0hMH19ZnVuY3Rpb24gZXIodCxlKXtjb25zdCByPW5ldyB0cihlKTtpZihyLnB1c2godCwhMCksci5lcnIpdGhyb3cgci5tc2d8fGR0W3IuZXJyXTtyZXR1cm4gci5yZXN1bHR9ZnVuY3Rpb24gcnIodCxlKXtyZXR1cm4oZT1lfHx7fSkucmF3PSEwLGVyKHQsZSl9ZnVuY3Rpb24gbnIodCxlKXtyZXR1cm4oZT1lfHx7fSkuZ3ppcD0hMCxlcih0LGUpfXRyLnByb3RvdHlwZS5wdXNoPWZ1bmN0aW9uKHQsZSl7Y29uc3Qgcj10aGlzLnN0cm0sbj10aGlzLm9wdGlvbnMuY2h1bmtTaXplO2xldCBpLGE7aWYodGhpcy5lbmRlZClyZXR1cm4hMTtmb3IoYT1lPT09fn5lP2U6ITA9PT1lP1dlOktlLCJzdHJpbmciPT10eXBlb2YgdD9yLmlucHV0PUllLnN0cmluZzJidWYodCk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PSRlLmNhbGwodCk/ci5pbnB1dD1uZXcgVWludDhBcnJheSh0KTpyLmlucHV0PXQsci5uZXh0X2luPTAsci5hdmFpbF9pbj1yLmlucHV0Lmxlbmd0aDs7KWlmKDA9PT1yLmF2YWlsX291dCYmKHIub3V0cHV0PW5ldyBVaW50OEFycmF5KG4pLHIubmV4dF9vdXQ9MCxyLmF2YWlsX291dD1uKSwoYT09PVhlfHxhPT09R2UpJiZyLmF2YWlsX291dDw9Nil0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxyLmF2YWlsX291dD0wO2Vsc2V7aWYoaT1DZS5kZWZsYXRlKHIsYSksaT09PXFlKXJldHVybiByLm5leHRfb3V0PjAmJnRoaXMub25EYXRhKHIub3V0cHV0LnN1YmFycmF5KDAsci5uZXh0X291dCkpLGk9Q2UuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pLHRoaXMub25FbmQoaSksdGhpcy5lbmRlZD0hMCxpPT09WWU7aWYoMCE9PXIuYXZhaWxfb3V0KXtpZihhPjAmJnIubmV4dF9vdXQ+MCl0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxyLmF2YWlsX291dD0wO2Vsc2UgaWYoMD09PXIuYXZhaWxfaW4pYnJlYWt9ZWxzZSB0aGlzLm9uRGF0YShyLm91dHB1dCl9cmV0dXJuITB9LHRyLnByb3RvdHlwZS5vbkRhdGE9ZnVuY3Rpb24odCl7dGhpcy5jaHVua3MucHVzaCh0KX0sdHIucHJvdG90eXBlLm9uRW5kPWZ1bmN0aW9uKHQpe3Q9PT1ZZSYmKHRoaXMucmVzdWx0PUhlLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpKSx0aGlzLmNodW5rcz1bXSx0aGlzLmVycj10LHRoaXMubXNnPXRoaXMuc3RybS5tc2d9O3ZhciBpcj10cixhcj1lcixzcj1ycixvcj1ucixscj1mdCxocj17RGVmbGF0ZTppcixkZWZsYXRlOmFyLGRlZmxhdGVSYXc6c3IsZ3ppcDpvcixjb25zdGFudHM6bHJ9O3QuRGVmbGF0ZT1pcix0LmNvbnN0YW50cz1scix0LmRlZmF1bHQ9aHIsdC5kZWZsYXRlPWFyLHQuZGVmbGF0ZVJhdz1zcix0Lmd6aXA9b3IsT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pfShzLmV4cG9ydHMpKSxzLmV4cG9ydHMpLGw9e2V4cG9ydHM6e319O3ZhciBoLGM9e2V4cG9ydHM6e319LHU9cihPYmplY3QuZnJlZXplKHtfX3Byb3RvX186bnVsbCxkZWZhdWx0Ont9fSkpO2Z1bmN0aW9uIF8oKXtyZXR1cm4gaHx8KGg9MSxjLmV4cG9ydHM9KGU9ZXx8ZnVuY3Rpb24oZSxyKXt2YXIgbjtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmd2luZG93LmNyeXB0byYmKG49d2luZG93LmNyeXB0byksInVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmJiZzZWxmLmNyeXB0byYmKG49c2VsZi5jcnlwdG8pLCJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcyYmZ2xvYmFsVGhpcy5jcnlwdG8mJihuPWdsb2JhbFRoaXMuY3J5cHRvKSwhbiYmInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJndpbmRvdy5tc0NyeXB0byYmKG49d2luZG93Lm1zQ3J5cHRvKSwhbiYmdm9pZCAwIT09dCYmdC5jcnlwdG8mJihuPXQuY3J5cHRvKSwhbil0cnl7bj11fWNhdGNoKHQpe312YXIgaT1mdW5jdGlvbigpe2lmKG4pe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBuLmdldFJhbmRvbVZhbHVlcyl0cnl7cmV0dXJuIG4uZ2V0UmFuZG9tVmFsdWVzKG5ldyBVaW50MzJBcnJheSgxKSlbMF19Y2F0Y2godCl7fWlmKCJmdW5jdGlvbiI9PXR5cGVvZiBuLnJhbmRvbUJ5dGVzKXRyeXtyZXR1cm4gbi5yYW5kb21CeXRlcyg0KS5yZWFkSW50MzJMRSgpfWNhdGNoKHQpe319dGhyb3cgbmV3IEVycm9yKCJOYXRpdmUgY3J5cHRvIG1vZHVsZSBjb3VsZCBub3QgYmUgdXNlZCB0byBnZXQgc2VjdXJlIHJhbmRvbSBudW1iZXIuIil9LGE9T2JqZWN0LmNyZWF0ZXx8ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7fXJldHVybiBmdW5jdGlvbihlKXt2YXIgcjtyZXR1cm4gdC5wcm90b3R5cGU9ZSxyPW5ldyB0LHQucHJvdG90eXBlPW51bGwscn19KCkscz17fSxvPXMubGliPXt9LGw9by5CYXNlPXtleHRlbmQ6ZnVuY3Rpb24odCl7dmFyIGU9YSh0aGlzKTtyZXR1cm4gdCYmZS5taXhJbih0KSxlLmhhc093blByb3BlcnR5KCJpbml0IikmJnRoaXMuaW5pdCE9PWUuaW5pdHx8KGUuaW5pdD1mdW5jdGlvbigpe2UuJHN1cGVyLmluaXQuYXBwbHkodGhpcyxhcmd1bWVudHMpfSksZS5pbml0LnByb3RvdHlwZT1lLGUuJHN1cGVyPXRoaXMsZX0sY3JlYXRlOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5leHRlbmQoKTtyZXR1cm4gdC5pbml0LmFwcGx5KHQsYXJndW1lbnRzKSx0fSxpbml0OmZ1bmN0aW9uKCl7fSxtaXhJbjpmdW5jdGlvbih0KXtmb3IodmFyIGUgaW4gdCl0Lmhhc093blByb3BlcnR5KGUpJiYodGhpc1tlXT10W2VdKTt0Lmhhc093blByb3BlcnR5KCJ0b1N0cmluZyIpJiYodGhpcy50b1N0cmluZz10LnRvU3RyaW5nKX0sY2xvbmU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pbml0LnByb3RvdHlwZS5leHRlbmQodGhpcyl9fSxoPW8uV29yZEFycmF5PWwuZXh0ZW5kKHtpbml0OmZ1bmN0aW9uKHQsZSl7dD10aGlzLndvcmRzPXR8fFtdLHRoaXMuc2lnQnl0ZXM9ZSE9cj9lOjQqdC5sZW5ndGh9LHRvU3RyaW5nOmZ1bmN0aW9uKHQpe3JldHVybih0fHxfKS5zdHJpbmdpZnkodGhpcyl9LGNvbmNhdDpmdW5jdGlvbih0KXt2YXIgZT10aGlzLndvcmRzLHI9dC53b3JkcyxuPXRoaXMuc2lnQnl0ZXMsaT10LnNpZ0J5dGVzO2lmKHRoaXMuY2xhbXAoKSxuJTQpZm9yKHZhciBhPTA7YTxpO2ErKyl7dmFyIHM9clthPj4+Ml0+Pj4yNC1hJTQqOCYyNTU7ZVtuK2E+Pj4yXXw9czw8MjQtKG4rYSklNCo4fWVsc2UgZm9yKHZhciBvPTA7bzxpO28rPTQpZVtuK28+Pj4yXT1yW28+Pj4yXTtyZXR1cm4gdGhpcy5zaWdCeXRlcys9aSx0aGlzfSxjbGFtcDpmdW5jdGlvbigpe3ZhciB0PXRoaXMud29yZHMscj10aGlzLnNpZ0J5dGVzO3Rbcj4+PjJdJj00Mjk0OTY3Mjk1PDwzMi1yJTQqOCx0Lmxlbmd0aD1lLmNlaWwoci80KX0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1sLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQud29yZHM9dGhpcy53b3Jkcy5zbGljZSgwKSx0fSxyYW5kb206ZnVuY3Rpb24odCl7Zm9yKHZhciBlPVtdLHI9MDtyPHQ7cis9NCllLnB1c2goaSgpKTtyZXR1cm4gbmV3IGguaW5pdChlLHQpfX0pLGM9cy5lbmM9e30sXz1jLkhleD17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10LndvcmRzLHI9dC5zaWdCeXRlcyxuPVtdLGk9MDtpPHI7aSsrKXt2YXIgYT1lW2k+Pj4yXT4+PjI0LWklNCo4JjI1NTtuLnB1c2goKGE+Pj40KS50b1N0cmluZygxNikpLG4ucHVzaCgoMTUmYSkudG9TdHJpbmcoMTYpKX1yZXR1cm4gbi5qb2luKCIiKX0scGFyc2U6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQubGVuZ3RoLHI9W10sbj0wO248ZTtuKz0yKXJbbj4+PjNdfD1wYXJzZUludCh0LnN1YnN0cihuLDIpLDE2KTw8MjQtbiU4KjQ7cmV0dXJuIG5ldyBoLmluaXQocixlLzIpfX0sZD1jLkxhdGluMT17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10LndvcmRzLHI9dC5zaWdCeXRlcyxuPVtdLGk9MDtpPHI7aSsrKXt2YXIgYT1lW2k+Pj4yXT4+PjI0LWklNCo4JjI1NTtuLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShhKSl9cmV0dXJuIG4uam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10Lmxlbmd0aCxyPVtdLG49MDtuPGU7bisrKXJbbj4+PjJdfD0oMjU1JnQuY2hhckNvZGVBdChuKSk8PDI0LW4lNCo4O3JldHVybiBuZXcgaC5pbml0KHIsZSl9fSxmPWMuVXRmOD17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe3RyeXtyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZShkLnN0cmluZ2lmeSh0KSkpfWNhdGNoKHQpe3Rocm93IG5ldyBFcnJvcigiTWFsZm9ybWVkIFVURi04IGRhdGEiKX19LHBhcnNlOmZ1bmN0aW9uKHQpe3JldHVybiBkLnBhcnNlKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudCh0KSkpfX0scD1vLkJ1ZmZlcmVkQmxvY2tBbGdvcml0aG09bC5leHRlbmQoe3Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5fZGF0YT1uZXcgaC5pbml0LHRoaXMuX25EYXRhQnl0ZXM9MH0sX2FwcGVuZDpmdW5jdGlvbih0KXsic3RyaW5nIj09dHlwZW9mIHQmJih0PWYucGFyc2UodCkpLHRoaXMuX2RhdGEuY29uY2F0KHQpLHRoaXMuX25EYXRhQnl0ZXMrPXQuc2lnQnl0ZXN9LF9wcm9jZXNzOmZ1bmN0aW9uKHQpe3ZhciByLG49dGhpcy5fZGF0YSxpPW4ud29yZHMsYT1uLnNpZ0J5dGVzLHM9dGhpcy5ibG9ja1NpemUsbz1hLyg0KnMpLGw9KG89dD9lLmNlaWwobyk6ZS5tYXgoKDB8byktdGhpcy5fbWluQnVmZmVyU2l6ZSwwKSkqcyxjPWUubWluKDQqbCxhKTtpZihsKXtmb3IodmFyIHU9MDt1PGw7dSs9cyl0aGlzLl9kb1Byb2Nlc3NCbG9jayhpLHUpO3I9aS5zcGxpY2UoMCxsKSxuLnNpZ0J5dGVzLT1jfXJldHVybiBuZXcgaC5pbml0KHIsYyl9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9bC5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0Ll9kYXRhPXRoaXMuX2RhdGEuY2xvbmUoKSx0fSxfbWluQnVmZmVyU2l6ZTowfSk7by5IYXNoZXI9cC5leHRlbmQoe2NmZzpsLmV4dGVuZCgpLGluaXQ6ZnVuY3Rpb24odCl7dGhpcy5jZmc9dGhpcy5jZmcuZXh0ZW5kKHQpLHRoaXMucmVzZXQoKX0scmVzZXQ6ZnVuY3Rpb24oKXtwLnJlc2V0LmNhbGwodGhpcyksdGhpcy5fZG9SZXNldCgpfSx1cGRhdGU6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2FwcGVuZCh0KSx0aGlzLl9wcm9jZXNzKCksdGhpc30sZmluYWxpemU6ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnRoaXMuX2FwcGVuZCh0KSx0aGlzLl9kb0ZpbmFsaXplKCl9LGJsb2NrU2l6ZToxNixfY3JlYXRlSGVscGVyOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlLHIpe3JldHVybiBuZXcgdC5pbml0KHIpLmZpbmFsaXplKGUpfX0sX2NyZWF0ZUhtYWNIZWxwZXI6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUscil7cmV0dXJuIG5ldyBnLkhNQUMuaW5pdCh0LHIpLmZpbmFsaXplKGUpfX19KTt2YXIgZz1zLmFsZ289e307cmV0dXJuIHN9KE1hdGgpLGUpKSxjLmV4cG9ydHM7dmFyIGV9dmFyIGQ7ZnVuY3Rpb24gZigpe3JldHVybiBkfHwoZD0xLGwuZXhwb3J0cz0odD1fKCksZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIuV29yZEFycmF5O2Z1bmN0aW9uIG4odCxlLG4pe2Zvcih2YXIgaT1bXSxhPTAscz0wO3M8ZTtzKyspaWYocyU0KXt2YXIgbz1uW3QuY2hhckNvZGVBdChzLTEpXTw8cyU0KjJ8blt0LmNoYXJDb2RlQXQocyldPj4+Ni1zJTQqMjtpW2E+Pj4yXXw9bzw8MjQtYSU0KjgsYSsrfXJldHVybiByLmNyZWF0ZShpLGEpfWUuZW5jLkJhc2U2ND17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe3ZhciBlPXQud29yZHMscj10LnNpZ0J5dGVzLG49dGhpcy5fbWFwO3QuY2xhbXAoKTtmb3IodmFyIGk9W10sYT0wO2E8cjthKz0zKWZvcih2YXIgcz0oZVthPj4+Ml0+Pj4yNC1hJTQqOCYyNTUpPDwxNnwoZVthKzE+Pj4yXT4+PjI0LShhKzEpJTQqOCYyNTUpPDw4fGVbYSsyPj4+Ml0+Pj4yNC0oYSsyKSU0KjgmMjU1LG89MDtvPDQmJmErLjc1Km88cjtvKyspaS5wdXNoKG4uY2hhckF0KHM+Pj42KigzLW8pJjYzKSk7dmFyIGw9bi5jaGFyQXQoNjQpO2lmKGwpZm9yKDtpLmxlbmd0aCU0OylpLnB1c2gobCk7cmV0dXJuIGkuam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKHQpe3ZhciBlPXQubGVuZ3RoLHI9dGhpcy5fbWFwLGk9dGhpcy5fcmV2ZXJzZU1hcDtpZighaSl7aT10aGlzLl9yZXZlcnNlTWFwPVtdO2Zvcih2YXIgYT0wO2E8ci5sZW5ndGg7YSsrKWlbci5jaGFyQ29kZUF0KGEpXT1hfXZhciBzPXIuY2hhckF0KDY0KTtpZihzKXt2YXIgbz10LmluZGV4T2Yocyk7LTEhPT1vJiYoZT1vKX1yZXR1cm4gbih0LGUsaSl9LF9tYXA6IkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89In19KCksdC5lbmMuQmFzZTY0KSksbC5leHBvcnRzO3ZhciB0fXZhciBwLGc9ZShmKCkpLHk9e2V4cG9ydHM6e319LHc9e2V4cG9ydHM6e319O2Z1bmN0aW9uIHYoKXtyZXR1cm4gcHx8KHA9MSx3LmV4cG9ydHM9KHQ9XygpLGZ1bmN0aW9uKGUpe3ZhciByPXQsbj1yLmxpYixpPW4uV29yZEFycmF5LGE9bi5IYXNoZXIscz1yLmFsZ28sbz1bXTshZnVuY3Rpb24oKXtmb3IodmFyIHQ9MDt0PDY0O3QrKylvW3RdPTQyOTQ5NjcyOTYqZS5hYnMoZS5zaW4odCsxKSl8MH0oKTt2YXIgbD1zLk1ENT1hLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9oYXNoPW5ldyBpLmluaXQoWzE3MzI1ODQxOTMsNDAyMzIzMzQxNywyNTYyMzgzMTAyLDI3MTczMzg3OF0pfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9MDtyPDE2O3IrKyl7dmFyIG49ZStyLGk9dFtuXTt0W25dPTE2NzExOTM1JihpPDw4fGk+Pj4yNCl8NDI3ODI1NTM2MCYoaTw8MjR8aT4+PjgpfXZhciBhPXRoaXMuX2hhc2gud29yZHMscz10W2UrMF0sbD10W2UrMV0sZD10W2UrMl0sZj10W2UrM10scD10W2UrNF0sZz10W2UrNV0seT10W2UrNl0sdz10W2UrN10sdj10W2UrOF0sbT10W2UrOV0sYj10W2UrMTBdLHg9dFtlKzExXSxrPXRbZSsxMl0sej10W2UrMTNdLEE9dFtlKzE0XSxFPXRbZSsxNV0sUz1hWzBdLEI9YVsxXSxPPWFbMl0sTD1hWzNdO1M9aChTLEIsTyxMLHMsNyxvWzBdKSxMPWgoTCxTLEIsTyxsLDEyLG9bMV0pLE89aChPLEwsUyxCLGQsMTcsb1syXSksQj1oKEIsTyxMLFMsZiwyMixvWzNdKSxTPWgoUyxCLE8sTCxwLDcsb1s0XSksTD1oKEwsUyxCLE8sZywxMixvWzVdKSxPPWgoTyxMLFMsQix5LDE3LG9bNl0pLEI9aChCLE8sTCxTLHcsMjIsb1s3XSksUz1oKFMsQixPLEwsdiw3LG9bOF0pLEw9aChMLFMsQixPLG0sMTIsb1s5XSksTz1oKE8sTCxTLEIsYiwxNyxvWzEwXSksQj1oKEIsTyxMLFMseCwyMixvWzExXSksUz1oKFMsQixPLEwsayw3LG9bMTJdKSxMPWgoTCxTLEIsTyx6LDEyLG9bMTNdKSxPPWgoTyxMLFMsQixBLDE3LG9bMTRdKSxTPWMoUyxCPWgoQixPLEwsUyxFLDIyLG9bMTVdKSxPLEwsbCw1LG9bMTZdKSxMPWMoTCxTLEIsTyx5LDksb1sxN10pLE89YyhPLEwsUyxCLHgsMTQsb1sxOF0pLEI9YyhCLE8sTCxTLHMsMjAsb1sxOV0pLFM9YyhTLEIsTyxMLGcsNSxvWzIwXSksTD1jKEwsUyxCLE8sYiw5LG9bMjFdKSxPPWMoTyxMLFMsQixFLDE0LG9bMjJdKSxCPWMoQixPLEwsUyxwLDIwLG9bMjNdKSxTPWMoUyxCLE8sTCxtLDUsb1syNF0pLEw9YyhMLFMsQixPLEEsOSxvWzI1XSksTz1jKE8sTCxTLEIsZiwxNCxvWzI2XSksQj1jKEIsTyxMLFMsdiwyMCxvWzI3XSksUz1jKFMsQixPLEwseiw1LG9bMjhdKSxMPWMoTCxTLEIsTyxkLDksb1syOV0pLE89YyhPLEwsUyxCLHcsMTQsb1szMF0pLFM9dShTLEI9YyhCLE8sTCxTLGssMjAsb1szMV0pLE8sTCxnLDQsb1szMl0pLEw9dShMLFMsQixPLHYsMTEsb1szM10pLE89dShPLEwsUyxCLHgsMTYsb1szNF0pLEI9dShCLE8sTCxTLEEsMjMsb1szNV0pLFM9dShTLEIsTyxMLGwsNCxvWzM2XSksTD11KEwsUyxCLE8scCwxMSxvWzM3XSksTz11KE8sTCxTLEIsdywxNixvWzM4XSksQj11KEIsTyxMLFMsYiwyMyxvWzM5XSksUz11KFMsQixPLEwseiw0LG9bNDBdKSxMPXUoTCxTLEIsTyxzLDExLG9bNDFdKSxPPXUoTyxMLFMsQixmLDE2LG9bNDJdKSxCPXUoQixPLEwsUyx5LDIzLG9bNDNdKSxTPXUoUyxCLE8sTCxtLDQsb1s0NF0pLEw9dShMLFMsQixPLGssMTEsb1s0NV0pLE89dShPLEwsUyxCLEUsMTYsb1s0Nl0pLFM9XyhTLEI9dShCLE8sTCxTLGQsMjMsb1s0N10pLE8sTCxzLDYsb1s0OF0pLEw9XyhMLFMsQixPLHcsMTAsb1s0OV0pLE89XyhPLEwsUyxCLEEsMTUsb1s1MF0pLEI9XyhCLE8sTCxTLGcsMjEsb1s1MV0pLFM9XyhTLEIsTyxMLGssNixvWzUyXSksTD1fKEwsUyxCLE8sZiwxMCxvWzUzXSksTz1fKE8sTCxTLEIsYiwxNSxvWzU0XSksQj1fKEIsTyxMLFMsbCwyMSxvWzU1XSksUz1fKFMsQixPLEwsdiw2LG9bNTZdKSxMPV8oTCxTLEIsTyxFLDEwLG9bNTddKSxPPV8oTyxMLFMsQix5LDE1LG9bNThdKSxCPV8oQixPLEwsUyx6LDIxLG9bNTldKSxTPV8oUyxCLE8sTCxwLDYsb1s2MF0pLEw9XyhMLFMsQixPLHgsMTAsb1s2MV0pLE89XyhPLEwsUyxCLGQsMTUsb1s2Ml0pLEI9XyhCLE8sTCxTLG0sMjEsb1s2M10pLGFbMF09YVswXStTfDAsYVsxXT1hWzFdK0J8MCxhWzJdPWFbMl0rT3wwLGFbM109YVszXStMfDB9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fZGF0YSxyPXQud29yZHMsbj04KnRoaXMuX25EYXRhQnl0ZXMsaT04KnQuc2lnQnl0ZXM7cltpPj4+NV18PTEyODw8MjQtaSUzMjt2YXIgYT1lLmZsb29yKG4vNDI5NDk2NzI5Nikscz1uO3JbMTUrKGkrNjQ+Pj45PDw0KV09MTY3MTE5MzUmKGE8PDh8YT4+PjI0KXw0Mjc4MjU1MzYwJihhPDwyNHxhPj4+OCksclsxNCsoaSs2ND4+Pjk8PDQpXT0xNjcxMTkzNSYoczw8OHxzPj4+MjQpfDQyNzgyNTUzNjAmKHM8PDI0fHM+Pj44KSx0LnNpZ0J5dGVzPTQqKHIubGVuZ3RoKzEpLHRoaXMuX3Byb2Nlc3MoKTtmb3IodmFyIG89dGhpcy5faGFzaCxsPW8ud29yZHMsaD0wO2g8NDtoKyspe3ZhciBjPWxbaF07bFtoXT0xNjcxMTkzNSYoYzw8OHxjPj4+MjQpfDQyNzgyNTUzNjAmKGM8PDI0fGM+Pj44KX1yZXR1cm4gb30sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1hLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLHR9fSk7ZnVuY3Rpb24gaCh0LGUscixuLGksYSxzKXt2YXIgbz10KyhlJnJ8fmUmbikraStzO3JldHVybihvPDxhfG8+Pj4zMi1hKStlfWZ1bmN0aW9uIGModCxlLHIsbixpLGEscyl7dmFyIG89dCsoZSZufHImfm4pK2krcztyZXR1cm4obzw8YXxvPj4+MzItYSkrZX1mdW5jdGlvbiB1KHQsZSxyLG4saSxhLHMpe3ZhciBvPXQrKGVecl5uKStpK3M7cmV0dXJuKG88PGF8bz4+PjMyLWEpK2V9ZnVuY3Rpb24gXyh0LGUscixuLGksYSxzKXt2YXIgbz10KyhyXihlfH5uKSkraStzO3JldHVybihvPDxhfG8+Pj4zMi1hKStlfXIuTUQ1PWEuX2NyZWF0ZUhlbHBlcihsKSxyLkhtYWNNRDU9YS5fY3JlYXRlSG1hY0hlbHBlcihsKX0oTWF0aCksdC5NRDUpKSx3LmV4cG9ydHM7dmFyIHR9dmFyIG0sYj17ZXhwb3J0czp7fX0seD17ZXhwb3J0czp7fX07ZnVuY3Rpb24gaygpe3JldHVybiBtfHwobT0xLHguZXhwb3J0cz0odD1fKCksZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIsbj1yLldvcmRBcnJheSxpPXIuSGFzaGVyLGE9ZS5hbGdvLHM9W10sbz1hLlNIQTE9aS5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5faGFzaD1uZXcgbi5pbml0KFsxNzMyNTg0MTkzLDQwMjMyMzM0MTcsMjU2MjM4MzEwMiwyNzE3MzM4NzgsMzI4NTM3NzUyMF0pfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9dGhpcy5faGFzaC53b3JkcyxuPXJbMF0saT1yWzFdLGE9clsyXSxvPXJbM10sbD1yWzRdLGg9MDtoPDgwO2grKyl7aWYoaDwxNilzW2hdPTB8dFtlK2hdO2Vsc2V7dmFyIGM9c1toLTNdXnNbaC04XV5zW2gtMTRdXnNbaC0xNl07c1toXT1jPDwxfGM+Pj4zMX12YXIgdT0objw8NXxuPj4+MjcpK2wrc1toXTt1Kz1oPDIwPzE1MTg1MDAyNDkrKGkmYXx+aSZvKTpoPDQwPzE4NTk3NzUzOTMrKGleYV5vKTpoPDYwPyhpJmF8aSZvfGEmbyktMTg5NDAwNzU4ODooaV5hXm8pLTg5OTQ5NzUxNCxsPW8sbz1hLGE9aTw8MzB8aT4+PjIsaT1uLG49dX1yWzBdPXJbMF0rbnwwLHJbMV09clsxXStpfDAsclsyXT1yWzJdK2F8MCxyWzNdPXJbM10rb3wwLHJbNF09cls0XStsfDB9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fZGF0YSxlPXQud29yZHMscj04KnRoaXMuX25EYXRhQnl0ZXMsbj04KnQuc2lnQnl0ZXM7cmV0dXJuIGVbbj4+PjVdfD0xMjg8PDI0LW4lMzIsZVsxNCsobis2ND4+Pjk8PDQpXT1NYXRoLmZsb29yKHIvNDI5NDk2NzI5NiksZVsxNSsobis2ND4+Pjk8PDQpXT1yLHQuc2lnQnl0ZXM9NCplLmxlbmd0aCx0aGlzLl9wcm9jZXNzKCksdGhpcy5faGFzaH0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1pLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLHR9fSk7ZS5TSEExPWkuX2NyZWF0ZUhlbHBlcihvKSxlLkhtYWNTSEExPWkuX2NyZWF0ZUhtYWNIZWxwZXIobyl9KCksdC5TSEExKSkseC5leHBvcnRzO3ZhciB0fXZhciB6LEE9e2V4cG9ydHM6e319O2Z1bmN0aW9uIEUoKXtyZXR1cm4genx8KHo9MSxBLmV4cG9ydHM9KHQ9XygpLHI9KGU9dCkubGliLkJhc2Usbj1lLmVuYy5VdGY4LHZvaWQoZS5hbGdvLkhNQUM9ci5leHRlbmQoe2luaXQ6ZnVuY3Rpb24odCxlKXt0PXRoaXMuX2hhc2hlcj1uZXcgdC5pbml0LCJzdHJpbmciPT10eXBlb2YgZSYmKGU9bi5wYXJzZShlKSk7dmFyIHI9dC5ibG9ja1NpemUsaT00KnI7ZS5zaWdCeXRlcz5pJiYoZT10LmZpbmFsaXplKGUpKSxlLmNsYW1wKCk7Zm9yKHZhciBhPXRoaXMuX29LZXk9ZS5jbG9uZSgpLHM9dGhpcy5faUtleT1lLmNsb25lKCksbz1hLndvcmRzLGw9cy53b3JkcyxoPTA7aDxyO2grKylvW2hdXj0xNTQ5NTU2ODI4LGxbaF1ePTkwOTUyMjQ4NjthLnNpZ0J5dGVzPXMuc2lnQnl0ZXM9aSx0aGlzLnJlc2V0KCl9LHJlc2V0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5faGFzaGVyO3QucmVzZXQoKSx0LnVwZGF0ZSh0aGlzLl9pS2V5KX0sdXBkYXRlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9oYXNoZXIudXBkYXRlKHQpLHRoaXN9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX2hhc2hlcixyPWUuZmluYWxpemUodCk7cmV0dXJuIGUucmVzZXQoKSxlLmZpbmFsaXplKHRoaXMuX29LZXkuY2xvbmUoKS5jb25jYXQocikpfX0pKSkpLEEuZXhwb3J0czt2YXIgdCxlLHIsbn12YXIgUztmdW5jdGlvbiBCKCl7cmV0dXJuIFN8fChTPTEsYi5leHBvcnRzPSh0PV8oKSxrKCksRSgpLGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLG49ci5CYXNlLGk9ci5Xb3JkQXJyYXksYT1lLmFsZ28scz1hLk1ENSxvPWEuRXZwS0RGPW4uZXh0ZW5kKHtjZmc6bi5leHRlbmQoe2tleVNpemU6NCxoYXNoZXI6cyxpdGVyYXRpb25zOjF9KSxpbml0OmZ1bmN0aW9uKHQpe3RoaXMuY2ZnPXRoaXMuY2ZnLmV4dGVuZCh0KX0sY29tcHV0ZTpmdW5jdGlvbih0LGUpe2Zvcih2YXIgcixuPXRoaXMuY2ZnLGE9bi5oYXNoZXIuY3JlYXRlKCkscz1pLmNyZWF0ZSgpLG89cy53b3JkcyxsPW4ua2V5U2l6ZSxoPW4uaXRlcmF0aW9ucztvLmxlbmd0aDxsOyl7ciYmYS51cGRhdGUocikscj1hLnVwZGF0ZSh0KS5maW5hbGl6ZShlKSxhLnJlc2V0KCk7Zm9yKHZhciBjPTE7YzxoO2MrKylyPWEuZmluYWxpemUociksYS5yZXNldCgpO3MuY29uY2F0KHIpfXJldHVybiBzLnNpZ0J5dGVzPTQqbCxzfX0pO2UuRXZwS0RGPWZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gby5jcmVhdGUocikuY29tcHV0ZSh0LGUpfX0oKSx0LkV2cEtERikpLGIuZXhwb3J0czt2YXIgdH12YXIgTyxMPXtleHBvcnRzOnt9fTt2YXIgUjt2YXIgRCxVLEM9KFJ8fChSPTEseS5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbigpe3ZhciBlPXQscj1lLmxpYi5CbG9ja0NpcGhlcixuPWUuYWxnbyxpPVtdLGE9W10scz1bXSxvPVtdLGw9W10saD1bXSxjPVtdLHU9W10sXz1bXSxkPVtdOyFmdW5jdGlvbigpe2Zvcih2YXIgdD1bXSxlPTA7ZTwyNTY7ZSsrKXRbZV09ZTwxMjg/ZTw8MTplPDwxXjI4Mzt2YXIgcj0wLG49MDtmb3IoZT0wO2U8MjU2O2UrKyl7dmFyIGY9bl5uPDwxXm48PDJebjw8M15uPDw0O2Y9Zj4+PjheMjU1JmZeOTksaVtyXT1mLGFbZl09cjt2YXIgcD10W3JdLGc9dFtwXSx5PXRbZ10sdz0yNTcqdFtmXV4xNjg0MzAwOCpmO3Nbcl09dzw8MjR8dz4+Pjgsb1tyXT13PDwxNnx3Pj4+MTYsbFtyXT13PDw4fHc+Pj4yNCxoW3JdPXcsdz0xNjg0MzAwOSp5XjY1NTM3KmdeMjU3KnBeMTY4NDMwMDgqcixjW2ZdPXc8PDI0fHc+Pj44LHVbZl09dzw8MTZ8dz4+PjE2LF9bZl09dzw8OHx3Pj4+MjQsZFtmXT13LHI/KHI9cF50W3RbdFt5XnBdXV0sbl49dFt0W25dXSk6cj1uPTF9fSgpO3ZhciBmPVswLDEsMiw0LDgsMTYsMzIsNjQsMTI4LDI3LDU0XSxwPW4uQUVTPXIuZXh0ZW5kKHtfZG9SZXNldDpmdW5jdGlvbigpe2lmKCF0aGlzLl9uUm91bmRzfHx0aGlzLl9rZXlQcmlvclJlc2V0IT09dGhpcy5fa2V5KXtmb3IodmFyIHQ9dGhpcy5fa2V5UHJpb3JSZXNldD10aGlzLl9rZXksZT10LndvcmRzLHI9dC5zaWdCeXRlcy80LG49NCooKHRoaXMuX25Sb3VuZHM9cis2KSsxKSxhPXRoaXMuX2tleVNjaGVkdWxlPVtdLHM9MDtzPG47cysrKXM8cj9hW3NdPWVbc106KGg9YVtzLTFdLHMlcj9yPjYmJnMlcj09NCYmKGg9aVtoPj4+MjRdPDwyNHxpW2g+Pj4xNiYyNTVdPDwxNnxpW2g+Pj44JjI1NV08PDh8aVsyNTUmaF0pOihoPWlbKGg9aDw8OHxoPj4+MjQpPj4+MjRdPDwyNHxpW2g+Pj4xNiYyNTVdPDwxNnxpW2g+Pj44JjI1NV08PDh8aVsyNTUmaF0saF49ZltzL3J8MF08PDI0KSxhW3NdPWFbcy1yXV5oKTtmb3IodmFyIG89dGhpcy5faW52S2V5U2NoZWR1bGU9W10sbD0wO2w8bjtsKyspe2lmKHM9bi1sLGwlNCl2YXIgaD1hW3NdO2Vsc2UgaD1hW3MtNF07b1tsXT1sPDR8fHM8PTQ/aDpjW2lbaD4+PjI0XV1edVtpW2g+Pj4xNiYyNTVdXV5fW2lbaD4+PjgmMjU1XV1eZFtpWzI1NSZoXV19fX0sZW5jcnlwdEJsb2NrOmZ1bmN0aW9uKHQsZSl7dGhpcy5fZG9DcnlwdEJsb2NrKHQsZSx0aGlzLl9rZXlTY2hlZHVsZSxzLG8sbCxoLGkpfSxkZWNyeXB0QmxvY2s6ZnVuY3Rpb24odCxlKXt2YXIgcj10W2UrMV07dFtlKzFdPXRbZSszXSx0W2UrM109cix0aGlzLl9kb0NyeXB0QmxvY2sodCxlLHRoaXMuX2ludktleVNjaGVkdWxlLGMsdSxfLGQsYSkscj10W2UrMV0sdFtlKzFdPXRbZSszXSx0W2UrM109cn0sX2RvQ3J5cHRCbG9jazpmdW5jdGlvbih0LGUscixuLGksYSxzLG8pe2Zvcih2YXIgbD10aGlzLl9uUm91bmRzLGg9dFtlXV5yWzBdLGM9dFtlKzFdXnJbMV0sdT10W2UrMl1eclsyXSxfPXRbZSszXV5yWzNdLGQ9NCxmPTE7ZjxsO2YrKyl7dmFyIHA9bltoPj4+MjRdXmlbYz4+PjE2JjI1NV1eYVt1Pj4+OCYyNTVdXnNbMjU1Jl9dXnJbZCsrXSxnPW5bYz4+PjI0XV5pW3U+Pj4xNiYyNTVdXmFbXz4+PjgmMjU1XV5zWzI1NSZoXV5yW2QrK10seT1uW3U+Pj4yNF1eaVtfPj4+MTYmMjU1XV5hW2g+Pj44JjI1NV1ec1syNTUmY11ecltkKytdLHc9bltfPj4+MjRdXmlbaD4+PjE2JjI1NV1eYVtjPj4+OCYyNTVdXnNbMjU1JnVdXnJbZCsrXTtoPXAsYz1nLHU9eSxfPXd9cD0ob1toPj4+MjRdPDwyNHxvW2M+Pj4xNiYyNTVdPDwxNnxvW3U+Pj44JjI1NV08PDh8b1syNTUmX10pXnJbZCsrXSxnPShvW2M+Pj4yNF08PDI0fG9bdT4+PjE2JjI1NV08PDE2fG9bXz4+PjgmMjU1XTw8OHxvWzI1NSZoXSlecltkKytdLHk9KG9bdT4+PjI0XTw8MjR8b1tfPj4+MTYmMjU1XTw8MTZ8b1toPj4+OCYyNTVdPDw4fG9bMjU1JmNdKV5yW2QrK10sdz0ob1tfPj4+MjRdPDwyNHxvW2g+Pj4xNiYyNTVdPDwxNnxvW2M+Pj44JjI1NV08PDh8b1syNTUmdV0pXnJbZCsrXSx0W2VdPXAsdFtlKzFdPWcsdFtlKzJdPXksdFtlKzNdPXd9LGtleVNpemU6OH0pO2UuQUVTPXIuX2NyZWF0ZUhlbHBlcihwKX0oKSx0LkFFU30oXygpLGYoKSx2KCksQigpLE98fChPPTEsTC5leHBvcnRzPShEPV8oKSxCKCksdm9pZChELmxpYi5DaXBoZXJ8fGZ1bmN0aW9uKHQpe3ZhciBlPUQscj1lLmxpYixuPXIuQmFzZSxpPXIuV29yZEFycmF5LGE9ci5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtLHM9ZS5lbmM7cy5VdGY4O3ZhciBvPXMuQmFzZTY0LGw9ZS5hbGdvLkV2cEtERixoPXIuQ2lwaGVyPWEuZXh0ZW5kKHtjZmc6bi5leHRlbmQoKSxjcmVhdGVFbmNyeXB0b3I6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5jcmVhdGUodGhpcy5fRU5DX1hGT1JNX01PREUsdCxlKX0sY3JlYXRlRGVjcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0RFQ19YRk9STV9NT0RFLHQsZSl9LGluaXQ6ZnVuY3Rpb24odCxlLHIpe3RoaXMuY2ZnPXRoaXMuY2ZnLmV4dGVuZChyKSx0aGlzLl94Zm9ybU1vZGU9dCx0aGlzLl9rZXk9ZSx0aGlzLnJlc2V0KCl9LHJlc2V0OmZ1bmN0aW9uKCl7YS5yZXNldC5jYWxsKHRoaXMpLHRoaXMuX2RvUmVzZXQoKX0scHJvY2VzczpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fYXBwZW5kKHQpLHRoaXMuX3Byb2Nlc3MoKX0sZmluYWxpemU6ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnRoaXMuX2FwcGVuZCh0KSx0aGlzLl9kb0ZpbmFsaXplKCl9LGtleVNpemU6NCxpdlNpemU6NCxfRU5DX1hGT1JNX01PREU6MSxfREVDX1hGT1JNX01PREU6MixfY3JlYXRlSGVscGVyOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0KXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIHQ/dzpnfXJldHVybiBmdW5jdGlvbihlKXtyZXR1cm57ZW5jcnlwdDpmdW5jdGlvbihyLG4saSl7cmV0dXJuIHQobikuZW5jcnlwdChlLHIsbixpKX0sZGVjcnlwdDpmdW5jdGlvbihyLG4saSl7cmV0dXJuIHQobikuZGVjcnlwdChlLHIsbixpKX19fX0oKX0pO3IuU3RyZWFtQ2lwaGVyPWguZXh0ZW5kKHtfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9wcm9jZXNzKCEwKX0sYmxvY2tTaXplOjF9KTt2YXIgYz1lLm1vZGU9e30sdT1yLkJsb2NrQ2lwaGVyTW9kZT1uLmV4dGVuZCh7Y3JlYXRlRW5jcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuRW5jcnlwdG9yLmNyZWF0ZSh0LGUpfSxjcmVhdGVEZWNyeXB0b3I6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5EZWNyeXB0b3IuY3JlYXRlKHQsZSl9LGluaXQ6ZnVuY3Rpb24odCxlKXt0aGlzLl9jaXBoZXI9dCx0aGlzLl9pdj1lfX0pLF89Yy5DQkM9ZnVuY3Rpb24oKXt2YXIgZT11LmV4dGVuZCgpO2Z1bmN0aW9uIHIoZSxyLG4pe3ZhciBpLGE9dGhpcy5faXY7YT8oaT1hLHRoaXMuX2l2PXQpOmk9dGhpcy5fcHJldkJsb2NrO2Zvcih2YXIgcz0wO3M8bjtzKyspZVtyK3NdXj1pW3NdfXJldHVybiBlLkVuY3J5cHRvcj1lLmV4dGVuZCh7cHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcy5fY2lwaGVyLGk9bi5ibG9ja1NpemU7ci5jYWxsKHRoaXMsdCxlLGkpLG4uZW5jcnlwdEJsb2NrKHQsZSksdGhpcy5fcHJldkJsb2NrPXQuc2xpY2UoZSxlK2kpfX0pLGUuRGVjcnlwdG9yPWUuZXh0ZW5kKHtwcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXt2YXIgbj10aGlzLl9jaXBoZXIsaT1uLmJsb2NrU2l6ZSxhPXQuc2xpY2UoZSxlK2kpO24uZGVjcnlwdEJsb2NrKHQsZSksci5jYWxsKHRoaXMsdCxlLGkpLHRoaXMuX3ByZXZCbG9jaz1hfX0pLGV9KCksZD0oZS5wYWQ9e30pLlBrY3M3PXtwYWQ6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9NCplLG49ci10LnNpZ0J5dGVzJXIsYT1uPDwyNHxuPDwxNnxuPDw4fG4scz1bXSxvPTA7bzxuO28rPTQpcy5wdXNoKGEpO3ZhciBsPWkuY3JlYXRlKHMsbik7dC5jb25jYXQobCl9LHVucGFkOmZ1bmN0aW9uKHQpe3ZhciBlPTI1NSZ0LndvcmRzW3Quc2lnQnl0ZXMtMT4+PjJdO3Quc2lnQnl0ZXMtPWV9fTtyLkJsb2NrQ2lwaGVyPWguZXh0ZW5kKHtjZmc6aC5jZmcuZXh0ZW5kKHttb2RlOl8scGFkZGluZzpkfSkscmVzZXQ6ZnVuY3Rpb24oKXt2YXIgdDtoLnJlc2V0LmNhbGwodGhpcyk7dmFyIGU9dGhpcy5jZmcscj1lLml2LG49ZS5tb2RlO3RoaXMuX3hmb3JtTW9kZT09dGhpcy5fRU5DX1hGT1JNX01PREU/dD1uLmNyZWF0ZUVuY3J5cHRvcjoodD1uLmNyZWF0ZURlY3J5cHRvcix0aGlzLl9taW5CdWZmZXJTaXplPTEpLHRoaXMuX21vZGUmJnRoaXMuX21vZGUuX19jcmVhdG9yPT10P3RoaXMuX21vZGUuaW5pdCh0aGlzLHImJnIud29yZHMpOih0aGlzLl9tb2RlPXQuY2FsbChuLHRoaXMsciYmci53b3JkcyksdGhpcy5fbW9kZS5fX2NyZWF0b3I9dCl9LF9kb1Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe3RoaXMuX21vZGUucHJvY2Vzc0Jsb2NrKHQsZSl9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQsZT10aGlzLmNmZy5wYWRkaW5nO3JldHVybiB0aGlzLl94Zm9ybU1vZGU9PXRoaXMuX0VOQ19YRk9STV9NT0RFPyhlLnBhZCh0aGlzLl9kYXRhLHRoaXMuYmxvY2tTaXplKSx0PXRoaXMuX3Byb2Nlc3MoITApKToodD10aGlzLl9wcm9jZXNzKCEwKSxlLnVucGFkKHQpKSx0fSxibG9ja1NpemU6NH0pO3ZhciBmPXIuQ2lwaGVyUGFyYW1zPW4uZXh0ZW5kKHtpbml0OmZ1bmN0aW9uKHQpe3RoaXMubWl4SW4odCl9LHRvU3RyaW5nOmZ1bmN0aW9uKHQpe3JldHVybih0fHx0aGlzLmZvcm1hdHRlcikuc3RyaW5naWZ5KHRoaXMpfX0pLHA9KGUuZm9ybWF0PXt9KS5PcGVuU1NMPXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7dmFyIGU9dC5jaXBoZXJ0ZXh0LHI9dC5zYWx0O3JldHVybihyP2kuY3JlYXRlKFsxMzk4ODkzNjg0LDE3MDEwNzY4MzFdKS5jb25jYXQocikuY29uY2F0KGUpOmUpLnRvU3RyaW5nKG8pfSxwYXJzZTpmdW5jdGlvbih0KXt2YXIgZSxyPW8ucGFyc2UodCksbj1yLndvcmRzO3JldHVybiAxMzk4ODkzNjg0PT1uWzBdJiYxNzAxMDc2ODMxPT1uWzFdJiYoZT1pLmNyZWF0ZShuLnNsaWNlKDIsNCkpLG4uc3BsaWNlKDAsNCksci5zaWdCeXRlcy09MTYpLGYuY3JlYXRlKHtjaXBoZXJ0ZXh0OnIsc2FsdDplfSl9fSxnPXIuU2VyaWFsaXphYmxlQ2lwaGVyPW4uZXh0ZW5kKHtjZmc6bi5leHRlbmQoe2Zvcm1hdDpwfSksZW5jcnlwdDpmdW5jdGlvbih0LGUscixuKXtuPXRoaXMuY2ZnLmV4dGVuZChuKTt2YXIgaT10LmNyZWF0ZUVuY3J5cHRvcihyLG4pLGE9aS5maW5hbGl6ZShlKSxzPWkuY2ZnO3JldHVybiBmLmNyZWF0ZSh7Y2lwaGVydGV4dDphLGtleTpyLGl2OnMuaXYsYWxnb3JpdGhtOnQsbW9kZTpzLm1vZGUscGFkZGluZzpzLnBhZGRpbmcsYmxvY2tTaXplOnQuYmxvY2tTaXplLGZvcm1hdHRlcjpuLmZvcm1hdH0pfSxkZWNyeXB0OmZ1bmN0aW9uKHQsZSxyLG4pe3JldHVybiBuPXRoaXMuY2ZnLmV4dGVuZChuKSxlPXRoaXMuX3BhcnNlKGUsbi5mb3JtYXQpLHQuY3JlYXRlRGVjcnlwdG9yKHIsbikuZmluYWxpemUoZS5jaXBoZXJ0ZXh0KX0sX3BhcnNlOmZ1bmN0aW9uKHQsZSl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0P2UucGFyc2UodCx0aGlzKTp0fX0pLHk9KGUua2RmPXt9KS5PcGVuU1NMPXtleGVjdXRlOmZ1bmN0aW9uKHQsZSxyLG4sYSl7aWYobnx8KG49aS5yYW5kb20oOCkpLGEpcz1sLmNyZWF0ZSh7a2V5U2l6ZTplK3IsaGFzaGVyOmF9KS5jb21wdXRlKHQsbik7ZWxzZSB2YXIgcz1sLmNyZWF0ZSh7a2V5U2l6ZTplK3J9KS5jb21wdXRlKHQsbik7dmFyIG89aS5jcmVhdGUocy53b3Jkcy5zbGljZShlKSw0KnIpO3JldHVybiBzLnNpZ0J5dGVzPTQqZSxmLmNyZWF0ZSh7a2V5OnMsaXY6byxzYWx0Om59KX19LHc9ci5QYXNzd29yZEJhc2VkQ2lwaGVyPWcuZXh0ZW5kKHtjZmc6Zy5jZmcuZXh0ZW5kKHtrZGY6eX0pLGVuY3J5cHQ6ZnVuY3Rpb24odCxlLHIsbil7dmFyIGk9KG49dGhpcy5jZmcuZXh0ZW5kKG4pKS5rZGYuZXhlY3V0ZShyLHQua2V5U2l6ZSx0Lml2U2l6ZSxuLnNhbHQsbi5oYXNoZXIpO24uaXY9aS5pdjt2YXIgYT1nLmVuY3J5cHQuY2FsbCh0aGlzLHQsZSxpLmtleSxuKTtyZXR1cm4gYS5taXhJbihpKSxhfSxkZWNyeXB0OmZ1bmN0aW9uKHQsZSxyLG4pe249dGhpcy5jZmcuZXh0ZW5kKG4pLGU9dGhpcy5fcGFyc2UoZSxuLmZvcm1hdCk7dmFyIGk9bi5rZGYuZXhlY3V0ZShyLHQua2V5U2l6ZSx0Lml2U2l6ZSxlLnNhbHQsbi5oYXNoZXIpO3JldHVybiBuLml2PWkuaXYsZy5kZWNyeXB0LmNhbGwodGhpcyx0LGUsaS5rZXksbil9fSl9KCkpKSkpKSx5LmV4cG9ydHMpLFQ9ZShDKSxGPXtleHBvcnRzOnt9fTtmdW5jdGlvbiBIKCl7cmV0dXJuIFV8fChVPTEsRi5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgcj10LG49ci5saWIsaT1uLldvcmRBcnJheSxhPW4uSGFzaGVyLHM9ci5hbGdvLG89W10sbD1bXTshZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQpe2Zvcih2YXIgcj1lLnNxcnQodCksbj0yO248PXI7bisrKWlmKCEodCVuKSlyZXR1cm4hMTtyZXR1cm4hMH1mdW5jdGlvbiByKHQpe3JldHVybiA0Mjk0OTY3Mjk2Kih0LSgwfHQpKXwwfWZvcih2YXIgbj0yLGk9MDtpPDY0Oyl0KG4pJiYoaTw4JiYob1tpXT1yKGUucG93KG4sLjUpKSksbFtpXT1yKGUucG93KG4sMS8zKSksaSsrKSxuKyt9KCk7dmFyIGg9W10sYz1zLlNIQTI1Nj1hLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9oYXNoPW5ldyBpLmluaXQoby5zbGljZSgwKSl9LF9kb1Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe2Zvcih2YXIgcj10aGlzLl9oYXNoLndvcmRzLG49clswXSxpPXJbMV0sYT1yWzJdLHM9clszXSxvPXJbNF0sYz1yWzVdLHU9cls2XSxfPXJbN10sZD0wO2Q8NjQ7ZCsrKXtpZihkPDE2KWhbZF09MHx0W2UrZF07ZWxzZXt2YXIgZj1oW2QtMTVdLHA9KGY8PDI1fGY+Pj43KV4oZjw8MTR8Zj4+PjE4KV5mPj4+MyxnPWhbZC0yXSx5PShnPDwxNXxnPj4+MTcpXihnPDwxM3xnPj4+MTkpXmc+Pj4xMDtoW2RdPXAraFtkLTddK3kraFtkLTE2XX12YXIgdz1uJmlebiZhXmkmYSx2PShuPDwzMHxuPj4+MileKG48PDE5fG4+Pj4xMyleKG48PDEwfG4+Pj4yMiksbT1fKygobzw8MjZ8bz4+PjYpXihvPDwyMXxvPj4+MTEpXihvPDw3fG8+Pj4yNSkpKyhvJmNefm8mdSkrbFtkXStoW2RdO189dSx1PWMsYz1vLG89cyttfDAscz1hLGE9aSxpPW4sbj1tKyh2K3cpfDB9clswXT1yWzBdK258MCxyWzFdPXJbMV0raXwwLHJbMl09clsyXSthfDAsclszXT1yWzNdK3N8MCxyWzRdPXJbNF0rb3wwLHJbNV09cls1XStjfDAscls2XT1yWzZdK3V8MCxyWzddPXJbN10rX3wwfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2RhdGEscj10LndvcmRzLG49OCp0aGlzLl9uRGF0YUJ5dGVzLGk9OCp0LnNpZ0J5dGVzO3JldHVybiByW2k+Pj41XXw9MTI4PDwyNC1pJTMyLHJbMTQrKGkrNjQ+Pj45PDw0KV09ZS5mbG9vcihuLzQyOTQ5NjcyOTYpLHJbMTUrKGkrNjQ+Pj45PDw0KV09bix0LnNpZ0J5dGVzPTQqci5sZW5ndGgsdGhpcy5fcHJvY2VzcygpLHRoaXMuX2hhc2h9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9YS5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0Ll9oYXNoPXRoaXMuX2hhc2guY2xvbmUoKSx0fX0pO3IuU0hBMjU2PWEuX2NyZWF0ZUhlbHBlcihjKSxyLkhtYWNTSEEyNTY9YS5fY3JlYXRlSG1hY0hlbHBlcihjKX0oTWF0aCksdC5TSEEyNTZ9KF8oKSkpLEYuZXhwb3J0c312YXIgWixNPWUoSCgpKSxOPXtleHBvcnRzOnt9fTt2YXIgSSxqPShafHwoWj0xLE4uZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXtpZigiZnVuY3Rpb24iPT10eXBlb2YgQXJyYXlCdWZmZXIpe3ZhciBlPXQubGliLldvcmRBcnJheSxyPWUuaW5pdCxuPWUuaW5pdD1mdW5jdGlvbih0KXtpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXImJih0PW5ldyBVaW50OEFycmF5KHQpKSwodCBpbnN0YW5jZW9mIEludDhBcnJheXx8InVuZGVmaW5lZCIhPXR5cGVvZiBVaW50OENsYW1wZWRBcnJheSYmdCBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5fHx0IGluc3RhbmNlb2YgSW50MTZBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQxNkFycmF5fHx0IGluc3RhbmNlb2YgSW50MzJBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQzMkFycmF5fHx0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5fHx0IGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5KSYmKHQ9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0LHQuYnl0ZUxlbmd0aCkpLHQgaW5zdGFuY2VvZiBVaW50OEFycmF5KXtmb3IodmFyIGU9dC5ieXRlTGVuZ3RoLG49W10saT0wO2k8ZTtpKyspbltpPj4+Ml18PXRbaV08PDI0LWklNCo4O3IuY2FsbCh0aGlzLG4sZSl9ZWxzZSByLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07bi5wcm90b3R5cGU9ZX19KCksdC5saWIuV29yZEFycmF5fShfKCkpKSxOLmV4cG9ydHMpLFA9ZShqKSwkPXtleHBvcnRzOnt9fTt2YXIgSz0oSXx8KEk9MSwkLmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIHQuSG1hY1NIQTI1Nn0oXygpLEgoKSxFKCkpKSwkLmV4cG9ydHMpLFg9ZShLKTtjb25zdCBHPSExO2xldCBXLFk9ZmV0Y2g7b25tZXNzYWdlPWZ1bmN0aW9uKHQpe2NvbnN0e2pvYjplLGNtZDpyLHNlcnZlcjpuLHBhdGg6aSxidWZmZXI6YSxrZXlCYXNlNjQ6cyxnemlwOmwscmVmZXJyZXI6aCxpZDpjLGFwcElkOnUscGVyc2lzdGVudElkOl8sQ1JPUVVFVF9WRVJTSU9OOmQsZGVidWc6Zix3aGF0OnAsb2ZmbGluZTp5fT10LmRhdGE7eSYmKFk9ayk7c3dpdGNoKHIpe2Nhc2UidXBsb2FkRW5jcnlwdGVkIjp4KGkpO2JyZWFrO2Nhc2UiZ2V0T2ZmbGluZUZpbGUiOnoodC5kYXRhLnVybCk7YnJlYWs7ZGVmYXVsdDpjb25zb2xlLmVycm9yKCJVbmtub3duIHdvcmtlciBjb21tYW5kIixyKX1mdW5jdGlvbiB3KHQpe2NvbnN0IGU9RGF0ZS5ub3coKSxyPVAuY3JlYXRlKHQpLG49Zy5wYXJzZShzKSxpPVgocixuKSxhPVAucmFuZG9tKDE2KSx7Y2lwaGVydGV4dDpvfT1ULmVuY3J5cHQocixuLHtpdjphfSksbD1uZXcgQXJyYXlCdWZmZXIoNCthLnNpZ0J5dGVzK2kuc2lnQnl0ZXMrby5zaWdCeXRlcyksaD1uZXcgRGF0YVZpZXcobCk7bGV0IHU9MDtoLnNldFVpbnQzMih1LDExMjk0NjgyMDksITEpLHUrPTQ7Zm9yKGNvbnN0IHQgb2ZbYSxpLG9dKWZvcihjb25zdCBlIG9mIHQud29yZHMpaC5zZXRJbnQzMih1LGUsITEpLHUrPTQ7cmV0dXJuIGYmJmNvbnNvbGUubG9nKGMsYCR7cH0gZW5jcnlwdGVkICgke2wuYnl0ZUxlbmd0aH0gYnl0ZXMpIGluICR7RGF0ZS5ub3coKS1lfW1zYCksbH1mdW5jdGlvbiB2KHQpe2NvbnN0IGU9RGF0ZS5ub3coKSxyPW8uZGVmbGF0ZSh0LHtnemlwOiEwLGxldmVsOjF9KTtyZXR1cm4gZiYmY29uc29sZS5sb2coYyxgJHtwfSBjb21wcmVzc2VkICgke3IubGVuZ3RofSBieXRlcykgaW4gJHtEYXRlLm5vdygpLWV9bXNgKSxyfWZ1bmN0aW9uIG0odCl7Y29uc3QgZT1EYXRlLm5vdygpLHI9TShQLmNyZWF0ZSh0KSksbj1nLnN0cmluZ2lmeShyKS5yZXBsYWNlKC89L2csIiIpLnJlcGxhY2UoL1wrL2csIi0iKS5yZXBsYWNlKC9cLy9nLCJfIik7cmV0dXJuIGYmJmNvbnNvbGUubG9nKGMsYCR7cH0gaGFzaGVkICgke3QuYnl0ZUxlbmd0aH0gYnl0ZXMpIGluICR7RGF0ZS5ub3coKS1lfW1zYCksbn1hc3luYyBmdW5jdGlvbiBiKHQpe2lmKHkpe2NvbnN0IGU9YG9mZmxpbmU6Ly8vJHt0fWA7cmV0dXJue3VybDplLHVwbG9hZFVybDplfX1jb25zdCBlPURhdGUubm93KCkscj1gJHtuLnVybH0vJHt0fWA7aWYoIW4uYXBpS2V5KXJldHVybnt1cmw6cix1cGxvYWRVcmw6cn07Y29uc3QgaT1hd2FpdCBZKHIse2hlYWRlcnM6eyJYLUNyb3F1ZXQtQXV0aCI6bi5hcGlLZXksIlgtQ3JvcXVldC1BcHAiOnUsIlgtQ3JvcXVldC1JZCI6XywiWC1Dcm9xdWV0LVNlc3Npb24iOmMsIlgtQ3JvcXVldC1WZXJzaW9uIjpkLCJYLUNyb3F1ZXQtUGF0aCI6bmV3IFVSTChoKS5wYXRobmFtZX0scmVmZXJyZXI6aH0pLHtvazphLHN0YXR1czpzLHN0YXR1c1RleHQ6b309aTtpZighYSl0aHJvdyBFcnJvcihgRXJyb3IgaW4gc2lnbmluZyBVUkw6ICR7c30gLSAke299YCk7Y29uc3R7ZXJyb3I6bCxyZWFkOmcsd3JpdGU6d309YXdhaXQgaS5qc29uKCk7aWYobCl0aHJvdyBFcnJvcihsKTtyZXR1cm4gZiYmY29uc29sZS5sb2coYyxgJHtwfSB1cGxvYWQgYXV0aG9yaXplZCBpbiAke0RhdGUubm93KCktZX1tc2ApLHt1cmw6Zyx1cGxvYWRVcmw6d319YXN5bmMgZnVuY3Rpb24geCh0KXt0cnl7bGV0IHI9dyhsP3YoYSk6YSk7Ryx0LmluY2x1ZGVzKCIlSEFTSCUiKSYmKHQ9dC5yZXBsYWNlKCIlSEFTSCUiLG0ocikpKTtjb25zdHt1cGxvYWRVcmw6bix1cmw6aX09YXdhaXQgYih0KSxzPURhdGUubm93KCkse29rOm8sc3RhdHVzOnUsc3RhdHVzVGV4dDpffT1hd2FpdCBZKG4se21ldGhvZDoiUFVUIixtb2RlOiJjb3JzIixoZWFkZXJzOnsiQ29udGVudC1UeXBlIjoiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIn0scmVmZXJyZXI6aCxib2R5OnJ9KTtpZighbyl0aHJvdyBFcnJvcihgc2VydmVyIHJldHVybmVkICR7dX0gJHtffSBmb3IgUFVUICR7bn1gKTtmJiZjb25zb2xlLmxvZyhjLGAke3B9IHVwbG9hZGVkICgke3V9KSBpbiAke0RhdGUubm93KCktc31tcyAke2l9YCksVyh7am9iOmUsdXJsOmksb2s6byxzdGF0dXM6dSxzdGF0dXNUZXh0Ol8sYnl0ZXM6ci5ieXRlTGVuZ3RofSl9Y2F0Y2godCl7ZiYmY29uc29sZS5lcnJvcihgJHtjfSB1cGxvYWQgZXJyb3IgJHt0Lm1lc3NhZ2V9YCksVyh7am9iOmUsb2s6ITEsc3RhdHVzOi0xLHN0YXR1c1RleHQ6dC5tZXNzYWdlfSl9fWZ1bmN0aW9uIGsodCxlKXtyZXR1cm4gZiYmY29uc29sZS5sb2coYyxgc3RvcmluZyAke3R9YCkscS5zZXQodCxlLmJvZHkpLHtvazohMCxzdGF0dXM6MjAxLHN0YXR1c1RleHQ6Ik9mZmxpbmUgY3JlYXRlZCJ9fWZ1bmN0aW9uIHoodCl7Y29uc3Qgcj1xLmdldCh0KTtpZighcilyZXR1cm4gZiYmY29uc29sZS5lcnJvcihgJHtjfSBmaWxlIG5vdCBmb3VuZCAke3R9YCksdm9pZCBXKHtqb2I6ZSxvazohMSxzdGF0dXM6LTEsc3RhdHVzVGV4dDoiT2ZmbGluZSBmaWxlIG5vdCBmb3VuZCJ9KTtmJiZjb25zb2xlLmxvZyhjLGByZXRyaWV2ZWQgJHt0fWApLFcoe2pvYjplLG9rOiEwLHN0YXR1czoyMDAsc3RhdHVzVGV4dDoiT2ZmbGluZSBmaWxlIGZvdW5kIixib2R5OnIsYnl0ZXM6ci5ieXRlTGVuZ3RofSl9fSxXPXBvc3RNZXNzYWdlO2NvbnN0IHE9bmV3IE1hcH0oKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXBsb2FkLmpzLm1hcAoK");const cc=r.CROQUET_VERSION,dc="node"===r.CROQUET_PLATFORM,hc="https://croquet.io/files/v1",uc="https://files.croquet.io",mc=uc;let pc=null;function fc(){globalThis.__MULTISYNQ__||(dc?console.log("Croquet "+cc):console.log("%cCroquet%c %c"+cc,"color:#F0493E","color:inherit","color:"+(cc.includes("+")?"#909":"inherit")));const t=!dc&&window.location.hostname.match(/^(.*\.)?croquet\.io$/i)&&window.location.pathname.startsWith("/dev/"),e=h.dev||!1!==h.dev&&t;if(pc={messages:h.has("debug","messages",!1),sends:h.has("debug","sends",!1),publish:h.has("debug","publish",!1),events:h.has("debug","events",!1),ticks:h.has("debug","ticks",!1),pong:h.has("debug","pong",!1),snapshot:h.has("debug","snapshot",!1),session:h.has("debug","session",!1),initsnapshot:h.has("debug","initsnapshot",!0),reflector:h.has("debug","reflector",e),offline:h.has("debug","offline",!1)},pc.offline&&qt.showMessage(`${qt.libName}: offline mode enabled, no multiuser`,{level:"warning"}),h.box){let t=new URL(h.box,dc?void 0:window.location).href;t.endsWith("/")||(t+="/"),h.reflector=t+"reflector",h.files=t+"files"}}function bc(t={}){pc||fc(),"string"==typeof t&&(t=Object.fromEntries(t.split(",").map((e=>[e.replace(/^no/,""),!t.startsWith("no")]))));for(const[e,s]of Object.entries(t))e in pc?pc[e]=s:qt.showMessage(`${qt.libName}: unknown debug option "${e}"`,{level:"warning",only:"once"});return pc}const yc="wss://api.multisynq.io/depin",gc=yc;let wc,Zc,vc="reflector";const Xc=h.nocheat,Lc=200,xc=[0],Sc=4096;let Gc;const Tc=new lc;Tc.onerror=t=>console.error(`UploadWorker error: ${t.message}`);let Wc=0;const Cc=new Set;function kc(t=""){let e=null;for(const s of Cc)if(e||(e=s),s.id===t){e=s;break}if(e){const{appId:t,persistentId:s}=e.sessionSpec;return{appId:t,persistentId:s,key:e.key,uploadEncrypted:t=>e.uploadEncrypted(t),downloadEncrypted:t=>e.downloadEncrypted(t)}}return{}}Object.defineProperty(se,"controller",{get(){return this.controllers.values().next().value}}),se.controllers=Cc;class Pc{constructor(){pc||fc(),this.reset()}reset(){globalThis.CROQUETVM===this.vm&&delete globalThis.CROQUETVM,this.vm=null,this.session=null,this.connection=this.connection||new Vc(this),this.networkQueue=[],this.reflectorTime=0,this.msPerTick=this.msPerTick||0,this.tickMultiplier=this.tickMultiplier||1,this.extrapolatedTimeBase=Date.now(),this.key=this.key||null,this.tove=this.tove||null,this.viewId=this.viewId||Math.floor(Math.random()*36**10).toString(36),this.viewDataEncrypted=this.viewDataEncrypted||null,this.timeline="",this.rejoinTimeout&&clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0,this.sendBuffer=[],this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.lastSnapshotRequest=0,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(globalThis.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(globalThis.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],this.auditStats={lastUsers:-1,minUsers:-1,maxUsers:-1,payloadTally:0},this.lastAnimationEnd=0,this.animationGapCheck=[],this.rateLimitedSendTimes=[],this.rateLimitBuffer=[],this.rateLimitSoftWarned=!1,this.rateLimitBufferWarned=!1,this.rateLimitLastLogged=0,this.payloadSizeWarned=!1,se.removeAllSubscriptionsFor(this.viewId),se.addSubscription(this.viewId,"__views__",this.viewId,(t=>Nt(`users now ${t}`)),"oncePerFrameWhileSynced"),this.leaving||qt.showSyncWait(!0)}get id(){return this.vm?this.vm.id:this.sessionSpec.id}get persistentId(){return this.sessionSpec.persistentId}get versionId(){return this.sessionSpec.codeHash}get extrapolatedTime(){return Date.now()-this.extrapolatedTimeBase}get viewOnly(){return this.sessionSpec.viewOnly}get backlog(){return this.vm?this.reflectorTime-this.vm.time:0}get starvation(){return Date.now()-this.lastReceived}get lag(){return this.vm?Math.max(0,this.extrapolatedTime-this.vm.time-this.msPerTick):0}get activity(){return Date.now()-this.lastSent}get viewed(){return!(!this.session||!this.session.view)}get connected(){return this.connection.connected}get shouldLeaveWhenDisconnected(){return this.leaving||!this.canRejoinSeamlessly||0===this.sessionSpec.rejoinLimit}get canRejoinSeamlessly(){return!!this.timeline}get migratingOldSnapshot(){if(!this.sessionSpec)return!1;const{codeHash:t,computedCodeHash:e}=this.sessionSpec;return t!==e}checkForConnection(t){this.connection.checkForConnection(t)}dormantDisconnect(){this.connected&&this.connection.dormantDisconnect()}async initFromSessionSpec(t){const{name:e,optionsFromUrl:s,persistentIdOptions:n,password:i,appId:o,apiKey:r,viewData:a,viewIdDebugSuffix:l,location:c}=t,d=o?`${o}/${e}`:e;this.key=go(i,"",{keySize:8,hasher:ro.algo.SHA1,iterations:1}),l&&(this.viewId=this.viewId.replace(/_.*$/,"")+"_"+encodeURIComponent((""+l).slice(0,16)).replace(/[^a-z0-9]/gi,(t=>`_${"%"===t?"":t.charCodeAt(0).toString(16).toUpperCase()}`)));const u={...t.options};if(s)for(const t of s)t in h&&(u[t]=h[t]);const m={},p={};for(const[t,e]of Object.entries(u))n?.includes(t)?m[t]=e:p[t]=e;const f=pc.events||pc.publish;f&&(p.__debugEvents=!0),c&&(p.__location=!0);const b=h.hashOverride||t.hashOverride,y=await async function(t,e){return q(t+V(e))}(d,m),{developerId:g,token:w}=await this.verifyApiKey(r,o,y),{id:Z,codeHash:v,computedCodeHash:X}=await async function(t,e,s,n,i){let o,r;const a=et[t];let l="";a?(o=a.codeHashes,r=a.computedCodeHash,l=" (code hashing from cache)"):(o=await Promise.all(tt),r=await q([i,...o].join("|")),et[t]={codeHashes:o,computedCodeHash:r});const c=n||r,d=await q(t+"|"+e+V(s)+c);if(B()&&!st.has(d)){(J?"utf-8":[...document.getElementsByTagName("meta")].find((t=>t.getAttribute("charset"))))||console.warn(`${qt.libName}: Missing <meta charset="..."> declaration. ${qt.libName} model code hashing might differ between browsers.`),A[r].what="Version ID",A[t].what="Persistent ID",A[d].what="Session ID",c!==r&&(o.push(r),A[r].what="Computed Version ID (replaced by overrideHash)",A[c]={what:"Version ID (as specified by overrideHash)"});const e=[...o,c,t,d].map((t=>({hash:t,...A[t]})));console.log(`${qt.libName}: Debug Hashing for session ${d}${l}`,e),st.add(d)}return B()||(A={}),{id:d,persistentId:t,codeHash:c,computedCodeHash:r}}(y,g,p,b,cc);this.tove||(this.tove=await this.encrypt(Z)),a&&!this.viewDataEncrypted&&(this.viewDataEncrypted=await this.encryptPayload(a)),pc.session&&console.log(`${qt.libName} session "${d}":\n        sessionId=${Z}${o?`\n        persistentId=${y}`:""}\n        versionId=${v===X?v:`${v} (specified in hashOverride)\n        versionId=${X} (computed)`}\n        viewId=${this.viewId}`),this.eventRateLimit=t.eventRateLimit,this.eventHistoryLimit=this.eventRateLimit,this.eventMaxBundles=this.eventRateLimit,this.sessionSpec={...t,options:u,name:d,id:Z,persistentId:y,developerId:g,token:w,codeHash:v,computedCodeHash:X,debugEvents:f};const{msPerTick:L,multiplier:x}=this.getTickAndMultiplier();this.msPerTick=L,this.tickMultiplier=x,this.setUpActivityChecks()}async establishSession(){const{id:t,persistentId:e,codeHash:s}=this.sessionSpec;this.sessionSpec.snapshot={id:t,time:0,meta:{id:t,persistentId:e,codeHash:s,created:(new Date).toISOString()}};const n=new Promise((t=>{this.sessionSpec.sessionJoined=t}));this.checkForConnection(!1),pc.session&&console.log(t,"waiting for join and SYNC"),await n,this.sessionSpec.sessionJoined=()=>{},this.syncCompleted=!0}getBackend(t){if(pc.offline)return{apiKey:"none",signServer:"none",reflector:"none"};if(h.box||h.reflector)return{apiKey:"none",signServer:"none",reflector:h.reflector};const e={};for(const s of t.split(",")){const t=s.lastIndexOf(":"),n=s[-1===t?0:t+1];if(!n?.match(/^[12]$/))throw Error("Invalid API key: "+s);if(n in e)throw Error("Duplicate API key versions");e[n]={key:-1===t?s:s.slice(t+1),backend:-1===t?"":s.slice(0,t)}}let s=!e[1];s&&e[2].backend&&(s=e[2].backend),function(t){void 0===wc&&(wc="depin"in h?h.depin:t,wc&&!pc.offline?(Zc=!0===wc?gc:"prod"===wc?yc:"dev"===wc?"wss://api.multisynq.dev/depin":"local"===wc?"ws://localhost:8787":wc,Zc.endsWith("/")&&(Zc=Zc.slice(0,-1)),Zc=Zc.replace(/^http(s):/,"ws$1:"),Zc.startsWith("ws")||(Zc=(dc||"https:"!==window.location.protocol?"ws://":"wss://")+Zc),vc="synchronizer",pc.session&&console.log(`DEPIN_API=${Zc}`)):wc=!1)}(s);const n=e[wc?2:1];if(!n)throw Error(`No ${wc?"Multisynq":"Croquet"} API key provided`);const i=n.key,o=h.backend||n.backend,r=h.reflector?.includes("/");if("none"===o)return{apiKey:i,signServer:"none",reflector:"overridden"};if(wc)return{apiKey:i,signServer:`${Zc.replace(/^ws/,"http")}/clients`,reflector:"depin"};return{apiKey:i,signServer:"https://api.croquet.io/sign",reflector:r?"overridden":"wss://api.croquet.io/reflector/v1"}}async verifyApiKey(t,e,s){const{signServer:n,apiKey:i}=this.getBackend(t);if("none"===n)return{developerId:"unknown_dev_id"};try{const t=2,o=await this.fetchWithRetries("verifying API key",[403],t,(()=>fetch(`${n}/join?meta=login`,{method:"GET",mode:"cors",headers:{"X-Croquet-Auth":i,"X-Croquet-App":e,"X-Croquet-Id":s,"X-Croquet-Version":cc,"X-Croquet-Path":new URL(qt.referrerURL()).pathname},referrer:qt.referrerURL(),referrerPolicy:"no-referrer-when-downgrade"}))),r=await o.json(),{developerId:a,error:l}=r;if(l)throw Error(l);return pc.session&&console.log(`${wc?"Multisynq":"Croquet"}: verified API key for developer ${a}`),r}catch(t){throw Error(`${wc?"Multisynq":"Croquet"} API key validation failed for "${i}": ${t.message}`)}}async fetchWithRetries(t,e,s,n){const i=1+s;let o,r=0;for(;;){let s,a;try{if(s=await n(),s.ok)return s}catch(t){a=t}r++;let l="";const c=s&&e.includes(s.status);if(c?l="fatal ":r===i&&(l="final "),o=s?`${l}status ${s.status} ${s.statusText} - "${await s.text()}"`:`${l}error "${a?.message}"`,r===i||c)break;const d=1===r?100:2===r?1e3:5e3;console.warn(`${o} while ${t}; retrying in ${d}ms`),await new Promise((t=>{setTimeout(t,d)}))}throw console.warn(`${o} while ${t}; giving up`),Error(o)}lastKnownTime(t){return Math.max(t.time,t.externalTime)}takeSnapshot(){const t=this.vm.snapshot(),e=this.lastKnownTime(t),s=t.externalSeq;return t.meta={...this.sessionSpec.snapshot.meta,options:this.sessionSpec.options,time:e,seq:s,date:(new globalThis.CroquetViewDate).toISOString(),host:dc?"localhost":window.location.hostname,sdk:cc},delete t.meta.hash,t}takeSnapshotHandleErrors(){let t,e,s;try{t=Tt.begin("snapshot"),s=this.takeSnapshot()}catch(t){return Ht("snapshot",t),null}finally{e=Tt.end("snapshot")-t}return pc.snapshot&&console.log(this.id,`snapshot taken in ${Math.ceil(e)}ms`),s}setDebug(t){return bc(t)}requestDebugSnapshot(){bc("snapshot"),this.triggeringCpuTime=1e-10,this.scheduleSnapshot(this.viewId)}scheduleSnapshot(t=!1){if(!this.connected||!this.vm||this.viewOnly)return;const e=this.vm.time,s=e-this.vm.lastSnapshotPoll;if(s<5e3&&!t)return void(pc.snapshot&&console.log(`not requesting snapshot poll (${s}ms since poll scheduled)`));if(this.migratingOldSnapshot)return void alert("Snapshot is due but hashOverride is set. Ignoring.");if(t){const e=Object.keys(this.vm.views);if(e.sort(),t!==this.viewId&&e[0]!==this.viewId&&e[1]!==this.viewId&&e[2]!==this.viewId)return void(pc.snapshot&&console.log("not forcing snapshot poll (not one of the three)"));pc.snapshot&&console.log("forcing snapshot poll")}const n=new Ld(e,0,"_","handlePollForSnapshot",[]);this.sendTagged(n,{debounce:5e3,msgID:"pollForSnapshot"}),pc.snapshot&&console.log(this.id,`requesting snapshot poll via ${vc}`)}handlePollForSnapshot(t){if(!0!==this.synced||this.viewOnly)return void(this.triggeringCpuTime=null);const e=this.triggeringCpuTime||this.cpuTime;let s,n,i;this.triggeringCpuTime=null,this.cpuTime=0;try{s=Tt.begin("snapshot"),n={cpuTime:e,hash:this.vm.getSummaryHash(),viewId:this.viewId}}catch(t){return void Ht("snapshot",t)}finally{i=Tt.end("snapshot")-s,this.cpuTime-=i}pc.snapshot&&console.log(this.id,`Summary hashing took ${Math.ceil(i)}ms`),queueMicrotask((()=>this.pollForSnapshot(t,n)))}pollForSnapshot(t,e){e.cpuTime+=Math.random(),pc.snapshot&&console.log(this.id,"sending snapshot vote",e),this.sendTutti({time:t,topic:"snapshot",data:e,tallyTarget:["handleSnapshotVote"]})}handleSnapshotVote(t){const{tally:e}=t;pc.snapshot&&console.log(this.id,"received snapshot votes",e);const{numberOfGroups:s,shouldUpload:n,dissidentFlag:i}=this.analyzeTally(e,"cpuTime");if(s>1){this.diverged=!0;const t=this.vm.diverged?this.vm.diverged.size:0;console.error(this.id,`Session diverged (#${t})! Snapshots fall into ${s} groups`)}if(!0!==this.synced)pc.snapshot&&console.log(this.id,"Ignoring snapshot vote during sync");else if(n){const t={...this.auditStats},e=this.takeSnapshotHandleErrors();e&&queueMicrotask((()=>this.uploadSnapshot(e,t,i)))}}analyzeTally(t,e){let s=!1,n=null;const i=[],o={};let r=null;Object.keys(t).forEach(((t,e)=>{const s=JSON.parse(t);i.push(s);const{hash:n,viewId:a}=s;a===this.viewId&&(r=e),o[n]||(o[n]=[]),o[n].push(e)}));const a=Object.keys(o),l=a.length;let c=0;l>1&&(a.sort(((t,e)=>o[e].length-o[t].length)),o[a[0]].length===o[a[1]].length&&(pc.snapshot&&console.log(this.id,"Deciding consensus by tie-break"),a[1]<a[0]&&(c=1)));const d=a[c];if(null!==r){const t=i[r].hash,a=o[t];a.length>1&&a.sort(((t,s)=>i[t][e]-i[s][e])),a[0]===r&&(s=!0,t!==d&&(n={groupVotes:a.length,allVotes:i.length}))}return{numberOfGroups:l,shouldUpload:s,dissidentFlag:n}}snapshotPath(t,e,s){const n=Math.ceil(t).toString().padStart(10,"0"),{appId:i,persistentId:o,codeHash:r,apiKey:a}=this.sessionSpec;return a?`apps/${i}/snap/${r}/${o}.${this.id}/${n}_${e}.${s}`:`snapshots/${this.id}/${n}_${e}-${s}.snap`}hashSnapshot(t){return t.meta.hash?t.meta.hash:(t.meta.hashPromise||(t.meta.hashPromise=new Promise((e=>{const s={...t};delete s.meta,q(JSON.stringify(s)).then((s=>{t.meta.hash=s,delete t.meta.hashPromise,e(s)}))}))),t.meta.hashPromise)}uploadServer(t){if("string"==typeof h.files){let t=new URL(h.files,dc?void 0:window.location).href;return t.endsWith("/")&&(t=t.slice(0,-1)),{url:t,apiKey:null}}const{apiKey:e,signServer:s}=this.getBackend(t);if("none"===s&&!pc.offline)throw Error("no file server configured");return{url:s,apiKey:e}}async uploadSnapshot(t,e,s=null){await this.hashSnapshot(t);const n=Tt.begin("snapshot"),i=JSON.stringify(t),o=Tt.end("snapshot")-n;pc.snapshot&&console.log(this.id,`snapshot stringified (${i.length} bytes) in ${Math.ceil(o)}ms`);const{time:r,seq:a,hash:l}=t.meta,c=this.connection.socket;try{const t=await this.uploadEncrypted({content:i,path:this.snapshotPath(r,a,l),key:this.key,gzip:!0,debug:pc.snapshot,what:"snapshot"});return this.connection.socket!==c?(console.warn(this.id,"Controller was reset while trying to upload snapshot"),!1):(this.announceSnapshotUrl(r,a,l,t,e,s),!0)}catch(t){return console.error(this.id,"Failed to upload snapshot"),!1}}announceSnapshotUrl(t,e,s,n,i,o){if(pc.snapshot){let i=`time: ${t}, seq: ${e}, hash: ${s}`;o&&(i+=", as dissident; "+JSON.stringify(o)),console.log(this.id,`sending snapshot url to ${vc} (${i}): ${n}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SNAP",args:{time:t,seq:e,hash:s,url:n,auditStats:i,dissident:o}}))}catch(t){console.error("ERROR while sending",t)}this.diverged&&this.vm.publishFromView("__VM__","__diverged__",{key:`@${t}#${e}`,url:n,dissident:o})}async diffDivergedSnapshots(t){const e=await Promise.all(t.map((t=>this.downloadEncrypted({url:t,gzip:!0,key:this.key,debug:pc.snapshot,json:!0,what:"diverged snapshot"}))));for(const t of e)delete t.meta;let s=0;!function t(e,n,i){if(typeof e!=typeof n)console.log(`${i} diverged (${typeof e} vs ${typeof n}):`,e,n),s++;else if(Array.isArray(e)!==Array.isArray(n))console.log(`${i} diverged (array vs object):`,e,n),s++;else if("object"==typeof e){const o=e?Object.keys(e):[],r=n?Object.keys(n):[],a=o.filter((t=>!r.includes(t))),l=r.filter((t=>!o.includes(t)));(a.length||l.length)&&(console.log(`${i} diverged (keys mismatch):`,a,l),s++);for(const s of o)r.includes(s)&&t(e[s],n[s],`${i}${Oc(e,s)}`)}else e!==n&&(console.log(`${i} diverged (value mismatch):`,e,n),s++)}(e[0],e[1],"CROQUETVM"),s?console.log(`Total ${s} differences between diverged snapshots:`,e.slice(0,2)):console.log("... but diverged snapshots are identical?!")}async downloadEncrypted({url:t,gzip:e,key:s,debug:n,json:i,what:o}){t.startsWith(hc)&&(t=t.replace(hc,uc));const r=t.startsWith("offline:"),a=r?1:3;let l=Date.now();const c=await this.fetchWithRetries(`fetching ${o}`,[],a,(()=>r?this.fetchOffline(t,o,n):fetch(t,{method:"GET",mode:"cors",referrer:qt.referrerURL()}))),d=await c.arrayBuffer();n&&console.log(this.id,`${o} fetched (${d.byteLength} bytes) in ${-l+(l=Date.now())}ms`),Tt.addNetworkTraffic(`${o}_in`,d.byteLength);const h=this.decryptBinary(d,s);n&&console.log(this.id,`${o} decrypted (${h.length} bytes) in ${-l+(l=Date.now())}ms`);const u=e?ec.inflate(h):h;return n&&e&&console.log(this.id,`${o} inflated (${u.length} bytes) in ${-l+(l=Date.now())}ms`),i?JSON.parse((new TextDecoder).decode(u)):u}async fetchOffline(t,e,s){const n=++Wc;return new Promise(((i,o)=>{const r=dc?"addListener":"addEventListener",a=dc?"removeListener":"removeEventListener";Tc.postMessage({job:n,cmd:"getOfflineFile",url:t,id:this.id,what:e,debug:s,offline:pc.offline});const l=t=>{if(n!==t.data.job)return;const{ok:s,status:r,statusText:c,body:d,bytes:h}=t.data;Tt.addNetworkTraffic(`${e}_out`,h),Tc[a]("message",l),s?i({arrayBuffer:()=>d}):o(Error(`${r}: ${c}`))};try{Tc[r]("message",l)}catch(t){console.log("failed to add listener",t)}}))}async uploadEncrypted({content:t,path:e,key:s,gzip:n,keep:i,debug:o,what:r}){const a="string"==typeof t?(new TextEncoder).encode(t).buffer:t,l=i?void 0:[a],c="string"==typeof s?s:oo.stringify(s),{apiKey:d,appId:h,persistentId:u}=this.sessionSpec,m=++Wc;return new Promise(((t,s)=>{const i=dc?"addListener":"addEventListener",p=dc?"removeListener":"removeEventListener";Tc.postMessage({job:m,cmd:"uploadEncrypted",server:this.uploadServer(d),path:e,buffer:a,keyBase64:c,gzip:n,referrer:qt.referrerURL(),id:this.id,appId:h,persistentId:u,CROQUET_VERSION:cc,debug:o,what:r,offline:pc.offline},l);const f=e=>{if(m!==e.data.job)return;const{url:n,ok:i,status:o,statusText:a,bytes:l}=e.data;Tt.addNetworkTraffic(`${r}_out`,l),Tc[p]("message",f),i?t(n):s(Error(`${o}: ${a}`))};try{Tc[i]("message",f)}catch(t){console.log("failed to add listener",t)}}))}persistentPath(t){const{appId:e,persistentId:s}=this.sessionSpec;return`apps/${e}/${s}/save/${t}`}pollForPersist(t,e,s,n,i){if(!this.synced)return;if(!this.sessionSpec.appId)throw Error("Persistence API requires appId");if(pc.offline)return;const o={viewId:this.viewId,hash:n,ms:i+.001*Math.random()},r={persistTime:e,persistentHash:n,persistentString:s};pc.snapshot&&console.log(this.id,`sending persistence vote for time @${e}`,o),this.sendTutti({time:t,topic:"persist",data:o,localContext:r,tallyTarget:["handlePersistVote"]})}async handlePersistVote(t){const{tally:e,localContext:s}=t;if(pc.snapshot){const t=!!s?`for time @${s.persistTime}`:"that we didn't participate in";console.log(this.id,`received persistence vote ${t}`,e)}const{numberOfGroups:n,shouldUpload:i,dissidentFlag:o}=this.analyzeTally(e,"ms");if(n>1&&console.warn(this.id,`Persistence records fall into ${n} groups`),!i||!s)return;const{persistTime:r,persistentHash:a,persistentString:l}=s;this.doPersist(r,l,a,o)}async doPersist(t,e,s,n){const i=await this.uploadEncrypted({path:this.persistentPath(s),content:e,key:this.key,gzip:!0,debug:pc.snapshot,what:"persistence"});if(pc.snapshot){const t=n?` (as dissident; ${JSON.stringify(n)})`:"";console.log(this.id,`sending persistent data url to ${vc}${t}: ${i}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SAVE",args:{persistTime:t,url:i,dissident:n}}))}catch(t){console.error("ERROR while sending",t)}}async forcePersist(t,e,s){this.didForcePersist?console.warn(this.id,"forcePersist called more than once, ignoring"):(console.warn(this.id,`forcePersist, will upload ${e.length} bytes`),"alert"===h.forcePersist&&confirm("forcePersist triggered. Do it?"),await this.doPersist(t,e,s),console.warn(this.id,"forcePersist completed"),this.didForcePersist=!0)}convertReflectorMessage(t){let e="noop",s=[];switch(t[2].what){case"users":{const{joined:n,left:i,active:o,total:r}=t[2];this.users=o,this.usersTotal=r;const a="__VM__",l="__peers__",c={entered:n||[],exited:i||[],count:o,total:r};for(const t of c.entered.concat(c.exited))t.data&&(t.data=this.decryptPayload(t.data));e="publishFromModelOnly",s=[a,l,c],se.handleEvent(this.viewId+":__views__",c.count);break}case"tally":{const{tuttiSeq:n,tuttiKey:i,tally:o,tallyTarget:r,missingClients:a}=t[2];(pc.messages||pc.snapshot)&&a&&console.log(`${a} ${1===a?"client":"clients"} failed to participate in tally ${i||n}`),e="handleTuttiResult",s=[{tuttiSeq:n,tuttiKey:i,tally:o,tallyTarget:r}];break}case"audit":{const n=t[0];pc.messages&&console.log(`audit request at time ${n}`),e="handleAuditRequest",s=[{time:n}];break}}const n=new Ld(0,0,"_",e,s);t[2]=n.asState()[2]}handleTuttiResult(t){const{tuttiSeq:e,tuttiKey:s,tally:n,tallyTarget:i}=t,o=s?t=>t.tuttiKey===s:t=>t.dummyTuttiSeq===e,r=this.tuttiHistory.findIndex(o),a=-1!==r&&this.tuttiHistory.splice(r,1)[0];let l=null,c=null;if(a&&(l=a.payload,c=a.localContext),i){const[t,...e]=i,s=[...e,{tally:n,localPayload:l,localContext:c}],o=new Ld(0,0,"_",t,s);this.vm.verifyExternal(o),o.executeOn(this.vm,!0)}}handleAuditRequest(t){const{time:e}=t;this.vm.time!==e&&console.error(`time ${this.vm.time} cf audit time ${e}`);const{auditStats:s}=this,{lastUsers:n,minUsers:i,maxUsers:o,payloadTally:r,sessionTimeAtDispatch:a}=s;if(s.payloadTally=0,this.vm.time>a&&(s.minUsers=s.maxUsers=n),!this.fastForwardHandler){const t=Tt.networkTraffic.audit_reflector_in||0,s=Tt.networkTraffic.audit_reflector_out||0;Tt.resetAuditStats();const{clientId:a}=this.connection.socket;queueMicrotask((()=>{pc.session&&console.log(this.id,`handling audit request at ${e} after ${t} bytes in, ${s} out`);const l=encodeURIComponent(JSON.stringify({time:e,clientId:a,lastUsers:n,minUsers:i,maxUsers:o,payloadTally:r,bytesIn:t,bytesOut:s})),c=`${Zc}/clients/report?session=${this.id}&stats=${l}`.replace("ws","http");fetch(c,{mode:"no-cors"})}))}}handleUserTotalForAccounting(t){if(wc){const{auditStats:e}=this;if(e.lastUsers=t,this.vm.time<=e.sessionTimeAtDispatch)return;(-1===e.minUsers||t<e.minUsers)&&(e.minUsers=t),t>e.maxUsers&&(e.maxUsers=t)}}messageSizeForAccounting(t){let e="string"==typeof t[2]?t[2].length:t[2]._size||0;return e+=16,e}async receive(t,e){const s=this.lastReceived;switch(this.lastReceived=this.connection.lastReceived,t){case"SYNC":{this.syncReceived=!0,this.clearSyncReceiptTimeout(),Cc.add(this);const{progressReporter:t}=this.sessionSpec,s=t||(()=>{}),{messages:n,url:i,persisted:o,time:r,seq:a,snapshotSeq:l,tove:c,reflector:d,flags:h,auditStatsInitializer:u}=e;if(c&&c!==this.tove)try{if(this.decrypt(c)!==this.id)throw Error("wrong sessionId in tove?!")}catch(t){return this.connection.closeConnectionWithError("SYNC",Error(`session password check: ${t.message}`),4200),void s(-1)}const m=e.timeline;this.flags=h||{};const p=o?"persistence":"snapshot";pc.session&&console.log(this.id,`received SYNC from ${d} ${vc}: time ${r}, ${n.length} messages, ${p} ${i||"<none>"}`);let f=!!this.vm,b=null;if(f){this.networkQueue.length=0;const t=!!m&&m===this.timeline,e=n[0],s=a,i=void 0!==l?l:e?e[1]:s;pc.messages&&console.log(this.id,`rejoin: we have #${this.vm.seq} SYNC has #${i}-#${s}`);let o=t&&Xd(i,this.vm.seq)&&Xd(this.vm.seq,s)&&r>=this.reflectorTime;if(o){let t=0;e&&Xd(e[1],this.vm.seq)&&(t=this.vm.seq-e[1]+1>>>0);for(let e=t;o&&e<n.length;e++){const t=n[e][2];"string"!=typeof t&&"users"===t.what&&t.left&&t.left.includes(this.viewId)&&(pc.session&&console.log(this.id,`${vc} reports that this view has left`),o=!1)}o&&t&&(pc.messages&&console.log(this.id,`rejoin: discarding ${t} messages #${e[1]}-#${this.vm.seq}`),n.splice(0,t))}o?this.sendBuffer.length>0&&(b=this.sendBuffer,this.sendBuffer=[]):(pc.session&&console.log(this.id,"cannot rejoin seamlessly; rebooting model/view"),this.leave(!0),f=!1)}const y=this.networkQueue;this.networkQueue=[];for(const t of n){const e=this.messageSizeForAccounting(t);if("string"!=typeof t[2])this.convertReflectorMessage(t);else try{t[2]=this.decryptPayload(t[2])[0]}catch(t){return this.connection.closeConnectionWithError("SYNC",Error(`session password decrypt: ${t.message}`),4200),void s(-1)}pc.messages&&console.log(this.id,"received in SYNC "+JSON.stringify(t)),this.networkQueue.push([t,e])}if(this.networkQueue.push(...y),r>this.reflectorTime&&this.timeFromReflector(r,"reflector"),f){if(pc.session&&console.log(this.id,"seamless rejoin successful"),this.syncCompleted=!0,b){pc.session&&console.log(this.id,`rejoin: sending ${b.length} messages buffered while disconnected`);for(const t of b)t()}return}let g;if(this.timeline=m||"",pc.snapshot&&i&&console.log(this.id,`fetching ${p} ${i}`),i)try{g=await this.downloadEncrypted({url:i,gzip:!0,key:this.key,debug:pc.snapshot,json:!0,what:p})}catch(t){return this.connection.closeConnectionWithError("SYNC",Error(`failed to fetch ${p}: ${t.message}`),4200),void s(-1)}if(!this.connected)return console.log(this.id,"disconnected during SYNC"),void s(-1);if(o){if(this.migratingOldSnapshot)throw Error("hashOverride is enabled but got persisted data instead of snapshot");this.install(g)}else g&&(this.sessionSpec.snapshot=g),this.install();u&&(pc.session&&console.log(this.id,`installing audit stats: ${JSON.stringify(u)}`),this.auditStats=u),pc.session&&console.log(this.id,`fast-forwarding from ${Math.round(this.vm.time)} to at least ${r}`);const w=this.vm.time,Z=await new Promise((t=>{const{port1:e,port2:n}=new MessageChannel;e.onmessage=()=>{let e=!0;if(this.vm)if(this.vm.time===this.reflectorTime)this.viewId in this.vm.views&&(s(1),t(!0),e=!1);else{const t=(this.vm.time-w)/(this.reflectorTime-w);s(t)}else pc.session&&console.log(this.id,"disconnected during SYNC fast-forwarding"),s(-1),t(!1),e=!1;e&&this.stepSession("fastForward",{budget:Lc})};this.fastForwardHandler=e=>{this.connected&&this.vm?"error"===e?(s(-1),t(!1)):n.postMessage("tick"):(console.log(this.id,"disconnected during SYNC fast-forwarding"),s(-1),t(!1))},queueMicrotask((()=>this.stepSession("fastForward",{budget:Lc})))}));return delete this.fastForwardHandler,void(Z&&(pc.session&&console.log(this.id,`fast-forwarded to ${Math.round(this.vm.time)}`),this.vm.diverged&&qt.showMessage(`${qt.libName}: session had diverged. Try CROQUETVM.debugDiverged()`,{level:"warning",only:"once"}),this.sessionSpec.sessionJoined()))}case"RECV":{const t=e;t[1]>>>=0;const s=this.messageSizeForAccounting(t);if("string"!=typeof t[2])pc.messages&&console.log(this.id,"received META "+JSON.stringify(t)),this.convertReflectorMessage(t),pc.messages&&console.log(this.id,"converted to "+JSON.stringify(t));else try{const[e,s,n]=this.decryptPayload(t[2]);t[2]=e,s===this.viewId&&this.addToStatistics(n,this.lastReceived),pc.messages&&console.log(this.id,"received "+JSON.stringify(t))}catch(t){return void this.connection.closeConnectionWithError("RECV",Error(`session password decrypt: ${t.message}`),4200)}let n;return this.networkQueue.push([t,s]),this.flags.rawtime&&(n=t[t.length-1]),this.timeFromReflector(t[0],"reflector",n),void(this.simulateIfNeeded&&queueMicrotask((()=>this.simulateIfNeeded())))}case"TICK":{if(!this.vm)return;const t="number"==typeof e?e:e.time;if(pc.ticks){const e=s&&this.lastReceived-s-this.msPerTick*this.tickMultiplier|0,n=t-this.vm.time;console.log(this.id,`received TICK ${t} ${Math.abs(e)<5?"on time":e<0?"early":"late"} (${n} ms, jitter ${e>0?"+":""}${e} ms)`)}return this.timeFromReflector(t,"reflector"),this.tickMultiplier>1&&this.multiplyTick(t),void(this.simulateIfNeeded&&queueMicrotask((()=>this.simulateIfNeeded())))}case"INFO":{const{msg:t,options:s}=e,n=wc?"Multisynq Synchronizer":"Croquet Reflector";return void qt.showMessage(`${n}: ${t}`,s)}case"REQU":return pc.snapshot&&console.log(`received REQU (snapshot request) from ${vc}`),void(this.reflectorNeedsSnapshot=!0);case"RECONNECT":this.connection.socket?.synchronizerDisconnected(4003,"told to reconnect");break;default:console.warn("Unknown action:",t,e)}}install(t){const e=Date.now(),{snapshot:s,initFn:n,options:i,debugEvents:o}=this.sessionSpec,[r,a]=s.models?["deserializ","snapshot"]:["initializ","root model"];pc.session&&console.log(this.id,`${r}ing ${a}`);let l=new Zd(s,o,(()=>{try{return n(i,t)}catch(t){throw Ht("init",t,"fatal"),t}}),this.migratingOldSnapshot);if((pc.session||pc.snapshot&&s.models)&&console.log(this.id,`${a} ${r}ed in ${Date.now()-e}ms`),pc.initsnapshot&&!s.models){pc.snapshot&&console.log(this.id,"exercising snapshot and restore after init()");let t=null;try{t=JSON.stringify(l.snapshot())}catch(t){throw Ht("initial snapshot",t,"fatal"),t}try{l=new Zd(JSON.parse(t),o,(()=>n(i)))}catch(t){throw Ht("initial snapshot resume",t,"fatal"),t}}const c=this.lastKnownTime(l);this.reflectorTime=Math.max(this.reflectorTime,c),this.setVM(l)}setVM(t){this.vm=t,this.vm.controller=this}sendJoin(){this.syncReceived=!1,this.syncCompleted=!1,delete this.fastForwardHandler,this.rejoinTimeout&&(clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0),pc.session&&console.log(this.id,"Controller sending JOIN");const{tick:t,delay:e}=this.getTickAndMultiplier(),{name:s,codeHash:n,appId:i,apiKey:o,persistentId:r,developerId:a,heraldUrl:l,rejoinLimit:c,autoSleep:d,computedCodeHash:h,location:u,flags:m}=this.sessionSpec,p=wc?"hiddenName":s,f=wc?"hiddenApiKey":this.getBackend(o).apiKey,b=wc?"hiddenAppId":i,y=wc?"hiddenUrl":qt.referrerURL(),g=this.viewDataEncrypted?{id:this.viewId,data:this.viewDataEncrypted}:u?[this.viewId]:this.viewId,w={name:p,apiKey:f,appId:b,url:y,persistentId:r,sdk:cc,developerId:a,version:1,user:g,location:u,ticks:{tick:t,delay:e},dormantDelay:d,tove:this.tove,codeHash:n};l&&Object.assign(w,{heraldUrl:l}),c&&Object.assign(w,{leaveDelay:c+250}),h!==n&&Object.assign(w,{computedCodeHash:h}),m&&Object.assign(w,{flags:m}),this.connection.send(JSON.stringify({id:this.id,action:"JOIN",args:w})),this.syncReceiptTimeout=setTimeout((()=>{delete this.syncReceiptTimeout,this.syncReceived||this.connection.closeConnectionWithError("JOIN",Error("Initial reflector connection timed out"))}),5e3)}clearSyncReceiptTimeout(){this.syncReceiptTimeout&&(clearTimeout(this.syncReceiptTimeout),delete this.syncReceiptTimeout)}connectionInterrupted(){this.syncReceived&&(this.shouldLeaveWhenDisconnected?this.leave():this.rejoinTimeout||(this.rejoinTimeout=setTimeout((()=>{this.leaving?pc.session&&console.log(this.id,"abandoning rejoin; session is defunct"):(pc.session&&console.log(this.id,"rejoin timed out"),this.rejoinTimeout=0,this.leave())}),this.sessionSpec.rejoinLimit)))}leave(t=!1){const{rebootModelView:e}=this.sessionSpec;if(this.reset(),pc.session&&console.log(this.id,`resetting ${t?"(but keeping)":"and discarding"} controller`),t||Cc.delete(this),!this.sessionSpec)throw Error("do not discard sessionSpec!");e()}async encrypt(t){const e=z.random(16),s=Io.encrypt(t,this.key,{iv:e}),n=Yo(t,this.key);return`${oo.stringify(e)}${oo.stringify(n)}${s}`}get deprecatedDefaultKey(){return Gc||(Gc=go("THIS SHOULDN'T BE IN LOGS","",{keySize:8,hasher:ro.algo.SHA1,iterations:1})),Gc}decrypt(t,e=this.key){const s=oo.parse(t.slice(0,24)),n=oo.parse(t.slice(24,68)),i=t.slice(68),o=Io.decrypt(i,e,{iv:s});let r="";try{r=ho.stringify(o)}catch(t){}const a=Yo(r,this.key);if(this.compareHmacs(n.words,a.words))return r;if(e!==this.deprecatedDefaultKey)return this.decrypt(t,this.deprecatedDefaultKey);throw Error("Decryption error")}decryptBinary(t,e){const s=(new TextDecoder).decode(new Uint8Array(t,0,4));let n,i,o,r,a;switch("string"==typeof e&&(e=oo.parse(e)),s){case"CRQ0":n=(new TextDecoder).decode(t),i=oo.parse(n.slice(4,28)),o=oo.parse(n.slice(28,72)),r=n.slice(72),a=Io.decrypt(r,e,{iv:i});break;case"CRQ1":n=new Uint8Array(t),i=z.create(n.subarray(4,20)),o=z.create(n.subarray(20,52)),r=z.create(n.subarray(52)),a=Io.decrypt({ciphertext:r},e,{iv:i});break;default:throw Error(`${this.id} unknown encryption version ${s}`)}a.clamp();const l=Yo(a,e);if(this.compareHmacs(o.words,l.words))return U(a);if(e!==this.deprecatedDefaultKey)return this.decryptBinary(t,this.deprecatedDefaultKey);throw Error("Decryption error")}async encryptMessage(t,e,s){const[n,i,o]=t.asState();return[n,i,await this.encryptPayload([o,e,s])]}async encryptPayload(t){return this.encrypt(JSON.stringify(t))}decryptPayload(t){return JSON.parse(this.decrypt(t))}compareHmacs(t,e){let s=t.length===e.length;for(let n=0;n<t.length;n++)t[n]!==e[n]&&(s=!1);return s}sendMessage(t){if(this.viewOnly||!this.vm)return;const e=t.asState()[2].length;if(e>16384)return void console.warn(this.id,`Message with payload of ${e} bytes exceeds maximum 16384 and will not be sent to ${vc}.`);!this.payloadSizeWarned&&e>Sc&&(console.log(this.id,`Message with payload of ${e} bytes being sent to ${vc}. Maximum recommended is 4096.`),this.payloadSizeWarned=!0);const s=Date.now(),n=this.rateLimitedSendTimes,i=this.rateLimitBuffer;if(Tt.perSecondTally({requestedMessages:1}),i.length)return void this.addToRateLimitBuffer(t);let o=0;if(n.length&&this.synced){const t=n[n.length-1],e=1e3/this.eventRateLimit-(s-t);e>1&&(o=Math.ceil(e))}o?(this.addToRateLimitBuffer(t),setTimeout((()=>this.serviceRateLimitBuffer()),o)):(this.recordRateLimitedSend(s),this.socketSendMessage(t),Tt.perSecondTally({sentSingleMessages:1,sentMessagesTotal:1,sentPayloadTotal:e}))}recordRateLimitedSend(t){const e=this.rateLimitedSendTimes;!this.synced&&e.length&&e[e.length-1]===t||(e.push(t),e.length>this.eventHistoryLimit&&e.shift()),!this.rateLimitSoftWarned&&e.length===this.eventHistoryLimit&&t-e[0]<1010&&(console.warn(this.id,`Sends to ${vc} are at or above recommended limit of ${this.eventHistoryLimit} within one second. Events will be bundled as necessary to keep to the limit.`),this.rateLimitSoftWarned=!0)}addToRateLimitBuffer(t){Tt.perSecondTally({bundledMessages:1});const e=Date.now(),s=t.asState(),n=s[2].length,i=this.rateLimitBuffer;if(i.length){const t=i[i.length-1],{msgStates:o,totalPayload:r}=t;if(r<Sc)return o.push({msgState:s,bufferTime:e}),void(t.totalPayload+=n)}Tt.perSecondTally({newBundles:1}),i.push({msgStates:[{msgState:s,bufferTime:e}],totalPayload:n});const o=i.length;pc.session&&o%5==0&&o!==this.rateLimitLastLogged&&(console.log(this.id,`SEND rate-limit buffer grew to ${o} event bundles (max ${this.eventMaxBundles})`),this.rateLimitLastLogged=o),o>this.eventMaxBundles?(console.error(this.id,"Disconnecting after overflow of SEND rate-limit buffer."),this.connection.closeConnectionWithError("SEND",Error("Send rate exceeded"),4200)):!this.rateLimitBufferWarned&&o>this.eventMaxBundles/2&&(console.warn(this.id,"SEND rate-limit buffer is 50% full. If send rate does not drop, the app will be disconnected."),this.rateLimitBufferWarned=!0)}serviceRateLimitBuffer(){if(!this.connected)return;const t=this.rateLimitBuffer;if(!t.length)return;const e=Date.now(),s=1e3/this.eventRateLimit,n=this.rateLimitedSendTimes;if(n.length){const t=n[n.length-1];if(s-(e-t)>0)return}const i=t.shift(),{msgStates:o,totalPayload:r}=i,a=[];let l=0;if(o.forEach((t=>{a.push(t.msgState),l+=e-t.bufferTime})),1===a.length){const t=Ld.fromState(a[0],this.vm);this.socketSendMessage(t)}else{const t=new Ld(this.vm.time,0,"_","handleBundledEvents",[a]);this.socketSendMessage(t)}if(this.recordRateLimitedSend(e),Tt.perSecondTally({sentBundles:1,sentMessagesTotal:o.length,sendDelay:l,sentBundlePayload:r,sentPayloadTotal:r}),pc.session&&this.connected){const e=t.length;e&&e%5==0&&e!==this.rateLimitLastLogged&&(console.log(this.id,`SEND rate-limit buffer dropped to ${e} event bundles`),this.rateLimitLastLogged=e)}t.length&&setTimeout((()=>this.serviceRateLimitBuffer()),s)}async socketSendMessage(t,e=null){const s=await this.encryptMessage(t,this.viewId,Date.now()),n=pc.sends&&(e?`tagged SEND ${t.asState()} with tags ${JSON.stringify(e)}`:`SEND ${t.asState()}`);if(!this.connected||!this.syncCompleted)return void(this.vm&&(pc.sends&&console.log(this.id,`buffering ${n}`),this.sendBuffer.push((()=>this.socketSendMessage(t,e)))));pc.sends&&console.log(this.id,`sending ${n}`);const i={id:this.id,action:"SEND",args:[...s,this.latency]};e&&(i.tags=e),this.lastSent=Date.now(),this.connection.send(JSON.stringify(i))}async sendTagged(t,e){this.viewOnly||this.socketSendMessage(t,e)}async sendTutti({time:t,topic:e,data:s,localContext:n=null,firstMessage:i=null,wantsVote:o=!0,tallyTarget:r=null}){if(this.viewOnly)return;const a=i&&await this.encryptMessage(i,this.viewId,Date.now()),l=V(s);if(!this.connected||!this.syncCompleted)return void(this.vm&&(pc.sends&&console.log(this.id,`buffering "${e}" TUTTI ${l} ${i&&i.asState()}`),this.sendBuffer.push((()=>this.sendTutti({time:t,topic:e,data:s,localContext:n,firstMessage:i,wantsVote:o,tallyTarget:r})))));pc.sends&&console.log(this.id,`sending "${e}" TUTTI ${l} ${i&&i.asState()}`),this.lastSent=Date.now();const c=`${e}@${t}`;this.connection.send(JSON.stringify({id:this.id,action:"TUTTI",args:[t,0,l,a,o,r,c]})),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.tuttiHistory.push({time:t,tuttiKey:c,dummyTuttiSeq:0,payload:l,localContext:n})}sendLog(...t){this.connected&&this.syncCompleted?(pc.sends&&console.log(this.id,"sending LOG"),t.length<2&&(t=t[0]),this.connection.send(JSON.stringify({action:"LOG",args:t}))):this.vm&&(pc.sends&&console.log(this.id,"buffering LOG"),this.sendBuffer.push((()=>this.sendLog(...t))))}addToStatistics(t,e){this.latency=e-t,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:e,ms:this.latency}))}get latencies(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}getTickAndMultiplier(){const t=this.sessionSpec.options,e=["number","string"].includes(typeof t.tps)?t.tps:["number","string"].includes(typeof this.sessionSpec.tps)?this.sessionSpec.tps:20,[s,n]=(e+"x").split("x").map((t=>Number.parseFloat("0"+t))),i=1e3/Math.max(1/30,Math.min(60,s)),o=Math.max(1,n);let r=i,a=0;return o>1&&!Xc&&(r=i/o,a=Math.ceil(r*(o-1))),{msPerTick:r,multiplier:o,tick:i,delay:a}}simulate(t){if(!this.vm)return!0;try{let e=!0;if(this.networkQueue.length+this.vm.messages.size===0)e=this.vm.advanceTo(this.reflectorTime,t);else{const s=Tt.begin("simulate");for(;e;){const s=this.networkQueue[0];if(!s)break;const[n,i]=s;if(e=this.vm.advanceTo(n[0],t),!e)break;this.networkQueue.shift(),wc&&(this.auditStats.payloadTally+=i);const o=this.vm.scheduleExternalMessage(n);e=this.vm.advanceTo(o.time,t),this.cpuTime+=5}e&&(e=this.vm.advanceTo(this.reflectorTime,t)),this.cpuTime+=Math.max(.01,Tt.end("simulate")-s)}Tt.backlog(this.backlog);const s=this.lag,n=Math.max(200,.1*this.msPerTick),i=Math.max(2e3,.2*this.msPerTick);if("boolean"==typeof this.synced&&this.viewed&&(this.synced&&s>i||!this.synced&&s<n)){!this.synced?this.syncTimer||(this.syncTimer=setTimeout((()=>{delete this.syncTimer,this.connected&&this.lag<n&&this.applySyncChange(!0)}),200)):this.applySyncChange(!1)}if(!pc.offline)if(this.synced&&e&&this.vm.time-this.lastSnapshotRequest>5e3){let t=!1;this.cpuTime>5e3?(pc.snapshot&&console.log(this.id,`due for snapshot: cpuTime is ${Math.round(this.cpuTime)}ms`),t=!0):wc&&this.vm.time-this.vm.lastSnapshotPoll>3e5&&(pc.snapshot&&console.log(this.id,`due for snapshot: time since last is ${this.vm.time-this.vm.lastSnapshotPoll}ms`),t=!0),t&&(this.lastSnapshotRequest=this.vm.time,this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,this.isBeingAnimated()?setTimeout((()=>this.scheduleSnapshot()),Math.floor(2e3*Math.random())):this.scheduleSnapshot())}else this.reflectorNeedsSnapshot&&(this.triggeringCpuTime=this.synced?this.cpuTime:12345,this.scheduleSnapshot(!0),this.reflectorNeedsSnapshot=!1);return e}catch(t){return Ht("simulate",t),this.connection.closeConnectionWithError("simulate",t),"error"}}stepSession(t,e={}){const s=Tt.stepSession(e.frameTime,!0);s&&console.log(s);const{backlog:n,latency:i,starvation:o,activity:r}=this;if("animation"===t){Tt.animationFrame(e.frameTime,{backlog:n,starvation:o,latency:i,activity:r,users:this.users});const t=Date.now();if(this.lastAnimationEnd){const e=t-this.lastAnimationEnd;if(!0===this.animationGapCheck&&e>200&&(this.animationGapCheck=[],pc.session&&console.log(this.id,"animation has stopped (too long between steps)")),!0!==this.animationGapCheck){const t=this.animationGapCheck;t.push(e),t.length>4&&t.shift(),4===t.length&&t.reduce(((t,e)=>t+e),0)<=400&&(this.animationGapCheck=!0,pc.session&&console.log(this.id,"animation has started"))}}this.lastAnimationEnd=t}if(!this.connected)return void(this.isInBackground()||this.checkForConnection(!0));if(!this.vm)return;let a;switch(t){case"animation":{const t=e.expectedSimFPS,s=Date.now(),n=xc.reduce(((t,e)=>t+e),0)/xc.length;if(a=this.simulate(s+Math.min(n,Lc)),!1===a){const e=0===t?0:1e3/t*4;this.backlog>e&&(a=this.simulate(s+Lc-n))}"error"!==a&&(xc.push(Date.now()-s),xc.length>4&&xc.shift());break}case"fastForward":case"background":a=this.simulate(Date.now()+e.budget);break;default:console.warn(t)}this.fastForwardHandler&&this.fastForwardHandler(a),"error"!==a&&(Tt.begin("update"),this.processModelViewEvents("animation"===t),Tt.end("update"),this.vm&&(this.serviceRateLimitBuffer(),"animation"===t&&(e.view&&(Tt.begin("render"),this.inViewRealm((()=>e.view.update(e.frameTime))),Tt.end("render")),this.lastAnimationEnd=Date.now())))}applySyncChange(t){pc.session&&console.log(this.id,`synced=${t}`),this.synced=t,qt.showSyncWait(!t),this.vm.publishFromView(this.viewId,"synced",t)}inViewRealm(t){return ce(this.vm,(()=>t(this.vm)))}processModelViewEvents(t){return this.vm?this.vm.processModelViewEvents(t):0}timeFromReflector(t,e,s){t<this.reflectorTime?("controller"!==e||pc.ticks)&&console.warn(`time is ${this.reflectorTime}, ignoring time ${t} from ${e}`):("boolean"!=typeof this.synced&&(this.synced=!1),this.reflectorTime=t,this.extrapolatedTimeBase=Date.now()-t,this.vm&&Tt.backlog(this.backlog),this.tickHook&&this.tickHook(t,s))}multiplyTick(t){this.localTicker&&globalThis.clearInterval(this.localTicker);const e=this.msPerTick,s=this.tickMultiplier;let n=1;this.localTicker=globalThis.setInterval((()=>{this.timeFromReflector(Math.round(t+n*e),"controller"),pc.ticks&&console.log(this.id,"Controller generate TICK "+this.reflectorTime,n),++n>=s&&(globalThis.clearInterval(this.localTicker),this.localTicker=0)}),e)}startStepping(t){const e=s=>{this.leaving||(this.isOutOfSight()||t(s),window.requestAnimationFrame(e))};window.requestAnimationFrame(e)}setUpActivityChecks(){let t=null;if(this.isOutOfSight=()=>!(dc||"hidden"!==document.visibilityState&&t),this.isBeingAnimated=()=>{const t=!0===this.animationGapCheck,e=Date.now()-this.lastAnimationEnd<200;return t&&!e&&(this.animationGapCheck=[],pc.session&&console.log(this.id,"animation has stopped (too long since last step)")),t&&e},this.isInBackground=()=>this.isOutOfSight()||!this.isBeingAnimated(),!dc){new IntersectionObserver(((e,s)=>t=e[0].isIntersecting)).observe(document.body)}const e=this.sessionSpec.autoSleep;let s;if(e){const t=1e3*e;let n=0,i=0;s=()=>{const e=Date.now();e-n<980||(n=e,this.isOutOfSight()?i?e-i>t&&(this.dormantDisconnect(),i=0):i=e:i=0)}}const n=()=>{this.leaving?i&&(clearInterval(i),i=null):this.connected&&this.vm&&(s&&s(),this.isBeingAnimated()||this.connection.keepAlive(Date.now()))};let i=setInterval(n,1e3);this.simulateIfNeeded=()=>{if(!this.isBeingAnimated()&&(n(),!this.fastForwardHandler&&this.connected)){let t=.9*this.msPerTick;e&&(t=Math.min(t,Lc));const s=this.synced?"background":"fastForward";this.stepSession(s,{budget:t})}}}toString(){return`Controller[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}}class Vc{constructor(t){this.controller=t,this.socketLastSent=0,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.reconnectDelay=0,this.missingTickThreshold=1/0}get id(){return this.controller.id}setTick(t){this.missingTickThreshold=Math.min(3*t,45e3)}get connected(){return!(!this.socket||!this.socket.isConnected())}checkForConnection(t){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!t||this.connectToReflector()}connectToReflector(){if(this.socket||this.connectHasBeenCalled)return;let t;this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1;const e=()=>{pc.session&&console.log(this.id,this.socket.constructor.name,"connected to",this.socket.url),this.reconnectDelay=0,Tt.connected(!0),this.controller.sendJoin()};if(pc.offline)t=new sc,t.isConnected=()=>t.readyState===WebSocket.OPEN;else if(wc){const{synchSpec:s,developSpec:n}=h;if(s&&n)throw Error("Cannot handle both synchSpec and developSpec options");let i="";const o=s||n;o&&(i+=`&synch=${encodeURIComponent(o)}`);const r=this.id,{persistentId:a,appId:l,developerId:c}=this.controller.sessionSpec;t=new oc(`${Zc}/clients/connect?session=${r}&persist=${a}&app=${encodeURIComponent(l)}&developer=${c}${i}`),t.isConnected=()=>"open"===t.dataChannel?.readyState,t.onconnected=e}else{let e=this.controller.getBackend(this.controller.sessionSpec.apiKey).reflector;const s=dc?void 0:window.location.href,n={},i=this.controller.sessionSpec.token;if(i&&(n.token=i),h.reflector){const t=h.reflector.toUpperCase();"CF"===t||t.match(/^[A-Z]{3}$/)?(e=pc.reflector?"wss://croquet.network/reflector/dev/":"wss://croquet.network/reflector/",3===t.length&&(n.colo=t)):h.reflector.match(/^[-a-z0-9]+$/i)?n.region=h.reflector:e=new URL(h.reflector,s).href.replace(/^http/,"ws")}if(!e.match(/^wss?:/))throw Error("Cannot interpret reflector address "+e);e.endsWith("/")||(e+="/");const o=new URL(e+this.id,s);for(const[t,e]of Object.entries(n))o.searchParams.append(t,e);t=new WebSocket(o),t.isConnected=()=>t.readyState===WebSocket.OPEN}t.onopen=s=>{const n=this.socket;n&&(n.onopen=n.onmessage=n.onerror=n.onclose=null),this.socket=t,this.connectHasBeenCalled=!1,t.twoStageConnection||e()},t.onmessage=e=>{if(t!==this.socket)return;const{data:s}=e,n="_CHUNK";if(s.startsWith(n)){const e="1"===s.charAt(6),n="1"===s.charAt(7),i=s.slice(8);if(e&&(t.chunkCollector=[]),t.chunkCollector.push(i),n){const e="".concat(...t.chunkCollector);t.chunkCollector=[],Tt.addNetworkTraffic("reflector_in",e.length,!!wc),this.receive(e)}}else Tt.addNetworkTraffic("reflector_in",s.length,!!wc),this.receive(s)},t.onerror=e=>{pc.session&&console.log(this.id,t.constructor.name,"connection error"),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout()},t.onclose=e=>{this.socket&&t!==this.socket||this.socketClosed(e.code,e.reason)}}socketClosed(t,e){pc.session&&console.log(this.id,`socketClosed with code=${t} message="${e}"`),t>=4100&&4110!==t&&(pc.session&&console.warn("resuming this session will require a new Session.join()"),this.controller.leaving||(this.controller.leaving=()=>{}),this.reconnectDelay=0);const s=!!!this.controller.leaving&&1e3!==t&&t<4100,n=4110===t;n||1e3===t||this.reconnectDelay||setTimeout((()=>{if(this.connected||this.socket?.isConnecting?.())return;const n=s?"Reconnecting":"Connection closed";qt.showMessage(`${n}: ${t} ${e}`,{level:s?"warning":"fatal"})}),500),pc.session&&console.log(this.id,`${this.socket?this.socket.constructor.name+" closed":"closed before opening,"} with code: ${t} ${e}`),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout(),Tt.connected(!1),Tt.resetAuditStats(),n?this.connectRestricted=!0:this.connectBlocked=!0,this.disconnected(),s&&(pc.session&&console.log(this.id,`reconnecting in ${this.reconnectDelay} ms`),this.reconnectTimeout=globalThis.setTimeout((()=>{delete this.reconnectTimeout,this.connectToReflector()}),this.reconnectDelay),this.reconnectDelay=Math.min(3e4,Math.round((this.reconnectDelay+100)*(1+Math.random()))))}disconnected(){this.socket&&(this.socket=null,this.lastReceived=0,this.socketLastSent=0,this.stalledSince=0,this.connectHasBeenCalled=!1,this.controller.connectionInterrupted())}send(t){this.socketLastSent=Date.now(),this.socket.send(t),Tt.addNetworkTraffic("reflector_out",t.length,!!wc)}receive(t){this.lastReceived=Date.now();const{id:e,action:s,args:n}=JSON.parse(t);if(e)try{this.controller.receive(s,n)}catch(t){this.closeConnectionWithError("receive",t)}else if("PONG"===s){if(pc.pong&&console.log("PONG after",Date.now()-n,"ms"),this.pongHook)try{this.pongHook(n)}catch(t){console.error(t)}}else console.warn("Unknown action",s)}dormantDisconnect(){this.connected&&(pc.session&&console.log(this.id,`dormant; disconnecting from ${vc}`),this.closeConnection(4110,"Going dormant"))}closeConnectionWithError(t,e,s=4e3){console.error(s,e),this.closeConnection(s,`Error in ${t}: ${e.message||e}`)}closeConnection(t,e){if(this.socket){this.socket.onclose=null;try{let s=e;s&&s.length>123&&(s=s.slice(0,123)),this.socket.close(t,s)}catch(s){console.error(`Error in socket.close(${t}, ${JSON.stringify(e)}):`,s)}}this.socketClosed(t,e)}PULSE(t){this.connected&&(0===this.socket.bufferedAmount?(this.send(JSON.stringify({action:"PULSE"})),this.stalledSince=0):this.stalledSince&&t-this.stalledSince>500?console.log(this.id,`Reflector connection stalled: ${this.socket.bufferedAmount} bytes unsent for ${t-this.stalledSince} ms`):this.stalledSince=Date.now())}keepAlive(t){0!==this.lastReceived&&(t-this.socketLastSent>25e3?this.PULSE(t):t-this.lastReceived>5e4?this.closeConnectionWithError("connection",Error((wc?"Synchronizer":"Reflector")+" has gone away")):t-this.lastReceived>this.missingTickThreshold&&this.PULSE(t))}PING(t=Date.now()){this.connected&&this.send(JSON.stringify({action:"PING",args:t}))}}globalThis.setInterval((()=>{for(const t of Cc)t.connected&&t.vm&&t.connection.keepAlive(Date.now())}),100);const Ic=Symbol("hash"),Mc=Symbol("key"),Rc=Symbol("url"),Yc=new Map;let Nc=0;function Hc(t){return h.has("debug",t,!1)}function Kc(t){return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function _c(t){return t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+3&-4,"=")}function zc(t,e){return t||(t="*"),e.replace(/[\s\S]/g,(e=>String.fromCharCode(e.charCodeAt(0)^t.charCodeAt(0))))}class Fc{async store(){throw Error("Data.store() needs to be called from session.data")}async fetch(){throw Error("Data.fetch() needs to be called from session.data")}static async store(t,e,s){if(Zd.hasCurrent())throw Error(`${qt.libName}.Data.store() called from Model code`);let n,i,o;if("string"==typeof t?(n=t,t=e,i=!0,o=s):(n=e&&e.sessionId,i=e&&e.shareable,o=e&&e.keep),!(t instanceof ArrayBuffer))throw Error(`${qt.libName}.Data.store() called with non-ArrayBuffer data`);const{appId:r,persistentId:a,key:l,uploadEncrypted:c}=kc(n),d=i?z.random(32).toString(oo):oo.stringify(l),h=`apps/${r}/${a}/data/%HASH%`,u="data#"+ ++Nc;Hc("data")&&console.log(`${qt.libName}.Data: storing ${u} ${t.byteLength} bytes`);const m=await c({path:h,content:t,key:d,keep:o,debug:Hc("data"),what:u}),p=function(t){return t.replace(/.*\//,"")}(m),f=new Ec(p,i&&d,m);return Hc("data")&&console.log(`${qt.libName}.Data: stored ${u} as ${this.toId(f)}`),f}static async fetch(t,e){let s;if(e&&e[Rc]?(s=t,t=e):s=e&&e.sessionId,Zd.hasCurrent())throw Error(`${qt.libName}.Data.fetch() called from Model code`);const{downloadEncrypted:n,key:i}=kc(s),o=t&&t[Ic],r=t&&t[Mc]||oo.stringify(i),a=t&&t[Rc];if("string"!=typeof o||"string"!=typeof r||"string"!=typeof a)throw Error(`${qt.libName}.Data.fetch() called with invalid handle`);const l="data#"+ ++Nc;return Hc("data")&&console.log(`${qt.libName}.Data: fetching ${l} ${this.toId(t)}`),n({url:a,key:r,debug:Hc("data"),what:l})}static hash(t,e="base64url"){"function"==typeof t&&(t=Function.prototype.toString.call(t)),"string"==typeof t?t=(new TextEncoder).encode(t):t&&t.constructor===DataView?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t&&t.constructor===ArrayBuffer?t=new Uint8Array(t):ArrayBuffer.isView(t)||(t=(new TextEncoder).encode(V(t)));const s=j(z.create(t));switch(e){case"hex":return s.toString();case"base64":return s.toString(oo);case"base64url":return Kc(s.toString(oo));default:throw Error(`${qt.libName}.Data: unknown hash output "${e}", expected "hex"/"base64"/"base64url"`)}}static fromId(t){const e=t.slice(0,1);let s,n,i,o;switch(e){case"0":s=t.slice(1,44),n=t.slice(44),i=`${mc}/sessiondata/${s}`;break;case"1":s=t.slice(1,44),n=t.slice(44,87)+"=",o=t.slice(87),i=`${mc}/apps/${o}/data/${s}`;break;case"2":s=t.slice(1,44),n=_c(t.slice(44,87)),o=zc(n,atob(_c(t.slice(87)))),i=`${mc}/apps/${o}/data/${s}`;break;case"3":n=_c(t.slice(1,44)),i=zc(n,atob(_c(t.slice(44)))),s=i.slice(-43);break;case"4":n=null,i=zc(n,atob(_c(t.slice(1)))),s=i.slice(-43);break;default:throw Error(`${qt.libName}.Data expected handle v0-v4 got v${e}`)}return new this(s,n,i)}static toId(t){if(!t)return"";const e=t[Ic],s=t[Mc],n=t[Rc];if(n.slice(-43)!==e)throw Error(`${qt.libName} Data: malformed URL`);const i=s&&Kc(s),o=Kc(btoa(zc(s,n)));return s?`3${i}${o}`:`4${o}`}constructor(t,e=null,s){const n=Yc.get(t);if(n)return n;if(s.slice(-43)!==t)throw Error(`${qt.libName} Data: malformed URL`);Object.defineProperty(this,Ic,{value:t}),e&&Object.defineProperty(this,Mc,{value:e}),Object.defineProperty(this,Rc,{value:s}),Yc.set(t,this)}}class Ec extends Fc{}const jc={cls:Ec,write:t=>Ec.toId(t),read:t=>Ec.fromId(t)};let Jc=null,Qc=null;const Uc=Symbol("DEBUG_WRITE_TARGET");let Dc=null;function Oc(t,e){return Array.isArray(t)||"string"!=typeof e?`[${e}]`:e.match(/^[a-z_$][a-z0-9_$]*$/i)?`.${e}`:`["${e}"]`}class Bc extends Error{}function Ac(){if(!globalThis.CroquetViewMath){globalThis.CroquetMath.random=()=>Jc.random(),globalThis.CroquetViewMath={};for(const[t,e]of Object.entries(Object.getOwnPropertyDescriptors(Math)))globalThis.CroquetViewMath[t]=e.value;for(const[s,n]of Object.entries(globalThis.CroquetMath)){const i=Math[s];Math[s]=1===n.length?t=>Jc?n(t):i(t):(t,e)=>Jc?n(t,e):i(t,e)}}if(!globalThis.CroquetViewDate){const o=globalThis.Date;let r=!1;function a(t,e){return r||(r=!0,console.warn(new Bc(`${t} used in Model code`))),e}function l(t,e,s,n,i,r,c){const d=this instanceof l,h=[t,e,s,n,i,r,c];if(h.length=arguments.length,Jc)switch(a(d?"new Date()":"Date()"),arguments.length){case 0:h.push(Jc.time);break;case 1:break;default:h[0]=o.UTC(...h),h.length=1}const u=new o(...h);return d?u:""+u}l.prototype=o.prototype,l.UTC=o.UTC,l.now=()=>Jc?a("Date.now()",Jc.time):o.now(),l.parse=(...t)=>Jc?a("Date.parse()",0):o.parse(...t),globalThis.CroquetViewDate=o,globalThis.Date=l}}Object.defineProperty(Bc.prototype,"name",{value:`${qt.libName}Warning`});const $c=Symbol("QFUNC");function qc(t,e,s,n){const i=new ed(t,e,s,n),o=i.compile();return o[$c]=i,o}function td(t,e,s,n){const i=[],o=[];let r,a,l,c;if(s){if("this"in s){for(e=s.this,r="_this";r in s;)r="_"+r;delete(s={...s,[r]:e}).this}if(l=[...Object.keys(s).sort()],c=[...l.map((t=>s[t]))],l.length){for(a="env";a in s||a===n;)a="_"+a;i.push(a),o.push(c)}}t.match(/\bCroquet\b/)&&!l?.includes("Croquet")&&(i.push("Croquet"),o.push(Hd.Croquet)),t.match(/\bMultisynq\b/)&&!l?.includes("Multisynq")&&(i.push("Multisynq"),o.push(Hd.Croquet));let d=n||"qFunc";for(;l?.includes(d);)d="_"+d;let h='"use strict"\n\n';h+="// Croquet QFunc Compiler by Codefrau\n\n",h+="//////////////// Start Compiler /////////////////\n",h+="try { const ",l?.length&&(h+=`[${l.join(", ")}] = ${a}, `);let u=t.split("\n");const m=u.slice(1),p=Math.min(...m.map((t=>t.match(/^\s*/)[0].length)));if(p>0){u.some((t=>(t.match(/`/g)||[]).length%2==1))||(u=[u[0],...m.map((t=>t.slice(p)))],t=u.join("\n"))}const f=u[u.length-1].match(/^\s*/)[0];f&&(t=f+t),h+=`${d} =\n`,h+="//////////////// Start User Code ////////////////\n\n",h+=t,h+="\n\n///////////////// End User Code /////////////////\n",h+=`return ${d}`,r&&(h+=`.bind(${r})`),h+=" } catch (compileError) { return compileError; }\n",h+="///////////////// End Compiler //////////////////";try{const t=new Function(...i,h).call(e,...o);if(t instanceof Error)throw console.warn("rethrowing error",t),t;return t}catch(e){throw console.warn(`createQFunc compiling:\n\n${t}`),Error(`createQFunc(): ${e.message}`)}}class ed{constructor(t,e,s,n){if(this.thisVal=t,this.env=e,this.selfRef=n,this.source=s,void 0===n){this.selfRef="","function"==typeof s&&(this.source=s.toString());const t=Object.keys(e);for(const n of t)if(s===e[n]){if(this.selfRef)throw Error(`createQFunc: env.${this.selfRef} and env.${n} cannot both reference the function`);this.selfRef=n}this.selfRef&&(this.env={...e},delete this.env[this.selfRef])}Object.freeze(this.env)}compile(){return td(this.source,this.thisVal,this.env,this.selfRef)}}const sd={cls:$c,write:({[$c]:{thisVal:t,env:e,source:s,selfRef:n}})=>[t,s,n,...Object.entries(e).flat()],read:([t,e,s,...n])=>{const i={};for(let t=0;t<n.length;t+=2)i[n[t]]=n[t+1];return qc(t,i,e,s)}},nd="future message",id="message in cancelFuture",od="subscription handler";function rd(t){return`qFunc~${t.split(" ")[0]}~`}const ad=rd(nd),ld=rd(od);function cd(t){return t===nd||t===od}function dd(t){return t.startsWith(ad)}function hd(t){return`${ld}${t}`}function ud(t,e){return!!t.startsWith(ld)&&t.slice(ld.length)===e}function md(t,e){if(Jc)throw Error("VirtualMachine confusion");if(!(t instanceof Zd))throw Error("not a VM: "+t);const s=Jc;try{Jc=t,globalThis.CROQUETVM=t,e()}finally{Jc=s}}const pd="#reflected",fd=["handleModelEventInModel","handleBundledEvents","publishFromModelOnly","handlePollForSnapshot","handleTuttiResult","handleTuttiDivergence","handleSnapshotVote","handlePersistVote","handleModelEventInView","noop","handleAuditRequest"],bd={};for(let t=0;t<fd.length;t++)bd[fd[t]]=t;const yd=new WeakMap;function gd(t){yd.set(t,null)}class wd{random(){throw Error("Math.random() cannot be used in Model.evaluate()")}}class Zd{static current(){return Jc||console.warn("VirtualMachine.current() called from outside the vm!"),Jc}static hasCurrent(){return!!Jc}static evaluate(t){if(Jc)return t();Ac();const e=Jc;try{return Jc=new wd,t()}finally{Jc=e}}constructor(t,e,s,n){Ac(),Qc={snapshot:h.has("debug","snapshot",!1),session:h.has("debug","session",!1),write:h.has("debug","write",!1)},gd(this),md(this,(()=>{le(this,(()=>{if(this.models={},this.namedModels={},this.messages=new to(((t,e)=>t.before(e))),this.subscriptions={},this.subscribers=new Map,this.genericSubscriptions=[],this.currentEvent="",this.currentEventFromModel=!1,this.debugEvents=e,this.views={},this._random=()=>{throw Error("You must not use random when applying state!")},this.id=t.id,this.time=0,this.seq=4294967280,this.externalTime=0,this.externalSeq=this.seq,this.futureSeq=0,this.lastSnapshotPoll=0,this.lastPersistencePoll=0,this.inPersistenceCoolOff=!1,this.persisted="",this.modelsId=0,this.diverged=null,this.controller=null,t.models){const e=Wd.newOrRecycled(this).readVM(t,"VM",n);let s=[],i=[];for(const t of Object.keys(e))"meta"!==t&&("staticInitializers"===t?s=e[t]:t in this?"_random"===t?this[t]=new S(null,{state:e[t]}):"messages"===t?i=e.messages:this[t]=e[t]:console.warn(`Ignoring property snapshot.${t}`));for(const t of s)t();for(const t of i)this.messages.add(t);for(const[t,e]of Object.entries(this.subscriptions))for(const s of e){const[e]=s.split(".");let n=this.subscribers.get(e);n||this.subscribers.set(e,n=new Set),n.add(t)}}else this._random=new S(t.id,{state:!0}),this.addSubscription(this,"__VM__","__peers__",this.generateJoinExit),this.addSubscription(this,"__VM__","__diverged__",this.handleSessionDiverged),s(this)}))}))}registerModel(t,e){if(Jc!==this)throw Error("You can only create models from model code!");return e||(e="M"+ ++this.modelsId),this.models[e]=t,e}deregisterModel(t){if(Jc!==this)throw Error("You can only destroy models from model code!");const e=this.models;delete this.models[t];for(const[t,s]of Object.entries(this.namedModels))e===s&&delete this.namedModels[t];this.messages.removeMany((e=>e.hasReceiver(t)))}lookUpModel(t){if("_"===t)return this;let e=this.models[t];if(e)return e;const[s,n,i]=t.match(/^([^#]+)#(.*)$/)||[];return e=this.models[n],e&&e.lookUp(i)}get(t){const e=this.namedModels[t];return Jc!==this&&Qc.write&&e?this.debugWriteProxy(this,e,e.id):e}set(t,e){if(Jc!==this)throw Error("You can only make a model well-known from model code!");this.namedModels[t]=e}debugWriteProxy(t,e,s){if("object"!=typeof e||null===e||e[Uc])return e;if(e instanceof Hd&&(s=e.id),!this.$debugWriteProxyHandler){function i(t,e,s){s&&(t+=` ${s} of`);const n=Dc.get(e).path;if(console.warn(`write-debug: non-model code is ${t} ${n}:`,e),s&&"$"!==s[0])throw Error(`write-debug: Attempt to modify ${qt.libName} model state from outside!`)}Dc||(Dc=new WeakMap),this.$debugWriteProxyHandler={set(e,s,n){Jc!==t?i("assigning",e,s):console.warn(`${qt.libName} debug write protection inside model - this should not happen!`),e[s]=n},deleteProperty(e,s){Jc!==t?i("deleting",e,s):console.warn(`${qt.libName} debug write protection inside model - this should not happen!`),delete e[s]},get(e,s){if(s===Uc)return e;const n=e[s];if(n&&n[Uc])return n;if(Jc!==t){if("object"==typeof n&&null!==n){const o=Dc.get(e).path;if(n instanceof Map){const e=new Map([...n.entries()].map((([e,s],n)=>[t.debugWriteProxy(t,e,`${o}.key#${n}`),t.debugWriteProxy(t,s,`${o}.value#${n}`)])));return e[Uc]=n,e.set=()=>i("setting an item in",n),e.delete=()=>i("deleting from",n),e.clear=()=>i("clearing",n),Dc.set(n,{proxy:e,path:o+Oc(n,s)}),e}if(n instanceof Set){const e=new Set([...n.values()].map(((e,s)=>t.debugWriteProxy(t,e,`${o}.item#${s}`))));return e[Uc]=n,e.add=()=>i("adding to",n),e.delete=()=>i("deleting from",n),e.clear=()=>i("clearing",n),Dc.set(n,{proxy:e,path:o+Oc(n,s)}),e}return t.debugWriteProxy(t,n,o+Oc(n,s))}}else console.warn(`${qt.libName} debug write protection inside model - this should not happen!`);return n}}}let n=Dc.get(e);return n||(n={proxy:new Proxy(e,this.$debugWriteProxyHandler),path:s},Dc.set(e,n)),n.proxy}noop(){}generateJoinExit({entered:t,exited:e,count:s,total:n}){this.controller.handleUserTotalForAccounting(n);const i={};for(const e of t){if("string"==typeof e)continue;let t,s,n;Array.isArray(e)?[t,s]=e:(t=e.id,n=e.data,s=e.location),i[t]={},n&&(i[t].data=n),s&&(s.region&&(s.country=s.region.slice(0,2),s.region=s.region.slice(2)),i[t].loc=s)}if(t=t.map((t=>"string"==typeof t?t:Array.isArray(t)?t[0]:t.id)),e=e.map((t=>"string"==typeof t?t:Array.isArray(t)?t[0]:t.id)),t.length===s){e=Object.keys(this.views);for(const t of e)this.views[t].extraConnections=0}if(t.length>0&&e.length>0&&t.some((t=>e.includes(t)))){for(let s=0;s<t.length;s++){const n=t[s],i=e.indexOf(n);i>=0&&(t.splice(s,1),e.splice(i,1),s--)}if(t.length+e.length===0)return}const o=t=>{const{data:e,loc:s}=this.views[t];if(!e)return t;const n={viewId:t,viewData:e};return s&&(n.location=s),n};for(const t of e)if(this.views[t]){if(this.views[t].extraConnections){this.views[t].extraConnections--,Qc.session&&console.log(this.id,`@${this.time}#${this.seq} view ${t} closed extra connection`);continue}const e=o(t);delete this.views[t],this.publishFromModelOnly(this.id,"view-exit",e)}else{const{time:e,seq:s}=this;console.error(`${this.id} @${e}#${s} view ${t} exited without being present - this should not happen`),Promise.resolve().then((()=>{this.controller.sendLog(`view-exit-mismatch @${e}#${s} ${t} left without being present`)}))}for(const e of t)if(this.views[e])Qc.session&&console.log(this.id,`@${this.time}#${this.seq} view ${e} opened another connection`),this.views[e].extraConnections=(this.views[e].extraConnections||0)+1;else{this.views[e]=i[e]||{};const t=o(e);this.publishFromModelOnly(this.id,"view-join",t)}const r=Object.values(this.views).reduce(((t,e)=>t+1+(e.extraConnections||0)),0);if(s!==r){const{time:t,seq:e}=this;console.error(`@${t}#${e} view count mismatch (model: ${r}, reflector: ${s}) - this should not happen`),Promise.resolve().then((()=>{this.controller.sendLog(`view-exit-mismatch @${t}#${e} connections model: ${r} reflector: ${s}`)}))}}scheduleExternalMessage(t){const e=Ld.fromState(t,this);if(e.time<this.time)throw Error("past message from reflector "+t);const s=this.externalSeq+1>>>0;if(e.seq!==s)throw Error(`External message error. Expected message #${s} got #${e.seq}`);return this.externalTime=e.time,this.externalSeq=e.seq,e.seq=2*e.seq+1,this.verifyExternal(e),this.messages.add(e),e}verifyExternal(t){if("_"!==t.receiver)throw Error(`invalid receiver in external message: ${t}`);if(!(t.selector in bd))throw Error(`unexpected external message: ${t.selector}`)}futureSend(t,e,s,n){if(t.every)return this.futureRepeat(t.every,e,s,n);if(t<0)throw Error("attempt to send future message into the past");this.futureSeq=this.futureSeq+1>>>0;const i=new Ld(this.time+t,2*this.futureSeq,e,s,n);return this.messages.add(i),{time:i.time,seq:i.seq}}cancelFuture(t,e){const s=this.messages;let n;if("number"==typeof e.time){const{time:t,seq:i}=e;n=s.removeOne((e=>e.time===t&&e.seq===i))}else{if("*"===e)return n=s.removeMany((e=>e.receiver===t.id)),n.length>0;{const i=this.asMethodName(t,e,id),o=t.id;n=s.removeOne((t=>t.receiver===o&&t.selector===i||"_"===t.receiver&&"futureExecAndRepeat"===t.selector&&t.args[1]===o&&t.args[2]===i)),dd(i)&&delete t[i]}}return void 0!==n}futureRepeat(t,e,s,n){this.futureSend(t,"_","futureExecAndRepeat",[t,e,s,n])}futureExecAndRepeat(t,e,s,n){const i=this.lookUpModel(e);if(i){if("function"==typeof i[s])try{i[s](...n)}catch(t){Ht(`future message ${i}.${s}`,t)}else{const t=this.compileFuncString(s,i);try{t(...n)}catch(e){Ht(`future message ${i} ${t}`,e)}}this.futureRepeat(t,e,s,n)}}future(t,e,s,n){if(!this.lookUpModel(t.id))throw Error(`future send to unregistered model ${t}`);if(void 0===s){const s=this;return new Proxy(t,{get:(n,i)=>(...n)=>s.future(t,e,i,n)})}const i=this.asMethodName(t,s,nd);if("string"!=typeof i)throw Error(`future message to ${t} ${i} is not a string`);if("function"!=typeof t[i]&&i.indexOf(".")<0&&"{"!==i[0])throw Error(`future send to ${t} with unknown method ${i}()`);return this.futureSend(e,t.id,i,n)}advanceTo(t,e){if(Jc)throw Error("cannot advance time from model code");let s;for(;(s=this.messages.peek())&&s.time<=t;){const{time:t,seq:n}=s;if(t<this.time)throw Error("past message encountered: "+s);if(1&n&&(this.seq=this.seq+1>>>0,n/2>>>0!==this.seq))throw Error(`Sequence error: expected ${this.seq} got ${n/2>>>0} in ${s}`);if(this.messages.poll(),this.time=s.time,s.executeOn(this),globalThis.CroquetViewDate.now()>=e)return!1}return this.time=t,!0}asMethodName(t,e,s,n=null){if("string"==typeof e)return e;if("function"==typeof e){if(t[e.name]===e)return e.name;if(e[$c]&&n){const s=hd(n);if(t[s]===e)return s}let o=t;for(;null!==o;){for(const[t,n]of Object.entries(Object.getOwnPropertyDescriptors(o)))if(n.value===e){if(e[$c]&&((i=s)!==nd&&i!==id||!dd(t)))continue;return t}if(o===t&&e[$c]){if(!cd(s))return Yt(`${s} is not a registered QFunc: ${e}`,{only:"once"}),null;let i;if(n)i=hd(n);else{const e=ad;let s=0;do{i=`${e}${s++}`}while(t[i])}return t[i]=e,i}o=Object.getPrototypeOf(o)}Yt(`${s} is not a method of ${t} and not a QFunc: ${e}\n`,{only:"once"});const r=/^\(?([a-z][a-z0-9]*)?\)? *=> *this\.([a-z][a-z0-9]*) *\( *([a-z][a-z0-9]*)? *\) *$/i,a=e.toString().match(r);return!a||a[3]&&a[3]!==a[1]?this.asFuncString(e):a[2]}var i;return null}asFuncString(t){const e=t.toString();return`{${btoa(JSON.stringify(e))}}`}compileFuncString(t,e){this.$compiledFuncs||(this.$compiledFuncs={});const s=e.id+":"+t;let n=this.$compiledFuncs[s];if(!n){const i=JSON.parse(atob(t.slice(1,-1)));n=td(i,e),i.startsWith("function")&&(n=n.bind(e)),this.$compiledFuncs[s]=n}return n}addSubscription(t,e,s,n){if(Jc!==this)throw Error("Cannot add a model subscription from outside model code");if(e.includes(":"))throw Error(`Invalid subscription scope "${e}" (must not contain ':')`);const i=e+":"+s,o=this.asMethodName(t,n,od,i);if("string"!=typeof o)throw Error(`Subscription handler for "${s}" must be a method name`);if(o.indexOf(".")<0&&"function"!=typeof t[o]&&"{"!==o[0])throw Error(`Subscriber method for "${s}" not found: ${t}.${o}()`);const r=t===this?"_":t.id,a=r+"."+o;if("*"===e||"*"===s)return void this.addGenericSubscription(i,a);if(this.subscriptions[i]){if(-1!==this.subscriptions[i].indexOf(a))throw Error(`${t}.${o} already subscribed to ${s}`)}else this.subscriptions[i]=[];this.subscriptions[i].push(a);let l=this.subscribers.get(r);l||this.subscribers.set(r,l=new Set),l.add(i)}removeSubscription(t,e,s,n="*"){if(Jc!==this)throw Error("Cannot remove a model subscription from outside model code");if("*"===e||"*"===s)return void this.removeGenericSubscription(t,e,s,n);const i=e+":"+s,o=this.subscriptions[i];if(o){const e=t.id+".";if("*"===n){for(let s=o.length-1;s>=0;s--)if(o[s].startsWith(e)){const n=o[s].slice(e.length);ud(n,i)&&delete t[n],o.splice(s,1)}0===o.length&&delete this.subscriptions[i]}else{const r=this.asMethodName(t,n,"unsubscribe argument",i);if("string"!=typeof r)throw Error(`Invalid unsubscribe args for "${s}" in ${t}: ${n}`);const a=e+r,l=o.indexOf(a);if(-1!==l&&(o.splice(l,1),0===o.length&&delete this.subscriptions[i],ud(r,i)&&delete t[r]),o.find((t=>t.startsWith(e))))return}const r=this.subscribers.get(t.id);r.delete(i),0===r.size&&this.subscribers.delete(t.id)}}addGenericSubscription(t,e){this.genericSubscriptions.push({topic:t,handler:e})}removeGenericSubscription(t,e,s,n="*"){const i=e+":"+s,o=t.id+".";for(let e=this.genericSubscriptions.length-1;e>=0;e--){const s=this.genericSubscriptions[e];s.topic===i&&s.handler.startsWith(o)&&("*"!==n&&s.handler!==o+n||(this.genericSubscriptions.splice(e,1),ud(n,i)&&delete t[n]))}}removeAllSubscriptionsFor(t){const e=this.subscribers.get(t.id);if(e){const s=t.id+".";for(const n of e){const e=this.subscriptions[n];for(let i=e.length-1;i>=0;i--)if(e[i].startsWith(s)){const o=e[i].slice(s.length);ud(o,n)&&delete t[o],e.splice(i,1)}0===e.length&&delete this.subscriptions[n]}this.subscribers.delete(t.id)}}publishFromModel(t,e,s){if(Jc!==this)throw Error("Cannot publish a model event from outside model code");if(t.includes(":"))throw Error(`Invalid publish scope "${t}" (must not contain ':')`);const n=e.endsWith(pd);n&&(e=e.slice(0,e.length-10));const i=this.currentEventFromModel;this.currentEventFromModel=!0;const o=t+":"+e;this.handleModelEventInModel(o,s,n),this.handleModelEventInView(o,s),this.currentEventFromModel=i}publishFromModelOnly(t,e,s){if(Jc!==this)throw Error("Cannot publish a model event from outside model code");const n=t+":"+e;this.handleModelEventInModel(n,s)}publishFromView(t,e,s){if(Jc)throw Error("Cannot publish a view event from model code");if(t.includes(":"))throw Error(`Invalid publish scope "${t}" (must not contain ':')`);const n=t+":"+e;this.handleViewEventInModel(n,s),this.handleViewEventInView(n,s)}handleBundledEvents(t){for(const e of t){const t=Ld.fromState(e,this);this.verifyExternal(t),t.executeOn(this,!0)}}handleModelEventInModel(t,e,s=!1){if(Jc!==this)throw Error("handleModelEventInModel called from outside model code");if(s){if(!0!==this.controller.synced)return;const s=t+"#__vote",n=t+"#divergence",i=!!se.subscriptions[s],o=!!this.subscriptions[t],r=!!this.subscriptions[n];i&&r&&console.log(`divergence subscription for ${t} overridden by vote subscription`);const a=o?new Ld(this.time,0,"_","handleModelEventInModel",[t,e]):null;let l;l=i?["handleModelEventInView",s]:["handleTuttiDivergence",n],Promise.resolve().then((()=>this.controller.sendTutti({time:this.time,topic:t,data:e,firstMessage:a,wantsVote:i,tallyTarget:l})))}else this.genericSubscriptions.length>0&&this.invokeGenericHandlers(t,e),this.subscriptions[t]&&this.invokeHandlers(this.subscriptions[t],t,e)}invokeHandlers(t,e,s){const n=t.slice();for(let i=0;i<n.length;i++){const o=n[i];(o===t[i]||t.includes(o))&&this.invokeHandler(o,e,s)}}invokeGenericHandlers(t,e){const[s,n]=t.split(":");if(!(s.startsWith("__")&&s.endsWith("__")||n.startsWith("__")&&n.endsWith("__")))for(const i of this.genericSubscriptions){const[o,r]=i.topic.split(":");("*"===o&&r===n||o===s&&"*"===r||"*"===o&&"*"===r)&&this.invokeHandler(i.handler,t,e)}}invokeHandler(t,e,s){const n=this.currentEvent;this.currentEvent=e;try{const[n,...i]=t.split("."),o=i.join("."),r=this.lookUpModel(n);if(!r)return void Yt(`event ${e} .${o}(): subscriber not found`);if("{"===o[0]){const t=this.compileFuncString(o,r);try{t(s)}catch(s){Ht(`event ${e} ${r} ${t}`,s)}return}if(o.indexOf(".")>=0){const t=o.indexOf("."),n=o.slice(0,t),i=o.slice(t+1);try{r.call(n,i,s)}catch(t){Ht(`event ${e} ${r}.call(${JSON.stringify(n)}, ${JSON.stringify(i)})`,t)}return}if("function"!=typeof r[o])return void Ht(`event ${e} ${r}.${o}(): method not found`);try{r[o](s)}catch(t){Ht(`event ${e} ${r}.${o}()`,t)}}finally{this.currentEvent=n}}handleViewEventInModel(t,e){if(this.subscriptions[t]){const s=[t];void 0!==e&&s.push(e);const n=new Ld(this.time,0,"_","handleModelEventInModel",s);this.controller.sendMessage(n)}}handleModelEventInView(t,e){Qc.write&&(e=this.debugWriteProxy(this,e,`event ${t} arg`)),se.handleEvent(t,e,(t=>function(t){if(!Jc)throw Error("VirtualMachine confusion");const e=Jc;try{Jc=null,t()}finally{Jc=e}}((()=>ce(this,t,!0)))))}handleViewEventInView(t,e){se.handleEvent(t,e)}handleTuttiDivergence(t,e){if(this.subscriptions[t])this.handleModelEventInModel(t,e);else{const s=t.split(":").slice(-1)[0];console.warn(`uncaptured divergence in ${s}:`,e)}}handleSessionDiverged(t){const{key:e,url:s}=t;this.diverged||(this.diverged=new Map);let n=this.diverged.get(e);n||this.diverged.set(e,n=[]),n.push(s),2===n.length&&this.controller&&!this.controller.fastForwardHandler&&this.debugDiverged(e)}debugDiverged(t){t||(t=this.diverged.keys().next().value);const e=this.diverged.get(t);if(!e||e.length<2)throw Error(`no diverged urls for snapshot ${t}`);Promise.resolve().then((()=>this.controller.diffDivergedSnapshots(e)))}processModelViewEvents(t){if(Jc)throw Error("cannot process view events in model code");return ce(this,(()=>se.processFrameEvents(t,!!this.controller.synced)))}handlePollForSnapshot(){const t=this.time,e=t-this.lastSnapshotPoll;e<5e3?console.log(`rejecting snapshot poll ${e}ms after previous`):(this.lastSnapshotPoll=t,this.controller.handlePollForSnapshot(t))}handleTuttiResult(t){this.controller.handleTuttiResult(t)}handleSnapshotVote(t){this.controller.handleSnapshotVote(t)}handlePersistVote(t){this.controller.handlePersistVote(t)}handleAuditRequest(t){this.controller.handleAuditRequest(t)}snapshot(){return Gd.newOrRecycled(this).snapshot(this,"VM")}getSummaryHash(){return V((new Sd).getHash(this))}debug(t){return this.controller.setDebug(t)}forceSnapshot(){this.controller.requestDebugSnapshot()}persist(t,e){this.controller&&"no.appId"===this.controller.sessionSpec.appId&&console.warn(`${qt.libName}: appId should be provided in Session.join() to not overwrite another apps's persistent data`);const s=Tt.begin("snapshot"),n="function"==typeof e?e.call(t):e;if("object"!=typeof n)throw Error(`${qt.libName}: persistSession() can only persist objects (got ${typeof n})`);const i=V(n),o=Ec.hash(i),r=Tt.end("snapshot")-s,a=this.persisted===o,l=this.time;var c,d;if(Qc.snapshot&&console.log(this.id,`persistent data @${l} collected, stringified and hashed in ${Math.ceil(r)}ms${a?" (unchanged, ignoring)":""}`),h.forcePersist&&queueMicrotask((()=>this.controller.forcePersist(l,i,o))),!a)if(c=this,d={persistTime:l,persistentString:i,persistentHash:o,ms:r},yd.set(c,d),this.persisted=o,this.inPersistenceCoolOff)Qc.snapshot&&console.log(this.id,"persistence poll postponed by cooloff");else{const t=this.lastPersistencePoll?this.lastPersistencePoll+25e3-this.time:0;t>0?(Qc.snapshot&&console.log(this.id,`postponing persistence poll by ${t}ms`),this.futureSend(t,"_","triggerPersistencePoll",[]),this.inPersistenceCoolOff=!0):this.triggerPersistencePoll()}}triggerPersistencePoll(){this.inPersistenceCoolOff=!1,this.lastPersistencePoll=this.controller?this.time:0;const t=(e=this,yd.get(e));var e;if(!t)return;const{persistTime:s,persistentString:n,persistentHash:i,ms:o}=t;if(gd(this),this.controller&&this.controller.synced){Qc.snapshot&&console.log(this.id,`asking controller to poll for persistence @${s}`);const t=this.time;Promise.resolve().then((()=>this.controller.pollForPersist(t,s,n,i,o)))}}random(){if(Jc!==this)throw Error("synchronized random accessed from outside the model");return this._random()}randomID(){if(Jc!==this)throw Error("synchronized random accessed from outside the model");let t="";for(let e=0;e<4;e++)t+=(this._random.int32()>>>0).toString(16).padStart(8,"0");return t}toString(){return`VirtualMachine[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}}function vd(t,e,s){let n;if("_"===t){const t=bd[e];"number"==typeof t&&(n=t.toString(36))}if(void 0===n&&(n=`${t}>${e}`),s.length>0){const t=Cd.newOrRecycled();n+=JSON.stringify(t.encode(s))}return n}function Xd(t,e){return(e-t|0)>=0}class Ld{constructor(t,e,s,n,i){this.time=t,this.seq=e,this.receiver=s,this.selector=n,this.args=i}before(t){return this.time!==t.time?this.time<t.time:this.isExternal()!==t.isExternal()?t.isExternal():this.isExternal()?Xd(this.externalSeq,t.externalSeq):Xd(this.internalSeq,t.internalSeq)}hasReceiver(t){return this.receiver===t}isExternal(){return 1&this.seq}get externalSeq(){return this.seq/2>>>0}set externalSeq(t){this.seq=2*t+1}get internalSeq(){return this.seq/2>>>0}set internalSeq(t){this.seq=2*t}asState(){return[this.time,this.seq,vd(this.receiver,this.selector,this.args)]}static fromState(t,e){const[s,n,i]=t,{receiver:o,selector:r,args:a}=function(t,e){let s,n,i;if(1===t.length||"["===t[1]){const e=parseInt(t[0],36);s="_",n=fd[e],i=t.slice(1)}else{const e=t.indexOf(">");let o=t.indexOf("[");-1===o&&(o=t.length),s=t.slice(0,e),n=t.slice(e+1,o),i=t.slice(o)}let o=[];i&&(o=kd.newOrRecycled(e).decode(JSON.parse(i)));return{receiver:s,selector:n,args:o}}(i,e);return new Ld(s,n,o,r,a)}executeOn(t,e=!1){t.currentEventFromModel=!this.isExternal();const s=e?t=>t():e=>md(t,(()=>le(t,e))),{receiver:n,selector:i,args:o}=this,r=t.lookUpModel(n);if(r)if("{"===i[0]){const e=t.compileFuncString(i,r);s((()=>{try{e(...o)}catch(t){Ht(`${this.shortString()} ${e}`,t)}}))}else i.indexOf(".")>=0?s((()=>{const t=i.indexOf("."),e=i.slice(0,t),s=i.slice(t+1);try{r.call(e,s,...o)}catch(t){Ht(`${this.shortString()} ${r}.call(${JSON.stringify(e)}, ${JSON.stringify(s)})`,t)}})):"function"!=typeof r[i]?Yt(`${this.shortString()} ${r}.${i}(): method not found`):s((()=>{try{if(dd(i)){const t=r[i];delete r[i],t(...o)}else r[i](...o)}catch(t){Ht(`${this.shortString()} ${r}.${i}()`,t)}}));else Yt(`${this.shortString()} ${i}(): receiver not found`)}shortString(){return(this.isExternal()?"External":"Future")+"Message"}toString(){const{receiver:t,selector:e,args:s}=this,n=this.isExternal(),i=n?this.externalSeq:this.internalSeq;return`${n?"External":"Future"}Message[${this.time}${":#"[+n]}${i} ${t}.${e}(${s.map(JSON.stringify).join(", ")})]`}[Symbol.toPrimitive](){return this.toString()}}const xd=(()=>{const t=new ArrayBuffer(8),e=new DataView(t);return t=>(e.setFloat64(0,t,!0),e.getInt32(0,!0)+e.getInt32(4,!0))})();class Sd{constructor(){this.done=new Set,this.todo=[],this.hashers=new Map,this.addHasher("Teatime:Message",Ld),this.addHasher("Teatime:Data",jc),this.addHasher("Teatime:QFunc",sd);for(const[t,e]of Hd.allClassTypes())this.addHasher(t,e)}addHasher(t,e){const{cls:s,write:n}=Object.getPrototypeOf(e)===Object.prototype?e:{cls:e,write:t=>({...t})};n&&this.hashers.set(s,(t=>this.hashStructure(t,n(t))))}getHash(t){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(const[e,s]of Object.entries(t))if("controller"!==e&&"meta"!==e)if("_random"===e)this.hash(s.state(),!1);else if("messages"===e){const t=s.asArray();(this.hashState.fC=t.length)&&this.hash(t,!1)}else this.hashEntry(e,s);return this.hashDeferred(),this.hashState}hashDeferred(){let t=0;for(;t<this.todo.length;){const{key:e,value:s}=this.todo[t++];this.hashEntry(e,s,!1)}this.todo.length=0}hash(t,e=!0){switch(typeof t){case"number":return void(Number.isNaN(t)?this.hashState.nanC++:Number.isFinite(t)?0===t?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=xd(t)):this.hashState.infC++);case"string":return this.hashState.sC++,void(this.hashState.sL+=t.length);case"boolean":case"undefined":return;case"bigint":if(0n===t)this.hashState.zC++;else{this.hashState.nC++;const e=t<0?-1n:0n;for(;t!==e;)this.hashState.nH+=Number(0xFFFFFFFFn&t),t>>=32n}return;default:{if(this.done.has(t))return;if(null===t)return;if(this.hashers.has(t.constructor))return void this.hashers.get(t.constructor)(t);const s=Object.prototype.toString.call(t).slice(8,-1);if(this.hashers.has(s))return void this.hashers.get(s)(t);switch(s){case"Array":return void this.hashArray(t,e);case"ArrayBuffer":return void this.hashIntArray(new Uint8Array(t));case"Set":return void this.hashStructure(t,[...t]);case"Map":return void this.hashStructure(t,[...t],!1);case"DataView":return void this.hashIntArray(new Uint8Array(t.buffer,t.byteOffset,t.byteLength));case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":return void this.hashIntArray(t);case"Float32Array":case"Float64Array":return void this.hashArray(t,!1);case"Object":t instanceof Hd?this.hashModel(t):t.constructor===Object&&this.hashObject(t,e)}}}}hashModel(t){this.hashState.mC++,this.done.add(t);for(const[e,s]of Object.entries(t))"__realm"!==e&&void 0!==s&&this.hashEntry(e,s)}hashObject(t,e=!0){this.hashState.oC++,this.done.add(t);for(const[s,n]of Object.entries(t))void 0!==n&&this.hashEntry(s,n,e)}hashArray(t,e=!0){this.done.add(t);for(let s=0;s<t.length;s++)this.hashEntry(s,t[s],e)}hashIntArray(t){this.done.add(t);for(let e=0;e<t.length;e++){const s=t[e];0===s?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=s)}}hashStructure(t,e,s=!0){void 0!==e&&(this.done.add(t),this.hash(e,s))}hashEntry(t,e,s=!0){"$"!==t[0]&&(s&&"object"==typeof e?this.todo.push({key:t,value:e}):this.hash(e,s))}}class Gd{static newOrRecycled(t){let e=this.reusableInstance;return e?(e.vm=t,e.nextRef=1,e.refs=new Map,e.todo=[]):e=this.reusableInstance=new this(t),e}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(t){this[this.name+"-instance"]=t}static resetInstance(){this.reusableInstance=null}constructor(t){this.vm=t,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter("Teatime:Message",Ld),this.addWriter("Teatime:Data",jc),this.addWriter("Teatime:QFunc",sd);for(const[t,e]of Hd.allClassTypes())this.addWriter(t,e);this.okayToIgnore={$debugWriteProxyHandler:!0};for(const t of Hd.allClasses())if(Object.prototype.hasOwnProperty.call(t,"okayToIgnore")){const e=t.okayToIgnore();if(!Array.isArray(e))throw new Error("okayToIgnore() must return an array");for(const t of e){if("$"!==t[0])throw Error(`okayToIgnore: ignored prop "${t}" must start with '$'`);this.okayToIgnore[t]=!0}}}addWriter(t,e){const s=Object.getPrototypeOf(e)===Object.prototype,{cls:n,write:i}=s?e:{cls:e,write:t=>({...t})};if(n===Object)throw Error(`${qt.libName} types: '${t}' is the Object class itself, must be a user class`);if(n===Array)throw Error(`${qt.libName} types: '${t}' is the Array class, must be a user class`);i?this.writers.set(n,((e,o)=>this.writeAs(t,e,i(e),s?`${o}.write(${n.name})`:o))):e.writeStatic||console.warn(`${qt.libName} types: ${t} does not implement write() or writeStatic()`)}snapshot(t,e){const s={_random:t._random.state(),messages:this.write(t.messages.asArray(),"FutureMessages"),subscribers:void 0,controller:void 0,$compiledFuncs:void 0};this.writeAllStaticInto(s);for(const[n,i]of Object.entries(t))n in s||this.writeInto(s,n,i,e);return this.writeDeferred(),delete s.controller,delete s.subscribers,delete s.$compiledFuncs,s}writeAllStaticInto(t){for(const e of Hd.allClasses())if(e!==Hd)for(const[s,n]of Object.entries(e)){if("$"===s[0])continue;const i=Hd.classToID(e);t.staticModelProps||(t.staticModelProps={}),i in t.staticModelProps||(t.staticModelProps[i]={}),this.writeInto(t.staticModelProps[i],s,n,`Model(${i}).static`),Id("Model",i)}for(const[e,s]of Hd.allClassTypes())if("object"==typeof s){const{writeStatic:n}=s;if(n){const s=n();s&&(t.staticTypeProps||(t.staticTypeProps={}),t.staticTypeProps[e]=this.write(s,`Type(${e}).writeStatic()`),Id("Type",e))}}}writeDeferred(){let t=0;for(;t<this.todo.length;){const{state:e,key:s,value:n,path:i}=this.todo[t++];this.writeInto(e,s,n,i,!1)}this.todo.length=0}write(t,e,s=!0){switch(typeof t){case"number":return Object.is(t,-0)?{$class:"NegZero"}:Number.isFinite(t)?t:Number.isNaN(t)?{$class:"NaN"}:{$class:"Infinity",$value:Math.sign(t)};case"string":case"boolean":return t;case"undefined":return{$class:"Undefined"};case"bigint":return{$class:"BigInt",$value:t.toString()};default:{if(this.refs.has(t))return this.writeRef(t);if(null===t)return t;if(this.writers.has(t.constructor))return this.writers.get(t.constructor)(t,e);const n=Object.prototype.toString.call(t).slice(8,-1);if(this.writers.has(n))return this.writers.get(n)(t,e);switch(n){case"Array":return this.writeArray(t,e,s);case"ArrayBuffer":return this.writeArrayBuffer(t);case"Set":return this.writeAs(n,t,[...t],e);case"Map":return this.writeAs(n,t,[...t].flat(),e);case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":return this.writeTypedArray(n,t);case"Object":if(t instanceof Hd)return this.writeModel(t,e);if(t.constructor===Object||"function"!=typeof t.constructor)return this.writeObject(t,e,s);throw console.warn(`${qt.libName}: unknown class at ${e}:`,t),Error(`${qt.libName}: class not registered in Model.types(): ${t.constructor.name}`);case"Function":if(t[$c])return this.writers.get($c)(t,e);throw console.warn(`${qt.libName}: found function at ${e}:`,t),Error(`${qt.libName}: cannot serialize functions except for QFuncs`);default:throw console.warn(`${qt.libName}: unsupported property at ${e}:`,t),Error(`${qt.libName}: serialization of ${n}s is not supported`)}}}}writeModel(t,e){const s={};this.refs.set(t,s);try{s.$model=Hd.classToID(t.constructor)}catch(s){throw console.error(`unregistered model class at ${e}:`,t),s}for(const e of Object.keys(t).sort()){if("__realm"===e)continue;const n=t[e];("number"==typeof n&&Number.isFinite(n)&&!Object.is(n,-0)||"string"==typeof n||"boolean"==typeof n)&&"$"!==e[0]?s[e]=n:this.writeInto(s,e,n,`${t}`,!0)}return s}writeObject(t,e,s=!0){const n={};this.refs.set(t,n);for(const i of Object.keys(t).sort()){const o=t[i];("number"==typeof o&&Number.isFinite(o)&&!Object.is(o,-0)||"string"==typeof o||"boolean"==typeof o)&&"$"!==i[0]?n[i]=o:this.writeInto(n,i,o,e,s)}return n}writeArray(t,e,s=!0){const n=[];this.refs.set(t,n);for(let i=0;i<t.length;i++){const o=t[i];"number"==typeof o&&Number.isFinite(o)&&!Object.is(o,-0)||"string"==typeof o||"boolean"==typeof o?n[i]=o:this.writeInto(n,i,o,e,s)}return n}writeArrayBuffer(t){const e={$class:"ArrayBuffer",$value:Md(t)};return this.refs.set(t,e),e}writeTypedArray(t,e){const s={$class:t,$value:[this.write(e.buffer),e.byteOffset,"DataView"===t?e.byteLength:e.length]};return this.refs.set(e,s),s}writeAs(t,e,s,n){const i={$class:t};this.refs.set(e,i);const o=this.write(s,n,!1);return"object"!=typeof o||null===o||o.$class||Array.isArray(o)?i.$value=o:Object.assign(i,o),i}writeRef(t){const e=this.refs.get(t);if("object"!=typeof e)throw Error("Non-object in refs: "+t);Array.isArray(e)&&(e.toJSON=function(){return{$id:this.$id,$class:"Array",$value:[...this]}});return{$ref:e.$id||(e.$id=this.nextRef++)}}writeInto(t,e,s,n,i=!0){if("$"===e[0])return void(this.okayToIgnore[e]||(Yt(`snapshot: ignoring property ${e} (declare as okayToIgnore to suppress warning)`,{only:"once"}),this.okayToIgnore[e]=!0));if(i&&"object"==typeof s)return void this.todo.push({state:t,key:e,value:s,path:n});const o=this.write(s,n+Oc(t,e));t[e]=o}}const Td=Symbol("croquet:unresolved");class Wd{static newOrRecycled(t){let e=this.reusableInstance;return e?(e.vm=t,e.refs=new Map,e.todo=[],e.unresolved=[],e.postprocess=[]):e=this.reusableInstance=new this(t),e}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(t){this[this.name+"-instance"]=t}static resetInstance(){this.reusableInstance=null}constructor(t){this.vm=t,this.refs=new Map,this.todo=[],this.forceNoDefer=!1,this.unresolved=[],this.postprocess=[],this.readers=new Map,this.addReader("Teatime:Message",Ld),this.addReader("Teatime:Data",jc),this.addReader("Teatime:QFunc",sd),this.readers.set("Undefined",(()=>{})),this.readers.set("NaN",(()=>NaN)),this.readers.set("Infinity",(t=>t*(1/0))),this.readers.set("NegZero",(()=>-0)),this.readers.set("BigInt",(t=>BigInt(t))),this.readers.set("ArrayBuffer",(t=>function(t){const e=globalThis.atob(t),s=e.length,n=new Uint8Array(s);for(let t=0;t<s;t++)n[t]=e.charCodeAt(t);return n.buffer}(t))),this.readers.set("DataView",(t=>new DataView(...t))),this.readers.set("Int8Array",(t=>new Int8Array(...t))),this.readers.set("Uint8Array",(t=>new Uint8Array(...t))),this.readers.set("Uint8ClampedArray",(t=>new Uint8ClampedArray(...t))),this.readers.set("Int16Array",(t=>new Int16Array(...t))),this.readers.set("Uint16Array",(t=>new Uint16Array(...t))),this.readers.set("Int32Array",(t=>new Int32Array(...t))),this.readers.set("Uint32Array",(t=>new Uint32Array(...t))),this.readers.set("Float32Array",(t=>new Float32Array(...t))),this.readers.set("Float64Array",(t=>new Float64Array(...t)));for(const[t,e]of Hd.allClassTypes())this.addReader(t,e)}addReader(t,e){let s=t=>Object.assign(Object.create(e.prototype),t);"object"==typeof e&&(s=e.read),this.readers.set(t,s)}enableBackwardCompatibility(t){const e=t?.meta?.sdk;if(!e)return;const[s,n,i,o]=e.split(/[-.+]/).map((t=>+t));let r=`${s}.${n}`;i&&(r+=`.${i}`),o&&(r+=`-${o}`),console.warn(`${qt.libName}: reading snapshot version ${r}`),this.compatMaps=s<1||1===s&&(n<1||1===n&&i<7)}readVM(t,e,s){if("VM"!==e)throw Error("VirtualMachine must be root object");s&&this.enableBackwardCompatibility(t);const n=this.read(t,e,!1);return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),this.readAllStatic(n),n}readDeferred(){let t=0;for(;t<this.todo.length;){const{object:e,key:s,value:n,path:i}=this.todo[t++];this.readInto(e,s,n,i,!1)}this.todo.length=0}resolveRefs(){for(const{object:t,key:e,ref:s,path:n}of this.unresolved){if(!this.refs.has(s))throw Error(`Unresolved ref: ${s} at ${n}[${JSON.stringify(e)}]`);t[e]=this.refs.get(s)}this.unresolved.length=0,this.refs.clear()}doPostprocess(){for(const t of this.postprocess)t();this.postprocess.length=0}readAllStatic(t){const{staticModelProps:e,staticTypeProps:s}=t,n=[];if(e){for(const[t,s]of Object.entries(e)){const e=Hd.classFromID(t);n.push((()=>Object.assign(e,s))),Id("Model",t)}delete t.staticModelProps}if(s){const e=Object.fromEntries(Hd.allClassTypes());for(const[t,i]of Object.entries(s)){const s=e[t];if("object"==typeof s){const t=s;n.push((()=>t.readStatic(i)))}else{const t=s;n.push((()=>Object.assign(t,i)))}Id("Type",t)}delete t.staticTypeProps}n.length&&(t.staticInitializers=n)}read(t,e,s=!0){switch(typeof t){case"number":case"string":case"boolean":return t;default:{const n=Object.prototype.toString.call(t).slice(8,-1);switch(n){case"Array":return this.readArray(t,e,s);case"Null":return null;case"Object":{const{$class:n,$model:i,$ref:o}=t;if(o)throw Error("refs should have been handled in readInto()");return i?this.readModel(t,e):n?this.readAs(n,t,e):this.readObject(Object,t,e,s)}default:throw Error(`Don't know how to deserialize ${n} at ${e}`)}}}}readModel(t,e){const s=Hd.instantiateClassID(t.$model,t.id);t.$id&&this.refs.set(t.$id,s);for(const[n,i]of Object.entries(t))"id"!==n&&"$"!==n[0]&&this.readInto(s,n,i,e);return s}readObject(t,e,s,n=!0){const i=new t;e.$id&&this.refs.set(e.$id,i);for(const[t,o]of Object.entries(e))"$"!==t[0]&&this.readInto(i,t,o,s,n);return i}readArray(t,e,s=!0){const n=[];t.$id&&this.refs.set(t.$id,n);for(let i=0;i<t.length;i++)void 0!==t[i]&&this.readInto(n,i,t[i],e,s);return n}readAsArray(t,e,s=!0){const n=t.$value;return t.$id&&(n.$id=t.$id),this.readArray(n,e,s)}readAsSet(t,e){const s=new Set;t.$id&&this.refs.set(t.$id,s);const n=this.unresolved.length,i=this.read(t.$value,e,!1),o=()=>{for(const t of i)s.add(t)};return this.unresolved.length===n?o():this.postprocess.push(o),s}readAsMap(t,e){const s=new Map;t.$id&&this.refs.set(t.$id,s);const n=this.unresolved.length,i=this.read(t.$value,e,!1),o=this.compatMaps?()=>{if(i.some((t=>2!==t.length)))console.warn("Deferring map resolution at",e),this.postprocess.push(o);else for(const[t,e]of i)s.set(t,e)}:()=>{for(let t=0;t<i.length;t+=2)s.set(i[t],i[t+1])};return this.unresolved.length===n?o():this.postprocess.push(o),s}readAsClass(t,e,s){let n={};const i=new Map,o=this.forceNoDefer;if(this.forceNoDefer=!0,"$value"in e)n=this.read(e.$value,s,!1);else for(const[t,o]of Object.entries(e)){if("$"===t[0])continue;const e=o&&o.$ref;e?this.refs.has(e)?n[t]=this.refs.get(e):(n[t]=Td,i.set(e,t)):this.readInto(n,t,o,s,!1)}this.forceNoDefer=o;const r=this.readers.get(t)(n,s);r||"Undefined"===t||"BigInt"===t||"NaN"===t||"NegZero"===t||console.warn(`Reading "${t}" returned ${r} at ${s}`),e.$id&&this.refs.set(e.$id,r);for(const[t,e]of i.entries())this.unresolved.push({object:r,key:e,ref:t,path:s});return r}readAs(t,e,s){switch(t){case"Array":return this.readAsArray(e,s);case"Set":return this.readAsSet(e,s);case"Map":return this.readAsMap(e,s);default:return this.readAsClass(t,e,s)}}readRef(t,e,s,n){if(!s||!s.$ref)return!1;const i=s.$ref;return this.refs.has(i)?t[e]=this.refs.get(i):(t[e]=Td,this.unresolved.push({object:t,key:e,ref:i,path:n})),!0}readInto(t,e,s,n,i=!0){this.readRef(t,e,s,n)||(!i||this.forceNoDefer||"object"!=typeof s?t[e]=this.read(s,n+Oc(t,e)):this.todo.push({object:t,key:e,value:s,path:n}))}}class Cd extends Gd{encode(t){const e=this.writeArray(t,"args");return this.writeDeferred(),e}writeModel(t){return{$ref:t.id}}}class kd extends Wd{decode(t){const e=this.readArray(t,"args");return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),e}resolveRefs(){for(const{object:t,key:e,ref:s,path:n}of this.unresolved)if(this.refs.has(s))t[e]=this.refs.get(s);else{const i=this.vm.lookUpModel(s);if(!i)throw Error(`Unresolved ref: ${s} at ${n}[${JSON.stringify(e)}]`);t[e]=i}}}const Pd=[Object,Array,Map,Set,BigInt,ArrayBuffer,DataView,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];function Vd(t,e,s,n){const i=Array.isArray(t)?t:t.constructor===Set?t.values():t.constructor===Map?t.entries():Object.values(t),o=[];for(const t of i)"object"!=typeof t||null===t||n.has(t)||(n.add(t),o.push(t));for(const t of o){if(Pd.includes(t.constructor))continue;const n=e+"."+t.constructor.name;if(s[n]){if(s[n]!==t.constructor)throw new Error("Class with name "+n+" already gathered, but new one has different identity")}else s[n]=t.constructor}for(const t of o)Vd(t,e,s,n)}function Id(t,e){const s=se.controllers.size;s>1&&Yt(`Static properties in shared ${t} ${e} can lead to divergence because ${s} ${qt.libName} sessions are running simultaneaously. Consider using wellKnownModel() instead.`,{only:"once"})}function Md(t){const e=new Uint8Array(t),s=[];for(let t=0;t<e.byteLength;t+=4096){const n=e.subarray(t,t+4096);s.push(String.fromCharCode.apply(null,n))}return globalThis.btoa(s.join(""))}const Rd={classes:h.has("debug","classes")};let Yd=Symbol("SECRET");const Nd=new WeakSet;class Hd{static create(...t){if(!Fd(this))throw Error(`Model class "${this.name}" not registered`);const e=this,s=this.createNoInit();return!this.wellKnownModel("modelRoot")&&(s.beWellKnownAs("modelRoot"),s.__realm.vm.debugEvents&&this.eventDebugInit(s)),Nd.add(s),s.init(...t),Nd.has(s)&&(Nd.delete(s),Object.getPrototypeOf(e)!==Hd&&console.warn(`${s} did not call super.init(options)`)),s}static createNoInit(t){const e=ae(),s=new this(Yd);return t||(t=e.register(s)),void 0===Rd.write&&(Rd.write=h.has("debug","write"),Rd.publish=h.has("debug","publish"),Rd.events=h.has("debug","events")),Object.defineProperty(s,"__realm",{value:e,writable:Rd.write}),Object.defineProperty(s,"id",{value:t,enumerable:!0}),s}static allowConstructors(){Yd=void 0,console.warn("disabling error reporting for Model constructors")}static register(t){return t||(t=this.name,console.warn(`Deprecation warning: ${this.name}.register(classId) called without classId. See https://croquet.io/docs/croquet/Model.html#.register`)),Wd.resetInstance(),Gd.resetInstance(),Cd.resetInstance(),kd.resetInstance(),function(t,e){const s=D(t),n=q(`${e}:${s}`);tt.push(n),n.then((t=>A[t].what=`Class ${e}`))}(this,t),function(t,e){const s=Kd[e];if(s&&s!==t)throw Error(`Registering model class ${t.name} failed, id "${e}" already used by ${s.name}`);Fd(t)?Rd.classes&&!s&&console.warn(`ignoring re-exported model class ${e}`):(Rd.classes&&console.log(`registering model class ${e}`),t[_d]=e);Kd[e]=t}(this,t),Hd.lastRegistered=this,this}static wellKnownModel(t){if(!Zd.hasCurrent())throw Error("static Model.wellKnownModel() called from outside model");return Zd.current().get(t)}static evaluate(t){return Zd.evaluate(t)}static isExecuting(){return Zd.hasCurrent()}static types(){return{}}static gatherClassTypes(t,e){const s={};return Vd({root:t},e,s,new Set),s}static eventDebugOptions(){return Rd}static eventDebugInit(t){t.subscribe("*","*",t.createQFunc('\n        function logEvents(data) {\n            // do this now to have no side effects below\n            const { scope, event, source } = this.activeSubscription;\n            // below stuff is outside the model. Must not have any side effects!\n            const debug = this.constructor.eventDebugOptions();\n            if (!debug.events && !debug.publish) return;\n            const action = source === "model" ? "publish" : "receive";\n            const emoji = source === "model" ? "" : "";\n            console.log(`${emoji} @${this.now()} Model ${action} ${scope}:${event}`, data);\n        }\n        '))}static okayToIgnore(){return[]}static classToID(t){return function(t){if(Fd(t))return t[_d];const e=t.name||"ClassName";throw Error(`Model class not registered, did you call ${e}.register("${e}")?`)}(t)}static classFromID(t){return Ed(t)}static allClasses(){return zd()}static allClassTypes(){return function(){const t={};for(const e of zd())Object.assign(t,e.types());return Object.entries(t)}()}static instantiateClassID(t,e){return Ed(t).createNoInit(e)}constructor(t){if(t!==Yd)throw Error(`You must create ${App.libName} Models using create() not "new"!`)}init(t,e){Nd.delete(this)}destroy(){ae().unsubscribeAll(this),ae().deregister(this)}publish(t,e,s){this.__realm||this.__realmError(),this.__realm.publish(e,s,t)}subscribe(t,e,s){return this.__realm||this.__realmError(),this.__realm.subscribe(this,t,e,s)}unsubscribe(t,e,s="*"){this.__realm||this.__realmError(),this.__realm.unsubscribe(this,t,e,s)}unsubscribeAll(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}get activeSubscription(){if(!Zd.hasCurrent())return;const{currentEvent:t,currentEventFromModel:e}=Zd.current();if(!t)return;const[s,n]=t.split(":");return{scope:s,event:n,source:e?"model":"view"}}__realmError(){if(!this.id)throw Error(`${this} has no ID, did you call super.init(options)?`)}future(t=0,e=void 0,...s){return this.__realm||this.__realmError(),this.__realm.future(this,t,e,s)}cancelFuture(t){return this.__realm||this.__realmError(),this.__realm.cancelFuture(this,t)}random(){return ae().random()}now(){return ae().now()}beWellKnownAs(t){ae().vm.set(t,this)}getModel(t){return this.__realm.vm.lookUpModel(t)}wellKnownModel(t){return this.__realm.vm.get(t)}modelOnly(t){if(Zd.current()===this.__realm.vm)return!0;const e=Error(t||`${this}.modelOnly() called from outside a model!`);throw Ht("view code",e),e}get sessionId(){return this.__realm.vm.id}get viewCount(){return Object.keys(this.__realm.vm.views).length}createQFunc(t,e){return void 0===e&&(e=t,t={}),qc(this,t,e)}persistSession(t){if(this!==this.wellKnownModel("modelRoot"))throw Error("persistSession() must only be called on the root model");this.__realm.vm.persist(this,t)}[Symbol.toPrimitive](){return`${this.constructor[_d]||this.constructor.name}#${this.id}`}}const Kd={},_d=Symbol("CLASS_ID");function zd(){return Object.values(Kd)}function Fd(t){return Object.prototype.hasOwnProperty.call(t,_d)}function Ed(t){if(Kd[t])return Kd[t];throw Error(`Model class "${t}" in snapshot, but not registered?`)}const jd="Croquet.Model";let Jd;Hd[_d]=jd,Kd[jd]=Hd;class Qd{static displayStatus(t,e){return Nt(t,e)}static displayWarning(t,e){return Yt(t,e)}static displayError(t,e){return function(t,e={}){return t&&qt.showMessage(t,{...e,level:"error"})}(t,e)}constructor(t){"object"==typeof t&&"__realm"in t||console.warn(`${qt.libName}: argument to View constructor needs to be a Model`);let e=ae("");e&&e.isViewRealm()||(e=ce(t.__realm.vm,(()=>ae()),!0)),Object.defineProperty(this,"realm",{value:e}),Object.defineProperty(this,"id",{value:e.register(this),configurable:!0});const s=e.controller.session;if(s.view||(s.view=this),Jd||(Jd={events:h.has("debug","events"),publish:h.has("debug","publish")}),s.view===this&&(Jd.events||Jd.publish)){const t=t=>{if(!e.vm.debugEvents)return;const{scope:s,event:n,source:i,subscribed:o}=this.activeSubscription;if(!o&&!Jd.publish)return;const r="view"===i?"publish":"receive",a="view"===i?"":"",l=o||"publish"===r?"":" (no subscribers)";console.log(`${a} View ${r} ${s}:${n}${l}`,t)},s=e=>"view"===this.activeSubscription.source&&t(e),n=e=>"model"===this.activeSubscription.source&&t(e);s.__CROQUET__=!0,n.__CROQUET__=!0,this.subscribe("*",{event:"*",handling:"queued"},n),this.subscribe("*",{event:"*",handling:"immediate"},s)}}detach(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,"id",{value:""})}reattach(){Object.defineProperty(this,"id",{value:this.realm.register(this)})}publish(t,e,s){this.realm.publish(e,s,t)}subscribe(t,e,s){if("string"==typeof s&&(s=this[s]),"function"!=typeof s)throw Error(`${qt.libName}: subscribe() handler is not a function`);const n=s;(s=n.bind(this)).unbound=n;const{event:i,handling:o}=e.event?e:{event:e};this.realm.subscribe(i,this.id,s,t,o)}unsubscribe(t,e,s=null){"string"==typeof s&&(s=this[s]),this.realm.unsubscribe(e,this.id,s,t)}unsubscribeAll(){this.realm.unsubscribeAll(this.id)}get activeSubscription(){const{currentEvent:t,currentEventFromModel:e,currentEventOnlyGeneric:s}=se;if(!t)return;const[n,i]=t.split(":");return{scope:n,event:i,source:e?"model":"view",subscribed:!s}}future(t=0){return this.realm.future(this,t)}random(){return ae().random()}now(){return this.realm.now()}externalNow(){return this.realm.externalNow()}extrapolatedNow(){return this.realm.extrapolatedNow()}update(t){}wellKnownModel(t){return this.realm.vm.get(t)}get sessionId(){return this.realm.controller.sessionSpec.id}get session(){if(this.id&&this.realm.valid())return this.realm.controller.session}get viewId(){return this.realm.controller.viewId}[Symbol.toPrimitive](){const t=this.constructor.name;return t.includes("View")?t:`${t}[View]`}}const Ud=new class{constructor(){this.ready=!1,this.isInIframe=window.top!==window,this.subscriptions={},this.enumerator=null}setReceiver(t){this.receiver=t,this.ready=!0}setIframeEnumerator(t){this.enumerator=t}on(t,e){if(!this.receiver)throw Error("setReceiver() has not been called");if("string"==typeof e&&(e=this.receiver[e]),!e)throw Error("Messenger.on: the second argument must be a method name or a function");if(this.subscriptions[t]){if(this.findIndex(this.subscriptions[t],e)>=0)throw Error(`${e} is already subscribed`)}else this.subscriptions[t]=[];this.subscriptions[t].push(e),this.listener||(this.listener=t=>this.receive(t),window.addEventListener("message",this.listener))}detach(){this.listener&&(window.removeEventListener("message",this.listener),this.listener=null),this.stopPublishingPointerMove(),this.receiver=null,this.subscriptions={},this.enumerator=null,this.ready=!1}removeSubscription(t,e){"string"==typeof e&&(e=this.receiver[e]);const s=this.subscriptions[t];if(s){const n=this.findIndex(s,e);s.splice(n,1),0===s.length&&delete this.subscriptions[t]}}removeAllSubscriptions(){this.subscriptions={}}receive(t){const{event:e,data:s}=t.data,n=t.source;this.handleEvent(e,s,n)}handleEvent(t,e,s){const n=this.subscriptions[t];n&&n.forEach((t=>{t.call(this.receiver,e,s)}))}send(t,e,s){if(this.isInIframe)return void window.top.postMessage({event:t,data:e},"*");if(s)return void s.postMessage({event:t,data:e},"*");if(!this.enumerator)return;this.enumerator().forEach((s=>{s.contentWindow.postMessage({event:t,data:e},"*")}))}findIndex(t,e){const s=e.name;return t.findIndex((t=>{const n=t.name;return s||n?s===n:e===t}))}startPublishingPointerMove(){this._moveHandler||(this._moveHandler=t=>this.send("pointerPosition",{x:t.clientX,y:t.clientY,type:t.type}),window.document.addEventListener("pointermove",this._moveHandler,!0))}stopPublishingPointerMove(){this._moveHandler&&(window.document.removeEventListener("pointermove",this._moveHandler,!0),this._moveHandler=null)}},Dd="node"===r.CROQUET_PLATFORM;let Od=60;class Bd{static async join(t){try{return await this.join_impl(t)}catch(t){throw qt.showMessage(t.message||t,{level:"fatal"}),t}}static async join_impl(t){t.appId||(t.appId="no.appId"),t.name||(t.name=qt.autoSession(),t.password||(t.password=qt.autoPassword())),t.model||(t.model=Hd.lastRegistered),t.view||(t.view=Qd);const e=[];for(const[m,p]of Object.entries(t))p instanceof Promise&&e.push(p.then((e=>t[m]=e)));function s(t,e){return t===e||t.prototype instanceof e}if(await Promise.all(e),t.box){if("string"!=typeof t.box)throw Error(`${qt.libName}: box must be a string in Session.join()!`);if(!t.box.includes("/"))throw Error(`${qt.libName}: box must be a (partial) URL in Session.join()!`)}else if(!t.reflector||!t.files){if("string"!=typeof t.apiKey)throw Error(`${qt.libName}: no apiKey provided in Session.join()!`);if(t.apiKey.length>128)throw Error(`${qt.libName}: apiKey > 128 characters in Session.join()!`)}if("string"!=typeof t.name)throw Error(`${qt.libName}: no session name provided in Session.join()!`);if(t.name.length>128)throw Error(`${qt.libName}: session name > 128 characters in Session.join()!`);const n=t.model;if("function"!=typeof n||!s(n,Hd))throw Error(`${qt.libName}: bad model class in Session.join()`);const i=t.view||Qd;if("function"!=typeof i||!s(i,Qd))throw Error(`${qt.libName}: bad view class in Session.join()`);if("string"!=typeof t.appId)throw Error(`${qt.libName}: no appId provided in Session.join()`);if(!t.appId.length>128)throw Error(`${qt.libName}: appId > 128 characters in Session.join()`);if(!t.appId.match(/^[a-z](-?[a-z0-9_])*(\.[a-z0-9_](-?[a-z0-9_])*)+$/i))throw Error(`${qt.libName}: malformed appId in Session.join()`);if("string"!=typeof t.password||!t.password)throw Error(`${qt.libName}: no password provided in Session.join()`);for(const f of["reflector","synchronizer","files","backend","box"]){const b=h[f]||t[f];void 0!==b&&(h[f]=b)}if(Dd&&"manual"!==t.step)throw Error("stepping must be manual in a Node.js app");if("rejoinLimit"in t){if("number"!=typeof t.rejoinLimit||t.rejoinLimit<0||t.rejoinLimit>6e4)throw Error("rejoinLimit range: 0-60000")}else t.rejoinLimit=1e3;if("eventRateLimit"in t){if("number"!=typeof t.eventRateLimit||t.eventRateLimit<1||t.eventRateLimit>60)throw Error("eventRateLimit range: 1-60")}else t.eventRateLimit=20;if(t.heraldUrl){if(t.heraldUrl.length>256)throw Error("heraldUrl can only be 256 characters");if(!t.heraldUrl.startsWith("https://"))throw Error("heraldUrl needs to be https")}if(t.hashOverride){if(43!==t.hashOverride.length)throw Error("hashOverride must be 43 characters");if(-1!==t.hashOverride.search(/[^-_a-zA-Z0-9]/))throw Error("hashOverride must be base64url encoded")}if(t.debug){function y(t){return"string"==typeof t&&(t=t.split(",")),t?Array.isArray(t)?t:[t]:[]}h.debug=[...y(t.debug),...y(h.debug)].join(",")}if("autoSleep"in t){const g=t.autoSleep,w=typeof g;if("number"===w){if(g<0)throw Error("an autoSleep value must be >= 0")}else{if("boolean"!==w)throw Error("autoSleep must be numeric or boolean");t.autoSleep=g?10:0}}else t.autoSleep=10;if(t.flags){let Z=t.flags;"string"==typeof Z&&(Z=Z.split(",")),Z=Z?Array.isArray(Z)?Z:[Z]:[],Z=Z.filter((t=>"object"!=typeof t)),Z.length?(t.flags={},Z.forEach((e=>t.flags[e]=!0))):t.flags=null}"expectedSimFPS"in t&&(Od=Math.min(t.expectedSimFPS,120));const o=["name","password","apiKey","appId","tps","autoSleep","heraldUrl","rejoinLimit","eventRateLimit","optionsFromUrl","persistentIdOptions","viewOptions","viewData","viewIdDebugSuffix","hashOverride","location","flags","progressReporter"];!function(){if(Object.isFrozen(Ad))return;$d(Ad),function(t){const e=JSON.stringify(t,((t,e)=>"function"==typeof e?D(e):e));if("{}"===e)return;const s=JSON.parse(e),n=q(V(s));tt.push(n),n.then((t=>A[t].what=`${qt.libName} Constants`))}(Ad)}();const r=new Pc,a=JSON.parse(JSON.stringify({...t.options}));if(t.persistentIdOptions){if(!Array.isArray(t.persistentIdOptions))throw Error("persistentIdOptions must be an array");for(const v of t.persistentIdOptions)if(!(v in a))throw Error(`persistentIdOptions key "${v}" not found in options`)}const l={id:"",persistentId:"",versionId:"",name:t.name,model:null,view:null,step(t){r.stepSession("animation",{frameTime:t,view:l.view,expectedSimFPS:Od})},leave:()=>Bd.leave(l.id),data:{store:(t,e)=>Ec.store(t,{...e,sessionId:l.id}),fetch:(t,e)=>Ec.fetch(t,{...e,sessionId:l.id}),hash:t=>Ec.hash(t),toId:t=>Ec.toId(t),fromId:t=>Ec.fromId(t)},get latency(){return r.latency},get latencies(){return r.latencies}};"undefined"!=typeof __CROQUET_DEVTOOLS__&&__CROQUET_DEVTOOLS__.dispatchEvent(new CustomEvent("session",{detail:{session:l,controller:r}}));const c={options:a,initFn:(t,e)=>n.create(t,e),rebootModelView:u};for(const[X,L]of Object.entries(t))o.includes(X)&&(c[X]=L);await r.initFromSessionSpec(c);let d=!1;return await u(),"manual"!==t.step&&r.startStepping(l.step),l;async function u(){!function(){l.model=null,l.view&&(h.has("debug","session",!1)&&console.log(l.id,"detaching root view"),l.view.detach(),""!==l.view.id&&console.warn(`${qt.libName}: ${l.view} did not call super.detach()`),l.view=null);qt.clearSessionMoniker(),Ud.ready&&Ud.detach()}(),r.leaving?r.leaving(!0):d||(d=!0,await r.establishSession(c),d=!1,l.model=r.vm.get("modelRoot"),l.id=r.id,l.persistentId=r.persistentId,l.versionId=r.versionId,r.session=l,qt.makeSessionWidgets(l.id),r.inViewRealm((()=>{h.has("debug","session",!1)&&console.log(l.id,"creating root view"),new i(l.model,c.viewOptions)})))}}static async leave(t){const e=function(t){for(const e of Cc)if(e.id===t)return e;return null}(t);if(!e)return!1;e.reconnectTimeout&&(clearTimeout(e.reconnectTimeout),delete e.reconnectTimeout);const s=new Promise((t=>e.leaving=t)),n=e.connection;return!!n.connected&&(n.closeConnection(1e3),s)}static thisSession(){const t=Zd.current();return t?t.id:""}get id(){return""}get persistentId(){return""}get versionId(){return""}get name(){return""}get data(){return{}}step(t){}leave(){}}const Ad={};function $d(t){if(!Object.isFrozen(t)){Object.freeze(t);for(const e of Object.values(t))!e||"object"!=typeof e&&"function"!=typeof e||$d(e)}}const qd={Model:Hd,View:Qd,Session:Bd,Data:Ec,Constants:Ad,App:qt,Messenger:Ud,VERSION:cc};return Hd.Croquet=qd,Qd.Croquet=qd,"undefined"!=typeof __CROQUET_DEVTOOLS__&&__CROQUET_DEVTOOLS__.dispatchEvent(new CustomEvent("load",{detail:{version:cc}})),"undefined"!=typeof globalThis&&(globalThis.__CROQUET__?console.warn("WARNING: Multiple instances of Croquet being imported."):globalThis.__CROQUET__=cc),t.App=qt,t.Constants=Ad,t.Data=Ec,t.Messenger=Ud,t.Model=Hd,t.Session=Bd,t.VERSION=cc,t.View=Qd,t}({});
//# sourceMappingURL=croquet.min.js.map
